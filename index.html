<!DOCTYPE html><html lang="zh-CN" data-et-theme="dark"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><script>!function(){try{var t=localStorage.getItem("et_theme");!t||"dark"!==t&&"light"!==t||document.documentElement.setAttribute("data-et-theme",t)}catch(t){}}()</script><link rel="icon" href="data:image/svg+xml,%3Csvg%20xmlns%3D'http%3A//www.w3.org/2000/svg'%20viewBox%3D'0%200%2064%2064'%20shape-rendering%3D'geometricPrecision'%3E%3Cdefs%3E%3ClinearGradient%20id%3D'g'%20x1%3D'0'%20y1%3D'0'%20x2%3D'1'%20y2%3D'1'%3E%3Cstop%20offset%3D'0'%20stop-color%3D'%2338bdf8'/%3E%3Cstop%20offset%3D'1'%20stop-color%3D'%236366f1'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect%20x%3D'6'%20y%3D'6'%20width%3D'52'%20height%3D'52'%20rx%3D'14'%20fill%3D'%23050816'%20stroke%3D'url(%23g)'%20stroke-width%3D'5'/%3E%3Cpath%20d%3D'M26%2021%20L16.5%2032%20L26%2043'%20fill%3D'none'%20stroke%3D'url(%23g)'%20stroke-width%3D'5'%20stroke-linecap%3D'round'%20stroke-linejoin%3D'round'/%3E%3Cpath%20d%3D'M38%2021%20L47.5%2032%20L38%2043'%20fill%3D'none'%20stroke%3D'url(%23g)'%20stroke-width%3D'5'%20stroke-linecap%3D'round'%20stroke-linejoin%3D'round'/%3E%3Cpath%20d%3D'M35%2019%20L29%2045'%20fill%3D'none'%20stroke%3D'url(%23g)'%20stroke-width%3D'5'%20stroke-linecap%3D'round'%20stroke-linejoin%3D'round'/%3E%3C/svg%3E"><title>EasyTools · 开发者工具箱</title><style>:root{--bg:#050816;--bg-glass:rgba(5, 8, 22, 0.7);--bg-2:#0b1220;--panel:rgba(255, 255, 255, 0.03);--panel-strong:rgba(255, 255, 255, 0.06);--panel-glass:rgba(20, 30, 50, 0.5);--panel-gradient:linear-gradient(145deg, rgba(255, 255, 255, 0.05) 0%, rgba(255, 255, 255, 0.01) 100%);--border:rgba(255, 255, 255, 0.08);--accent:#38bdf8;--accent-2:#7dd3fc;--success:#22c55e;--warn:#f97316;--danger:#ef4444;--text:#f8fafc;--muted:rgba(248, 250, 252, 0.75);--text-muted:var(--muted);--shadow:0 4px 6px -1px rgba(0, 0, 0, 0.5);--shadow-soft:0 2px 8px rgba(0, 0, 0, 0.25);--shadow-strong:0 16px 40px rgba(0, 0, 0, 0.35);--glow-accent:0 0 0 2px rgba(56, 189, 248, 0.28),0 0 24px rgba(56, 189, 248, 0.12);--spotlight-1:rgba(56, 189, 248, 0.12);--spotlight-2:rgba(125, 211, 252, 0.06);--code-font:"JetBrains Mono","SFMono-Regular",Consolas,"Liberation Mono",Menlo,monospace;--code-size:0.875rem;--radius-control:6px;--control-padding:0.5rem 0.8rem;--control-font-size:0.9rem;--control-height:36px;--app-padding:12px;font-synthesis:none}:root[data-et-theme=light]{--bg:#f8fafc;--bg-glass:rgba(248, 250, 252, 0.85);--bg-2:#ffffff;--panel:rgba(241, 245, 249, 0.75);--panel-strong:rgba(226, 232, 240, 0.75);--panel-gradient:linear-gradient(145deg, rgba(255, 255, 255, 0.85) 0%, rgba(241, 245, 249, 0.75) 100%);--border:#cbd5e1;--text:#0f172a;--muted:#64748b;--accent:#0284c7;--accent-2:#0ea5e9;--success:#16a34a;--warn:#ea580c;--danger:#dc2626;--shadow:0 4px 6px -1px rgba(0, 0, 0, 0.1);--shadow-soft:0 2px 10px rgba(2, 6, 23, 0.12);--shadow-strong:0 18px 44px rgba(2, 6, 23, 0.18);--glow-accent:0 0 0 2px rgba(2, 132, 199, 0.22),0 0 20px rgba(14, 165, 233, 0.12);--spotlight-1:rgba(2, 132, 199, 0.10);--spotlight-2:rgba(14, 165, 233, 0.05)}:root[data-et-theme=dracula]{--bg:#282a36;--bg-glass:rgba(40, 42, 54, 0.85);--bg-2:#44475a;--panel:rgba(255, 255, 255, 0.05);--panel-strong:rgba(255, 255, 255, 0.1);--panel-gradient:linear-gradient(145deg, rgba(255, 255, 255, 0.08) 0%, rgba(255, 255, 255, 0.03) 100%);--border:#6272a4;--text:#f8f8f2;--muted:#6272a4;--accent:#bd93f9;--accent-2:#ff79c6;--success:#50fa7b;--warn:#ffb86c;--danger:#ff5555;--shadow:0 4px 6px -1px rgba(0, 0, 0, 0.5)}:root[data-et-theme=forest]{--bg:#0f1713;--bg-glass:rgba(15, 23, 19, 0.85);--bg-2:#182620;--panel:rgba(255, 255, 255, 0.04);--panel-strong:rgba(255, 255, 255, 0.08);--panel-gradient:linear-gradient(145deg, rgba(255, 255, 255, 0.06) 0%, rgba(255, 255, 255, 0.02) 100%);--border:#2d4a3e;--text:#e0eadd;--muted:#6b8c7e;--accent:#4ade80;--accent-2:#22c55e;--success:#22c55e;--warn:#f59e0b;--danger:#f87171;--shadow:0 4px 6px -1px rgba(0, 0, 0, 0.5)}:root[data-et-theme=warm]{--bg:#fdf6e3;--bg-glass:rgba(253, 246, 227, 0.9);--bg-2:#eee8d5;--panel:#f5efdc;--panel-strong:#ebe5ce;--panel-gradient:linear-gradient(145deg, #fdf6e3 0%, #f5efdc 100%);--border:#d6d0b8;--text:#586e75;--muted:#93a1a1;--accent:#268bd2;--accent-2:#2aa198;--success:#859900;--warn:#cb4b16;--danger:#dc322f;--shadow:0 4px 6px -1px rgba(0, 0, 0, 0.1)}:root[data-et-theme=neon]{--bg:#03030a;--bg-glass:rgba(5, 5, 20, 0.9);--bg-2:#050618;--panel:rgba(10, 10, 50, 0.8);--panel-strong:rgba(45, 12, 120, 0.65);--panel-gradient:radial-gradient(circle at top, rgba(124, 58, 237, 0.5), transparent 45%);--border:rgba(124, 58, 237, 0.5);--text:#f7f3ff;--muted:rgba(247, 243, 255, 0.7);--accent:#7c3aed;--accent-2:#14b8a6;--success:#22c55e;--warn:#f472b6;--danger:#fb7185;--shadow:0 10px 35px rgba(7, 6, 20, 0.8);--glow-accent:0 0 18px rgba(124, 58, 237, 0.35),0 0 40px rgba(20, 184, 166, 0.25);--spotlight-1:rgba(124, 58, 237, 0.35);--spotlight-2:rgba(14, 184, 201, 0.12)}:root[data-et-theme=cosmic]{--bg:#041120;--bg-glass:rgba(4, 17, 32, 0.85);--bg-2:#061623;--panel:rgba(7, 16, 33, 0.65);--panel-strong:rgba(43, 108, 231, 0.35);--panel-gradient:linear-gradient(145deg, rgba(10, 33, 91, 0.85) 0%, rgba(3, 20, 40, 0.95) 100%);--border:rgba(59, 130, 246, 0.4);--text:#e2ecff;--muted:rgba(226, 236, 255, 0.75);--accent:#22d3ee;--accent-2:#6366f1;--success:#34d399;--warn:#facc15;--danger:#fb7185;--shadow:0 10px 40px rgba(3, 10, 25, 0.85);--glow-accent:0 0 24px rgba(34, 211, 238, 0.25),inset 0 0 20px rgba(99, 102, 241, 0.2);--spotlight-1:rgba(34, 211, 238, 0.22);--spotlight-2:rgba(99, 102, 241, 0.12)}:root[data-et-theme=monokai]{--bg:#272822;--bg-glass:rgba(39, 40, 34, 0.86);--bg-2:#2d2e27;--panel:rgba(255, 255, 255, 0.04);--panel-strong:rgba(255, 255, 255, 0.08);--panel-gradient:linear-gradient(145deg, rgba(255, 255, 255, 0.07) 0%, rgba(255, 255, 255, 0.02) 100%);--border:rgba(255, 255, 255, 0.12);--text:#f8f8f2;--muted:rgba(248, 248, 242, 0.72);--accent:#f92672;--accent-2:#a6e22e;--success:#a6e22e;--warn:#fd971f;--danger:#ff6b6b;--shadow:0 10px 35px rgba(0, 0, 0, 0.7);--glow-accent:0 0 18px rgba(249, 38, 114, 0.25),0 0 40px rgba(166, 226, 46, 0.18);--spotlight-1:rgba(249, 38, 114, 0.18);--spotlight-2:rgba(166, 226, 46, 0.10)}:root[data-et-theme=nord]{--bg:#2e3440;--bg-glass:rgba(46, 52, 64, 0.85);--bg-2:#3b4252;--panel:rgba(255, 255, 255, 0.04);--panel-strong:rgba(255, 255, 255, 0.08);--panel-gradient:linear-gradient(145deg, rgba(216, 222, 233, 0.10) 0%, rgba(59, 66, 82, 0.25) 100%);--border:rgba(216, 222, 233, 0.18);--text:#e5e9f0;--muted:rgba(229, 233, 240, 0.72);--accent:#88c0d0;--accent-2:#81a1c1;--success:#a3be8c;--warn:#ebcb8b;--danger:#bf616a;--shadow:0 10px 35px rgba(0, 0, 0, 0.55);--glow-accent:0 0 18px rgba(136, 192, 208, 0.20),0 0 36px rgba(129, 161, 193, 0.16);--spotlight-1:rgba(136, 192, 208, 0.14);--spotlight-2:rgba(129, 161, 193, 0.08)}:root[data-et-theme=synthwave]{--bg:#090014;--bg-glass:rgba(9, 0, 20, 0.86);--bg-2:#16002b;--panel:rgba(255, 255, 255, 0.04);--panel-strong:rgba(255, 45, 149, 0.15);--panel-gradient:radial-gradient(circle at 20% 15%, rgba(255, 45, 149, 0.30), transparent 55%),radial-gradient(circle at 85% 0%, rgba(34, 211, 238, 0.18), transparent 60%);--border:rgba(255, 45, 149, 0.35);--text:#f5f3ff;--muted:rgba(245, 243, 255, 0.72);--accent:#ff2d95;--accent-2:#22d3ee;--success:#34d399;--warn:#facc15;--danger:#fb7185;--shadow:0 10px 40px rgba(0, 0, 0, 0.75);--glow-accent:0 0 22px rgba(255, 45, 149, 0.22),0 0 44px rgba(34, 211, 238, 0.14);--spotlight-1:rgba(255, 45, 149, 0.20);--spotlight-2:rgba(34, 211, 238, 0.12)}:root[data-et-theme=matrix]{--bg:#020b02;--bg-glass:rgba(2, 11, 2, 0.86);--bg-2:#071707;--panel:rgba(13, 32, 13, 0.55);--panel-strong:rgba(34, 197, 94, 0.16);--panel-gradient:radial-gradient(circle at 15% 20%, rgba(34, 197, 94, 0.22), transparent 55%);--border:rgba(34, 197, 94, 0.35);--text:#eaffea;--muted:rgba(234, 255, 234, 0.70);--accent:#22c55e;--accent-2:#86efac;--success:#86efac;--warn:#facc15;--danger:#fb7185;--shadow:0 10px 35px rgba(0, 0, 0, 0.75);--glow-accent:0 0 18px rgba(34, 197, 94, 0.22),inset 0 0 22px rgba(134, 239, 172, 0.12);--spotlight-1:rgba(34, 197, 94, 0.18);--spotlight-2:rgba(134, 239, 172, 0.08)}.tree-row.search-focus{background-color:rgba(56,189,248,.15);transition:background-color .3s;border-radius:4px}#json-search-case.active,#xml-search-case.active{background-color:var(--accent);color:#fff;border-color:var(--accent)}.highlight-match{background-color:rgba(255,255,0,.3);border-radius:2px;color:var(--text)}@keyframes flash-highlight{0%{transform:scale(1);box-shadow:0 0 0 0 rgba(255,165,0,.7)}50%{transform:scale(1.2);box-shadow:0 0 15px 5px rgba(255,165,0,.5)}100%{transform:scale(1);box-shadow:0 0 0 0 rgba(255,165,0,0)}}.highlight-current{background-color:var(--warn);color:#fff;animation:flash-highlight .4s ease-out;box-shadow:0 0 8px var(--warn);z-index:1;position:relative;border-radius:3px;padding:0 2px}[data-et-theme=light] .highlight-match{background-color:rgba(255,215,0,.5);color:#000}.context-menu{position:fixed;background:var(--bg-2);border:1px solid var(--border);border-radius:8px;padding:5px;z-index:9999;box-shadow:0 8px 24px rgba(0,0,0,.5),0 2px 6px rgba(0,0,0,.2);backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);min-width:160px;animation:menu-in .12s cubic-bezier(0,0,.2,1);display:none}.context-menu.active{display:block}@keyframes menu-in{from{opacity:0;transform:scale(.95) translateY(-5px)}to{opacity:1;transform:scale(1) translateY(0)}}.context-menu-item{padding:8px 12px;cursor:pointer;font-size:.85rem;color:var(--text);display:flex;align-items:center;border-radius:4px;transition:all .1s}.context-menu-item:hover{background:var(--accent);color:#fff;transform:translateX(2px)}.context-menu-separator{height:1px;background:var(--border);margin:4px 0}::-webkit-scrollbar{width:10px;height:10px}::-webkit-scrollbar-track{background:var(--bg)}::-webkit-scrollbar-thumb{background:var(--border);border-radius:5px;border:2px solid var(--bg)}::-webkit-scrollbar-thumb:hover{background:var(--muted)}::selection{background:var(--accent);color:#fff}*{box-sizing:border-box;font-family:"IBM Plex Sans","Segoe UI",system-ui,sans-serif}html{height:100%!important;width:100%!important;overflow:hidden!important;scrollbar-width:thin;scrollbar-color:var(--border) var(--bg)}body{margin:0!important;padding:0!important;width:100%!important;height:100%!important;overflow:hidden!important}#app-body{margin:0;height:100vh!important;height:100svh!important;min-height:100vh!important;min-height:100svh!important;min-width:0!important;overflow:hidden!important;overflow-anchor:none;background:var(--bg);color:var(--text);display:block!important;transition:background .3s,color .3s}#et-app{height:100%;min-height:0;min-width:0;overflow:hidden;overflow-anchor:none;display:flex;flex-direction:column;gap:calc(var(--app-padding) - 4px)}header{flex-shrink:0!important}#et-app>main,#et-app>main[style]{flex:1 1 auto!important;height:auto!important;min-height:0!important;overflow:hidden!important;display:flex!important;flex-direction:column!important}body::before{content:"";position:fixed;inset:0;pointer-events:none;z-index:0;background:radial-gradient(900px 640px at var(--mx,50vw) var(--my,35vh),var(--spotlight-1),transparent 62%),radial-gradient(760px 560px at calc(var(--mx,50vw) + 180px) calc(var(--my,35vh) + 120px),var(--spotlight-2),transparent 68%);opacity:.95}main{position:relative;z-index:1}header{position:relative;z-index:1500}main{flex:1;width:100%;padding:0 var(--app-padding) var(--app-padding) var(--app-padding);display:flex;flex-direction:column;gap:var(--app-padding);overflow:hidden}header{display:flex;justify-content:space-between;align-items:center;padding:var(--app-padding);padding-bottom:0;flex-shrink:0}.app-toolbar{display:flex;justify-content:space-between;align-items:center;background:var(--bg-2);border:1px solid var(--border);border-radius:8px;padding:.25rem;flex:1;gap:.5rem;min-width:0;overflow:hidden}html:not([data-layout=left]) .app-toolbar{min-height:calc(var(--control-height) + .5rem)}.tab-list{display:flex;gap:4px;align-items:center;overflow-x:auto;flex:1;min-width:0;padding:0 4px;scrollbar-width:none;touch-action:pan-x;overscroll-behavior-x:contain;cursor:pointer;position:relative;scroll-behavior:smooth}html:not([data-layout=left]) .header-actions,html:not([data-layout=left]) .tab-list{height:var(--control-height)}.tab-list::-webkit-scrollbar{display:none}.tab-trigger{border:1px solid var(--border);background:var(--panel-strong);color:var(--muted);padding:0 .6rem;border-radius:var(--radius-control);cursor:pointer!important;font-size:var(--control-font-size);font-weight:600;line-height:1;transition:all 160ms ease;height:var(--control-height);display:inline-flex;align-items:center;justify-content:center;white-space:nowrap;flex-shrink:0}.scroll-btn{background:var(--panel-glass);backdrop-filter:blur(4px);-webkit-backdrop-filter:blur(4px);border:1px solid var(--border);color:var(--muted);cursor:pointer;padding:0;width:26px;height:26px;display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:all .2s cubic-bezier(.4, 0, .2, 1);z-index:2;border-radius:50%;box-shadow:0 2px 4px rgba(0,0,0,.1);opacity:.9}.scroll-btn:hover{color:var(--accent);border-color:rgba(56,189,248,.5);background:var(--bg-2);box-shadow:0 0 10px rgba(56,189,248,.25),inset 0 0 0 1px rgba(56,189,248,.1);opacity:1;transform:translateY(-1px)}.scroll-btn:active{transform:scale(.92);box-shadow:0 0 4px rgba(56,189,248,.2)}.scroll-btn.hidden{display:none;opacity:0;pointer-events:none}.scroll-btn svg{width:16px;height:16px;fill:currentColor;transition:transform .2s ease,filter .2s}.scroll-btn:hover svg{filter:drop-shadow(0 0 3px rgba(56, 189, 248, .5))}#scroll-left:hover svg{transform:translateX(-2px)}#scroll-right:hover svg{transform:translateX(2px)}.tab-trigger *{cursor:pointer!important}.tab-trigger:hover{background:var(--panel-strong);color:var(--accent);transform:translateY(-1px);box-shadow:var(--shadow-soft)}.tab-trigger.dragging{background:var(--panel-glass);color:var(--accent);box-shadow:0 10px 30px rgba(0,0,0,.35),var(--glow-accent);transform:scale(1.05) rotate(-1deg);z-index:3}.tab-list.dragging .tab-trigger:not(.dragging){filter:blur(.15px) saturate(.9);opacity:.7;transition:filter 120ms,opacity 120ms}.tab-drop-indicator{position:absolute;top:18%;width:4px;height:64%;border-radius:8px;background:linear-gradient(180deg,var(--accent),var(--accent-2));box-shadow:0 0 0 3px rgba(56,189,248,.25),0 10px 30px rgba(0,0,0,.4);opacity:0;transform:translateX(0);transition:transform 140ms ease,opacity 120ms ease;pointer-events:none}.tab-drop-indicator.active{opacity:1}.tab-trigger.is-active{background:var(--accent);color:#fff;box-shadow:0 4px 12px rgba(0,0,0,.2);transform:translateY(0)}.header-actions{display:flex;gap:.25rem;flex-shrink:0;padding-left:.5rem;margin-left:.25rem;border-left:1px solid var(--border);align-items:center}.header-actions #btn-toggle-nav{display:none}.icon-btn{background:var(--panel-strong);border:1px solid var(--border);color:var(--muted);padding:0;border-radius:var(--radius-control);cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s;height:var(--control-height);width:var(--control-height);font-size:1.1rem;opacity:.8}.icon-btn:hover{background:var(--panel-strong);color:var(--accent);opacity:1;transform:scale(1.05);box-shadow:var(--shadow-soft)}@keyframes shake-icon{0%{transform:scale(1.05) rotate(0)}25%{transform:scale(1.05) rotate(-15deg)}50%{transform:scale(1.05) rotate(15deg)}75%{transform:scale(1.05) rotate(-10deg)}100%{transform:scale(1.05) rotate(0)}}.header-actions .icon-btn:hover{animation:shake-icon .4s ease-in-out}@keyframes panel-in{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}.tab-panel{display:none;flex:1;flex-direction:column;min-height:0;overflow:hidden}.tab-panel.is-active{display:flex;animation:panel-in .18s ease}@media (prefers-reduced-motion:reduce){.tab-panel.is-active{animation:none}}.panel-grid{display:grid;grid-template-columns:1fr 1fr;gap:.5rem;flex:1;height:100%;min-height:0;overflow:hidden}.panel{background:var(--panel-glass,var(--panel));border:1px solid var(--border);border-radius:12px;padding:.8rem;display:flex;flex-direction:column;gap:.5rem;height:100%;min-height:0;overflow:hidden;position:relative;transition:all .3s ease;box-shadow:var(--shadow);backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px)}@media (hover:hover){.panel:hover{transform:translateY(-2px);box-shadow:var(--shadow-strong)}}.toolbar{display:flex;justify-content:space-between;align-items:center;flex-shrink:0;flex-wrap:wrap;gap:.5rem}.toolbar h2{margin:0;font-size:1rem;color:var(--accent);font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.toolbar button{white-space:nowrap}.hint-row{display:flex;gap:.5rem;align-items:center;color:var(--muted);font-size:.8rem;flex-wrap:wrap;justify-content:flex-end}#panel-timestamp .ts-body{flex:1;min-height:0;overflow-y:auto;-webkit-overflow-scrolling:touch;padding:0;display:flex;flex-direction:column;gap:.8rem}#panel-timestamp #ts-result{white-space:normal}#panel-timestamp #ts-result .ts-result-val{display:flex;align-items:center;gap:.5rem;flex:1;min-width:0}#panel-timestamp #ts-result .result-label{width:110px;flex-shrink:0}#panel-timestamp #ts-result .result-value{word-break:break-all}#panel-cron .cron-body{flex:1;min-height:0;overflow-y:auto;-webkit-overflow-scrolling:touch;display:flex;flex-direction:column}textarea{flex:1;width:100%;border-radius:var(--radius-control);border:1px solid var(--border);background:var(--bg-2);color:var(--text);padding:var(--control-padding);font-size:var(--code-size);font-family:var(--code-font);resize:none;line-height:1.4;min-height:0;transition:border-color .2s;tab-size:2}textarea:focus{outline:0;border-color:var(--accent);box-shadow:0 0 10px -2px var(--accent)}.code-viewer{flex:1;width:100%;border-radius:var(--radius-control);border:1px solid var(--border);background:var(--bg-2);color:var(--text);padding:var(--control-padding);font-size:var(--code-size);font-family:var(--code-font);overflow:auto;line-height:1.5;white-space:pre;tab-size:2}.code-viewer:focus{outline:0;border-color:var(--accent);box-shadow:0 0 10px -2px var(--accent)}.actions{display:flex;flex-wrap:wrap;gap:.5rem;flex-shrink:0}button{border:none;border-radius:var(--radius-control);padding:var(--control-padding);background:linear-gradient(135deg,var(--accent),var(--accent-2));color:#fff;cursor:pointer;font-size:var(--control-font-size);font-weight:600;transition:all .2s ease;box-shadow:var(--shadow-soft);display:inline-flex;align-items:center;justify-content:center;height:var(--control-height);line-height:1}button:hover{filter:brightness(1.1);transform:translateY(-1px);box-shadow:var(--shadow-strong)}button:active{transform:translateY(0);box-shadow:var(--shadow-soft)}button.secondary{background:var(--panel-strong);color:var(--text);border:1px solid var(--border)}button.secondary:hover{background:var(--border);border-color:var(--accent);transform:translateY(-1px)}.code-viewer:focus-visible,.icon-btn:focus-visible,.tab-trigger:focus-visible,button:focus-visible,input:focus-visible,select:focus-visible,textarea:focus-visible{outline:0;border-color:var(--accent)!important;box-shadow:var(--glow-accent)!important}button.success{background:var(--success)}button.warning{background:var(--warn)}button.danger{background:var(--danger)}button.btn-purple{background:linear-gradient(135deg,#ab47bc,#7b1fa2)}button.btn-teal{background:linear-gradient(135deg,#26a69a,#00796b)}button.btn-indigo{background:linear-gradient(135deg,#5c6bc0,#3949ab)}button.btn-blue{background:linear-gradient(135deg,#42a5f5,#1976d2)}button.btn-orange{background:linear-gradient(135deg,#ffa726,#f57c00)}button.btn-pink{background:linear-gradient(135deg,#ec407a,#c2185b)}button.btn-brown{background:linear-gradient(135deg,#8d6e63,#5d4037)}button.btn-cyan{background:linear-gradient(135deg,#26c6da,#0097a7)}button.btn-lime{background:linear-gradient(135deg,#d4e157,#9e9d24);color:#000}button.btn-deep-orange{background:linear-gradient(135deg,#ff7043,#e64a19)}button.btn-blue-grey{background:linear-gradient(135deg,#78909c,#455a64)}.tree-row{display:flex;align-items:center;padding:3px 0;font-family:"JetBrains Mono",Consolas,monospace}.tree-row:hover{background:var(--spotlight-1);border-radius:4px}.tree-icon{display:inline-flex;align-items:center;justify-content:center;width:22px;height:22px;margin-right:5px;border-radius:var(--radius-control);font-size:11px;font-weight:800;cursor:pointer;user-select:none;background:var(--panel);color:var(--muted);border:1px solid var(--border);box-shadow:0 1px 2px rgba(0,0,0,.2);transition:all .2s cubic-bezier(.4, 0, .2, 1);position:relative;overflow:hidden}.tree-icon::before{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background:linear-gradient(135deg,rgba(255,255,255,.1),transparent);opacity:0;transition:opacity .2s}.tree-icon:hover{border-color:var(--accent);color:var(--accent);transform:translateY(-1px);box-shadow:0 4px 8px rgba(0,0,0,.3);background:var(--spotlight-1)}.tree-icon:hover::before{opacity:1}.tree-icon:active{transform:translateY(0);box-shadow:0 1px 2px rgba(0,0,0,.2)}.tree-icon.collapsed{background:linear-gradient(135deg,var(--accent),var(--accent-2));color:#fff;border-color:transparent;box-shadow:0 2px 6px rgba(56,189,248,.4);text-shadow:0 1px 2px rgba(0,0,0,.2)}.tree-spacer{display:inline-block;width:22px;height:22px;margin-right:5px;position:relative}.tree-children{padding-left:16px;overflow:hidden;border-left:1px dashed var(--border);margin-left:11px;transition:border-color .2s}.tree-children:hover{border-left-color:rgba(56,189,248,.3)}.tree-children.collapsed{display:none}.token-key{color:#e2b340}.token-string{color:#98c379}.token-number{color:#d19a66}.token-boolean{color:#56b6c2}.token-null{color:#c678dd}.token-punctuation{color:var(--muted)}[data-et-theme=light] .token-key{color:#b7791f}[data-et-theme=light] .token-string{color:#166534}[data-et-theme=light] .token-number{color:#d97706}[data-et-theme=light] .token-boolean{color:#0891b2}[data-et-theme=light] .token-null{color:#9333ea}.sql-keyword{color:#c678dd;font-weight:700}.sql-function{color:#61afef}.xml-tag{color:#e06c75}.xml-attr{color:#d19a66}[data-et-theme=light] .sql-keyword{color:#9333ea}[data-et-theme=light] .sql-function{color:#2563eb}[data-et-theme=light] .xml-tag{color:#dc2626}.utility{background:var(--panel-strong);border:1px solid var(--border);border-radius:8px;padding:.5rem;display:flex;justify-content:center;gap:1rem;flex-shrink:0}.toast{position:fixed;top:30px;left:50%;transform:translateX(-50%) translateY(-20px);background:var(--bg);background-color:var(--panel-glass);color:var(--text);padding:.6rem 1.2rem;border-radius:50px;box-shadow:0 8px 32px rgba(0,0,0,.3);opacity:0;transition:all .3s cubic-bezier(.16, 1, .3, 1);z-index:9999;pointer-events:none;font-size:.9rem;font-weight:500;display:flex;align-items:center;gap:.6rem;white-space:nowrap;backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px);border:1px solid var(--border)}.toast.visible{transform:translateX(-50%) translateY(0);opacity:1}@keyframes flash-glow{0%{box-shadow:0 0 20px 5px var(--accent)}100%{box-shadow:none}}.preview-flash{animation:flash-glow 1s ease-out forwards}#img-preview-area img{max-width:none;max-height:none}.modal-backdrop{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.4);z-index:2000;backdrop-filter:blur(4px);-webkit-backdrop-filter:blur(4px);display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:opacity .2s}.modal-backdrop.active{opacity:1;pointer-events:all}.modal{background:var(--bg-glass);backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px);border:1px solid var(--border);border-radius:12px;width:90%;max-width:500px;max-height:80vh;display:flex;flex-direction:column;box-shadow:0 20px 50px -12px rgba(0,0,0,.5);transform:scale(.95);transition:transform .2s cubic-bezier(.34, 1.56, .64, 1)}[data-et-theme=dark] .modal{box-shadow:0 25px 50px -12px rgba(0,0,0,.6),0 0 0 1px rgba(255,255,255,.05)}.modal-backdrop.active .modal{transform:scale(1)}.modal-header{padding:.5rem 1rem;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center}.modal-header h3{margin:0;font-size:1rem}.modal-body{padding:1rem;overflow-y:auto}.modal-footer{padding:1rem;border-top:1px solid var(--border);text-align:right}.history-item{padding:.75rem;border-bottom:1px solid var(--border);cursor:pointer;display:flex;justify-content:space-between;align-items:center;transition:all .2s ease;position:relative}.history-item:hover{background:var(--panel);padding-left:1rem}.history-content-wrapper{flex:1;overflow:hidden}.history-meta{font-size:.9rem;color:var(--text);display:block;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.history-time{font-size:.75rem;color:var(--muted);display:block;margin-bottom:2px}.history-actions{display:flex;gap:.5rem;opacity:0;transition:opacity .2s}.history-item:hover .history-actions{opacity:1}.btn-mini{padding:2px 6px;font-size:.75rem;border-radius:4px;background:var(--panel-strong);color:var(--muted);border:1px solid var(--border);cursor:pointer;transition:all .2s}.btn-mini:hover{background:var(--accent);color:#fff;border-color:var(--accent)}.btn-mini.danger{background:color-mix(in srgb,var(--danger),transparent 86%);border-color:color-mix(in srgb,var(--danger),transparent 65%);color:var(--danger)}.btn-mini.danger:hover{background:var(--danger);color:#fff;border-color:var(--danger)}.history-badge{display:inline-flex;align-items:center;gap:.35rem;padding:.15rem .5rem;border-radius:999px;border:1px solid var(--border);background:var(--panel-strong);color:var(--accent);font-size:.75rem;font-weight:700;letter-spacing:.2px;flex-shrink:0}.history-date-group{margin-bottom:.8rem;border:1px solid var(--border);border-radius:8px;overflow:hidden;box-shadow:0 2px 4px rgba(0,0,0,.1)}.history-date-header{background:var(--bg-2);padding:.6rem 1rem;cursor:pointer;display:flex;justify-content:space-between;align-items:center;font-weight:600;font-size:.85rem;user-select:none;color:var(--accent);border-bottom:1px solid var(--border);transition:background .2s}.history-date-header:hover{background:var(--panel)}.history-date-header .arrow{transition:transform .2s;font-size:.8rem}.history-date-header.collapsed .arrow{transform:rotate(-90deg)}.history-date-body{display:block;border-top:1px solid var(--border)}.history-date-body.collapsed{display:none}.form-grid{display:grid;grid-template-columns:1fr 1fr;gap:1rem;padding:.5rem}.form-group{display:flex;flex-direction:column;gap:.4rem}.form-group-row{display:flex;gap:1rem;margin-bottom:.8rem}.diff-output{font-family:var(--code-font);white-space:pre-wrap;overflow:auto;background:var(--bg-2);padding:.5rem;border:1px solid var(--border);border-radius:var(--radius-control);line-height:1.5;font-size:var(--code-size)}.diff-line{display:flex;width:100%}.diff-marker{width:45px;user-select:none;color:var(--muted);text-align:right;padding-right:6px;flex-shrink:0;border-right:1px solid var(--border);margin-right:5px}.diff-content{flex:1;word-break:break-all}.diff-line.removed{background-color:rgba(239,68,68,.2);color:#fca5a5}.diff-line.added{background-color:rgba(34,197,94,.2);color:#86efac}[data-et-theme=light] .diff-line.removed{background-color:#fee2e2;color:#b91c1c}[data-et-theme=light] .diff-line.added{background-color:#dcfce7;color:#15803d}.url-table{width:100%;border-collapse:collapse;margin-top:.5rem;font-size:.9rem}.url-table td,.url-table th{border:1px solid var(--border);padding:6px 8px;text-align:left;box-sizing:border-box}.url-table th{background:var(--panel-strong);color:var(--muted);font-weight:600;font-size:.8rem}.url-table input{width:100%;background:0 0;border:none;color:var(--text);outline:0;font-family:var(--code-font);font-size:.9rem}.url-table .action-col{width:40px;text-align:center}.url-table .btn-icon{color:var(--muted);cursor:pointer;transition:color .2s}.url-table .btn-icon:hover{color:var(--danger)}.url-table .btn-add{color:var(--success);cursor:pointer;font-weight:700;display:block;text-align:center;margin-top:5px;padding:4px;border:1px dashed var(--border);border-radius:4px}.url-table .btn-add:hover{background:var(--panel-strong)}.info-block{background:var(--bg-2);border:1px solid var(--border);border-radius:4px;padding:10px;margin-bottom:10px}.info-label{color:var(--muted);font-size:.8rem;margin-bottom:4px;display:block}.info-value{font-family:var(--code-font);font-size:.95rem;word-break:break-all}.jwt-part{border-bottom:1px solid var(--border);padding-bottom:10px;margin-bottom:10px}.jwt-part:last-child{border-bottom:none;margin-bottom:0;padding-bottom:0}.jwt-header{color:#e06c75;font-weight:700}.jwt-payload{color:#98c379;font-weight:700}.jwt-signature{color:#61afef;font-weight:700}.form-group-row>.form-group{flex:1;margin-bottom:0}.form-group.full-width{grid-column:1/-1}.form-group label{font-size:.85rem;color:var(--muted)}.form-group input,.form-group select{padding:0 .8rem;border-radius:var(--radius-control);border:1px solid var(--border);background:var(--bg-2);color:var(--text);font-size:var(--control-font-size);height:var(--control-height)}.form-group input:focus,.form-group select:focus{border-color:var(--accent);outline:0;box-shadow:0 0 10px -2px var(--accent)}.input-group{display:flex;gap:.5rem}.input-group .std-input{flex:1;width:auto}.result-card{background:var(--bg-2);border:1px solid var(--border);border-radius:8px;padding:.6rem;margin-bottom:.6rem}.result-group-title{font-size:.85rem;color:var(--accent);margin-bottom:.4rem;font-weight:600;text-transform:uppercase;letter-spacing:.5px}.result-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:.3rem;padding-bottom:.3rem;border-bottom:1px solid var(--panel)}.result-row:last-child{border-bottom:none;margin-bottom:0;padding-bottom:0}.result-label{color:var(--muted);font-size:.85rem}.result-value{font-family:var(--code-font);font-size:var(--code-size);color:var(--text);user-select:all}.copy-icon{cursor:pointer;color:var(--muted);margin-left:.5rem;font-size:.9rem;transition:color .2s}.copy-icon:hover{color:var(--accent)}.file-drop-area{border:2px dashed var(--border);border-radius:8px;padding:1rem;text-align:center;cursor:pointer;background:var(--bg-2);transition:all .2s;margin-bottom:.5rem;position:relative;z-index:200}.file-drop-area.active,.file-drop-area:hover{border-color:var(--accent);background:var(--panel-strong);transform:scale(1.02);box-shadow:0 0 15px rgba(56,189,248,.2)}.file-drop-area input[type=file]{position:absolute;top:0;left:0;width:100%;height:100%;opacity:0;cursor:pointer}.file-msg{display:flex;flex-direction:column;align-items:center;justify-content:center;color:var(--muted);gap:.5rem}.file-msg .icon{font-size:2rem}.file-msg .text{font-size:.9rem}.custom-select-container{position:relative;width:100%}.selected-option{padding:0 .8rem;border-radius:var(--radius-control);background:var(--bg-2);color:var(--text);border:1px solid var(--border);cursor:pointer;display:flex;align-items:center;justify-content:space-between;height:var(--control-height)}.selected-option:hover{border-color:var(--accent)}.std-input{width:100%;padding:0 .8rem;border-radius:var(--radius-control);border:1px solid var(--border);background:var(--bg-2);color:var(--text);font-size:var(--control-font-size);height:var(--control-height)}.std-input:focus{border-color:var(--accent);outline:0;box-shadow:0 0 10px -2px var(--accent)}.bank-logo{width:24px;height:24px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:700;color:#fff;margin-right:8px;flex-shrink:0;text-shadow:0 1px 2px rgba(0,0,0,.3)}.options-dropdown{position:absolute;top:100%;left:0;width:100%;max-height:300px;background:var(--bg-2);border:1px solid var(--border);border-radius:var(--radius-control);z-index:1000;box-shadow:var(--shadow);display:none;flex-direction:column;margin-top:4px}.options-dropdown.show{display:flex}.search-box{padding:.5rem;border-bottom:1px solid var(--border)}.search-box input{width:100%;padding:0 .8rem;border-radius:var(--radius-control);border:1px solid var(--border);background:var(--bg);color:var(--text);outline:0;height:var(--control-height);font-size:var(--control-font-size)}.search-box input:focus{border-color:var(--accent)}.options-list{overflow-y:auto;flex:1}.option-item{padding:.5rem;display:flex;align-items:center;cursor:pointer;transition:background .2s}.option-item:hover{background:var(--panel-strong)}.option-item.selected{background:var(--panel-strong);color:var(--accent)}.options-list::-webkit-scrollbar{width:6px}.options-list::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px}@media (max-width:768px){:root{--control-height:42px;--app-padding:8px}.panel-grid{grid-template-columns:1fr!important;overflow-y:auto}.panel{height:auto;min-height:350px;padding:12px}.tab-list{overflow-x:auto;padding-bottom:0;width:100%;padding-right:0;-webkit-overflow-scrolling:touch;gap:.4rem;flex:1 1 auto;min-width:0}.tab-trigger{white-space:nowrap;padding:0 15px;flex-shrink:0}.app-toolbar{flex-direction:row;align-items:center;justify-content:space-between;gap:.35rem;padding:6px 10px;overflow:hidden;min-width:0}.header-actions{width:auto;flex-shrink:0;border-left:none;border-top:none;padding-left:0;margin-left:0;overflow:visible;flex:0 0 auto;gap:.35rem;justify-content:flex-end}html[data-layout=left] .app-toolbar{flex-direction:column;align-items:stretch;gap:.25rem}html[data-layout=left] .tab-list{flex-direction:column;overflow-x:hidden;overflow-y:auto;max-height:min(70vh,280px);touch-action:pan-y;overscroll-behavior:contain}html[data-layout=left] header{max-height:none;overflow:visible;height:auto}html[data-layout=left] .tab-trigger{padding:.5rem .8rem;font-size:.9rem}html[data-layout=left] body[data-nav-collapsed=true] .tab-list{max-height:calc(var(--control-height) * 2 + .5rem)}html[data-layout=left] .header-actions #btn-toggle-nav{display:inline-flex}#panel-other .panel-grid{grid-template-columns:1fr!important}.form-group-row{flex-direction:column;gap:.5rem}#panel-timestamp .ts-body{gap:.75rem}}input[type=checkbox]{appearance:none;-webkit-appearance:none;width:1.6em;height:1.3em;border:1px solid var(--border);border-radius:4px;background-color:var(--bg-2);display:inline-grid;place-content:center;margin-right:.6em;cursor:pointer;flex-shrink:0}input[type=checkbox]::before{content:"";width:.75em;height:.75em;transform:scale(0);transition:120ms transform ease-in-out;box-shadow:inset 1em 1em var(--accent);transform-origin:center;clip-path:polygon(14% 44%,0 65%,50% 100%,100% 16%,80% 0%,43% 62%)}input[type=checkbox]:checked::before{transform:scale(1)}input[type=checkbox]:checked{border-color:var(--accent)}#panel-other .panel-grid{grid-template-columns:repeat(auto-fit,minmax(350px,1fr));overflow-y:auto}#panel-other .panel{height:auto;min-height:500px}@media (min-width:768px){html[data-layout=left] #et-app{flex-direction:row!important}html[data-layout=left] #et-app header{width:200px;height:100%;flex-shrink:0;padding:0;padding-bottom:0;border-right:1px solid var(--border);border-bottom:none;background:var(--panel-glass,var(--bg));backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px)}html[data-layout=left] #et-app .app-toolbar{flex-direction:column;height:100%;border:none;border-radius:0;padding:.5rem;align-items:stretch;background:0 0}html[data-layout=left] #et-app .tab-list{flex-direction:column;overflow-y:auto;overflow-x:hidden;width:100%;padding-bottom:1rem}html[data-layout=left] #et-app .tab-trigger{justify-content:flex-start;width:100%;text-align:left;padding-left:1rem}html[data-layout=left] #et-app .header-actions{flex-direction:row;justify-content:center;padding:1rem 0;margin-left:0;margin-top:auto;border-left:none;border-top:1px solid var(--border);width:100%;flex-shrink:0}html[data-layout=left] #et-app main{padding:var(--app-padding);height:100%;min-height:0;min-width:0;overflow:hidden}}</style><script>!function(){!function(){"use strict";var e=[function(t,e,u){var i=u(1).Beautifier,n=u(5).Options;t.exports=function(t,e){return new i(t,e).beautify()},t.exports.defaultOptions=function(){return new n}},function(t,e,u){var i=u(2).Output,n=u(3).Token,_=u(4),s=u(5).Options,a=u(7).Tokenizer,o=u(7).line_starters,r=u(7).positionable_operators,h=u(7).TOKEN;function p(t,e){return-1!==e.indexOf(t)}function l(t,e){return t&&t.type===h.RESERVED&&t.text===e}function f(t,e){return t&&t.type===h.RESERVED&&p(t.text,e)}var c=["case","return","do","if","throw","else","await","break","continue","async"],d=function(t){for(var e={},u=0;u<t.length;u++)e[t[u].replace(/-/g,"_")]=t[u];return e}(["before-newline","after-newline","preserve-newline"]),b=[d.before_newline,d.preserve_newline],g="BlockStatement",k="Statement",m="ObjectLiteral",w="ArrayLiteral",y="ForInitializer",x="Conditional",v="Expression";function E(t,e){e.multiline_frame||e.mode===y||e.mode===x||t.remove_indent(e.start_line_index)}function R(t){return t===w}function O(t){return p(t,[v,y,x])}function T(t,e){e=e||{},this._source_text=t||"",this._output=null,this._tokens=null,this._last_last_text=null,this._flags=null,this._previous_flags=null,this._flag_store=null,this._options=new s(e)}T.prototype.create_flags=function(t,e){var u=0;return t&&(u=t.indentation_level,!this._output.just_added_newline()&&t.line_indent_level>u&&(u=t.line_indent_level)),{mode:e,parent:t,last_token:t?t.last_token:new n(h.START_BLOCK,""),last_word:t?t.last_word:"",declaration_statement:!1,declaration_assignment:!1,multiline_frame:!1,inline_frame:!1,if_block:!1,else_block:!1,class_start_block:!1,do_block:!1,do_while:!1,import_block:!1,in_case_statement:!1,in_case:!1,case_body:!1,case_block:!1,indentation_level:u,alignment:0,line_indent_level:t?t.line_indent_level:u,start_line_index:this._output.get_line_number(),ternary_depth:0}},T.prototype._reset=function(t){var e=t.match(/^[\t ]*/)[0];this._last_last_text="",this._output=new i(this._options,e),this._output.raw=this._options.test_output_raw,this._flag_store=[],this.set_mode(g),e=new a(t,this._options);return this._tokens=e.tokenize(),t},T.prototype.beautify=function(){if(this._options.disabled)return this._source_text;for(var t=this._reset(this._source_text),e=this._options.eol,u=("auto"===this._options.eol&&(e="\n",t&&_.lineBreak.test(t||"")&&(e=t.match(_.lineBreak)[0])),this._tokens.next());u;)this.handle_token(u),this._last_last_text=this._flags.last_token.text,this._flags.last_token=u,u=this._tokens.next();return this._output.get_code(e)},T.prototype.handle_token=function(t,e){t.type===h.START_EXPR?this.handle_start_expr(t):t.type===h.END_EXPR?this.handle_end_expr(t):t.type===h.START_BLOCK?this.handle_start_block(t):t.type===h.END_BLOCK?this.handle_end_block(t):t.type===h.WORD||t.type===h.RESERVED?this.handle_word(t):t.type===h.SEMICOLON?this.handle_semicolon(t):t.type===h.STRING?this.handle_string(t):t.type===h.EQUALS?this.handle_equals(t):t.type===h.OPERATOR?this.handle_operator(t):t.type===h.COMMA?this.handle_comma(t):t.type===h.BLOCK_COMMENT?this.handle_block_comment(t,e):t.type===h.COMMENT?this.handle_comment(t,e):t.type===h.DOT?this.handle_dot(t):t.type===h.EOF?this.handle_eof(t):(t.type,h.UNKNOWN,this.handle_unknown(t,e))},T.prototype.handle_whitespace_and_comments=function(t,e){var u=t.newlines,i=this._options.keep_array_indentation&&R(this._flags.mode);if(t.comments_before)for(var n=t.comments_before.next();n;)this.handle_whitespace_and_comments(n,e),this.handle_token(n,e),n=t.comments_before.next();if(i)for(var _=0;_<u;_+=1)this.print_newline(0<_,e);else if(this._options.max_preserve_newlines&&u>this._options.max_preserve_newlines&&(u=this._options.max_preserve_newlines),this._options.preserve_newlines&&1<u){this.print_newline(!1,e);for(var s=1;s<u;s+=1)this.print_newline(!0,e)}};var A=["async","break","continue","return","throw","yield"];T.prototype.allow_wrap_or_preserved_newline=function(t,e){e=void 0!==e&&e,this._output.just_added_newline()||(e=this._options.preserve_newlines&&t.newlines||e,(p(this._flags.last_token.text,r)||p(t.text,r))&&(t=p(this._flags.last_token.text,r)&&p(this._options.operator_position,b)||p(t.text,r),e=e&&t),e?this.print_newline(!1,!0):this._options.wrap_line_length&&!f(this._flags.last_token,A)&&this._output.set_wrap_point())},T.prototype.print_newline=function(t,e){if(!e&&";"!==this._flags.last_token.text&&","!==this._flags.last_token.text&&"="!==this._flags.last_token.text&&(this._flags.last_token.type!==h.OPERATOR||"--"===this._flags.last_token.text||"++"===this._flags.last_token.text))for(var u=this._tokens.peek();!(this._flags.mode!==k||this._flags.if_block&&l(u,"else")||this._flags.do_block);)this.restore_mode();this._output.add_new_line(t)&&(this._flags.multiline_frame=!0)},T.prototype.print_token_line_indentation=function(t){this._output.just_added_newline()&&(this._options.keep_array_indentation&&t.newlines&&("["===t.text||R(this._flags.mode))?(this._output.current_line.set_indent(-1),this._output.current_line.push(t.whitespace_before),this._output.space_before_token=!1):this._output.set_indent(this._flags.indentation_level,this._flags.alignment)&&(this._flags.line_indent_level=this._flags.indentation_level))},T.prototype.print_token=function(t){var e;this._output.raw?this._output.add_raw_token(t):(this._options.comma_first&&t.previous&&t.previous.type===h.COMMA&&this._output.just_added_newline()&&","===this._output.previous_line.last()&&(e=this._output.previous_line.pop(),this._output.previous_line.is_empty()&&(this._output.previous_line.push(e),this._output.trim(!0),this._output.current_line.pop(),this._output.trim()),this.print_token_line_indentation(t),this._output.add_token(","),this._output.space_before_token=!0),this.print_token_line_indentation(t),this._output.non_breaking_space=!0,this._output.add_token(t.text),this._output.previous_token_wrapped&&(this._flags.multiline_frame=!0))},T.prototype.indent=function(){this._flags.indentation_level+=1,this._output.set_indent(this._flags.indentation_level,this._flags.alignment)},T.prototype.deindent=function(){0<this._flags.indentation_level&&(!this._flags.parent||this._flags.indentation_level>this._flags.parent.indentation_level)&&(--this._flags.indentation_level,this._output.set_indent(this._flags.indentation_level,this._flags.alignment))},T.prototype.set_mode=function(t){this._flags?(this._flag_store.push(this._flags),this._previous_flags=this._flags):this._previous_flags=this.create_flags(null,t),this._flags=this.create_flags(this._previous_flags,t),this._output.set_indent(this._flags.indentation_level,this._flags.alignment)},T.prototype.restore_mode=function(){0<this._flag_store.length&&(this._previous_flags=this._flags,this._flags=this._flag_store.pop(),this._previous_flags.mode===k&&E(this._output,this._previous_flags),this._output.set_indent(this._flags.indentation_level,this._flags.alignment))},T.prototype.start_of_object_property=function(){return this._flags.parent.mode===m&&this._flags.mode===k&&(":"===this._flags.last_token.text&&0===this._flags.ternary_depth||f(this._flags.last_token,["get","set"]))},T.prototype.start_of_statement=function(t){return!!(f(this._flags.last_token,["var","let","const"])&&t.type===h.WORD||l(this._flags.last_token,"do")||(this._flags.parent.mode!==m||this._flags.mode!==k)&&f(this._flags.last_token,A)&&!t.newlines||l(this._flags.last_token,"else")&&(!l(t,"if")||t.comments_before)||this._flags.last_token.type===h.END_EXPR&&(this._previous_flags.mode===y||this._previous_flags.mode===x)||this._flags.last_token.type===h.WORD&&this._flags.mode===g&&!this._flags.in_case&&"--"!==t.text&&"++"!==t.text&&"function"!==this._last_last_text&&t.type!==h.WORD&&t.type!==h.RESERVED||this._flags.mode===m&&(":"===this._flags.last_token.text&&0===this._flags.ternary_depth||f(this._flags.last_token,["get","set"])))&&(this.set_mode(k),this.indent(),this.handle_whitespace_and_comments(t,!0),this.start_of_object_property()||this.allow_wrap_or_preserved_newline(t,f(t,["do","for","if","while"])),!0)},T.prototype.handle_start_expr=function(t){this.start_of_statement(t)||this.handle_whitespace_and_comments(t);var e,u,i=v;if("["===t.text){if(this._flags.last_token.type===h.WORD||")"===this._flags.last_token.text)return f(this._flags.last_token,o)&&(this._output.space_before_token=!0),this.print_token(t),this.set_mode(i),this.indent(),void(this._options.space_in_paren&&(this._output.space_before_token=!0));i=w,!R(this._flags.mode)||"["!==this._flags.last_token.text&&(","!==this._flags.last_token.text||"]"!==this._last_last_text&&"}"!==this._last_last_text)||this._options.keep_array_indentation||this.print_newline(),p(this._flags.last_token.type,[h.START_EXPR,h.END_EXPR,h.WORD,h.OPERATOR,h.DOT])||(this._output.space_before_token=!0)}else this._flags.last_token.type===h.RESERVED?"for"===this._flags.last_token.text?(this._output.space_before_token=this._options.space_before_conditional,i=y):p(this._flags.last_token.text,["if","while","switch"])?(this._output.space_before_token=this._options.space_before_conditional,i=x):p(this._flags.last_word,["await","async"])?this._output.space_before_token=!0:"import"===this._flags.last_token.text&&""===t.whitespace_before?this._output.space_before_token=!1:!p(this._flags.last_token.text,o)&&"catch"!==this._flags.last_token.text||(this._output.space_before_token=!0):this._flags.last_token.type===h.EQUALS||this._flags.last_token.type===h.OPERATOR?this.start_of_object_property()||this.allow_wrap_or_preserved_newline(t):this._flags.last_token.type===h.WORD?(this._output.space_before_token=!1,e=this._tokens.peek(-3),this._options.space_after_named_function&&e&&(u=this._tokens.peek(-4),f(e,["async","function"])||"*"===e.text&&f(u,["async","function"])?this._output.space_before_token=!0:this._flags.mode===m?"{"!==e.text&&","!==e.text&&("*"!==e.text||"{"!==u.text&&","!==u.text)||(this._output.space_before_token=!0):this._flags.parent&&this._flags.parent.class_start_block&&(this._output.space_before_token=!0))):this.allow_wrap_or_preserved_newline(t),(this._flags.last_token.type===h.RESERVED&&("function"===this._flags.last_word||"typeof"===this._flags.last_word)||"*"===this._flags.last_token.text&&(p(this._last_last_text,["function","yield"])||this._flags.mode===m&&p(this._last_last_text,["{",","])))&&(this._output.space_before_token=this._options.space_after_anon_function);";"===this._flags.last_token.text||this._flags.last_token.type===h.START_BLOCK?this.print_newline():this._flags.last_token.type!==h.END_EXPR&&this._flags.last_token.type!==h.START_EXPR&&this._flags.last_token.type!==h.END_BLOCK&&"."!==this._flags.last_token.text&&this._flags.last_token.type!==h.COMMA||this.allow_wrap_or_preserved_newline(t,t.newlines),this.print_token(t),this.set_mode(i),this._options.space_in_paren&&(this._output.space_before_token=!0),this.indent()},T.prototype.handle_end_expr=function(t){for(;this._flags.mode===k;)this.restore_mode();this.handle_whitespace_and_comments(t),this._flags.multiline_frame&&this.allow_wrap_or_preserved_newline(t,"]"===t.text&&R(this._flags.mode)&&!this._options.keep_array_indentation),this._options.space_in_paren&&(this._flags.last_token.type!==h.START_EXPR||this._options.space_in_empty_paren?this._output.space_before_token=!0:(this._output.trim(),this._output.space_before_token=!1)),this.deindent(),this.print_token(t),this.restore_mode(),E(this._output,this._previous_flags),this._flags.do_while&&this._previous_flags.mode===x&&(this._previous_flags.mode=v,this._flags.do_block=!1,this._flags.do_while=!1)},T.prototype.handle_start_block=function(t){this.handle_whitespace_and_comments(t);var e=this._tokens.peek(),u=this._tokens.peek(1);e=(u=("switch"===this._flags.last_word&&this._flags.last_token.type===h.END_EXPR?(this.set_mode(g),this._flags.in_case_statement=!0):this._flags.case_body?this.set_mode(g):u&&(p(u.text,[":",","])&&p(e.type,[h.STRING,h.WORD,h.RESERVED])||p(e.text,["get","set","..."])&&p(u.type,[h.WORD,h.RESERVED]))?p(this._last_last_text,["class","interface"])&&!p(u.text,[":",","])?this.set_mode(g):this.set_mode(m):this._flags.last_token.type===h.OPERATOR&&"=>"===this._flags.last_token.text||!p(this._flags.last_token.type,[h.EQUALS,h.START_EXPR,h.COMMA,h.OPERATOR])&&!f(this._flags.last_token,["return","throw","import","default"])?this.set_mode(g):this.set_mode(m),this._flags.last_token&&f(this._flags.last_token.previous,["class","extends"])&&(this._flags.class_start_block=!0),!e.comments_before&&"}"===e.text))&&"function"===this._flags.last_word&&this._flags.last_token.type===h.END_EXPR;if(this._options.brace_preserve_inline){var i=0,n=null;this._flags.inline_frame=!0;do{if((n=this._tokens.peek((i+=1)-1)).newlines){this._flags.inline_frame=!1;break}}while(n.type!==h.EOF&&(n.type!==h.END_BLOCK||n.opened!==t))}("expand"===this._options.brace_style||"none"===this._options.brace_style&&t.newlines)&&!this._flags.inline_frame?this._flags.last_token.type!==h.OPERATOR&&(e||this._flags.last_token.type===h.EQUALS||f(this._flags.last_token,c)&&"else"!==this._flags.last_token.text)?this._output.space_before_token=!0:this.print_newline(!1,!0):(!R(this._previous_flags.mode)||this._flags.last_token.type!==h.START_EXPR&&this._flags.last_token.type!==h.COMMA||(this._flags.last_token.type!==h.COMMA&&!this._options.space_in_paren||(this._output.space_before_token=!0),(this._flags.last_token.type===h.COMMA||this._flags.last_token.type===h.START_EXPR&&this._flags.inline_frame)&&(this.allow_wrap_or_preserved_newline(t),this._previous_flags.multiline_frame=this._previous_flags.multiline_frame||this._flags.multiline_frame,this._flags.multiline_frame=!1)),this._flags.last_token.type!==h.OPERATOR&&this._flags.last_token.type!==h.START_EXPR&&(this._flags.last_token.type!==h.START_BLOCK||this._flags.inline_frame?this._output.space_before_token=!0:this.print_newline())),this.print_token(t),this.indent(),u||this._options.brace_preserve_inline&&this._flags.inline_frame||this.print_newline()},T.prototype.handle_end_block=function(t){for(this.handle_whitespace_and_comments(t);this._flags.mode===k;)this.restore_mode();var e=this._flags.last_token.type===h.START_BLOCK;this._flags.inline_frame&&!e?this._output.space_before_token=!0:"expand"===this._options.brace_style?e||this.print_newline():e||(R(this._flags.mode)&&this._options.keep_array_indentation?(this._options.keep_array_indentation=!1,this.print_newline(),this._options.keep_array_indentation=!0):this.print_newline()),this.restore_mode(),this.print_token(t)},T.prototype.handle_word=function(t){if(t.type===h.RESERVED&&(p(t.text,["set","get"])&&this._flags.mode!==m||"import"===t.text&&p(this._tokens.peek().text,["(","."])||p(t.text,["as","from"])&&!this._flags.import_block||this._flags.mode===m&&":"===this._tokens.peek().text)&&(t.type=h.WORD),this.start_of_statement(t)?f(this._flags.last_token,["var","let","const"])&&t.type===h.WORD&&(this._flags.declaration_statement=!0):!t.newlines||O(this._flags.mode)||this._flags.last_token.type===h.OPERATOR&&"--"!==this._flags.last_token.text&&"++"!==this._flags.last_token.text||this._flags.last_token.type===h.EQUALS||!this._options.preserve_newlines&&f(this._flags.last_token,["var","let","const","set","get"])?this.handle_whitespace_and_comments(t):(this.handle_whitespace_and_comments(t),this.print_newline()),this._flags.do_block&&!this._flags.do_while){if(l(t,"while"))return this._output.space_before_token=!0,this.print_token(t),this._output.space_before_token=!0,void(this._flags.do_while=!0);this.print_newline(),this._flags.do_block=!1}if(this._flags.if_block)if(!this._flags.else_block&&l(t,"else"))this._flags.else_block=!0;else{for(;this._flags.mode===k;)this.restore_mode();this._flags.if_block=!1,this._flags.else_block=!1}if(this._flags.in_case_statement&&f(t,["case","default"]))return this.print_newline(),this._flags.case_block||!this._flags.case_body&&!this._options.jslint_happy||this.deindent(),this._flags.case_body=!1,this.print_token(t),void(this._flags.in_case=!0);if(this._flags.last_token.type!==h.COMMA&&this._flags.last_token.type!==h.START_EXPR&&this._flags.last_token.type!==h.EQUALS&&this._flags.last_token.type!==h.OPERATOR||this.start_of_object_property()||this.allow_wrap_or_preserved_newline(t),l(t,"function"))return!(p(this._flags.last_token.text,["}",";"])||this._output.just_added_newline()&&!p(this._flags.last_token.text,["(","[","{",":","=",","])&&this._flags.last_token.type!==h.OPERATOR)||this._output.just_added_blankline()||t.comments_before||(this.print_newline(),this.print_newline(!0)),this._flags.last_token.type===h.RESERVED||this._flags.last_token.type===h.WORD?f(this._flags.last_token,["get","set","new","export"])||f(this._flags.last_token,A)||l(this._flags.last_token,"default")&&"export"===this._last_last_text||"declare"===this._flags.last_token.text?this._output.space_before_token=!0:this.print_newline():this._flags.last_token.type===h.OPERATOR||"="===this._flags.last_token.text?this._output.space_before_token=!0:!this._flags.multiline_frame&&(O(this._flags.mode)||R(this._flags.mode))||this.print_newline(),this.print_token(t),void(this._flags.last_word=t.text);var e="NONE";this._flags.last_token.type===h.END_BLOCK?this._previous_flags.inline_frame?e="SPACE":!f(t,["else","catch","finally","from"])||"expand"===this._options.brace_style||"end-expand"===this._options.brace_style||"none"===this._options.brace_style&&t.newlines?e="NEWLINE":(e="SPACE",this._output.space_before_token=!0):this._flags.last_token.type===h.SEMICOLON&&this._flags.mode===g?e="NEWLINE":this._flags.last_token.type===h.SEMICOLON&&O(this._flags.mode)?e="SPACE":this._flags.last_token.type===h.STRING?e="NEWLINE":this._flags.last_token.type===h.RESERVED||this._flags.last_token.type===h.WORD||"*"===this._flags.last_token.text&&(p(this._last_last_text,["function","yield"])||this._flags.mode===m&&p(this._last_last_text,["{",","]))?e="SPACE":this._flags.last_token.type===h.START_BLOCK?e=this._flags.inline_frame?"SPACE":"NEWLINE":this._flags.last_token.type===h.END_EXPR&&(this._output.space_before_token=!0,e="NEWLINE"),f(t,o)&&")"!==this._flags.last_token.text&&(e=this._flags.inline_frame||"else"===this._flags.last_token.text||"export"===this._flags.last_token.text?"SPACE":"NEWLINE"),f(t,["else","catch","finally"])?(this._flags.last_token.type!==h.END_BLOCK||this._previous_flags.mode!==g||"expand"===this._options.brace_style||"end-expand"===this._options.brace_style||"none"===this._options.brace_style&&t.newlines)&&!this._flags.inline_frame?this.print_newline():(this._output.trim(!0),"}"!==this._output.current_line.last()&&this.print_newline(),this._output.space_before_token=!0):"NEWLINE"===e?f(this._flags.last_token,c)||"declare"===this._flags.last_token.text&&f(t,["var","let","const"])?this._output.space_before_token=!0:this._flags.last_token.type!==h.END_EXPR?this._flags.last_token.type===h.START_EXPR&&f(t,["var","let","const"])||":"===this._flags.last_token.text||(l(t,"if")&&l(t.previous,"else")?this._output.space_before_token=!0:this.print_newline()):f(t,o)&&")"!==this._flags.last_token.text&&this.print_newline():this._flags.multiline_frame&&R(this._flags.mode)&&","===this._flags.last_token.text&&"}"===this._last_last_text?this.print_newline():"SPACE"===e&&(this._output.space_before_token=!0),!t.previous||t.previous.type!==h.WORD&&t.previous.type!==h.RESERVED||(this._output.space_before_token=!0),this.print_token(t),this._flags.last_word=t.text,t.type===h.RESERVED&&("do"===t.text?this._flags.do_block=!0:"if"===t.text?this._flags.if_block=!0:"import"===t.text?this._flags.import_block=!0:this._flags.import_block&&l(t,"from")&&(this._flags.import_block=!1))},T.prototype.handle_semicolon=function(t){this.start_of_statement(t)?this._output.space_before_token=!1:this.handle_whitespace_and_comments(t);for(var e=this._tokens.peek();!(this._flags.mode!==k||this._flags.if_block&&l(e,"else")||this._flags.do_block);)this.restore_mode();this._flags.import_block&&(this._flags.import_block=!1),this.print_token(t)},T.prototype.handle_string=function(t){t.text.startsWith("`")&&0===t.newlines&&""===t.whitespace_before&&(")"===t.previous.text||this._flags.last_token.type===h.WORD)||(this.start_of_statement(t)?this._output.space_before_token=!0:(this.handle_whitespace_and_comments(t),this._flags.last_token.type===h.RESERVED||this._flags.last_token.type===h.WORD||this._flags.inline_frame?this._output.space_before_token=!0:this._flags.last_token.type===h.COMMA||this._flags.last_token.type===h.START_EXPR||this._flags.last_token.type===h.EQUALS||this._flags.last_token.type===h.OPERATOR?this.start_of_object_property()||this.allow_wrap_or_preserved_newline(t):!t.text.startsWith("`")||this._flags.last_token.type!==h.END_EXPR||"]"!==t.previous.text&&")"!==t.previous.text||0!==t.newlines?this.print_newline():this._output.space_before_token=!0)),this.print_token(t)},T.prototype.handle_equals=function(t){this.start_of_statement(t)||this.handle_whitespace_and_comments(t),this._flags.declaration_statement&&(this._flags.declaration_assignment=!0),this._output.space_before_token=!0,this.print_token(t),this._output.space_before_token=!0},T.prototype.handle_comma=function(t){this.handle_whitespace_and_comments(t,!0),this.print_token(t),this._output.space_before_token=!0,this._flags.declaration_statement?(O(this._flags.parent.mode)&&(this._flags.declaration_assignment=!1),this._flags.declaration_assignment?(this._flags.declaration_assignment=!1,this.print_newline(!1,!0)):this._options.comma_first&&this.allow_wrap_or_preserved_newline(t)):this._flags.mode===m||this._flags.mode===k&&this._flags.parent.mode===m?(this._flags.mode===k&&this.restore_mode(),this._flags.inline_frame||this.print_newline()):this._options.comma_first&&this.allow_wrap_or_preserved_newline(t)},T.prototype.handle_operator=function(t){var e="*"===t.text&&(f(this._flags.last_token,["function","yield"])||p(this._flags.last_token.type,[h.START_BLOCK,h.COMMA,h.END_BLOCK,h.SEMICOLON])),u=p(t.text,["-","+"])&&(p(this._flags.last_token.type,[h.START_BLOCK,h.START_EXPR,h.EQUALS,h.OPERATOR])||p(this._flags.last_token.text,o)||","===this._flags.last_token.text);if(this.start_of_statement(t)||this.handle_whitespace_and_comments(t,!e),"*"===t.text&&this._flags.last_token.type===h.DOT)this.print_token(t);else if("::"===t.text)this.print_token(t);else{if(this._flags.last_token.type===h.OPERATOR&&p(this._options.operator_position,b)&&this.allow_wrap_or_preserved_newline(t),":"===t.text&&this._flags.in_case)return this.print_token(t),this._flags.in_case=!1,this._flags.case_body=!0,void(this._tokens.peek().type!==h.START_BLOCK?(this.indent(),this.print_newline(),this._flags.case_block=!1):(this._flags.case_block=!0,this._output.space_before_token=!0));var i=!0,n=!0,_=!1;if(":"===t.text?0===this._flags.ternary_depth?i=!1:(--this._flags.ternary_depth,_=!0):"?"===t.text&&(this._flags.ternary_depth+=1),!u&&!e&&this._options.preserve_newlines&&p(t.text,r)){var s=":"===t.text,a=s&&_,l=s&&!_;switch(this._options.operator_position){case d.before_newline:return this._output.space_before_token=!l,this.print_token(t),s&&!a||this.allow_wrap_or_preserved_newline(t),void(this._output.space_before_token=!0);case d.after_newline:return this._output.space_before_token=!0,!s||a?this._tokens.peek().newlines?this.print_newline(!1,!0):this.allow_wrap_or_preserved_newline(t):this._output.space_before_token=!1,this.print_token(t),void(this._output.space_before_token=!0);case d.preserve_newline:return l||this.allow_wrap_or_preserved_newline(t),i=!(this._output.just_added_newline()||l),this._output.space_before_token=i,this.print_token(t),void(this._output.space_before_token=!0)}}e?(this.allow_wrap_or_preserved_newline(t),i=!1,n=(_=this._tokens.peek())&&p(_.type,[h.WORD,h.RESERVED])):"..."===t.text?(this.allow_wrap_or_preserved_newline(t),i=this._flags.last_token.type===h.START_BLOCK,n=!1):(p(t.text,["--","++","!","~"])||u)&&(this._flags.last_token.type!==h.COMMA&&this._flags.last_token.type!==h.START_EXPR||this.allow_wrap_or_preserved_newline(t),n=i=!1,!t.newlines||"--"!==t.text&&"++"!==t.text&&"~"!==t.text||((e=f(this._flags.last_token,c)&&t.newlines)&&(this._previous_flags.if_block||this._previous_flags.else_block)&&this.restore_mode(),this.print_newline(e,!0)),";"===this._flags.last_token.text&&O(this._flags.mode)&&(i=!0),this._flags.last_token.type===h.RESERVED?i=!0:this._flags.last_token.type===h.END_EXPR?i=!("]"===this._flags.last_token.text&&("--"===t.text||"++"===t.text)):this._flags.last_token.type===h.OPERATOR&&(i=p(t.text,["--","-","++","+"])&&p(this._flags.last_token.text,["--","-","++","+"]),p(t.text,["+","-"])&&p(this._flags.last_token.text,["--","++"])&&(n=!0)),(this._flags.mode!==g||this._flags.inline_frame)&&this._flags.mode!==k||"{"!==this._flags.last_token.text&&";"!==this._flags.last_token.text||this.print_newline()),this._output.space_before_token=this._output.space_before_token||i,this.print_token(t),this._output.space_before_token=n}},T.prototype.handle_block_comment=function(t,e){return this._output.raw?(this._output.add_raw_token(t),void(t.directives&&"end"===t.directives.preserve&&(this._output.raw=this._options.test_output_raw))):t.directives?(this.print_newline(!1,e),this.print_token(t),"start"===t.directives.preserve&&(this._output.raw=!0),void this.print_newline(!1,!0)):void(_.newline.test(t.text)||t.newlines?this.print_block_commment(t,e):(this._output.space_before_token=!0,this.print_token(t),this._output.space_before_token=!0))},T.prototype.print_block_commment=function(t,e){var u,i,n,s=function(t){for(var e=[],u=(t=t.replace(_.allLineBreaks,"\n")).indexOf("\n");-1!==u;)e.push(t.substring(0,u)),u=(t=t.substring(u+1)).indexOf("\n");return t.length&&e.push(t),e}(t.text),a=t.whitespace_before,o=a.length;if(this.print_newline(!1,e),this.print_token_line_indentation(t),this._output.add_token(s[0]),this.print_newline(!1,e),1<s.length){for(i=function(t){for(var e=0;e<t.length;e++)if("*"!==t[e].trim().charAt(0))return!1;return!0}(s=s.slice(1)),n=function(t,e){for(var u,i=0,n=t.length;i<n;i++)if((u=t[i])&&0!==u.indexOf(e))return!1;return!0}(s,a),i&&(this._flags.alignment=1),u=0;u<s.length;u++)i?(this.print_token_line_indentation(t),this._output.add_token(s[u].replace(/^\s+/g,""))):n&&s[u]?(this.print_token_line_indentation(t),this._output.add_token(s[u].substring(o))):(this._output.current_line.set_indent(-1),this._output.add_token(s[u])),this.print_newline(!1,e);this._flags.alignment=0}},T.prototype.handle_comment=function(t,e){t.newlines?this.print_newline(!1,e):this._output.trim(!0),this._output.space_before_token=!0,this.print_token(t),this.print_newline(!1,e)},T.prototype.handle_dot=function(t){this.start_of_statement(t)||this.handle_whitespace_and_comments(t,!0),this._flags.last_token.text.match("^[0-9]+$")&&(this._output.space_before_token=!0),f(this._flags.last_token,c)?this._output.space_before_token=!1:this.allow_wrap_or_preserved_newline(t,")"===this._flags.last_token.text&&this._options.break_chained_methods),this._options.unindent_chained_methods&&this._output.just_added_newline()&&this.deindent(),this.print_token(t)},T.prototype.handle_unknown=function(t,e){this.print_token(t),"\n"===t.text[t.text.length-1]&&this.print_newline(!1,e)},T.prototype.handle_eof=function(t){for(;this._flags.mode===k;)this.restore_mode();this.handle_whitespace_and_comments(t)},t.exports.Beautifier=T},function(t){function e(t){this.__parent=t,this.__character_count=0,this.__indent_count=-1,this.__alignment_count=0,this.__wrap_point_index=0,this.__wrap_point_character_count=0,this.__wrap_point_indent_count=-1,this.__wrap_point_alignment_count=0,this.__items=[]}function u(t,e){this.__cache=[""],this.__indent_size=t.indent_size,this.__indent_string=t.indent_char,t.indent_with_tabs||(this.__indent_string=new Array(t.indent_size+1).join(t.indent_char)),e=e||"",0<t.indent_level&&(e=new Array(t.indent_level+1).join(this.__indent_string)),this.__base_string=e,this.__base_string_length=e.length}function i(t,i){this.__indent_cache=new u(t,i),this.raw=!1,this._end_with_newline=t.end_with_newline,this.indent_size=t.indent_size,this.wrap_line_length=t.wrap_line_length,this.indent_empty_lines=t.indent_empty_lines,this.__lines=[],this.previous_line=null,this.current_line=null,this.next_line=new e(this),this.space_before_token=!1,this.non_breaking_space=!1,this.previous_token_wrapped=!1,this.__add_outputline()}e.prototype.clone_empty=function(){var t=new e(this.__parent);return t.set_indent(this.__indent_count,this.__alignment_count),t},e.prototype.item=function(t){return t<0?this.__items[this.__items.length+t]:this.__items[t]},e.prototype.has_match=function(t){for(var e=this.__items.length-1;0<=e;e--)if(this.__items[e].match(t))return!0;return!1},e.prototype.set_indent=function(t,e){this.is_empty()&&(this.__indent_count=t||0,this.__alignment_count=e||0,this.__character_count=this.__parent.get_indent_size(this.__indent_count,this.__alignment_count))},e.prototype._set_wrap_point=function(){this.__parent.wrap_line_length&&(this.__wrap_point_index=this.__items.length,this.__wrap_point_character_count=this.__character_count,this.__wrap_point_indent_count=this.__parent.next_line.__indent_count,this.__wrap_point_alignment_count=this.__parent.next_line.__alignment_count)},e.prototype._should_wrap=function(){return this.__wrap_point_index&&this.__character_count>this.__parent.wrap_line_length&&this.__wrap_point_character_count>this.__parent.next_line.__character_count},e.prototype._allow_wrap=function(){var t;return!!this._should_wrap()&&(this.__parent.add_new_line(),(t=this.__parent.current_line).set_indent(this.__wrap_point_indent_count,this.__wrap_point_alignment_count),t.__items=this.__items.slice(this.__wrap_point_index),this.__items=this.__items.slice(0,this.__wrap_point_index),t.__character_count+=this.__character_count-this.__wrap_point_character_count,this.__character_count=this.__wrap_point_character_count," "===t.__items[0]&&(t.__items.splice(0,1),--t.__character_count),!0)},e.prototype.is_empty=function(){return 0===this.__items.length},e.prototype.last=function(){return this.is_empty()?null:this.__items[this.__items.length-1]},e.prototype.push=function(t){this.__items.push(t);var e=t.lastIndexOf("\n");-1!==e?this.__character_count=t.length-e:this.__character_count+=t.length},e.prototype.pop=function(){var t=null;return this.is_empty()||(t=this.__items.pop(),this.__character_count-=t.length),t},e.prototype._remove_indent=function(){0<this.__indent_count&&(--this.__indent_count,this.__character_count-=this.__parent.indent_size)},e.prototype._remove_wrap_indent=function(){0<this.__wrap_point_indent_count&&--this.__wrap_point_indent_count},e.prototype.trim=function(){for(;" "===this.last();)this.__items.pop(),--this.__character_count},e.prototype.toString=function(){var t="";return this.is_empty()?this.__parent.indent_empty_lines&&(t=this.__parent.get_indent_string(this.__indent_count)):(t=this.__parent.get_indent_string(this.__indent_count,this.__alignment_count),t+=this.__items.join("")),t},u.prototype.get_indent_size=function(t,e){var u=this.__base_string_length;return(u=t<0?0:u)+t*this.__indent_size+(e||0)},u.prototype.get_indent_string=function(t,e){var u=this.__base_string;return e=e||0,t<0&&(t=0,u=""),e+=t*this.__indent_size,this.__ensure_cache(e),u+this.__cache[e]},u.prototype.__ensure_cache=function(t){for(;t>=this.__cache.length;)this.__add_column()},u.prototype.__add_column=function(){var t,e=this.__cache.length,u="";this.__indent_size&&e>=this.__indent_size&&(e-=(t=Math.floor(e/this.__indent_size))*this.__indent_size,u=new Array(t+1).join(this.__indent_string)),e&&(u+=new Array(e+1).join(" ")),this.__cache.push(u)},i.prototype.__add_outputline=function(){this.previous_line=this.current_line,this.current_line=this.next_line.clone_empty(),this.__lines.push(this.current_line)},i.prototype.get_line_number=function(){return this.__lines.length},i.prototype.get_indent_string=function(t,e){return this.__indent_cache.get_indent_string(t,e)},i.prototype.get_indent_size=function(t,e){return this.__indent_cache.get_indent_size(t,e)},i.prototype.is_empty=function(){return!this.previous_line&&this.current_line.is_empty()},i.prototype.add_new_line=function(t){return!(this.is_empty()||!t&&this.just_added_newline()||(this.raw||this.__add_outputline(),0))},i.prototype.get_code=function(t){this.trim(!0);var e=((e=this.current_line.pop())&&("\n"===e[e.length-1]&&(e=e.replace(/\n+$/g,"")),this.current_line.push(e)),this._end_with_newline&&this.__add_outputline(),this.__lines.join("\n"));return"\n"!==t?e.replace(/[\n]/g,t):e},i.prototype.set_wrap_point=function(){this.current_line._set_wrap_point()},i.prototype.set_indent=function(t,e){return this.next_line.set_indent(t=t||0,e=e||0),1<this.__lines.length?(this.current_line.set_indent(t,e),!0):(this.current_line.set_indent(),!1)},i.prototype.add_raw_token=function(t){for(var e=0;e<t.newlines;e++)this.__add_outputline();this.current_line.set_indent(-1),this.current_line.push(t.whitespace_before),this.current_line.push(t.text),this.space_before_token=!1,this.non_breaking_space=!1,this.previous_token_wrapped=!1},i.prototype.add_token=function(t){this.__add_space_before_token(),this.current_line.push(t),this.space_before_token=!1,this.non_breaking_space=!1,this.previous_token_wrapped=this.current_line._allow_wrap()},i.prototype.__add_space_before_token=function(){this.space_before_token&&!this.just_added_newline()&&(this.non_breaking_space||this.set_wrap_point(),this.current_line.push(" "))},i.prototype.remove_indent=function(t){for(var e=this.__lines.length;t<e;)this.__lines[t]._remove_indent(),t++;this.current_line._remove_wrap_indent()},i.prototype.trim=function(t){for(t=void 0!==t&&t,this.current_line.trim();t&&1<this.__lines.length&&this.current_line.is_empty();)this.__lines.pop(),this.current_line=this.__lines[this.__lines.length-1],this.current_line.trim();this.previous_line=1<this.__lines.length?this.__lines[this.__lines.length-2]:null},i.prototype.just_added_newline=function(){return this.current_line.is_empty()},i.prototype.just_added_blankline=function(){return this.is_empty()||this.current_line.is_empty()&&this.previous_line.is_empty()},i.prototype.ensure_empty_line_above=function(t,u){for(var i=this.__lines.length-2;0<=i;){var n=this.__lines[i];if(n.is_empty())break;if(0!==n.item(0).indexOf(t)&&n.item(-1)!==u){this.__lines.splice(i+1,0,new e(this)),this.previous_line=this.__lines[this.__lines.length-2];break}i--}},t.exports.Output=i},function(t){t.exports.Token=function(t,e,u,i){this.type=t,this.text=e,this.comments_before=null,this.newlines=u||0,this.whitespace_before=i||"",this.parent=null,this.next=null,this.previous=null,this.opened=null,this.closed=null,this.directives=null}},function(t,e){var u="\\xaa\\xb5\\xba\\xc0-\\xd6\\xd8-\\xf6\\xf8-\\u02c1\\u02c6-\\u02d1\\u02e0-\\u02e4\\u02ec\\u02ee\\u0370-\\u0374\\u0376\\u0377\\u037a-\\u037d\\u0386\\u0388-\\u038a\\u038c\\u038e-\\u03a1\\u03a3-\\u03f5\\u03f7-\\u0481\\u048a-\\u0527\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05d0-\\u05ea\\u05f0-\\u05f2\\u0620-\\u064a\\u066e\\u066f\\u0671-\\u06d3\\u06d5\\u06e5\\u06e6\\u06ee\\u06ef\\u06fa-\\u06fc\\u06ff\\u0710\\u0712-\\u072f\\u074d-\\u07a5\\u07b1\\u07ca-\\u07ea\\u07f4\\u07f5\\u07fa\\u0800-\\u0815\\u081a\\u0824\\u0828\\u0840-\\u0858\\u08a0\\u08a2-\\u08ac\\u0904-\\u0939\\u093d\\u0950\\u0958-\\u0961\\u0971-\\u0977\\u0979-\\u097f\\u0985-\\u098c\\u098f\\u0990\\u0993-\\u09a8\\u09aa-\\u09b0\\u09b2\\u09b6-\\u09b9\\u09bd\\u09ce\\u09dc\\u09dd\\u09df-\\u09e1\\u09f0\\u09f1\\u0a05-\\u0a0a\\u0a0f\\u0a10\\u0a13-\\u0a28\\u0a2a-\\u0a30\\u0a32\\u0a33\\u0a35\\u0a36\\u0a38\\u0a39\\u0a59-\\u0a5c\\u0a5e\\u0a72-\\u0a74\\u0a85-\\u0a8d\\u0a8f-\\u0a91\\u0a93-\\u0aa8\\u0aaa-\\u0ab0\\u0ab2\\u0ab3\\u0ab5-\\u0ab9\\u0abd\\u0ad0\\u0ae0\\u0ae1\\u0b05-\\u0b0c\\u0b0f\\u0b10\\u0b13-\\u0b28\\u0b2a-\\u0b30\\u0b32\\u0b33\\u0b35-\\u0b39\\u0b3d\\u0b5c\\u0b5d\\u0b5f-\\u0b61\\u0b71\\u0b83\\u0b85-\\u0b8a\\u0b8e-\\u0b90\\u0b92-\\u0b95\\u0b99\\u0b9a\\u0b9c\\u0b9e\\u0b9f\\u0ba3\\u0ba4\\u0ba8-\\u0baa\\u0bae-\\u0bb9\\u0bd0\\u0c05-\\u0c0c\\u0c0e-\\u0c10\\u0c12-\\u0c28\\u0c2a-\\u0c33\\u0c35-\\u0c39\\u0c3d\\u0c58\\u0c59\\u0c60\\u0c61\\u0c85-\\u0c8c\\u0c8e-\\u0c90\\u0c92-\\u0ca8\\u0caa-\\u0cb3\\u0cb5-\\u0cb9\\u0cbd\\u0cde\\u0ce0\\u0ce1\\u0cf1\\u0cf2\\u0d05-\\u0d0c\\u0d0e-\\u0d10\\u0d12-\\u0d3a\\u0d3d\\u0d4e\\u0d60\\u0d61\\u0d7a-\\u0d7f\\u0d85-\\u0d96\\u0d9a-\\u0db1\\u0db3-\\u0dbb\\u0dbd\\u0dc0-\\u0dc6\\u0e01-\\u0e30\\u0e32\\u0e33\\u0e40-\\u0e46\\u0e81\\u0e82\\u0e84\\u0e87\\u0e88\\u0e8a\\u0e8d\\u0e94-\\u0e97\\u0e99-\\u0e9f\\u0ea1-\\u0ea3\\u0ea5\\u0ea7\\u0eaa\\u0eab\\u0ead-\\u0eb0\\u0eb2\\u0eb3\\u0ebd\\u0ec0-\\u0ec4\\u0ec6\\u0edc-\\u0edf\\u0f00\\u0f40-\\u0f47\\u0f49-\\u0f6c\\u0f88-\\u0f8c\\u1000-\\u102a\\u103f\\u1050-\\u1055\\u105a-\\u105d\\u1061\\u1065\\u1066\\u106e-\\u1070\\u1075-\\u1081\\u108e\\u10a0-\\u10c5\\u10c7\\u10cd\\u10d0-\\u10fa\\u10fc-\\u1248\\u124a-\\u124d\\u1250-\\u1256\\u1258\\u125a-\\u125d\\u1260-\\u1288\\u128a-\\u128d\\u1290-\\u12b0\\u12b2-\\u12b5\\u12b8-\\u12be\\u12c0\\u12c2-\\u12c5\\u12c8-\\u12d6\\u12d8-\\u1310\\u1312-\\u1315\\u1318-\\u135a\\u1380-\\u138f\\u13a0-\\u13f4\\u1401-\\u166c\\u166f-\\u167f\\u1681-\\u169a\\u16a0-\\u16ea\\u16ee-\\u16f0\\u1700-\\u170c\\u170e-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176c\\u176e-\\u1770\\u1780-\\u17b3\\u17d7\\u17dc\\u1820-\\u1877\\u1880-\\u18a8\\u18aa\\u18b0-\\u18f5\\u1900-\\u191c\\u1950-\\u196d\\u1970-\\u1974\\u1980-\\u19ab\\u19c1-\\u19c7\\u1a00-\\u1a16\\u1a20-\\u1a54\\u1aa7\\u1b05-\\u1b33\\u1b45-\\u1b4b\\u1b83-\\u1ba0\\u1bae\\u1baf\\u1bba-\\u1be5\\u1c00-\\u1c23\\u1c4d-\\u1c4f\\u1c5a-\\u1c7d\\u1ce9-\\u1cec\\u1cee-\\u1cf1\\u1cf5\\u1cf6\\u1d00-\\u1dbf\\u1e00-\\u1f15\\u1f18-\\u1f1d\\u1f20-\\u1f45\\u1f48-\\u1f4d\\u1f50-\\u1f57\\u1f59\\u1f5b\\u1f5d\\u1f5f-\\u1f7d\\u1f80-\\u1fb4\\u1fb6-\\u1fbc\\u1fbe\\u1fc2-\\u1fc4\\u1fc6-\\u1fcc\\u1fd0-\\u1fd3\\u1fd6-\\u1fdb\\u1fe0-\\u1fec\\u1ff2-\\u1ff4\\u1ff6-\\u1ffc\\u2071\\u207f\\u2090-\\u209c\\u2102\\u2107\\u210a-\\u2113\\u2115\\u2119-\\u211d\\u2124\\u2126\\u2128\\u212a-\\u212d\\u212f-\\u2139\\u213c-\\u213f\\u2145-\\u2149\\u214e\\u2160-\\u2188\\u2c00-\\u2c2e\\u2c30-\\u2c5e\\u2c60-\\u2ce4\\u2ceb-\\u2cee\\u2cf2\\u2cf3\\u2d00-\\u2d25\\u2d27\\u2d2d\\u2d30-\\u2d67\\u2d6f\\u2d80-\\u2d96\\u2da0-\\u2da6\\u2da8-\\u2dae\\u2db0-\\u2db6\\u2db8-\\u2dbe\\u2dc0-\\u2dc6\\u2dc8-\\u2dce\\u2dd0-\\u2dd6\\u2dd8-\\u2dde\\u2e2f\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303c\\u3041-\\u3096\\u309d-\\u309f\\u30a1-\\u30fa\\u30fc-\\u30ff\\u3105-\\u312d\\u3131-\\u318e\\u31a0-\\u31ba\\u31f0-\\u31ff\\u3400-\\u4db5\\u4e00-\\u9fcc\\ua000-\\ua48c\\ua4d0-\\ua4fd\\ua500-\\ua60c\\ua610-\\ua61f\\ua62a\\ua62b\\ua640-\\ua66e\\ua67f-\\ua697\\ua6a0-\\ua6ef\\ua717-\\ua71f\\ua722-\\ua788\\ua78b-\\ua78e\\ua790-\\ua793\\ua7a0-\\ua7aa\\ua7f8-\\ua801\\ua803-\\ua805\\ua807-\\ua80a\\ua80c-\\ua822\\ua840-\\ua873\\ua882-\\ua8b3\\ua8f2-\\ua8f7\\ua8fb\\ua90a-\\ua925\\ua930-\\ua946\\ua960-\\ua97c\\ua984-\\ua9b2\\ua9cf\\uaa00-\\uaa28\\uaa40-\\uaa42\\uaa44-\\uaa4b\\uaa60-\\uaa76\\uaa7a\\uaa80-\\uaaaf\\uaab1\\uaab5\\uaab6\\uaab9-\\uaabd\\uaac0\\uaac2\\uaadb-\\uaadd\\uaae0-\\uaaea\\uaaf2-\\uaaf4\\uab01-\\uab06\\uab09-\\uab0e\\uab11-\\uab16\\uab20-\\uab26\\uab28-\\uab2e\\uabc0-\\uabe2\\uac00-\\ud7a3\\ud7b0-\\ud7c6\\ud7cb-\\ud7fb\\uf900-\\ufa6d\\ufa70-\\ufad9\\ufb00-\\ufb06\\ufb13-\\ufb17\\ufb1d\\ufb1f-\\ufb28\\ufb2a-\\ufb36\\ufb38-\\ufb3c\\ufb3e\\ufb40\\ufb41\\ufb43\\ufb44\\ufb46-\\ufbb1\\ufbd3-\\ufd3d\\ufd50-\\ufd8f\\ufd92-\\ufdc7\\ufdf0-\\ufdfb\\ufe70-\\ufe74\\ufe76-\\ufefc\\uff21-\\uff3a\\uff41-\\uff5a\\uff66-\\uffbe\\uffc2-\\uffc7\\uffca-\\uffcf\\uffd2-\\uffd7\\uffda-\\uffdc",i="(?:\\\\u[0-9a-fA-F]{4}|[\\x23\\x24\\x40\\x41-\\x5a\\x5f\\x61-\\x7a"+u+"])";e.identifier=new RegExp(i+"(?:\\\\u[0-9a-fA-F]{4}|[\\x24\\x30-\\x39\\x41-\\x5a\\x5f\\x61-\\x7a\\xaa\\xb5\\xba\\xc0-\\xd6\\xd8-\\xf6\\xf8-\\u02c1\\u02c6-\\u02d1\\u02e0-\\u02e4\\u02ec\\u02ee\\u0370-\\u0374\\u0376\\u0377\\u037a-\\u037d\\u0386\\u0388-\\u038a\\u038c\\u038e-\\u03a1\\u03a3-\\u03f5\\u03f7-\\u0481\\u048a-\\u0527\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05d0-\\u05ea\\u05f0-\\u05f2\\u0620-\\u064a\\u066e\\u066f\\u0671-\\u06d3\\u06d5\\u06e5\\u06e6\\u06ee\\u06ef\\u06fa-\\u06fc\\u06ff\\u0710\\u0712-\\u072f\\u074d-\\u07a5\\u07b1\\u07ca-\\u07ea\\u07f4\\u07f5\\u07fa\\u0800-\\u0815\\u081a\\u0824\\u0828\\u0840-\\u0858\\u08a0\\u08a2-\\u08ac\\u0904-\\u0939\\u093d\\u0950\\u0958-\\u0961\\u0971-\\u0977\\u0979-\\u097f\\u0985-\\u098c\\u098f\\u0990\\u0993-\\u09a8\\u09aa-\\u09b0\\u09b2\\u09b6-\\u09b9\\u09bd\\u09ce\\u09dc\\u09dd\\u09df-\\u09e1\\u09f0\\u09f1\\u0a05-\\u0a0a\\u0a0f\\u0a10\\u0a13-\\u0a28\\u0a2a-\\u0a30\\u0a32\\u0a33\\u0a35\\u0a36\\u0a38\\u0a39\\u0a59-\\u0a5c\\u0a5e\\u0a72-\\u0a74\\u0a85-\\u0a8d\\u0a8f-\\u0a91\\u0a93-\\u0aa8\\u0aaa-\\u0ab0\\u0ab2\\u0ab3\\u0ab5-\\u0ab9\\u0abd\\u0ad0\\u0ae0\\u0ae1\\u0b05-\\u0b0c\\u0b0f\\u0b10\\u0b13-\\u0b28\\u0b2a-\\u0b30\\u0b32\\u0b33\\u0b35-\\u0b39\\u0b3d\\u0b5c\\u0b5d\\u0b5f-\\u0b61\\u0b71\\u0b83\\u0b85-\\u0b8a\\u0b8e-\\u0b90\\u0b92-\\u0b95\\u0b99\\u0b9a\\u0b9c\\u0b9e\\u0b9f\\u0ba3\\u0ba4\\u0ba8-\\u0baa\\u0bae-\\u0bb9\\u0bd0\\u0c05-\\u0c0c\\u0c0e-\\u0c10\\u0c12-\\u0c28\\u0c2a-\\u0c33\\u0c35-\\u0c39\\u0c3d\\u0c58\\u0c59\\u0c60\\u0c61\\u0c85-\\u0c8c\\u0c8e-\\u0c90\\u0c92-\\u0ca8\\u0caa-\\u0cb3\\u0cb5-\\u0cb9\\u0cbd\\u0cde\\u0ce0\\u0ce1\\u0cf1\\u0cf2\\u0d05-\\u0d0c\\u0d0e-\\u0d10\\u0d12-\\u0d3a\\u0d3d\\u0d4e\\u0d60\\u0d61\\u0d7a-\\u0d7f\\u0d85-\\u0d96\\u0d9a-\\u0db1\\u0db3-\\u0dbb\\u0dbd\\u0dc0-\\u0dc6\\u0e01-\\u0e30\\u0e32\\u0e33\\u0e40-\\u0e46\\u0e81\\u0e82\\u0e84\\u0e87\\u0e88\\u0e8a\\u0e8d\\u0e94-\\u0e97\\u0e99-\\u0e9f\\u0ea1-\\u0ea3\\u0ea5\\u0ea7\\u0eaa\\u0eab\\u0ead-\\u0eb0\\u0eb2\\u0eb3\\u0ebd\\u0ec0-\\u0ec4\\u0ec6\\u0edc-\\u0edf\\u0f00\\u0f40-\\u0f47\\u0f49-\\u0f6c\\u0f88-\\u0f8c\\u1000-\\u102a\\u103f\\u1050-\\u1055\\u105a-\\u105d\\u1061\\u1065\\u1066\\u106e-\\u1070\\u1075-\\u1081\\u108e\\u10a0-\\u10c5\\u10c7\\u10cd\\u10d0-\\u10fa\\u10fc-\\u1248\\u124a-\\u124d\\u1250-\\u1256\\u1258\\u125a-\\u125d\\u1260-\\u1288\\u128a-\\u128d\\u1290-\\u12b0\\u12b2-\\u12b5\\u12b8-\\u12be\\u12c0\\u12c2-\\u12c5\\u12c8-\\u12d6\\u12d8-\\u1310\\u1312-\\u1315\\u1318-\\u135a\\u1380-\\u138f\\u13a0-\\u13f4\\u1401-\\u166c\\u166f-\\u167f\\u1681-\\u169a\\u16a0-\\u16ea\\u16ee-\\u16f0\\u1700-\\u170c\\u170e-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176c\\u176e-\\u1770\\u1780-\\u17b3\\u17d7\\u17dc\\u1820-\\u1877\\u1880-\\u18a8\\u18aa\\u18b0-\\u18f5\\u1900-\\u191c\\u1950-\\u196d\\u1970-\\u1974\\u1980-\\u19ab\\u19c1-\\u19c7\\u1a00-\\u1a16\\u1a20-\\u1a54\\u1aa7\\u1b05-\\u1b33\\u1b45-\\u1b4b\\u1b83-\\u1ba0\\u1bae\\u1baf\\u1bba-\\u1be5\\u1c00-\\u1c23\\u1c4d-\\u1c4f\\u1c5a-\\u1c7d\\u1ce9-\\u1cec\\u1cee-\\u1cf1\\u1cf5\\u1cf6\\u1d00-\\u1dbf\\u1e00-\\u1f15\\u1f18-\\u1f1d\\u1f20-\\u1f45\\u1f48-\\u1f4d\\u1f50-\\u1f57\\u1f59\\u1f5b\\u1f5d\\u1f5f-\\u1f7d\\u1f80-\\u1fb4\\u1fb6-\\u1fbc\\u1fbe\\u1fc2-\\u1fc4\\u1fc6-\\u1fcc\\u1fd0-\\u1fd3\\u1fd6-\\u1fdb\\u1fe0-\\u1fec\\u1ff2-\\u1ff4\\u1ff6-\\u1ffc\\u2071\\u207f\\u2090-\\u209c\\u2102\\u2107\\u210a-\\u2113\\u2115\\u2119-\\u211d\\u2124\\u2126\\u2128\\u212a-\\u212d\\u212f-\\u2139\\u213c-\\u213f\\u2145-\\u2149\\u214e\\u2160-\\u2188\\u2c00-\\u2c2e\\u2c30-\\u2c5e\\u2c60-\\u2ce4\\u2ceb-\\u2cee\\u2cf2\\u2cf3\\u2d00-\\u2d25\\u2d27\\u2d2d\\u2d30-\\u2d67\\u2d6f\\u2d80-\\u2d96\\u2da0-\\u2da6\\u2da8-\\u2dae\\u2db0-\\u2db6\\u2db8-\\u2dbe\\u2dc0-\\u2dc6\\u2dc8-\\u2dce\\u2dd0-\\u2dd6\\u2dd8-\\u2dde\\u2e2f\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303c\\u3041-\\u3096\\u309d-\\u309f\\u30a1-\\u30fa\\u30fc-\\u30ff\\u3105-\\u312d\\u3131-\\u318e\\u31a0-\\u31ba\\u31f0-\\u31ff\\u3400-\\u4db5\\u4e00-\\u9fcc\\ua000-\\ua48c\\ua4d0-\\ua4fd\\ua500-\\ua60c\\ua610-\\ua61f\\ua62a\\ua62b\\ua640-\\ua66e\\ua67f-\\ua697\\ua6a0-\\ua6ef\\ua717-\\ua71f\\ua722-\\ua788\\ua78b-\\ua78e\\ua790-\\ua793\\ua7a0-\\ua7aa\\ua7f8-\\ua801\\ua803-\\ua805\\ua807-\\ua80a\\ua80c-\\ua822\\ua840-\\ua873\\ua882-\\ua8b3\\ua8f2-\\ua8f7\\ua8fb\\ua90a-\\ua925\\ua930-\\ua946\\ua960-\\ua97c\\ua984-\\ua9b2\\ua9cf\\uaa00-\\uaa28\\uaa40-\\uaa42\\uaa44-\\uaa4b\\uaa60-\\uaa76\\uaa7a\\uaa80-\\uaaaf\\uaab1\\uaab5\\uaab6\\uaab9-\\uaabd\\uaac0\\uaac2\\uaadb-\\uaadd\\uaae0-\\uaaea\\uaaf2-\\uaaf4\\uab01-\\uab06\\uab09-\\uab0e\\uab11-\\uab16\\uab20-\\uab26\\uab28-\\uab2e\\uabc0-\\uabe2\\uac00-\\ud7a3\\ud7b0-\\ud7c6\\ud7cb-\\ud7fb\\uf900-\\ufa6d\\ufa70-\\ufad9\\ufb00-\\ufb06\\ufb13-\\ufb17\\ufb1d\\ufb1f-\\ufb28\\ufb2a-\\ufb36\\ufb38-\\ufb3c\\ufb3e\\ufb40\\ufb41\\ufb43\\ufb44\\ufb46-\\ufbb1\\ufbd3-\\ufd3d\\ufd50-\\ufd8f\\ufd92-\\ufdc7\\ufdf0-\\ufdfb\\ufe70-\\ufe74\\ufe76-\\ufefc\\uff21-\\uff3a\\uff41-\\uff5a\\uff66-\\uffbe\\uffc2-\\uffc7\\uffca-\\uffcf\\uffd2-\\uffd7\\uffda-\\uffdc\\u0300-\\u036f\\u0483-\\u0487\\u0591-\\u05bd\\u05bf\\u05c1\\u05c2\\u05c4\\u05c5\\u05c7\\u0610-\\u061a\\u0620-\\u0649\\u0672-\\u06d3\\u06e7-\\u06e8\\u06fb-\\u06fc\\u0730-\\u074a\\u0800-\\u0814\\u081b-\\u0823\\u0825-\\u0827\\u0829-\\u082d\\u0840-\\u0857\\u08e4-\\u08fe\\u0900-\\u0903\\u093a-\\u093c\\u093e-\\u094f\\u0951-\\u0957\\u0962-\\u0963\\u0966-\\u096f\\u0981-\\u0983\\u09bc\\u09be-\\u09c4\\u09c7\\u09c8\\u09d7\\u09df-\\u09e0\\u0a01-\\u0a03\\u0a3c\\u0a3e-\\u0a42\\u0a47\\u0a48\\u0a4b-\\u0a4d\\u0a51\\u0a66-\\u0a71\\u0a75\\u0a81-\\u0a83\\u0abc\\u0abe-\\u0ac5\\u0ac7-\\u0ac9\\u0acb-\\u0acd\\u0ae2-\\u0ae3\\u0ae6-\\u0aef\\u0b01-\\u0b03\\u0b3c\\u0b3e-\\u0b44\\u0b47\\u0b48\\u0b4b-\\u0b4d\\u0b56\\u0b57\\u0b5f-\\u0b60\\u0b66-\\u0b6f\\u0b82\\u0bbe-\\u0bc2\\u0bc6-\\u0bc8\\u0bca-\\u0bcd\\u0bd7\\u0be6-\\u0bef\\u0c01-\\u0c03\\u0c46-\\u0c48\\u0c4a-\\u0c4d\\u0c55\\u0c56\\u0c62-\\u0c63\\u0c66-\\u0c6f\\u0c82\\u0c83\\u0cbc\\u0cbe-\\u0cc4\\u0cc6-\\u0cc8\\u0cca-\\u0ccd\\u0cd5\\u0cd6\\u0ce2-\\u0ce3\\u0ce6-\\u0cef\\u0d02\\u0d03\\u0d46-\\u0d48\\u0d57\\u0d62-\\u0d63\\u0d66-\\u0d6f\\u0d82\\u0d83\\u0dca\\u0dcf-\\u0dd4\\u0dd6\\u0dd8-\\u0ddf\\u0df2\\u0df3\\u0e34-\\u0e3a\\u0e40-\\u0e45\\u0e50-\\u0e59\\u0eb4-\\u0eb9\\u0ec8-\\u0ecd\\u0ed0-\\u0ed9\\u0f18\\u0f19\\u0f20-\\u0f29\\u0f35\\u0f37\\u0f39\\u0f41-\\u0f47\\u0f71-\\u0f84\\u0f86-\\u0f87\\u0f8d-\\u0f97\\u0f99-\\u0fbc\\u0fc6\\u1000-\\u1029\\u1040-\\u1049\\u1067-\\u106d\\u1071-\\u1074\\u1082-\\u108d\\u108f-\\u109d\\u135d-\\u135f\\u170e-\\u1710\\u1720-\\u1730\\u1740-\\u1750\\u1772\\u1773\\u1780-\\u17b2\\u17dd\\u17e0-\\u17e9\\u180b-\\u180d\\u1810-\\u1819\\u1920-\\u192b\\u1930-\\u193b\\u1951-\\u196d\\u19b0-\\u19c0\\u19c8-\\u19c9\\u19d0-\\u19d9\\u1a00-\\u1a15\\u1a20-\\u1a53\\u1a60-\\u1a7c\\u1a7f-\\u1a89\\u1a90-\\u1a99\\u1b46-\\u1b4b\\u1b50-\\u1b59\\u1b6b-\\u1b73\\u1bb0-\\u1bb9\\u1be6-\\u1bf3\\u1c00-\\u1c22\\u1c40-\\u1c49\\u1c5b-\\u1c7d\\u1cd0-\\u1cd2\\u1d00-\\u1dbe\\u1e01-\\u1f15\\u200c\\u200d\\u203f\\u2040\\u2054\\u20d0-\\u20dc\\u20e1\\u20e5-\\u20f0\\u2d81-\\u2d96\\u2de0-\\u2dff\\u3021-\\u3028\\u3099\\u309a\\ua640-\\ua66d\\ua674-\\ua67d\\ua69f\\ua6f0-\\ua6f1\\ua7f8-\\ua800\\ua806\\ua80b\\ua823-\\ua827\\ua880-\\ua881\\ua8b4-\\ua8c4\\ua8d0-\\ua8d9\\ua8f3-\\ua8f7\\ua900-\\ua909\\ua926-\\ua92d\\ua930-\\ua945\\ua980-\\ua983\\ua9b3-\\ua9c0\\uaa00-\\uaa27\\uaa40-\\uaa41\\uaa4c-\\uaa4d\\uaa50-\\uaa59\\uaa7b\\uaae0-\\uaae9\\uaaf2-\\uaaf3\\uabc0-\\uabe1\\uabec\\uabed\\uabf0-\\uabf9\\ufb20-\\ufb28\\ufe00-\\ufe0f\\ufe20-\\ufe26\\ufe33\\ufe34\\ufe4d-\\ufe4f\\uff10-\\uff19\\uff3f])*","g"),e.identifierStart=new RegExp(i),e.identifierMatch=new RegExp("(?:\\\\u[0-9a-fA-F]{4}|[\\x24\\x30-\\x39\\x41-\\x5a\\x5f\\x61-\\x7a"+u+"\\u0300-\\u036f\\u0483-\\u0487\\u0591-\\u05bd\\u05bf\\u05c1\\u05c2\\u05c4\\u05c5\\u05c7\\u0610-\\u061a\\u0620-\\u0649\\u0672-\\u06d3\\u06e7-\\u06e8\\u06fb-\\u06fc\\u0730-\\u074a\\u0800-\\u0814\\u081b-\\u0823\\u0825-\\u0827\\u0829-\\u082d\\u0840-\\u0857\\u08e4-\\u08fe\\u0900-\\u0903\\u093a-\\u093c\\u093e-\\u094f\\u0951-\\u0957\\u0962-\\u0963\\u0966-\\u096f\\u0981-\\u0983\\u09bc\\u09be-\\u09c4\\u09c7\\u09c8\\u09d7\\u09df-\\u09e0\\u0a01-\\u0a03\\u0a3c\\u0a3e-\\u0a42\\u0a47\\u0a48\\u0a4b-\\u0a4d\\u0a51\\u0a66-\\u0a71\\u0a75\\u0a81-\\u0a83\\u0abc\\u0abe-\\u0ac5\\u0ac7-\\u0ac9\\u0acb-\\u0acd\\u0ae2-\\u0ae3\\u0ae6-\\u0aef\\u0b01-\\u0b03\\u0b3c\\u0b3e-\\u0b44\\u0b47\\u0b48\\u0b4b-\\u0b4d\\u0b56\\u0b57\\u0b5f-\\u0b60\\u0b66-\\u0b6f\\u0b82\\u0bbe-\\u0bc2\\u0bc6-\\u0bc8\\u0bca-\\u0bcd\\u0bd7\\u0be6-\\u0bef\\u0c01-\\u0c03\\u0c46-\\u0c48\\u0c4a-\\u0c4d\\u0c55\\u0c56\\u0c62-\\u0c63\\u0c66-\\u0c6f\\u0c82\\u0c83\\u0cbc\\u0cbe-\\u0cc4\\u0cc6-\\u0cc8\\u0cca-\\u0ccd\\u0cd5\\u0cd6\\u0ce2-\\u0ce3\\u0ce6-\\u0cef\\u0d02\\u0d03\\u0d46-\\u0d48\\u0d57\\u0d62-\\u0d63\\u0d66-\\u0d6f\\u0d82\\u0d83\\u0dca\\u0dcf-\\u0dd4\\u0dd6\\u0dd8-\\u0ddf\\u0df2\\u0df3\\u0e34-\\u0e3a\\u0e40-\\u0e45\\u0e50-\\u0e59\\u0eb4-\\u0eb9\\u0ec8-\\u0ecd\\u0ed0-\\u0ed9\\u0f18\\u0f19\\u0f20-\\u0f29\\u0f35\\u0f37\\u0f39\\u0f41-\\u0f47\\u0f71-\\u0f84\\u0f86-\\u0f87\\u0f8d-\\u0f97\\u0f99-\\u0fbc\\u0fc6\\u1000-\\u1029\\u1040-\\u1049\\u1067-\\u106d\\u1071-\\u1074\\u1082-\\u108d\\u108f-\\u109d\\u135d-\\u135f\\u170e-\\u1710\\u1720-\\u1730\\u1740-\\u1750\\u1772\\u1773\\u1780-\\u17b2\\u17dd\\u17e0-\\u17e9\\u180b-\\u180d\\u1810-\\u1819\\u1920-\\u192b\\u1930-\\u193b\\u1951-\\u196d\\u19b0-\\u19c0\\u19c8-\\u19c9\\u19d0-\\u19d9\\u1a00-\\u1a15\\u1a20-\\u1a53\\u1a60-\\u1a7c\\u1a7f-\\u1a89\\u1a90-\\u1a99\\u1b46-\\u1b4b\\u1b50-\\u1b59\\u1b6b-\\u1b73\\u1bb0-\\u1bb9\\u1be6-\\u1bf3\\u1c00-\\u1c22\\u1c40-\\u1c49\\u1c5b-\\u1c7d\\u1cd0-\\u1cd2\\u1d00-\\u1dbe\\u1e01-\\u1f15\\u200c\\u200d\\u203f\\u2040\\u2054\\u20d0-\\u20dc\\u20e1\\u20e5-\\u20f0\\u2d81-\\u2d96\\u2de0-\\u2dff\\u3021-\\u3028\\u3099\\u309a\\ua640-\\ua66d\\ua674-\\ua67d\\ua69f\\ua6f0-\\ua6f1\\ua7f8-\\ua800\\ua806\\ua80b\\ua823-\\ua827\\ua880-\\ua881\\ua8b4-\\ua8c4\\ua8d0-\\ua8d9\\ua8f3-\\ua8f7\\ua900-\\ua909\\ua926-\\ua92d\\ua930-\\ua945\\ua980-\\ua983\\ua9b3-\\ua9c0\\uaa00-\\uaa27\\uaa40-\\uaa41\\uaa4c-\\uaa4d\\uaa50-\\uaa59\\uaa7b\\uaae0-\\uaae9\\uaaf2-\\uaaf3\\uabc0-\\uabe1\\uabec\\uabed\\uabf0-\\uabf9\\ufb20-\\ufb28\\ufe00-\\ufe0f\\ufe20-\\ufe26\\ufe33\\ufe34\\ufe4d-\\ufe4f\\uff10-\\uff19\\uff3f])+"),e.newline=/[\n\r\u2028\u2029]/,e.lineBreak=new RegExp("\r\n|"+e.newline.source),e.allLineBreaks=new RegExp(e.lineBreak.source,"g")},function(t,e,u){var i=u(6).Options,n=["before-newline","after-newline","preserve-newline"];function _(t){i.call(this,t,"js");var e=("expand-strict"===(t=this.raw_options.brace_style||null)?this.raw_options.brace_style="expand":"collapse-preserve-inline"===t?this.raw_options.brace_style="collapse,preserve-inline":void 0!==this.raw_options.braces_on_own_line&&(this.raw_options.brace_style=this.raw_options.braces_on_own_line?"expand":"collapse"),this._get_selection_list("brace_style",["collapse","expand","end-expand","none","preserve-inline"]));this.brace_preserve_inline=!1,this.brace_style="collapse";for(var u=0;u<e.length;u++)"preserve-inline"===e[u]?this.brace_preserve_inline=!0:this.brace_style=e[u];this.unindent_chained_methods=this._get_boolean("unindent_chained_methods"),this.break_chained_methods=this._get_boolean("break_chained_methods"),this.space_in_paren=this._get_boolean("space_in_paren"),this.space_in_empty_paren=this._get_boolean("space_in_empty_paren"),this.jslint_happy=this._get_boolean("jslint_happy"),this.space_after_anon_function=this._get_boolean("space_after_anon_function"),this.space_after_named_function=this._get_boolean("space_after_named_function"),this.keep_array_indentation=this._get_boolean("keep_array_indentation"),this.space_before_conditional=this._get_boolean("space_before_conditional",!0),this.unescape_strings=this._get_boolean("unescape_strings"),this.e4x=this._get_boolean("e4x"),this.comma_first=this._get_boolean("comma_first"),this.operator_position=this._get_selection("operator_position",n),this.test_output_raw=this._get_boolean("test_output_raw"),this.jslint_happy&&(this.space_after_anon_function=!0)}_.prototype=new i,t.exports.Options=_},function(t){function e(t,e){this.raw_options=u(t,e),this.disabled=this._get_boolean("disabled"),this.eol=this._get_characters("eol","auto"),this.end_with_newline=this._get_boolean("end_with_newline"),this.indent_size=this._get_number("indent_size",4),this.indent_char=this._get_characters("indent_char"," "),this.indent_level=this._get_number("indent_level"),this.preserve_newlines=this._get_boolean("preserve_newlines",!0),this.max_preserve_newlines=this._get_number("max_preserve_newlines",32786),this.preserve_newlines||(this.max_preserve_newlines=0),this.indent_with_tabs=this._get_boolean("indent_with_tabs","\t"===this.indent_char),this.indent_with_tabs&&(this.indent_char="\t",1===this.indent_size&&(this.indent_size=4)),this.wrap_line_length=this._get_number("wrap_line_length",this._get_number("max_char")),this.indent_empty_lines=this._get_boolean("indent_empty_lines"),this.templating=this._get_selection_list("templating",["auto","none","django","erb","handlebars","php","smarty"],["auto"])}function u(t,e){var u,n={};for(u in t=i(t))u!==e&&(n[u]=t[u]);if(e&&t[e])for(u in t[e])n[u]=t[e][u];return n}function i(t){var e,u={};for(e in t)u[e.replace(/-/g,"_")]=t[e];return u}e.prototype._get_array=function(t,e){return e=e||[],"object"==typeof(t=this.raw_options[t])?null!==t&&"function"==typeof t.concat&&(e=t.concat()):"string"==typeof t&&(e=t.split(/[^a-zA-Z0-9_\/\-]+/)),e},e.prototype._get_boolean=function(t,e){return void 0===(t=this.raw_options[t])?!!e:!!t},e.prototype._get_characters=function(t,e){return e=e||"","string"==typeof(t=this.raw_options[t])?t.replace(/\\r/,"\r").replace(/\\n/,"\n").replace(/\\t/,"\t"):e},e.prototype._get_number=function(t,e){return t=this.raw_options[t],e=parseInt(e,10),isNaN(e)&&(e=0),t=parseInt(t,10),isNaN(t)?e:t},e.prototype._get_selection=function(t,e,u){if(1!==(u=this._get_selection_list(t,e,u)).length)throw new Error("Invalid Option Value: The option '"+t+"' can only be one of the following values:\n"+e+"\nYou passed in: '"+this.raw_options[t]+"'");return u[0]},e.prototype._get_selection_list=function(t,e,u){if(!e||0===e.length)throw new Error("Selection list cannot be empty.");if(u=u||[e[0]],!this._is_valid_selection(u,e))throw new Error("Invalid Default Value!");if(u=this._get_array(t,u),this._is_valid_selection(u,e))return u;throw new Error("Invalid Option Value: The option '"+t+"' can contain only the following values:\n"+e+"\nYou passed in: '"+this.raw_options[t]+"'")},e.prototype._is_valid_selection=function(t,e){return t.length&&e.length&&!t.some(function(t){return-1===e.indexOf(t)})},t.exports.Options=e,t.exports.normalizeOpts=i,t.exports.mergeOpts=u},function(t,e,u){var i=u(8).InputScanner,n=u(9).Tokenizer,_=u(9).TOKEN,s=u(13).Directives,a=u(4),o=u(12).Pattern,r=u(14).TemplatablePattern;function h(t,e){return-1!==e.indexOf(t)}function p(t,e){n.call(this,t,e),this._patterns.whitespace=this._patterns.whitespace.matching(/\u00A0\u1680\u180e\u2000-\u200a\u202f\u205f\u3000\ufeff/.source,/\u2028\u2029/.source),t=new o(this._input),e=new r(this._input).read_options(this._options),this.__patterns={template:e,identifier:e.starting_with(a.identifier).matching(a.identifierMatch),number:t.matching(d),punct:t.matching(k),comment:t.starting_with(/\/\//).until(/[\n\r\u2028\u2029]/),block_comment:t.starting_with(/\/\*/).until_after(/\*\//),html_comment_start:t.matching(/<!--/),html_comment_end:t.matching(/-->/),include:t.starting_with(/#include/).until_after(a.lineBreak),shebang:t.starting_with(/#!/).until_after(a.lineBreak),xml:t.matching(/[\s\S]*?<(\/?)([-a-zA-Z:0-9_.]+|{[^}]+?}|!\[CDATA\[[^\]]*?\]\]|)(\s*{[^}]+?}|\s+[-a-zA-Z:0-9_.]+|\s+[-a-zA-Z:0-9_.]+\s*=\s*('[^']*'|"[^"]*"|{([^{}]|{[^}]+?})+?}))*\s*(\/?)\s*>/),single_quote:e.until(/['\\\n\r\u2028\u2029]/),double_quote:e.until(/["\\\n\r\u2028\u2029]/),template_text:e.until(/[`\\$]/),template_expression:e.until(/[`}\\]/)}}var l,f={START_EXPR:"TK_START_EXPR",END_EXPR:"TK_END_EXPR",START_BLOCK:"TK_START_BLOCK",END_BLOCK:"TK_END_BLOCK",WORD:"TK_WORD",RESERVED:"TK_RESERVED",SEMICOLON:"TK_SEMICOLON",STRING:"TK_STRING",EQUALS:"TK_EQUALS",OPERATOR:"TK_OPERATOR",COMMA:"TK_COMMA",BLOCK_COMMENT:"TK_BLOCK_COMMENT",COMMENT:"TK_COMMENT",DOT:"TK_DOT",UNKNOWN:"TK_UNKNOWN",START:_.START,RAW:_.RAW,EOF:_.EOF},c=new s(/\/\*/,/\*\//),d=/0[xX][0123456789abcdefABCDEF_]*n?|0[oO][01234567_]*n?|0[bB][01_]*n?|\d[\d_]*n|(?:\.\d[\d_]*|\d[\d_]*\.?[\d_]*)(?:[eE][+-]?[\d_]+)?/,b=/[0-9]/,g=/[^\d\.]/,k=(u=">>> === !== &&= ??= ||= << && >= ** != == <= >> || ?? |> < / - + > : & % ? ^ | *".split(" "),_=(_="\\?\\.(?!\\d) "+(_=(_=">>>= ... >>= <<= === >>> !== **= &&= ??= ||= => ^= :: /= << <= == && -= >= >> != -- += ** || ?? ++ %= &= *= |= |> = ! ? > < : / ^ - + * & % ~ |").replace(/[-[\]{}()*+?.,\\^$|#]/g,"\\$&"))).replace(/ /g,"|"),new RegExp(_)),m=(_=(s="continue,try,throw,return,var,let,const,if,switch,case,default,for,while,break,function,import,export".split(",")).concat(["do","in","of","else","get","set","new","catch","finally","typeof","yield","async","await","from","as","class","extends"]),new RegExp("^(?:"+_.join("|")+")$"));(p.prototype=new n)._is_comment=function(t){return t.type===f.COMMENT||t.type===f.BLOCK_COMMENT||t.type===f.UNKNOWN},p.prototype._is_opening=function(t){return t.type===f.START_BLOCK||t.type===f.START_EXPR},p.prototype._is_closing=function(t,e){return(t.type===f.END_BLOCK||t.type===f.END_EXPR)&&e&&("]"===t.text&&"["===e.text||")"===t.text&&"("===e.text||"}"===t.text&&"{"===e.text)},p.prototype._reset=function(){l=!1},p.prototype._get_next_token=function(t,e){this._readWhitespace();var u=this._input.peek();return null===u?this._create_token(f.EOF,""):this._read_non_javascript(u)||this._read_string(u)||this._read_word(t)||this._read_singles(u)||this._read_comment(u)||this._read_regexp(u,t)||this._read_xml(u,t)||this._read_punctuation()||this._create_token(f.UNKNOWN,this._input.next())},p.prototype._read_word=function(t){var e=this.__patterns.identifier.read();return""!==e?(e=e.replace(a.allLineBreaks,"\n"),t.type!==f.DOT&&(t.type!==f.RESERVED||"set"!==t.text&&"get"!==t.text)&&m.test(e)?"in"!==e&&"of"!==e||t.type!==f.WORD&&t.type!==f.STRING?this._create_token(f.RESERVED,e):this._create_token(f.OPERATOR,e):this._create_token(f.WORD,e)):""!==(e=this.__patterns.number.read())?this._create_token(f.WORD,e):void 0},p.prototype._read_singles=function(t){var e=null;return"("===t||"["===t?e=this._create_token(f.START_EXPR,t):")"===t||"]"===t?e=this._create_token(f.END_EXPR,t):"{"===t?e=this._create_token(f.START_BLOCK,t):"}"===t?e=this._create_token(f.END_BLOCK,t):";"===t?e=this._create_token(f.SEMICOLON,t):"."===t&&g.test(this._input.peek(1))?e=this._create_token(f.DOT,t):","===t&&(e=this._create_token(f.COMMA,t)),e&&this._input.next(),e},p.prototype._read_punctuation=function(){var t=this.__patterns.punct.read();if(""!==t)return"="===t?this._create_token(f.EQUALS,t):"?."===t?this._create_token(f.DOT,t):this._create_token(f.OPERATOR,t)},p.prototype._read_non_javascript=function(t){var e="";if("#"===t){if(this._is_first_token()&&(e=this.__patterns.shebang.read()))return this._create_token(f.UNKNOWN,e.trim()+"\n");if(e=this.__patterns.include.read())return this._create_token(f.UNKNOWN,e.trim()+"\n");t=this._input.next();var u="#";if(this._input.hasNext()&&this._input.testChar(b)){for(;u+=t=this._input.next(),this._input.hasNext()&&"#"!==t&&"="!==t;);return"#"!==t&&("["===this._input.peek()&&"]"===this._input.peek(1)?(u+="[]",this._input.next(),this._input.next()):"{"===this._input.peek()&&"}"===this._input.peek(1)&&(u+="{}",this._input.next(),this._input.next())),this._create_token(f.WORD,u)}this._input.back()}else if("<"===t&&this._is_first_token()){if(e=this.__patterns.html_comment_start.read()){for(;this._input.hasNext()&&!this._input.testChar(a.newline);)e+=this._input.next();return l=!0,this._create_token(f.COMMENT,e)}}else if(l&&"-"===t&&(e=this.__patterns.html_comment_end.read()))return l=!1,this._create_token(f.COMMENT,e);return null},p.prototype._read_comment=function(t){var e,u=null;return"/"===t&&(t="","*"===this._input.peek(1)?(t=this.__patterns.block_comment.read(),(e=c.get_directives(t))&&"start"===e.ignore&&(t+=c.readIgnored(this._input)),t=t.replace(a.allLineBreaks,"\n"),(u=this._create_token(f.BLOCK_COMMENT,t)).directives=e):"/"===this._input.peek(1)&&(t=this.__patterns.comment.read(),u=this._create_token(f.COMMENT,t))),u},p.prototype._read_string=function(t){var e;return"`"===t||"'"===t||'"'===t?(e=this._input.next(),this.has_char_escapes=!1,e+="`"===t?this._read_string_recursive("`",!0,"${"):this._read_string_recursive(t),this.has_char_escapes&&this._options.unescape_strings&&(e=function(t){for(var e="",u=0,n=new i(t),_=null;n.hasNext();)if((_=n.match(/([\s]|[^\\]|\\\\)+/g))&&(e+=_[0]),"\\"===n.peek()){if(n.next(),"x"===n.peek())_=n.match(/x([0-9A-Fa-f]{2})/g);else{if("u"!==n.peek()){e+="\\",n.hasNext()&&(e+=n.next());continue}_=n.match(/u([0-9A-Fa-f]{4})/g)}if(!_)return t;if(126<(u=parseInt(_[1],16))&&u<=255&&0===_[0].indexOf("x"))return t;e+=0<=u&&u<32?"\\"+_[0]:34===u||39===u||92===u?"\\"+String.fromCharCode(u):String.fromCharCode(u)}return e}(e)),this._input.peek()===t&&(e+=this._input.next()),e=e.replace(a.allLineBreaks,"\n"),this._create_token(f.STRING,e)):null},p.prototype._allow_regexp_or_xml=function(t){return t.type===f.RESERVED&&h(t.text,["return","case","throw","else","do","typeof","yield"])||t.type===f.END_EXPR&&")"===t.text&&t.opened.previous.type===f.RESERVED&&h(t.opened.previous.text,["if","while","for"])||h(t.type,[f.COMMENT,f.START_EXPR,f.START_BLOCK,f.START,f.END_BLOCK,f.OPERATOR,f.EQUALS,f.EOF,f.SEMICOLON,f.COMMA])},p.prototype._read_regexp=function(t,e){if("/"===t&&this._allow_regexp_or_xml(e)){for(var u=this._input.next(),i=!1,n=!1;this._input.hasNext()&&(i||n||this._input.peek()!==t)&&!this._input.testChar(a.newline);)u+=this._input.peek(),i?i=!1:(i="\\"===this._input.peek(),"["===this._input.peek()?n=!0:"]"===this._input.peek()&&(n=!1)),this._input.next();return this._input.peek()===t&&(u=(u+=this._input.next())+this._input.read(a.identifier)),this._create_token(f.STRING,u)}return null},p.prototype._read_xml=function(t,e){if(this._options.e4x&&"<"===t&&this._allow_regexp_or_xml(e)){var u="",i=this.__patterns.xml.read_match();if(i){for(var n=i[2].replace(/^{\s+/,"{").replace(/\s+}$/,"}"),_=0===n.indexOf("{"),s=0;i;){var o=!!i[1],r=i[2];if(!(i[i.length-1]||"![CDATA["===r.slice(0,8))&&(r===n||_&&r.replace(/^{\s+/,"{").replace(/\s+}$/,"}"))&&(o?--s:++s),u+=i[0],s<=0)break;i=this.__patterns.xml.read_match()}return i||(u+=this._input.match(/[\s\S]*/g)[0]),u=u.replace(a.allLineBreaks,"\n"),this._create_token(f.STRING,u)}}return null},p.prototype._read_string_recursive=function(t,e,u){"'"===t?n=this.__patterns.single_quote:'"'===t?n=this.__patterns.double_quote:"`"===t?n=this.__patterns.template_text:"}"===t&&(n=this.__patterns.template_expression);for(var i,n,_=n.read(),s="";this._input.hasNext();){if((s=this._input.next())===t||!e&&a.newline.test(s)){this._input.back();break}"\\"===s&&this._input.hasNext()?("x"===(i=this._input.peek())||"u"===i?this.has_char_escapes=!0:"\r"===i&&"\n"===this._input.peek(1)&&this._input.next(),s+=this._input.next()):u&&("${"===u&&"$"===s&&"{"===this._input.peek()&&(s+=this._input.next()),u===s&&(s+="`"===t?this._read_string_recursive("}",e,"`"):this._read_string_recursive("`",e,"${"),this._input.hasNext()&&(s+=this._input.next()))),_+=s+=n.read()}return _},t.exports.Tokenizer=p,t.exports.TOKEN=f,t.exports.positionable_operators=u.slice(),t.exports.line_starters=s.slice()},function(t){var e=RegExp.prototype.hasOwnProperty("sticky");function u(t){this.__input=t||"",this.__input_length=this.__input.length,this.__position=0}u.prototype.restart=function(){this.__position=0},u.prototype.back=function(){0<this.__position&&--this.__position},u.prototype.hasNext=function(){return this.__position<this.__input_length},u.prototype.next=function(){var t=null;return this.hasNext()&&(t=this.__input.charAt(this.__position),this.__position+=1),t},u.prototype.peek=function(t){var e=null;return t=t||0,0<=(t+=this.__position)&&t<this.__input_length?this.__input.charAt(t):e},u.prototype.__match=function(t,u){t.lastIndex=u;var i=t.exec(this.__input);return!i||e&&t.sticky||i.index!==u&&(i=null),i},u.prototype.test=function(t,e){return e=e||0,0<=(e+=this.__position)&&e<this.__input_length&&!!this.__match(t,e)},u.prototype.testChar=function(t,e){return e=this.peek(e),t.lastIndex=0,null!==e&&t.test(e)},u.prototype.match=function(t){return(t=this.__match(t,this.__position))?this.__position+=t[0].length:t=null,t},u.prototype.read=function(t,e,u){var i,n="";return t&&(i=this.match(t))&&(n+=i[0]),!e||!i&&t||(n+=this.readUntil(e,u)),n},u.prototype.readUntil=function(t,e){var u=this.__position;return(t=(t.lastIndex=this.__position,t.exec(this.__input)))?(u=t.index,e&&(u+=t[0].length)):u=this.__input_length,e=this.__input.substring(this.__position,u),this.__position=u,e},u.prototype.readUntilAfter=function(t){return this.readUntil(t,!0)},u.prototype.get_regexp=function(t,u){var i=null;u=u&&e?"y":"g";return"string"==typeof t&&""!==t?i=new RegExp(t,u):t&&(i=new RegExp(t.source,u)),i},u.prototype.get_literal_regexp=function(t){return RegExp(t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"))},u.prototype.peekUntilAfter=function(t){var e=this.__position;t=this.readUntilAfter(t);return this.__position=e,t},u.prototype.lookBack=function(t){var e=this.__position-1;return e>=t.length&&this.__input.substring(e-t.length,e).toLowerCase()===t},t.exports.InputScanner=u},function(t,e,u){function i(t,e){this._input=new n(t),this._options=e||{},this.__tokens=null,this._patterns={},this._patterns.whitespace=new a(this._input)}var n=u(8).InputScanner,_=u(3).Token,s=u(10).TokenStream,a=u(11).WhitespacePattern,o={START:"TK_START",RAW:"TK_RAW",EOF:"TK_EOF"};i.prototype.tokenize=function(){this._input.restart(),this.__tokens=new s,this._reset();for(var t,e=new _(o.START,""),u=null,i=[],n=new s;e.type!==o.EOF;){for(t=this._get_next_token(e,u);this._is_comment(t);)n.add(t),t=this._get_next_token(e,u);n.isEmpty()||(t.comments_before=n,n=new s),t.parent=u,this._is_opening(t)?(i.push(u),u=t):u&&this._is_closing(t,u)&&((t.opened=u).closed=t,u=i.pop(),t.parent=u),(t.previous=e).next=t,this.__tokens.add(t),e=t}return this.__tokens},i.prototype._is_first_token=function(){return this.__tokens.isEmpty()},i.prototype._reset=function(){},i.prototype._get_next_token=function(t,e){this._readWhitespace();var u=this._input.read(/.+/g);return u?this._create_token(o.RAW,u):this._create_token(o.EOF,"")},i.prototype._is_comment=function(t){return!1},i.prototype._is_opening=function(t){return!1},i.prototype._is_closing=function(t,e){return!1},i.prototype._create_token=function(t,e){return new _(t,e,this._patterns.whitespace.newline_count,this._patterns.whitespace.whitespace_before_token)},i.prototype._readWhitespace=function(){return this._patterns.whitespace.read()},t.exports.Tokenizer=i,t.exports.TOKEN=o},function(t){function e(t){this.__tokens=[],this.__tokens_length=this.__tokens.length,this.__position=0,this.__parent_token=t}e.prototype.restart=function(){this.__position=0},e.prototype.isEmpty=function(){return 0===this.__tokens_length},e.prototype.hasNext=function(){return this.__position<this.__tokens_length},e.prototype.next=function(){var t=null;return this.hasNext()&&(t=this.__tokens[this.__position],this.__position+=1),t},e.prototype.peek=function(t){var e=null;return t=t||0,0<=(t+=this.__position)&&t<this.__tokens_length?this.__tokens[t]:e},e.prototype.add=function(t){this.__parent_token&&(t.parent=this.__parent_token),this.__tokens.push(t),this.__tokens_length+=1},t.exports.TokenStream=e},function(t,e,u){var i=u(12).Pattern;function n(t,e){i.call(this,t,e),e?this._line_regexp=this._input.get_regexp(e._line_regexp):this.__set_whitespace_patterns("",""),this.newline_count=0,this.whitespace_before_token=""}(n.prototype=new i).__set_whitespace_patterns=function(t,e){this._match_pattern=this._input.get_regexp("["+(t+="\\t ")+(e+="\\n\\r")+"]+",!0),this._newline_regexp=this._input.get_regexp("\\r\\n|["+e+"]")},n.prototype.read=function(){this.newline_count=0,this.whitespace_before_token="";var t,e=this._input.read(this._match_pattern);return" "===e?this.whitespace_before_token=" ":e&&(t=this.__split(this._newline_regexp,e),this.newline_count=t.length-1,this.whitespace_before_token=t[this.newline_count]),e},n.prototype.matching=function(t,e){var u=this._create();return u.__set_whitespace_patterns(t,e),u._update(),u},n.prototype._create=function(){return new n(this._input,this)},n.prototype.__split=function(t,e){for(var u=t.lastIndex=0,i=[],n=t.exec(e);n;)i.push(e.substring(u,n.index)),u=n.index+n[0].length,n=t.exec(e);return u<e.length?i.push(e.substring(u,e.length)):i.push(""),i},t.exports.WhitespacePattern=n},function(t){function e(t,e){this._input=t,this._starting_pattern=null,this._match_pattern=null,this._until_pattern=null,this._until_after=!1,e&&(this._starting_pattern=this._input.get_regexp(e._starting_pattern,!0),this._match_pattern=this._input.get_regexp(e._match_pattern,!0),this._until_pattern=this._input.get_regexp(e._until_pattern),this._until_after=e._until_after)}e.prototype.read=function(){var t=this._input.read(this._starting_pattern);return this._starting_pattern&&!t||(t+=this._input.read(this._match_pattern,this._until_pattern,this._until_after)),t},e.prototype.read_match=function(){return this._input.match(this._match_pattern)},e.prototype.until_after=function(t){var e=this._create();return e._until_after=!0,e._until_pattern=this._input.get_regexp(t),e._update(),e},e.prototype.until=function(t){var e=this._create();return e._until_after=!1,e._until_pattern=this._input.get_regexp(t),e._update(),e},e.prototype.starting_with=function(t){var e=this._create();return e._starting_pattern=this._input.get_regexp(t,!0),e._update(),e},e.prototype.matching=function(t){var e=this._create();return e._match_pattern=this._input.get_regexp(t,!0),e._update(),e},e.prototype._create=function(){return new e(this._input,this)},e.prototype._update=function(){},t.exports.Pattern=e},function(t){function e(t,e){t="string"==typeof t?t:t.source,e="string"==typeof e?e:e.source,this.__directives_block_pattern=new RegExp(t+/ beautify( \w+[:]\w+)+ /.source+e,"g"),this.__directive_pattern=/ (\w+)[:](\w+)/g,this.__directives_end_ignore_pattern=new RegExp(t+/\sbeautify\signore:end\s/.source+e,"g")}e.prototype.get_directives=function(t){if(!t.match(this.__directives_block_pattern))return null;for(var e={},u=(this.__directive_pattern.lastIndex=0,this.__directive_pattern.exec(t));u;)e[u[1]]=u[2],u=this.__directive_pattern.exec(t);return e},e.prototype.readIgnored=function(t){return t.readUntilAfter(this.__directives_end_ignore_pattern)},t.exports.Directives=e},function(t,e,u){var i=u(12).Pattern,n={django:!1,erb:!1,handlebars:!1,php:!1,smarty:!1};function _(t,e){i.call(this,t,e),this.__template_pattern=null,this._disabled=Object.assign({},n),this._excluded=Object.assign({},n),e&&(this.__template_pattern=this._input.get_regexp(e.__template_pattern),this._excluded=Object.assign(this._excluded,e._excluded),this._disabled=Object.assign(this._disabled,e._disabled)),e=new i(t),this.__patterns={handlebars_comment:e.starting_with(/{{!--/).until_after(/--}}/),handlebars_unescaped:e.starting_with(/{{{/).until_after(/}}}/),handlebars:e.starting_with(/{{/).until_after(/}}/),php:e.starting_with(/<\?(?:[= ]|php)/).until_after(/\?>/),erb:e.starting_with(/<%[^%]/).until_after(/[^%]%>/),django:e.starting_with(/{%/).until_after(/%}/),django_value:e.starting_with(/{{/).until_after(/}}/),django_comment:e.starting_with(/{#/).until_after(/#}/),smarty:e.starting_with(/{(?=[^}{\s\n])/).until_after(/[^\s\n]}/),smarty_comment:e.starting_with(/{\*/).until_after(/\*}/),smarty_literal:e.starting_with(/{literal}/).until_after(/{\/literal}/)}}(_.prototype=new i)._create=function(){return new _(this._input,this)},_.prototype._update=function(){this.__set_templated_pattern()},_.prototype.disable=function(t){var e=this._create();return e._disabled[t]=!0,e._update(),e},_.prototype.read_options=function(t){var e,u=this._create();for(e in n)u._disabled[e]=-1===t.templating.indexOf(e);return u._update(),u},_.prototype.exclude=function(t){var e=this._create();return e._excluded[t]=!0,e._update(),e},_.prototype.read=function(){for(var t="",e=(t=this._match_pattern?this._input.read(this._starting_pattern):this._input.read(this._starting_pattern,this.__template_pattern),this._read_template());e;)this._match_pattern?e+=this._input.read(this._match_pattern):e+=this._input.readUntil(this.__template_pattern),t+=e,e=this._read_template();return this._until_after&&(t+=this._input.readUntilAfter(this._until_pattern)),t},_.prototype.__set_templated_pattern=function(){var t=[];this._disabled.php||t.push(this.__patterns.php._starting_pattern.source),this._disabled.handlebars||t.push(this.__patterns.handlebars._starting_pattern.source),this._disabled.erb||t.push(this.__patterns.erb._starting_pattern.source),this._disabled.django||(t.push(this.__patterns.django._starting_pattern.source),t.push(this.__patterns.django_value._starting_pattern.source),t.push(this.__patterns.django_comment._starting_pattern.source)),this._disabled.smarty||t.push(this.__patterns.smarty._starting_pattern.source),this._until_pattern&&t.push(this._until_pattern.source),this.__template_pattern=this._input.get_regexp("(?:"+t.join("|")+")")},_.prototype._read_template=function(){var t,e="",u=this._input.peek();return"<"===u?(t=this._input.peek(1),this._disabled.php||this._excluded.php||"?"!==t||(e=e||this.__patterns.php.read()),this._disabled.erb||this._excluded.erb||"%"!==t||(e=e||this.__patterns.erb.read())):"{"===u&&(this._disabled.handlebars||this._excluded.handlebars||(e=(e=(e=e||this.__patterns.handlebars_comment.read())||this.__patterns.handlebars_unescaped.read())||this.__patterns.handlebars.read()),this._disabled.django||(this._excluded.django||this._excluded.handlebars||(e=e||this.__patterns.django_value.read()),this._excluded.django||(e=(e=e||this.__patterns.django_comment.read())||this.__patterns.django.read())),this._disabled.smarty||this._disabled.django&&this._disabled.handlebars&&(e=(e=(e=e||this.__patterns.smarty_comment.read())||this.__patterns.smarty_literal.read())||this.__patterns.smarty.read())),e},t.exports.TemplatablePattern=_}],u={},i=function t(i){var n=u[i];return void 0!==n||(n=u[i]={exports:{}},e[i](n,n.exports,t)),n.exports}(0);t=i}();var t,e=t;"function"==typeof define&&define.amd?define([],function(){return{js_beautify:e}}):"undefined"!=typeof exports?exports.js_beautify=e:"undefined"!=typeof window?window.js_beautify=e:"undefined"!=typeof global&&(global.js_beautify=e)}()</script><script>!function(){!function(){"use strict";var e=[,,function(t){function e(t){this.__parent=t,this.__character_count=0,this.__indent_count=-1,this.__alignment_count=0,this.__wrap_point_index=0,this.__wrap_point_character_count=0,this.__wrap_point_indent_count=-1,this.__wrap_point_alignment_count=0,this.__items=[]}function i(t,e){this.__cache=[""],this.__indent_size=t.indent_size,this.__indent_string=t.indent_char,t.indent_with_tabs||(this.__indent_string=new Array(t.indent_size+1).join(t.indent_char)),e=e||"",0<t.indent_level&&(e=new Array(t.indent_level+1).join(this.__indent_string)),this.__base_string=e,this.__base_string_length=e.length}function n(t,n){this.__indent_cache=new i(t,n),this.raw=!1,this._end_with_newline=t.end_with_newline,this.indent_size=t.indent_size,this.wrap_line_length=t.wrap_line_length,this.indent_empty_lines=t.indent_empty_lines,this.__lines=[],this.previous_line=null,this.current_line=null,this.next_line=new e(this),this.space_before_token=!1,this.non_breaking_space=!1,this.previous_token_wrapped=!1,this.__add_outputline()}e.prototype.clone_empty=function(){var t=new e(this.__parent);return t.set_indent(this.__indent_count,this.__alignment_count),t},e.prototype.item=function(t){return t<0?this.__items[this.__items.length+t]:this.__items[t]},e.prototype.has_match=function(t){for(var e=this.__items.length-1;0<=e;e--)if(this.__items[e].match(t))return!0;return!1},e.prototype.set_indent=function(t,e){this.is_empty()&&(this.__indent_count=t||0,this.__alignment_count=e||0,this.__character_count=this.__parent.get_indent_size(this.__indent_count,this.__alignment_count))},e.prototype._set_wrap_point=function(){this.__parent.wrap_line_length&&(this.__wrap_point_index=this.__items.length,this.__wrap_point_character_count=this.__character_count,this.__wrap_point_indent_count=this.__parent.next_line.__indent_count,this.__wrap_point_alignment_count=this.__parent.next_line.__alignment_count)},e.prototype._should_wrap=function(){return this.__wrap_point_index&&this.__character_count>this.__parent.wrap_line_length&&this.__wrap_point_character_count>this.__parent.next_line.__character_count},e.prototype._allow_wrap=function(){var t;return!!this._should_wrap()&&(this.__parent.add_new_line(),(t=this.__parent.current_line).set_indent(this.__wrap_point_indent_count,this.__wrap_point_alignment_count),t.__items=this.__items.slice(this.__wrap_point_index),this.__items=this.__items.slice(0,this.__wrap_point_index),t.__character_count+=this.__character_count-this.__wrap_point_character_count,this.__character_count=this.__wrap_point_character_count," "===t.__items[0]&&(t.__items.splice(0,1),--t.__character_count),!0)},e.prototype.is_empty=function(){return 0===this.__items.length},e.prototype.last=function(){return this.is_empty()?null:this.__items[this.__items.length-1]},e.prototype.push=function(t){this.__items.push(t);var e=t.lastIndexOf("\n");-1!==e?this.__character_count=t.length-e:this.__character_count+=t.length},e.prototype.pop=function(){var t=null;return this.is_empty()||(t=this.__items.pop(),this.__character_count-=t.length),t},e.prototype._remove_indent=function(){0<this.__indent_count&&(--this.__indent_count,this.__character_count-=this.__parent.indent_size)},e.prototype._remove_wrap_indent=function(){0<this.__wrap_point_indent_count&&--this.__wrap_point_indent_count},e.prototype.trim=function(){for(;" "===this.last();)this.__items.pop(),--this.__character_count},e.prototype.toString=function(){var t="";return this.is_empty()?this.__parent.indent_empty_lines&&(t=this.__parent.get_indent_string(this.__indent_count)):(t=this.__parent.get_indent_string(this.__indent_count,this.__alignment_count),t+=this.__items.join("")),t},i.prototype.get_indent_size=function(t,e){var i=this.__base_string_length;return(i=t<0?0:i)+t*this.__indent_size+(e||0)},i.prototype.get_indent_string=function(t,e){var i=this.__base_string;return e=e||0,t<0&&(t=0,i=""),e+=t*this.__indent_size,this.__ensure_cache(e),i+this.__cache[e]},i.prototype.__ensure_cache=function(t){for(;t>=this.__cache.length;)this.__add_column()},i.prototype.__add_column=function(){var t,e=this.__cache.length,i="";this.__indent_size&&e>=this.__indent_size&&(e-=(t=Math.floor(e/this.__indent_size))*this.__indent_size,i=new Array(t+1).join(this.__indent_string)),e&&(i+=new Array(e+1).join(" ")),this.__cache.push(i)},n.prototype.__add_outputline=function(){this.previous_line=this.current_line,this.current_line=this.next_line.clone_empty(),this.__lines.push(this.current_line)},n.prototype.get_line_number=function(){return this.__lines.length},n.prototype.get_indent_string=function(t,e){return this.__indent_cache.get_indent_string(t,e)},n.prototype.get_indent_size=function(t,e){return this.__indent_cache.get_indent_size(t,e)},n.prototype.is_empty=function(){return!this.previous_line&&this.current_line.is_empty()},n.prototype.add_new_line=function(t){return!(this.is_empty()||!t&&this.just_added_newline()||(this.raw||this.__add_outputline(),0))},n.prototype.get_code=function(t){this.trim(!0);var e=((e=this.current_line.pop())&&("\n"===e[e.length-1]&&(e=e.replace(/\n+$/g,"")),this.current_line.push(e)),this._end_with_newline&&this.__add_outputline(),this.__lines.join("\n"));return"\n"!==t?e.replace(/[\n]/g,t):e},n.prototype.set_wrap_point=function(){this.current_line._set_wrap_point()},n.prototype.set_indent=function(t,e){return this.next_line.set_indent(t=t||0,e=e||0),1<this.__lines.length?(this.current_line.set_indent(t,e),!0):(this.current_line.set_indent(),!1)},n.prototype.add_raw_token=function(t){for(var e=0;e<t.newlines;e++)this.__add_outputline();this.current_line.set_indent(-1),this.current_line.push(t.whitespace_before),this.current_line.push(t.text),this.space_before_token=!1,this.non_breaking_space=!1,this.previous_token_wrapped=!1},n.prototype.add_token=function(t){this.__add_space_before_token(),this.current_line.push(t),this.space_before_token=!1,this.non_breaking_space=!1,this.previous_token_wrapped=this.current_line._allow_wrap()},n.prototype.__add_space_before_token=function(){this.space_before_token&&!this.just_added_newline()&&(this.non_breaking_space||this.set_wrap_point(),this.current_line.push(" "))},n.prototype.remove_indent=function(t){for(var e=this.__lines.length;t<e;)this.__lines[t]._remove_indent(),t++;this.current_line._remove_wrap_indent()},n.prototype.trim=function(t){for(t=void 0!==t&&t,this.current_line.trim();t&&1<this.__lines.length&&this.current_line.is_empty();)this.__lines.pop(),this.current_line=this.__lines[this.__lines.length-1],this.current_line.trim();this.previous_line=1<this.__lines.length?this.__lines[this.__lines.length-2]:null},n.prototype.just_added_newline=function(){return this.current_line.is_empty()},n.prototype.just_added_blankline=function(){return this.is_empty()||this.current_line.is_empty()&&this.previous_line.is_empty()},n.prototype.ensure_empty_line_above=function(t,i){for(var n=this.__lines.length-2;0<=n;){var _=this.__lines[n];if(_.is_empty())break;if(0!==_.item(0).indexOf(t)&&_.item(-1)!==i){this.__lines.splice(n+1,0,new e(this)),this.previous_line=this.__lines[this.__lines.length-2];break}n--}},t.exports.Output=n},,,,function(t){function e(t,e){this.raw_options=i(t,e),this.disabled=this._get_boolean("disabled"),this.eol=this._get_characters("eol","auto"),this.end_with_newline=this._get_boolean("end_with_newline"),this.indent_size=this._get_number("indent_size",4),this.indent_char=this._get_characters("indent_char"," "),this.indent_level=this._get_number("indent_level"),this.preserve_newlines=this._get_boolean("preserve_newlines",!0),this.max_preserve_newlines=this._get_number("max_preserve_newlines",32786),this.preserve_newlines||(this.max_preserve_newlines=0),this.indent_with_tabs=this._get_boolean("indent_with_tabs","\t"===this.indent_char),this.indent_with_tabs&&(this.indent_char="\t",1===this.indent_size&&(this.indent_size=4)),this.wrap_line_length=this._get_number("wrap_line_length",this._get_number("max_char")),this.indent_empty_lines=this._get_boolean("indent_empty_lines"),this.templating=this._get_selection_list("templating",["auto","none","django","erb","handlebars","php","smarty"],["auto"])}function i(t,e){var i,_={};for(i in t=n(t))i!==e&&(_[i]=t[i]);if(e&&t[e])for(i in t[e])_[i]=t[e][i];return _}function n(t){var e,i={};for(e in t)i[e.replace(/-/g,"_")]=t[e];return i}e.prototype._get_array=function(t,e){return e=e||[],"object"==typeof(t=this.raw_options[t])?null!==t&&"function"==typeof t.concat&&(e=t.concat()):"string"==typeof t&&(e=t.split(/[^a-zA-Z0-9_\/\-]+/)),e},e.prototype._get_boolean=function(t,e){return void 0===(t=this.raw_options[t])?!!e:!!t},e.prototype._get_characters=function(t,e){return e=e||"","string"==typeof(t=this.raw_options[t])?t.replace(/\\r/,"\r").replace(/\\n/,"\n").replace(/\\t/,"\t"):e},e.prototype._get_number=function(t,e){return t=this.raw_options[t],e=parseInt(e,10),isNaN(e)&&(e=0),t=parseInt(t,10),isNaN(t)?e:t},e.prototype._get_selection=function(t,e,i){if(1!==(i=this._get_selection_list(t,e,i)).length)throw new Error("Invalid Option Value: The option '"+t+"' can only be one of the following values:\n"+e+"\nYou passed in: '"+this.raw_options[t]+"'");return i[0]},e.prototype._get_selection_list=function(t,e,i){if(!e||0===e.length)throw new Error("Selection list cannot be empty.");if(i=i||[e[0]],!this._is_valid_selection(i,e))throw new Error("Invalid Default Value!");if(i=this._get_array(t,i),this._is_valid_selection(i,e))return i;throw new Error("Invalid Option Value: The option '"+t+"' can contain only the following values:\n"+e+"\nYou passed in: '"+this.raw_options[t]+"'")},e.prototype._is_valid_selection=function(t,e){return t.length&&e.length&&!t.some(function(t){return-1===e.indexOf(t)})},t.exports.Options=e,t.exports.normalizeOpts=n,t.exports.mergeOpts=i},,function(t){var e=RegExp.prototype.hasOwnProperty("sticky");function i(t){this.__input=t||"",this.__input_length=this.__input.length,this.__position=0}i.prototype.restart=function(){this.__position=0},i.prototype.back=function(){0<this.__position&&--this.__position},i.prototype.hasNext=function(){return this.__position<this.__input_length},i.prototype.next=function(){var t=null;return this.hasNext()&&(t=this.__input.charAt(this.__position),this.__position+=1),t},i.prototype.peek=function(t){var e=null;return t=t||0,0<=(t+=this.__position)&&t<this.__input_length?this.__input.charAt(t):e},i.prototype.__match=function(t,i){t.lastIndex=i;var n=t.exec(this.__input);return!n||e&&t.sticky||n.index!==i&&(n=null),n},i.prototype.test=function(t,e){return e=e||0,0<=(e+=this.__position)&&e<this.__input_length&&!!this.__match(t,e)},i.prototype.testChar=function(t,e){return e=this.peek(e),t.lastIndex=0,null!==e&&t.test(e)},i.prototype.match=function(t){return(t=this.__match(t,this.__position))?this.__position+=t[0].length:t=null,t},i.prototype.read=function(t,e,i){var n,_="";return t&&(n=this.match(t))&&(_+=n[0]),!e||!n&&t||(_+=this.readUntil(e,i)),_},i.prototype.readUntil=function(t,e){var i=this.__position;return(t=(t.lastIndex=this.__position,t.exec(this.__input)))?(i=t.index,e&&(i+=t[0].length)):i=this.__input_length,e=this.__input.substring(this.__position,i),this.__position=i,e},i.prototype.readUntilAfter=function(t){return this.readUntil(t,!0)},i.prototype.get_regexp=function(t,i){var n=null;i=i&&e?"y":"g";return"string"==typeof t&&""!==t?n=new RegExp(t,i):t&&(n=new RegExp(t.source,i)),n},i.prototype.get_literal_regexp=function(t){return RegExp(t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"))},i.prototype.peekUntilAfter=function(t){var e=this.__position;t=this.readUntilAfter(t);return this.__position=e,t},i.prototype.lookBack=function(t){var e=this.__position-1;return e>=t.length&&this.__input.substring(e-t.length,e).toLowerCase()===t},t.exports.InputScanner=i},,,,,function(t){function e(t,e){t="string"==typeof t?t:t.source,e="string"==typeof e?e:e.source,this.__directives_block_pattern=new RegExp(t+/ beautify( \w+[:]\w+)+ /.source+e,"g"),this.__directive_pattern=/ (\w+)[:](\w+)/g,this.__directives_end_ignore_pattern=new RegExp(t+/\sbeautify\signore:end\s/.source+e,"g")}e.prototype.get_directives=function(t){if(!t.match(this.__directives_block_pattern))return null;for(var e={},i=(this.__directive_pattern.lastIndex=0,this.__directive_pattern.exec(t));i;)e[i[1]]=i[2],i=this.__directive_pattern.exec(t);return e},e.prototype.readIgnored=function(t){return t.readUntilAfter(this.__directives_end_ignore_pattern)},t.exports.Directives=e},,function(t,e,i){var n=i(16).Beautifier,_=i(17).Options;t.exports=function(t,e){return new n(t,e).beautify()},t.exports.defaultOptions=function(){return new _}},function(t,e,i){var n=i(17).Options,_=i(2).Output,s=i(8).InputScanner,r=new(i(13).Directives)(/\/\*/,/\*\//),h=/\r\n|[\r\n]/,o=/\r\n|[\r\n]/g,p=/\s/,a=/(?:\s|\n)+/g,u=/\/\*(?:[\s\S]*?)((?:\*\/)|$)/g,c=/\/\/(?:[^\n\r\u2028\u2029]*)/g;function l(t,e){this._source_text=t||"",this._options=new n(e),this._ch=null,this._input=null,this.NESTED_AT_RULE={"@page":!0,"@font-face":!0,"@keyframes":!0,"@media":!0,"@supports":!0,"@document":!0},this.CONDITIONAL_GROUP_RULE={"@media":!0,"@supports":!0,"@document":!0},this.NON_SEMICOLON_NEWLINE_PROPERTY=["grid-template-areas","grid-template"]}l.prototype.eatString=function(t){var e="";for(this._ch=this._input.next();this._ch;){if(e+=this._ch,"\\"===this._ch)e+=this._input.next();else if(-1!==t.indexOf(this._ch)||"\n"===this._ch)break;this._ch=this._input.next()}return e},l.prototype.eatWhitespace=function(t){for(var e=p.test(this._input.peek()),i=0;p.test(this._input.peek());)this._ch=this._input.next(),t&&"\n"===this._ch&&(0===i||i<this._options.max_preserve_newlines)&&(i++,this._output.add_new_line(!0));return e},l.prototype.foundNestedPseudoClass=function(){for(var t=0,e=1,i=this._input.peek(e);i;){if("{"===i)return!0;if("("===i)t+=1;else if(")"===i){if(0===t)return!1;--t}else if(";"===i||"}"===i)return!1;e++,i=this._input.peek(e)}return!1},l.prototype.print_string=function(t){this._output.set_indent(this._indentLevel),this._output.non_breaking_space=!0,this._output.add_token(t)},l.prototype.preserveSingleSpace=function(t){t&&(this._output.space_before_token=!0)},l.prototype.indent=function(){this._indentLevel++},l.prototype.outdent=function(){0<this._indentLevel&&this._indentLevel--},l.prototype.beautify=function(){if(this._options.disabled)return this._source_text;for(var t,e,i=this._source_text,n=this._options.eol,l=("auto"===n&&(n="\n",i&&h.test(i||"")&&(n=i.match(h)[0])),(i=i.replace(o,"\n")).match(/^[\t ]*/)[0]),d=(this._output=new _(this._options,l),this._input=new s(i),this._indentLevel=0,this._nestedLevel=0,this._ch=null,0),f=!1,g=!1,w=!1,y=!1,v=!1,m=!1,b=this._ch,k=!1;t=""!==this._input.read(a),e=b,this._ch=this._input.next(),"\\"===this._ch&&this._input.hasNext()&&(this._ch+=this._input.next()),b=this._ch,this._ch;)if("/"===this._ch&&"*"===this._input.peek()){this._output.add_new_line(),this._input.back();var x=this._input.read(u),O=r.get_directives(x);O&&"start"===O.ignore&&(x+=r.readIgnored(this._input)),this.print_string(x),this.eatWhitespace(!0),this._output.add_new_line()}else if("/"===this._ch&&"/"===this._input.peek())this._output.space_before_token=!0,this._input.back(),this.print_string(this._input.read(c)),this.eatWhitespace(!0);else if("@"===this._ch||"$"===this._ch)this.preserveSingleSpace(t),"{"===this._input.peek()?this.print_string(this._ch+this.eatString("}")):(this.print_string(this._ch),(O=this._input.peekUntilAfter(/[: ,;{}()[\]\/='"]/g)).match(/[ :]$/)&&(O=this.eatString(": ").replace(/\s$/,""),this.print_string(O),this._output.space_before_token=!0),"extend"===(O=O.replace(/\s$/,""))?y=!0:"import"===O&&(v=!0),O in this.NESTED_AT_RULE?(this._nestedLevel+=1,O in this.CONDITIONAL_GROUP_RULE&&(w=!0)):f||0!==d||-1===O.indexOf(":")||(g=!0,this.indent()));else if("#"===this._ch&&"{"===this._input.peek())this.preserveSingleSpace(t),this.print_string(this._ch+this.eatString("}"));else if("{"===this._ch)g&&(g=!1,this.outdent()),f=w?(w=!1,this._indentLevel>=this._nestedLevel):this._indentLevel>=this._nestedLevel-1,this._options.newline_between_rules&&f&&this._output.previous_line&&"{"!==this._output.previous_line.item(-1)&&this._output.ensure_empty_line_above("/",","),this._output.space_before_token=!0,"expand"===this._options.brace_style?(this._output.add_new_line(),this.print_string(this._ch),this.indent(),this._output.set_indent(this._indentLevel)):("("===e?this._output.space_before_token=!1:","!==e&&this.indent(),this.print_string(this._ch)),this.eatWhitespace(!0),this._output.add_new_line();else if("}"===this._ch)this.outdent(),this._output.add_new_line(),"{"===e&&this._output.trim(!0),y=v=!1,g&&(this.outdent(),g=!1),this.print_string(this._ch),f=!1,this._nestedLevel&&this._nestedLevel--,this.eatWhitespace(!0),this._output.add_new_line(),this._options.newline_between_rules&&!this._output.just_added_blankline()&&"}"!==this._input.peek()&&this._output.add_new_line(!0),")"===this._input.peek()&&(this._output.trim(!0),"expand"===this._options.brace_style&&this._output.add_new_line(!0));else if(":"===this._ch){for(var E=0;E<this.NON_SEMICOLON_NEWLINE_PROPERTY.length;E++)if(this._input.lookBack(this.NON_SEMICOLON_NEWLINE_PROPERTY[E])){k=!0;break}!f&&!w||this._input.lookBack("&")||this.foundNestedPseudoClass()||this._input.lookBack("(")||y||0!==d?(this._input.lookBack(" ")&&(this._output.space_before_token=!0),":"===this._input.peek()?(this._ch=this._input.next(),this.print_string("::")):this.print_string(":")):(this.print_string(":"),g||(this._output.space_before_token=g=!0,this.eatWhitespace(!0),this.indent()))}else'"'===this._ch||"'"===this._ch?(this.preserveSingleSpace('"'===e||"'"===e||t),this.print_string(this._ch+this.eatString(this._ch)),this.eatWhitespace(!0)):";"===this._ch?(k=!1,0===d?(g&&(this.outdent(),g=!1),v=y=!1,this.print_string(this._ch),this.eatWhitespace(!0),"/"!==this._input.peek()&&this._output.add_new_line()):(this.print_string(this._ch),this.eatWhitespace(!0),this._output.space_before_token=!0)):"("===this._ch?this._input.lookBack("url")?(this.print_string(this._ch),this.eatWhitespace(),d++,this.indent(),this._ch=this._input.next(),")"===this._ch||'"'===this._ch||"'"===this._ch?this._input.back():this._ch&&(this.print_string(this._ch+this.eatString(")")),d&&(d--,this.outdent()))):(x=!1,this._input.lookBack("with")&&(x=!0),this.preserveSingleSpace(t||x),this.print_string(this._ch),g&&"$"===e&&this._options.selector_separator_newline?(this._output.add_new_line(),m=!0):(this.eatWhitespace(),d++,this.indent())):")"===this._ch?(d&&(d--,this.outdent()),m&&";"===this._input.peek()&&this._options.selector_separator_newline&&(m=!1,this.outdent(),this._output.add_new_line()),this.print_string(this._ch)):","===this._ch?(this.print_string(this._ch),this.eatWhitespace(!0),!this._options.selector_separator_newline||g&&!m||0!==d||v||y?this._output.space_before_token=!0:this._output.add_new_line()):">"!==this._ch&&"+"!==this._ch&&"~"!==this._ch||g||0!==d?"]"===this._ch?this.print_string(this._ch):"["===this._ch?(this.preserveSingleSpace(t),this.print_string(this._ch)):"="===this._ch?(this.eatWhitespace(),this.print_string("="),p.test(this._ch)&&(this._ch="")):"!"!==this._ch||this._input.lookBack("\\")?(this.preserveSingleSpace('"'===e||"'"===e||t),this.print_string(this._ch),!this._output.just_added_newline()&&"\n"===this._input.peek()&&k&&this._output.add_new_line()):(this._output.space_before_token=!0,this.print_string(this._ch)):this._options.space_around_combinator?(this._output.space_before_token=!0,this.print_string(this._ch),this._output.space_before_token=!0):(this.print_string(this._ch),this.eatWhitespace(),this._ch&&p.test(this._ch)&&(this._ch=""));return this._output.get_code(n)},t.exports.Beautifier=l},function(t,e,i){var n=i(6).Options;function _(t){n.call(this,t,"css"),this.selector_separator_newline=this._get_boolean("selector_separator_newline",!0),this.newline_between_rules=this._get_boolean("newline_between_rules",!0);t=this._get_boolean("space_around_selector_separator");var e=(this.space_around_combinator=this._get_boolean("space_around_combinator")||t,this._get_selection_list("brace_style",["collapse","expand","end-expand","none","preserve-inline"]));this.brace_style="collapse";for(var i=0;i<e.length;i++)"expand"!==e[i]?this.brace_style="collapse":this.brace_style=e[i]}_.prototype=new n,t.exports.Options=_}],i={},n=function t(n){var _=i[n];return void 0!==_||(_=i[n]={exports:{}},e[n](_,_.exports,t)),_.exports}(15);t=n}();var t,e=t;"function"==typeof define&&define.amd?define([],function(){return{css_beautify:e}}):"undefined"!=typeof exports?exports.css_beautify=e:"undefined"!=typeof window?window.css_beautify=e:"undefined"!=typeof global&&(global.css_beautify=e)}()</script><script>!function(){!function(){"use strict";var e=[,,function(t){function e(t){this.__parent=t,this.__character_count=0,this.__indent_count=-1,this.__alignment_count=0,this.__wrap_point_index=0,this.__wrap_point_character_count=0,this.__wrap_point_indent_count=-1,this.__wrap_point_alignment_count=0,this.__items=[]}function n(t,e){this.__cache=[""],this.__indent_size=t.indent_size,this.__indent_string=t.indent_char,t.indent_with_tabs||(this.__indent_string=new Array(t.indent_size+1).join(t.indent_char)),e=e||"",0<t.indent_level&&(e=new Array(t.indent_level+1).join(this.__indent_string)),this.__base_string=e,this.__base_string_length=e.length}function i(t,i){this.__indent_cache=new n(t,i),this.raw=!1,this._end_with_newline=t.end_with_newline,this.indent_size=t.indent_size,this.wrap_line_length=t.wrap_line_length,this.indent_empty_lines=t.indent_empty_lines,this.__lines=[],this.previous_line=null,this.current_line=null,this.next_line=new e(this),this.space_before_token=!1,this.non_breaking_space=!1,this.previous_token_wrapped=!1,this.__add_outputline()}e.prototype.clone_empty=function(){var t=new e(this.__parent);return t.set_indent(this.__indent_count,this.__alignment_count),t},e.prototype.item=function(t){return t<0?this.__items[this.__items.length+t]:this.__items[t]},e.prototype.has_match=function(t){for(var e=this.__items.length-1;0<=e;e--)if(this.__items[e].match(t))return!0;return!1},e.prototype.set_indent=function(t,e){this.is_empty()&&(this.__indent_count=t||0,this.__alignment_count=e||0,this.__character_count=this.__parent.get_indent_size(this.__indent_count,this.__alignment_count))},e.prototype._set_wrap_point=function(){this.__parent.wrap_line_length&&(this.__wrap_point_index=this.__items.length,this.__wrap_point_character_count=this.__character_count,this.__wrap_point_indent_count=this.__parent.next_line.__indent_count,this.__wrap_point_alignment_count=this.__parent.next_line.__alignment_count)},e.prototype._should_wrap=function(){return this.__wrap_point_index&&this.__character_count>this.__parent.wrap_line_length&&this.__wrap_point_character_count>this.__parent.next_line.__character_count},e.prototype._allow_wrap=function(){var t;return!!this._should_wrap()&&(this.__parent.add_new_line(),(t=this.__parent.current_line).set_indent(this.__wrap_point_indent_count,this.__wrap_point_alignment_count),t.__items=this.__items.slice(this.__wrap_point_index),this.__items=this.__items.slice(0,this.__wrap_point_index),t.__character_count+=this.__character_count-this.__wrap_point_character_count,this.__character_count=this.__wrap_point_character_count," "===t.__items[0]&&(t.__items.splice(0,1),--t.__character_count),!0)},e.prototype.is_empty=function(){return 0===this.__items.length},e.prototype.last=function(){return this.is_empty()?null:this.__items[this.__items.length-1]},e.prototype.push=function(t){this.__items.push(t);var e=t.lastIndexOf("\n");-1!==e?this.__character_count=t.length-e:this.__character_count+=t.length},e.prototype.pop=function(){var t=null;return this.is_empty()||(t=this.__items.pop(),this.__character_count-=t.length),t},e.prototype._remove_indent=function(){0<this.__indent_count&&(--this.__indent_count,this.__character_count-=this.__parent.indent_size)},e.prototype._remove_wrap_indent=function(){0<this.__wrap_point_indent_count&&--this.__wrap_point_indent_count},e.prototype.trim=function(){for(;" "===this.last();)this.__items.pop(),--this.__character_count},e.prototype.toString=function(){var t="";return this.is_empty()?this.__parent.indent_empty_lines&&(t=this.__parent.get_indent_string(this.__indent_count)):(t=this.__parent.get_indent_string(this.__indent_count,this.__alignment_count),t+=this.__items.join("")),t},n.prototype.get_indent_size=function(t,e){var n=this.__base_string_length;return(n=t<0?0:n)+t*this.__indent_size+(e||0)},n.prototype.get_indent_string=function(t,e){var n=this.__base_string;return e=e||0,t<0&&(t=0,n=""),e+=t*this.__indent_size,this.__ensure_cache(e),n+this.__cache[e]},n.prototype.__ensure_cache=function(t){for(;t>=this.__cache.length;)this.__add_column()},n.prototype.__add_column=function(){var t,e=this.__cache.length,n="";this.__indent_size&&e>=this.__indent_size&&(e-=(t=Math.floor(e/this.__indent_size))*this.__indent_size,n=new Array(t+1).join(this.__indent_string)),e&&(n+=new Array(e+1).join(" ")),this.__cache.push(n)},i.prototype.__add_outputline=function(){this.previous_line=this.current_line,this.current_line=this.next_line.clone_empty(),this.__lines.push(this.current_line)},i.prototype.get_line_number=function(){return this.__lines.length},i.prototype.get_indent_string=function(t,e){return this.__indent_cache.get_indent_string(t,e)},i.prototype.get_indent_size=function(t,e){return this.__indent_cache.get_indent_size(t,e)},i.prototype.is_empty=function(){return!this.previous_line&&this.current_line.is_empty()},i.prototype.add_new_line=function(t){return!(this.is_empty()||!t&&this.just_added_newline()||(this.raw||this.__add_outputline(),0))},i.prototype.get_code=function(t){this.trim(!0);var e=((e=this.current_line.pop())&&("\n"===e[e.length-1]&&(e=e.replace(/\n+$/g,"")),this.current_line.push(e)),this._end_with_newline&&this.__add_outputline(),this.__lines.join("\n"));return"\n"!==t?e.replace(/[\n]/g,t):e},i.prototype.set_wrap_point=function(){this.current_line._set_wrap_point()},i.prototype.set_indent=function(t,e){return this.next_line.set_indent(t=t||0,e=e||0),1<this.__lines.length?(this.current_line.set_indent(t,e),!0):(this.current_line.set_indent(),!1)},i.prototype.add_raw_token=function(t){for(var e=0;e<t.newlines;e++)this.__add_outputline();this.current_line.set_indent(-1),this.current_line.push(t.whitespace_before),this.current_line.push(t.text),this.space_before_token=!1,this.non_breaking_space=!1,this.previous_token_wrapped=!1},i.prototype.add_token=function(t){this.__add_space_before_token(),this.current_line.push(t),this.space_before_token=!1,this.non_breaking_space=!1,this.previous_token_wrapped=this.current_line._allow_wrap()},i.prototype.__add_space_before_token=function(){this.space_before_token&&!this.just_added_newline()&&(this.non_breaking_space||this.set_wrap_point(),this.current_line.push(" "))},i.prototype.remove_indent=function(t){for(var e=this.__lines.length;t<e;)this.__lines[t]._remove_indent(),t++;this.current_line._remove_wrap_indent()},i.prototype.trim=function(t){for(t=void 0!==t&&t,this.current_line.trim();t&&1<this.__lines.length&&this.current_line.is_empty();)this.__lines.pop(),this.current_line=this.__lines[this.__lines.length-1],this.current_line.trim();this.previous_line=1<this.__lines.length?this.__lines[this.__lines.length-2]:null},i.prototype.just_added_newline=function(){return this.current_line.is_empty()},i.prototype.just_added_blankline=function(){return this.is_empty()||this.current_line.is_empty()&&this.previous_line.is_empty()},i.prototype.ensure_empty_line_above=function(t,n){for(var i=this.__lines.length-2;0<=i;){var _=this.__lines[i];if(_.is_empty())break;if(0!==_.item(0).indexOf(t)&&_.item(-1)!==n){this.__lines.splice(i+1,0,new e(this)),this.previous_line=this.__lines[this.__lines.length-2];break}i--}},t.exports.Output=i},function(t){t.exports.Token=function(t,e,n,i){this.type=t,this.text=e,this.comments_before=null,this.newlines=n||0,this.whitespace_before=i||"",this.parent=null,this.next=null,this.previous=null,this.opened=null,this.closed=null,this.directives=null}},,,function(t){function e(t,e){this.raw_options=n(t,e),this.disabled=this._get_boolean("disabled"),this.eol=this._get_characters("eol","auto"),this.end_with_newline=this._get_boolean("end_with_newline"),this.indent_size=this._get_number("indent_size",4),this.indent_char=this._get_characters("indent_char"," "),this.indent_level=this._get_number("indent_level"),this.preserve_newlines=this._get_boolean("preserve_newlines",!0),this.max_preserve_newlines=this._get_number("max_preserve_newlines",32786),this.preserve_newlines||(this.max_preserve_newlines=0),this.indent_with_tabs=this._get_boolean("indent_with_tabs","\t"===this.indent_char),this.indent_with_tabs&&(this.indent_char="\t",1===this.indent_size&&(this.indent_size=4)),this.wrap_line_length=this._get_number("wrap_line_length",this._get_number("max_char")),this.indent_empty_lines=this._get_boolean("indent_empty_lines"),this.templating=this._get_selection_list("templating",["auto","none","django","erb","handlebars","php","smarty"],["auto"])}function n(t,e){var n,_={};for(n in t=i(t))n!==e&&(_[n]=t[n]);if(e&&t[e])for(n in t[e])_[n]=t[e][n];return _}function i(t){var e,n={};for(e in t)n[e.replace(/-/g,"_")]=t[e];return n}e.prototype._get_array=function(t,e){return e=e||[],"object"==typeof(t=this.raw_options[t])?null!==t&&"function"==typeof t.concat&&(e=t.concat()):"string"==typeof t&&(e=t.split(/[^a-zA-Z0-9_\/\-]+/)),e},e.prototype._get_boolean=function(t,e){return void 0===(t=this.raw_options[t])?!!e:!!t},e.prototype._get_characters=function(t,e){return e=e||"","string"==typeof(t=this.raw_options[t])?t.replace(/\\r/,"\r").replace(/\\n/,"\n").replace(/\\t/,"\t"):e},e.prototype._get_number=function(t,e){return t=this.raw_options[t],e=parseInt(e,10),isNaN(e)&&(e=0),t=parseInt(t,10),isNaN(t)?e:t},e.prototype._get_selection=function(t,e,n){if(1!==(n=this._get_selection_list(t,e,n)).length)throw new Error("Invalid Option Value: The option '"+t+"' can only be one of the following values:\n"+e+"\nYou passed in: '"+this.raw_options[t]+"'");return n[0]},e.prototype._get_selection_list=function(t,e,n){if(!e||0===e.length)throw new Error("Selection list cannot be empty.");if(n=n||[e[0]],!this._is_valid_selection(n,e))throw new Error("Invalid Default Value!");if(n=this._get_array(t,n),this._is_valid_selection(n,e))return n;throw new Error("Invalid Option Value: The option '"+t+"' can contain only the following values:\n"+e+"\nYou passed in: '"+this.raw_options[t]+"'")},e.prototype._is_valid_selection=function(t,e){return t.length&&e.length&&!t.some(function(t){return-1===e.indexOf(t)})},t.exports.Options=e,t.exports.normalizeOpts=i,t.exports.mergeOpts=n},,function(t){var e=RegExp.prototype.hasOwnProperty("sticky");function n(t){this.__input=t||"",this.__input_length=this.__input.length,this.__position=0}n.prototype.restart=function(){this.__position=0},n.prototype.back=function(){0<this.__position&&--this.__position},n.prototype.hasNext=function(){return this.__position<this.__input_length},n.prototype.next=function(){var t=null;return this.hasNext()&&(t=this.__input.charAt(this.__position),this.__position+=1),t},n.prototype.peek=function(t){var e=null;return t=t||0,0<=(t+=this.__position)&&t<this.__input_length?this.__input.charAt(t):e},n.prototype.__match=function(t,n){t.lastIndex=n;var i=t.exec(this.__input);return!i||e&&t.sticky||i.index!==n&&(i=null),i},n.prototype.test=function(t,e){return e=e||0,0<=(e+=this.__position)&&e<this.__input_length&&!!this.__match(t,e)},n.prototype.testChar=function(t,e){return e=this.peek(e),t.lastIndex=0,null!==e&&t.test(e)},n.prototype.match=function(t){return(t=this.__match(t,this.__position))?this.__position+=t[0].length:t=null,t},n.prototype.read=function(t,e,n){var i,_="";return t&&(i=this.match(t))&&(_+=i[0]),!e||!i&&t||(_+=this.readUntil(e,n)),_},n.prototype.readUntil=function(t,e){var n=this.__position;return(t=(t.lastIndex=this.__position,t.exec(this.__input)))?(n=t.index,e&&(n+=t[0].length)):n=this.__input_length,e=this.__input.substring(this.__position,n),this.__position=n,e},n.prototype.readUntilAfter=function(t){return this.readUntil(t,!0)},n.prototype.get_regexp=function(t,n){var i=null;n=n&&e?"y":"g";return"string"==typeof t&&""!==t?i=new RegExp(t,n):t&&(i=new RegExp(t.source,n)),i},n.prototype.get_literal_regexp=function(t){return RegExp(t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"))},n.prototype.peekUntilAfter=function(t){var e=this.__position;t=this.readUntilAfter(t);return this.__position=e,t},n.prototype.lookBack=function(t){var e=this.__position-1;return e>=t.length&&this.__input.substring(e-t.length,e).toLowerCase()===t},t.exports.InputScanner=n},function(t,e,n){function i(t,e){this._input=new _(t),this._options=e||{},this.__tokens=null,this._patterns={},this._patterns.whitespace=new a(this._input)}var _=n(8).InputScanner,s=n(3).Token,r=n(10).TokenStream,a=n(11).WhitespacePattern,o={START:"TK_START",RAW:"TK_RAW",EOF:"TK_EOF"};i.prototype.tokenize=function(){this._input.restart(),this.__tokens=new r,this._reset();for(var t,e=new s(o.START,""),n=null,i=[],_=new r;e.type!==o.EOF;){for(t=this._get_next_token(e,n);this._is_comment(t);)_.add(t),t=this._get_next_token(e,n);_.isEmpty()||(t.comments_before=_,_=new r),t.parent=n,this._is_opening(t)?(i.push(n),n=t):n&&this._is_closing(t,n)&&((t.opened=n).closed=t,n=i.pop(),t.parent=n),(t.previous=e).next=t,this.__tokens.add(t),e=t}return this.__tokens},i.prototype._is_first_token=function(){return this.__tokens.isEmpty()},i.prototype._reset=function(){},i.prototype._get_next_token=function(t,e){this._readWhitespace();var n=this._input.read(/.+/g);return n?this._create_token(o.RAW,n):this._create_token(o.EOF,"")},i.prototype._is_comment=function(t){return!1},i.prototype._is_opening=function(t){return!1},i.prototype._is_closing=function(t,e){return!1},i.prototype._create_token=function(t,e){return new s(t,e,this._patterns.whitespace.newline_count,this._patterns.whitespace.whitespace_before_token)},i.prototype._readWhitespace=function(){return this._patterns.whitespace.read()},t.exports.Tokenizer=i,t.exports.TOKEN=o},function(t){function e(t){this.__tokens=[],this.__tokens_length=this.__tokens.length,this.__position=0,this.__parent_token=t}e.prototype.restart=function(){this.__position=0},e.prototype.isEmpty=function(){return 0===this.__tokens_length},e.prototype.hasNext=function(){return this.__position<this.__tokens_length},e.prototype.next=function(){var t=null;return this.hasNext()&&(t=this.__tokens[this.__position],this.__position+=1),t},e.prototype.peek=function(t){var e=null;return t=t||0,0<=(t+=this.__position)&&t<this.__tokens_length?this.__tokens[t]:e},e.prototype.add=function(t){this.__parent_token&&(t.parent=this.__parent_token),this.__tokens.push(t),this.__tokens_length+=1},t.exports.TokenStream=e},function(t,e,n){var i=n(12).Pattern;function _(t,e){i.call(this,t,e),e?this._line_regexp=this._input.get_regexp(e._line_regexp):this.__set_whitespace_patterns("",""),this.newline_count=0,this.whitespace_before_token=""}(_.prototype=new i).__set_whitespace_patterns=function(t,e){this._match_pattern=this._input.get_regexp("["+(t+="\\t ")+(e+="\\n\\r")+"]+",!0),this._newline_regexp=this._input.get_regexp("\\r\\n|["+e+"]")},_.prototype.read=function(){this.newline_count=0,this.whitespace_before_token="";var t,e=this._input.read(this._match_pattern);return" "===e?this.whitespace_before_token=" ":e&&(t=this.__split(this._newline_regexp,e),this.newline_count=t.length-1,this.whitespace_before_token=t[this.newline_count]),e},_.prototype.matching=function(t,e){var n=this._create();return n.__set_whitespace_patterns(t,e),n._update(),n},_.prototype._create=function(){return new _(this._input,this)},_.prototype.__split=function(t,e){for(var n=t.lastIndex=0,i=[],_=t.exec(e);_;)i.push(e.substring(n,_.index)),n=_.index+_[0].length,_=t.exec(e);return n<e.length?i.push(e.substring(n,e.length)):i.push(""),i},t.exports.WhitespacePattern=_},function(t){function e(t,e){this._input=t,this._starting_pattern=null,this._match_pattern=null,this._until_pattern=null,this._until_after=!1,e&&(this._starting_pattern=this._input.get_regexp(e._starting_pattern,!0),this._match_pattern=this._input.get_regexp(e._match_pattern,!0),this._until_pattern=this._input.get_regexp(e._until_pattern),this._until_after=e._until_after)}e.prototype.read=function(){var t=this._input.read(this._starting_pattern);return this._starting_pattern&&!t||(t+=this._input.read(this._match_pattern,this._until_pattern,this._until_after)),t},e.prototype.read_match=function(){return this._input.match(this._match_pattern)},e.prototype.until_after=function(t){var e=this._create();return e._until_after=!0,e._until_pattern=this._input.get_regexp(t),e._update(),e},e.prototype.until=function(t){var e=this._create();return e._until_after=!1,e._until_pattern=this._input.get_regexp(t),e._update(),e},e.prototype.starting_with=function(t){var e=this._create();return e._starting_pattern=this._input.get_regexp(t,!0),e._update(),e},e.prototype.matching=function(t){var e=this._create();return e._match_pattern=this._input.get_regexp(t,!0),e._update(),e},e.prototype._create=function(){return new e(this._input,this)},e.prototype._update=function(){},t.exports.Pattern=e},function(t){function e(t,e){t="string"==typeof t?t:t.source,e="string"==typeof e?e:e.source,this.__directives_block_pattern=new RegExp(t+/ beautify( \w+[:]\w+)+ /.source+e,"g"),this.__directive_pattern=/ (\w+)[:](\w+)/g,this.__directives_end_ignore_pattern=new RegExp(t+/\sbeautify\signore:end\s/.source+e,"g")}e.prototype.get_directives=function(t){if(!t.match(this.__directives_block_pattern))return null;for(var e={},n=(this.__directive_pattern.lastIndex=0,this.__directive_pattern.exec(t));n;)e[n[1]]=n[2],n=this.__directive_pattern.exec(t);return e},e.prototype.readIgnored=function(t){return t.readUntilAfter(this.__directives_end_ignore_pattern)},t.exports.Directives=e},function(t,e,n){var i=n(12).Pattern,_={django:!1,erb:!1,handlebars:!1,php:!1,smarty:!1};function s(t,e){i.call(this,t,e),this.__template_pattern=null,this._disabled=Object.assign({},_),this._excluded=Object.assign({},_),e&&(this.__template_pattern=this._input.get_regexp(e.__template_pattern),this._excluded=Object.assign(this._excluded,e._excluded),this._disabled=Object.assign(this._disabled,e._disabled)),e=new i(t),this.__patterns={handlebars_comment:e.starting_with(/{{!--/).until_after(/--}}/),handlebars_unescaped:e.starting_with(/{{{/).until_after(/}}}/),handlebars:e.starting_with(/{{/).until_after(/}}/),php:e.starting_with(/<\?(?:[= ]|php)/).until_after(/\?>/),erb:e.starting_with(/<%[^%]/).until_after(/[^%]%>/),django:e.starting_with(/{%/).until_after(/%}/),django_value:e.starting_with(/{{/).until_after(/}}/),django_comment:e.starting_with(/{#/).until_after(/#}/),smarty:e.starting_with(/{(?=[^}{\s\n])/).until_after(/[^\s\n]}/),smarty_comment:e.starting_with(/{\*/).until_after(/\*}/),smarty_literal:e.starting_with(/{literal}/).until_after(/{\/literal}/)}}(s.prototype=new i)._create=function(){return new s(this._input,this)},s.prototype._update=function(){this.__set_templated_pattern()},s.prototype.disable=function(t){var e=this._create();return e._disabled[t]=!0,e._update(),e},s.prototype.read_options=function(t){var e,n=this._create();for(e in _)n._disabled[e]=-1===t.templating.indexOf(e);return n._update(),n},s.prototype.exclude=function(t){var e=this._create();return e._excluded[t]=!0,e._update(),e},s.prototype.read=function(){for(var t="",e=(t=this._match_pattern?this._input.read(this._starting_pattern):this._input.read(this._starting_pattern,this.__template_pattern),this._read_template());e;)this._match_pattern?e+=this._input.read(this._match_pattern):e+=this._input.readUntil(this.__template_pattern),t+=e,e=this._read_template();return this._until_after&&(t+=this._input.readUntilAfter(this._until_pattern)),t},s.prototype.__set_templated_pattern=function(){var t=[];this._disabled.php||t.push(this.__patterns.php._starting_pattern.source),this._disabled.handlebars||t.push(this.__patterns.handlebars._starting_pattern.source),this._disabled.erb||t.push(this.__patterns.erb._starting_pattern.source),this._disabled.django||(t.push(this.__patterns.django._starting_pattern.source),t.push(this.__patterns.django_value._starting_pattern.source),t.push(this.__patterns.django_comment._starting_pattern.source)),this._disabled.smarty||t.push(this.__patterns.smarty._starting_pattern.source),this._until_pattern&&t.push(this._until_pattern.source),this.__template_pattern=this._input.get_regexp("(?:"+t.join("|")+")")},s.prototype._read_template=function(){var t,e="",n=this._input.peek();return"<"===n?(t=this._input.peek(1),this._disabled.php||this._excluded.php||"?"!==t||(e=e||this.__patterns.php.read()),this._disabled.erb||this._excluded.erb||"%"!==t||(e=e||this.__patterns.erb.read())):"{"===n&&(this._disabled.handlebars||this._excluded.handlebars||(e=(e=(e=e||this.__patterns.handlebars_comment.read())||this.__patterns.handlebars_unescaped.read())||this.__patterns.handlebars.read()),this._disabled.django||(this._excluded.django||this._excluded.handlebars||(e=e||this.__patterns.django_value.read()),this._excluded.django||(e=(e=e||this.__patterns.django_comment.read())||this.__patterns.django.read())),this._disabled.smarty||this._disabled.django&&this._disabled.handlebars&&(e=(e=(e=e||this.__patterns.smarty_comment.read())||this.__patterns.smarty_literal.read())||this.__patterns.smarty.read())),e},t.exports.TemplatablePattern=s},,,,function(t,e,n){var i=n(19).Beautifier,_=n(20).Options;t.exports=function(t,e,n,_){return new i(t,e,n,_).beautify()},t.exports.defaultOptions=function(){return new _}},function(t,e,n){function i(t,e){this.indent_level=0,this.alignment_size=0,this.max_preserve_newlines=t.max_preserve_newlines,this.preserve_newlines=t.preserve_newlines,this._output=new s(t,e)}var _=n(20).Options,s=n(2).Output,r=n(21).Tokenizer,a=n(21).TOKEN,o=/\r\n|[\r\n]/,p=/\r\n|[\r\n]/g;function h(t,e){return-1!==e.indexOf(t)}function u(t,e,n){this.parent=t||null,this.tag=e?e.tag_name:"",this.indent_level=n||0,this.parser_token=e||null}function l(t){this._printer=t,this._current_frame=null}function c(t,e,n,i){this._source_text=t||"",e=e||{},this._js_beautify=n,this._css_beautify=i,this._tag_stack=null,t=new _(e,"html"),this._options=t,this._is_wrap_attributes_force="force"===this._options.wrap_attributes.substr(0,5),this._is_wrap_attributes_force_expand_multiline="force-expand-multiline"===this._options.wrap_attributes,this._is_wrap_attributes_force_aligned="force-aligned"===this._options.wrap_attributes,this._is_wrap_attributes_aligned_multiple="aligned-multiple"===this._options.wrap_attributes,this._is_wrap_attributes_preserve="preserve"===this._options.wrap_attributes.substr(0,8),this._is_wrap_attributes_preserve_aligned="preserve-aligned"===this._options.wrap_attributes}i.prototype.current_line_has_match=function(t){return this._output.current_line.has_match(t)},i.prototype.set_space_before_token=function(t,e){this._output.space_before_token=t,this._output.non_breaking_space=e},i.prototype.set_wrap_point=function(){this._output.set_indent(this.indent_level,this.alignment_size),this._output.set_wrap_point()},i.prototype.add_raw_token=function(t){this._output.add_raw_token(t)},i.prototype.print_preserved_newlines=function(t){var e=0;t.type!==a.TEXT&&t.previous.type!==a.TEXT&&(e=t.newlines?1:0),this.preserve_newlines&&(e=t.newlines<this.max_preserve_newlines+1?t.newlines:this.max_preserve_newlines+1);for(var n=0;n<e;n++)this.print_newline(0<n);return 0!==e},i.prototype.traverse_whitespace=function(t){return!(!t.whitespace_before&&!t.newlines||(this.print_preserved_newlines(t)||(this._output.space_before_token=!0),0))},i.prototype.previous_token_wrapped=function(){return this._output.previous_token_wrapped},i.prototype.print_newline=function(t){this._output.add_new_line(t)},i.prototype.print_token=function(t){t.text&&(this._output.set_indent(this.indent_level,this.alignment_size),this._output.add_token(t.text))},i.prototype.indent=function(){this.indent_level++},i.prototype.get_full_indent=function(t){return(t=this.indent_level+(t||0))<1?"":this._output.get_indent_string(t)},l.prototype.get_parser_token=function(){return this._current_frame?this._current_frame.parser_token:null},l.prototype.record_tag=function(t){t=new u(this._current_frame,t,this._printer.indent_level),this._current_frame=t},l.prototype._try_pop_frame=function(t){var e=null;return t&&(e=t.parser_token,this._printer.indent_level=t.indent_level,this._current_frame=t.parent),e},l.prototype._get_frame=function(t,e){for(var n=this._current_frame;n&&-1===t.indexOf(n.tag);){if(e&&-1!==e.indexOf(n.tag)){n=null;break}n=n.parent}return n},l.prototype.try_pop=function(t,e){return t=this._get_frame([t],e),this._try_pop_frame(t)},l.prototype.indent_to_tag=function(t){(t=this._get_frame(t))&&(this._printer.indent_level=t.indent_level)},c.prototype.beautify=function(){if(this._options.disabled)return this._source_text;for(var t=this._source_text,e=this._options.eol,n=("auto"===this._options.eol&&(e="\n",t&&o.test(t)&&(e=t.match(o)[0])),(t=t.replace(p,"\n")).match(/^[\t ]*/)[0]),_={text:"",type:""},s=new d,h=new i(this._options,n),u=new r(t,this._options).tokenize(),c=(this._tag_stack=new l(h),null),g=u.next();g.type!==a.EOF;)g.type===a.TAG_OPEN||g.type===a.COMMENT?s=c=this._handle_tag_open(h,g,s,_):g.type===a.ATTRIBUTE||g.type===a.EQUALS||g.type===a.VALUE||g.type===a.TEXT&&!s.tag_complete?c=this._handle_inside_tag(h,g,s,u):g.type===a.TAG_CLOSE?c=this._handle_tag_close(h,g,s):g.type===a.TEXT?c=this._handle_text(h,g,s):h.add_raw_token(g),_=c,g=u.next();return h._output.get_code(e)},c.prototype._handle_tag_close=function(t,e,n){var i={text:e.text,type:e.type};return t.alignment_size=0,n.tag_complete=!0,t.set_space_before_token(e.newlines||""!==e.whitespace_before,!0),n.is_unformatted?t.add_raw_token(e):("<"===n.tag_start_char&&(t.set_space_before_token("/"===e.text[0],!0),this._is_wrap_attributes_force_expand_multiline&&n.has_wrapped_attrs&&t.print_newline(!1)),t.print_token(e)),!n.indent_content||n.is_unformatted||n.is_content_unformatted||(t.indent(),n.indent_content=!1),n.is_inline_element||n.is_unformatted||n.is_content_unformatted||t.set_wrap_point(),i},c.prototype._handle_inside_tag=function(t,e,n,i){var _=n.has_wrapped_attrs,s={text:e.text,type:e.type};if(t.set_space_before_token(e.newlines||""!==e.whitespace_before,!0),n.is_unformatted)t.add_raw_token(e);else if("{"===n.tag_start_char&&e.type===a.TEXT)t.print_preserved_newlines(e)?(e.newlines=0,t.add_raw_token(e)):t.print_token(e);else{if(e.type===a.ATTRIBUTE?(t.set_space_before_token(!0),n.attr_count+=1):(e.type===a.EQUALS||e.type===a.VALUE&&e.previous.type===a.EQUALS)&&t.set_space_before_token(!1),e.type===a.ATTRIBUTE&&"<"===n.tag_start_char&&((this._is_wrap_attributes_preserve||this._is_wrap_attributes_preserve_aligned)&&(t.traverse_whitespace(e),_=_||0!==e.newlines),this._is_wrap_attributes_force)){var r=1<n.attr_count;if(this._is_wrap_attributes_force_expand_multiline&&1===n.attr_count){var o,p=!0,h=0;do{if((o=i.peek(h)).type===a.ATTRIBUTE){p=!1;break}}while((h+=1)<4&&o.type!==a.EOF&&o.type!==a.TAG_CLOSE);r=!p}r&&(t.print_newline(!1),_=!0)}t.print_token(e),_=_||t.previous_token_wrapped(),n.has_wrapped_attrs=_}return s},c.prototype._handle_text=function(t,e,n){var i={text:e.text,type:"TK_CONTENT"};return n.custom_beautifier_name?this._print_custom_beatifier_text(t,e,n):n.is_unformatted||n.is_content_unformatted?t.add_raw_token(e):(t.traverse_whitespace(e),t.print_token(e)),i},c.prototype._print_custom_beatifier_text=function(t,e,n){var i=this;if(""!==e.text){var _,s=e.text,r=1,a="",o="";r=("javascript"===n.custom_beautifier_name&&"function"==typeof this._js_beautify?_=this._js_beautify:"css"===n.custom_beautifier_name&&"function"==typeof this._css_beautify?_=this._css_beautify:"html"===n.custom_beautifier_name&&(_=function(t,e){return new c(t,e,i._js_beautify,i._css_beautify).beautify()}),"keep"===this._options.indent_scripts?r=0:"separate"===this._options.indent_scripts&&(r=-t.indent_level),t.get_full_indent(r));if(s=s.replace(/\n[ \t]*$/,""),"html"!==n.custom_beautifier_name&&"<"===s[0]&&s.match(/^(<!--|<!\[CDATA\[)/)){if(!(n=/^(<!--[^\n]*|<!\[CDATA\[)(\n?)([ \t\n]*)([\s\S]*)(-->|]]>)$/.exec(s)))return void t.add_raw_token(e);a=r+n[1]+"\n",s=n[4],n[5]&&(o=r+n[5]),s=s.replace(/\n[ \t]*$/,""),(n[2]||-1!==n[3].indexOf("\n"))&&(n=n[3].match(/[ \t]+$/))&&(e.whitespace_before=n[0])}s=s&&(_?((n=function(){this.eol="\n"}).prototype=this._options.raw_options,_(r+s,new n)):r+(s=(_=e.whitespace_before)?s.replace(new RegExp("\n("+_+")?","g"),"\n"):s).replace(/\n/g,"\n"+r)),a&&(s=s?a+s+"\n"+o:a+o),t.print_newline(!1),s&&(e.text=s,e.whitespace_before="",e.newlines=0,t.add_raw_token(e),t.print_newline(!0))}},c.prototype._handle_tag_open=function(t,e,n,i){var _=this._get_tag_open_token(e);return!n.is_unformatted&&!n.is_content_unformatted||n.is_empty_element||e.type!==a.TAG_OPEN||0!==e.text.indexOf("</")?(t.traverse_whitespace(e),this._set_tag_position(t,e,_,n,i),_.is_inline_element||t.set_wrap_point(),t.print_token(e)):(t.add_raw_token(e),_.start_tag_token=this._tag_stack.try_pop(_.tag_name)),(this._is_wrap_attributes_force_aligned||this._is_wrap_attributes_aligned_multiple||this._is_wrap_attributes_preserve_aligned)&&(_.alignment_size=e.text.length+1),_.tag_complete||_.is_unformatted||(t.alignment_size=_.alignment_size),_};var d=function(t,e){var n;this.parent=t||null,this.text="",this.type="TK_TAG_OPEN",this.tag_name="",this.is_inline_element=!1,this.is_unformatted=!1,this.is_content_unformatted=!1,this.is_empty_element=!1,this.is_start_tag=!1,this.is_end_tag=!1,this.indent_content=!1,this.multiline_content=!1,this.custom_beautifier_name=null,this.start_tag_token=null,this.attr_count=0,this.has_wrapped_attrs=!1,this.alignment_size=0,this.tag_complete=!1,this.tag_start_char="",this.tag_check="",e?(this.tag_start_char=e.text[0],this.text=e.text,"<"===this.tag_start_char?(n=e.text.match(/^<([^\s>]*)/),this.tag_check=n?n[1]:""):(n=e.text.match(/^{{~?(?:[\^]|#\*?)?([^\s}]+)/),this.tag_check=n?n[1]:"",(e.text.startsWith("{{#>")||e.text.startsWith("{{~#>"))&&">"===this.tag_check[0]&&(">"===this.tag_check&&null!==e.next?this.tag_check=e.next.text.split(" ")[0]:this.tag_check=e.text.split(">")[1])),this.tag_check=this.tag_check.toLowerCase(),e.type===a.COMMENT&&(this.tag_complete=!0),this.is_start_tag="/"!==this.tag_check.charAt(0),this.tag_name=this.is_start_tag?this.tag_check:this.tag_check.substr(1),this.is_end_tag=!this.is_start_tag||e.closed&&"/>"===e.closed.text,t=2,"{"===this.tag_start_char&&3<=this.text.length&&"~"===this.text.charAt(2)&&(t=3),this.is_end_tag=this.is_end_tag||"{"===this.tag_start_char&&(this.text.length<3||/[^#\^]/.test(this.text.charAt(t)))):this.tag_complete=!0},g=(c.prototype._get_tag_open_token=function(t){return(t=new d(this._tag_stack.get_parser_token(),t)).alignment_size=this._options.wrap_attributes_indent_size,t.is_end_tag=t.is_end_tag||h(t.tag_check,this._options.void_elements),t.is_empty_element=t.tag_complete||t.is_start_tag&&t.is_end_tag,t.is_unformatted=!t.tag_complete&&h(t.tag_check,this._options.unformatted),t.is_content_unformatted=!t.is_empty_element&&h(t.tag_check,this._options.content_unformatted),t.is_inline_element=h(t.tag_name,this._options.inline)||t.tag_name.includes("-")||"{"===t.tag_start_char,t},c.prototype._set_tag_position=function(t,e,n,i,_){n.is_empty_element||(n.is_end_tag?n.start_tag_token=this._tag_stack.try_pop(n.tag_name):(this._do_optional_end_element(n)&&!n.is_inline_element&&t.print_newline(!1),this._tag_stack.record_tag(n),"script"!==n.tag_name&&"style"!==n.tag_name||n.is_unformatted||n.is_content_unformatted||(n.custom_beautifier_name=function(t,e){var n=null,i=null;return e.closed?("script"===t?n="text/javascript":"style"===t&&(n="text/css"),-1<(n=function(t){for(var e=null,n=t.next;n.type!==a.EOF&&t.closed!==n;){if(n.type===a.ATTRIBUTE&&"type"===n.text){n.next&&n.next.type===a.EQUALS&&n.next.next&&n.next.next.type===a.VALUE&&(e=n.next.next.text);break}n=n.next}return e}(e)||n).search("text/css")?i="css":-1<n.search(/module|((text|application|dojo)\/(x-)?(javascript|ecmascript|jscript|livescript|(ld\+)?json|method|aspect))/)?i="javascript":-1<n.search(/(text|application|dojo)\/(x-)?(html)/)?i="html":-1<n.search(/test\/null/)&&(i="null"),i):null}(n.tag_check,e)))),h(n.tag_check,this._options.extra_liners)&&(t.print_newline(!1),t._output.just_added_blankline()||t.print_newline(!0)),n.is_empty_element?("{"===n.tag_start_char&&"else"===n.tag_check&&(this._tag_stack.indent_to_tag(["if","unless","each"]),n.indent_content=!0,t.current_line_has_match(/{{#if/)||t.print_newline(!1)),"!--"===n.tag_name&&_.type===a.TAG_CLOSE&&i.is_end_tag&&-1===n.text.indexOf("\n")||(n.is_inline_element||n.is_unformatted||t.print_newline(!1),this._calcluate_parent_multiline(t,n))):n.is_end_tag?(e=!1,e=(e=n.start_tag_token&&n.start_tag_token.multiline_content)||!n.is_inline_element&&!(i.is_inline_element||i.is_unformatted)&&!(_.type===a.TAG_CLOSE&&n.start_tag_token===i)&&"TK_CONTENT"!==_.type,(e=!n.is_content_unformatted&&!n.is_unformatted&&e)&&t.print_newline(!1)):(n.indent_content=!n.custom_beautifier_name,"<"===n.tag_start_char&&("html"===n.tag_name?n.indent_content=this._options.indent_inner_html:"head"===n.tag_name?n.indent_content=this._options.indent_head_inner_html:"body"===n.tag_name&&(n.indent_content=this._options.indent_body_inner_html)),n.is_inline_element||n.is_unformatted||"TK_CONTENT"===_.type&&!n.is_content_unformatted||t.print_newline(!1),this._calcluate_parent_multiline(t,n))},c.prototype._calcluate_parent_multiline=function(t,e){!e.parent||!t._output.just_added_newline()||(e.is_inline_element||e.is_unformatted)&&e.parent.is_inline_element||(e.parent.multiline_content=!0)},["address","article","aside","blockquote","details","div","dl","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hr","main","nav","ol","p","pre","section","table","ul"]),f=["a","audio","del","ins","map","noscript","video"];c.prototype._do_optional_end_element=function(t){var e,n=null;if(!t.is_empty_element&&t.is_start_tag&&t.parent)return"body"===t.tag_name?n=n||this._tag_stack.try_pop("head"):"li"===t.tag_name?n=n||this._tag_stack.try_pop("li",["ol","ul"]):"dd"===t.tag_name||"dt"===t.tag_name?n=(n=n||this._tag_stack.try_pop("dt",["dl"]))||this._tag_stack.try_pop("dd",["dl"]):"p"===t.parent.tag_name&&-1!==g.indexOf(t.tag_name)?(e=t.parent.parent)&&-1!==f.indexOf(e.tag_name)||(n=n||this._tag_stack.try_pop("p")):"rp"===t.tag_name||"rt"===t.tag_name?n=(n=n||this._tag_stack.try_pop("rt",["ruby","rtc"]))||this._tag_stack.try_pop("rp",["ruby","rtc"]):"optgroup"===t.tag_name?n=n||this._tag_stack.try_pop("optgroup",["select"]):"option"===t.tag_name?n=n||this._tag_stack.try_pop("option",["select","datalist","optgroup"]):"colgroup"===t.tag_name?n=n||this._tag_stack.try_pop("caption",["table"]):"thead"===t.tag_name?n=(n=n||this._tag_stack.try_pop("caption",["table"]))||this._tag_stack.try_pop("colgroup",["table"]):"tbody"===t.tag_name||"tfoot"===t.tag_name?n=(n=(n=(n=n||this._tag_stack.try_pop("caption",["table"]))||this._tag_stack.try_pop("colgroup",["table"]))||this._tag_stack.try_pop("thead",["table"]))||this._tag_stack.try_pop("tbody",["table"]):"tr"===t.tag_name?n=(n=(n=n||this._tag_stack.try_pop("caption",["table"]))||this._tag_stack.try_pop("colgroup",["table"]))||this._tag_stack.try_pop("tr",["table","thead","tbody","tfoot"]):"th"!==t.tag_name&&"td"!==t.tag_name||(n=(n=n||this._tag_stack.try_pop("td",["table","thead","tbody","tfoot","tr"]))||this._tag_stack.try_pop("th",["table","thead","tbody","tfoot","tr"])),t.parent=this._tag_stack.get_parser_token(),n},t.exports.Beautifier=c},function(t,e,n){var i=n(6).Options;function _(t){i.call(this,t,"html"),1===this.templating.length&&"auto"===this.templating[0]&&(this.templating=["django","erb","handlebars","php"]),this.indent_inner_html=this._get_boolean("indent_inner_html"),this.indent_body_inner_html=this._get_boolean("indent_body_inner_html",!0),this.indent_head_inner_html=this._get_boolean("indent_head_inner_html",!0),this.indent_handlebars=this._get_boolean("indent_handlebars",!0),this.wrap_attributes=this._get_selection("wrap_attributes",["auto","force","force-aligned","force-expand-multiline","aligned-multiple","preserve","preserve-aligned"]),this.wrap_attributes_indent_size=this._get_number("wrap_attributes_indent_size",this.indent_size),this.extra_liners=this._get_array("extra_liners",["head","body","/html"]),this.inline=this._get_array("inline",["a","abbr","area","audio","b","bdi","bdo","br","button","canvas","cite","code","data","datalist","del","dfn","em","embed","i","iframe","img","input","ins","kbd","keygen","label","map","mark","math","meter","noscript","object","output","progress","q","ruby","s","samp","select","small","span","strong","sub","sup","svg","template","textarea","time","u","var","video","wbr","text","acronym","big","strike","tt"]),this.void_elements=this._get_array("void_elements",["area","base","br","col","embed","hr","img","input","keygen","link","menuitem","meta","param","source","track","wbr","!doctype","?xml","basefont","isindex"]),this.unformatted=this._get_array("unformatted",[]),this.content_unformatted=this._get_array("content_unformatted",["pre","textarea"]),this.unformatted_content_delimiter=this._get_characters("unformatted_content_delimiter"),this.indent_scripts=this._get_selection("indent_scripts",["normal","keep","separate"])}_.prototype=new i,t.exports.Options=_},function(t,e,n){function i(t,e){_.call(this,t,e),this._current_tag_name="";t=new a(this._input).read_options(this._options),e=new o(this._input);this.__patterns={word:t.until(/[\n\r\t <]/),single_quote:t.until_after(/'/),double_quote:t.until_after(/"/),attribute:t.until(/[\n\r\t =>]|\/>/),element_name:t.until(/[\n\r\t >\/]/),handlebars_comment:e.starting_with(/{{!--/).until_after(/--}}/),handlebars:e.starting_with(/{{/).until_after(/}}/),handlebars_open:e.until(/[\n\r\t }]/),handlebars_raw_close:e.until(/}}/),comment:e.starting_with(/<!--/).until_after(/-->/),cdata:e.starting_with(/<!\[CDATA\[/).until_after(/]]>/),conditional_comment:e.starting_with(/<!\[/).until_after(/]>/),processing:e.starting_with(/<\?/).until_after(/\?>/)},this._options.indent_handlebars&&(this.__patterns.word=this.__patterns.word.exclude("handlebars")),this._unformatted_content_delimiter=null,this._options.unformatted_content_delimiter&&(t=this._input.get_literal_regexp(this._options.unformatted_content_delimiter),this.__patterns.unformatted_content_delimiter=e.matching(t).until_after(t))}var _=n(9).Tokenizer,s=n(9).TOKEN,r=n(13).Directives,a=n(14).TemplatablePattern,o=n(12).Pattern,p={TAG_OPEN:"TK_TAG_OPEN",TAG_CLOSE:"TK_TAG_CLOSE",ATTRIBUTE:"TK_ATTRIBUTE",EQUALS:"TK_EQUALS",VALUE:"TK_VALUE",COMMENT:"TK_COMMENT",TEXT:"TK_TEXT",UNKNOWN:"TK_UNKNOWN",START:s.START,RAW:s.RAW,EOF:s.EOF},h=new r(/<\!--/,/-->/);(i.prototype=new _)._is_comment=function(t){return!1},i.prototype._is_opening=function(t){return t.type===p.TAG_OPEN},i.prototype._is_closing=function(t,e){return t.type===p.TAG_CLOSE&&e&&((">"===t.text||"/>"===t.text)&&"<"===e.text[0]||"}}"===t.text&&"{"===e.text[0]&&"{"===e.text[1])},i.prototype._reset=function(){this._current_tag_name=""},i.prototype._get_next_token=function(t,e){this._readWhitespace();var n=this._input.peek();return null===n?this._create_token(p.EOF,""):this._read_open_handlebars(n,e)||this._read_attribute(n,t,e)||this._read_close(n,e)||this._read_raw_content(n,t,e)||this._read_content_word(n)||this._read_comment_or_cdata(n)||this._read_processing(n)||this._read_open(n,e)||this._create_token(p.UNKNOWN,this._input.next())},i.prototype._read_comment_or_cdata=function(t){var e=null,n=null,i=null;return"<"===t&&("!"===this._input.peek(1)&&((n=this.__patterns.comment.read())?(i=h.get_directives(n))&&"start"===i.ignore&&(n+=h.readIgnored(this._input)):n=this.__patterns.cdata.read()),n&&((e=this._create_token(p.COMMENT,n)).directives=i)),e},i.prototype._read_processing=function(t){var e=null,n=null;return"<"===t&&(n="!"!==(t=this._input.peek(1))&&"?"!==t?n:(n=this.__patterns.conditional_comment.read())||this.__patterns.processing.read())&&((e=this._create_token(p.COMMENT,n)).directives=null),e},i.prototype._read_open=function(t,e){var n=null,i=null;return e||"<"===t&&(n=this._input.next(),"/"===this._input.peek()&&(n+=this._input.next()),n+=this.__patterns.element_name.read(),i=this._create_token(p.TAG_OPEN,n)),i},i.prototype._read_open_handlebars=function(t,e){var n=null,i=null;return e||this._options.indent_handlebars&&"{"===t&&"{"===this._input.peek(1)&&(i="!"===this._input.peek(2)?(n=(n=this.__patterns.handlebars_comment.read())||this.__patterns.handlebars.read(),this._create_token(p.COMMENT,n)):(n=this.__patterns.handlebars_open.read(),this._create_token(p.TAG_OPEN,n))),i},i.prototype._read_close=function(t,e){var n=null,i=null;return e&&("<"===e.text[0]&&(">"===t||"/"===t&&">"===this._input.peek(1))?(n=this._input.next(),"/"===t&&(n+=this._input.next()),i=this._create_token(p.TAG_CLOSE,n)):"{"===e.text[0]&&"}"===t&&"}"===this._input.peek(1)&&(this._input.next(),this._input.next(),i=this._create_token(p.TAG_CLOSE,"}}"))),i},i.prototype._read_attribute=function(t,e,n){var i=null;return n&&"<"===n.text[0]&&("="===t?i=this._create_token(p.EQUALS,this._input.next()):'"'===t||"'"===t?(n=this._input.next(),n+=('"'===t?this.__patterns.double_quote:this.__patterns.single_quote).read(),i=this._create_token(p.VALUE,n)):(t=this.__patterns.attribute.read())&&(i=e.type===p.EQUALS?this._create_token(p.VALUE,t):this._create_token(p.ATTRIBUTE,t))),i},i.prototype._is_content_unformatted=function(t){return-1===this._options.void_elements.indexOf(t)&&(-1!==this._options.content_unformatted.indexOf(t)||-1!==this._options.unformatted.indexOf(t))},i.prototype._read_raw_content=function(t,e,n){var i="";if(n&&"{"===n.text[0])i=this.__patterns.handlebars_raw_close.read();else if(e.type===p.TAG_CLOSE&&"<"===e.opened.text[0]&&"/"!==e.text[0])if("script"===(n=e.opened.text.substr(1).toLowerCase())||"style"===n){if(e=this._read_comment_or_cdata(t))return e.type=p.TEXT,e;i=this._input.readUntil(new RegExp("</"+n+"[\\n\\r\\t ]*?>","ig"))}else this._is_content_unformatted(n)&&(i=this._input.readUntil(new RegExp("</"+n+"[\\n\\r\\t ]*?>","ig")));return i?this._create_token(p.TEXT,i):null},i.prototype._read_content_word=function(t){var e="";if(e=(e=this._options.unformatted_content_delimiter&&t===this._options.unformatted_content_delimiter[0]?this.__patterns.unformatted_content_delimiter.read():e)||this.__patterns.word.read())return this._create_token(p.TEXT,e)},t.exports.Tokenizer=i,t.exports.TOKEN=p}],n={},i=function t(i){var _=n[i];return void 0!==_||(_=n[i]={exports:{}},e[i](_,_.exports,t)),_.exports}(18);t=i}();var t,e,n,i=t;"function"==typeof define&&define.amd?define(["require","./beautify","./beautify-css"],function(t){var e=t("./beautify"),n=t("./beautify-css");return{html_beautify:function(t,_){return i(t,_,e.js_beautify,n.css_beautify)}}}):"undefined"!=typeof exports?(e=require("./beautify.js"),n=require("./beautify-css.js"),exports.html_beautify=function(t,_){return i(t,_,e.js_beautify,n.css_beautify)}):"undefined"!=typeof window?window.html_beautify=function(t,e){return i(t,e,window.js_beautify,window.css_beautify)}:"undefined"!=typeof global&&(global.html_beautify=function(t,e){return i(t,e,global.js_beautify,global.css_beautify)})}()</script><script>/*! js-yaml 4.1.0 https://github.com/nodeca/js-yaml @license MIT */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).jsyaml={})}(this,(function(e){"use strict";function t(e){return null==e}var n={isNothing:t,isObject:function(e){return"object"==typeof e&&null!==e},toArray:function(e){return Array.isArray(e)?e:t(e)?[]:[e]},repeat:function(e,t){var n,i="";for(n=0;n<t;n+=1)i+=e;return i},isNegativeZero:function(e){return 0===e&&Number.NEGATIVE_INFINITY===1/e},extend:function(e,t){var n,i,r,o;if(t)for(n=0,i=(o=Object.keys(t)).length;n<i;n+=1)e[r=o[n]]=t[r];return e}};function i(e,t){var n="",i=e.reason||"(unknown reason)";return e.mark?(e.mark.name&&(n+='in "'+e.mark.name+'" '),n+="("+(e.mark.line+1)+":"+(e.mark.column+1)+")",!t&&e.mark.snippet&&(n+="\n\n"+e.mark.snippet),i+" "+n):i}function r(e,t){Error.call(this),this.name="YAMLException",this.reason=e,this.mark=t,this.message=i(this,!1),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack||""}r.prototype=Object.create(Error.prototype),r.prototype.constructor=r,r.prototype.toString=function(e){return this.name+": "+i(this,e)};var o=r;function a(e,t,n,i,r){var o="",a="",l=Math.floor(r/2)-1;return i-t>l&&(t=i-l+(o=" ... ").length),n-i>l&&(n=i+l-(a=" ...").length),{str:o+e.slice(t,n).replace(/\t/g,"→")+a,pos:i-t+o.length}}function l(e,t){return n.repeat(" ",t-e.length)+e}var c=function(e,t){if(t=Object.create(t||null),!e.buffer)return null;t.maxLength||(t.maxLength=79),"number"!=typeof t.indent&&(t.indent=1),"number"!=typeof t.linesBefore&&(t.linesBefore=3),"number"!=typeof t.linesAfter&&(t.linesAfter=2);for(var i,r=/\r?\n|\r|\0/g,o=[0],c=[],s=-1;i=r.exec(e.buffer);)c.push(i.index),o.push(i.index+i[0].length),e.position<=i.index&&s<0&&(s=o.length-2);s<0&&(s=o.length-1);var u,p,f="",d=Math.min(e.line+t.linesAfter,c.length).toString().length,h=t.maxLength-(t.indent+d+3);for(u=1;u<=t.linesBefore&&!(s-u<0);u++)p=a(e.buffer,o[s-u],c[s-u],e.position-(o[s]-o[s-u]),h),f=n.repeat(" ",t.indent)+l((e.line-u+1).toString(),d)+" | "+p.str+"\n"+f;for(p=a(e.buffer,o[s],c[s],e.position,h),f+=n.repeat(" ",t.indent)+l((e.line+1).toString(),d)+" | "+p.str+"\n",f+=n.repeat("-",t.indent+d+3+p.pos)+"^\n",u=1;u<=t.linesAfter&&!(s+u>=c.length);u++)p=a(e.buffer,o[s+u],c[s+u],e.position-(o[s]-o[s+u]),h),f+=n.repeat(" ",t.indent)+l((e.line+u+1).toString(),d)+" | "+p.str+"\n";return f.replace(/\n$/,"")},s=["kind","multi","resolve","construct","instanceOf","predicate","represent","representName","defaultStyle","styleAliases"],u=["scalar","sequence","mapping"];var p=function(e,t){if(t=t||{},Object.keys(t).forEach((function(t){if(-1===s.indexOf(t))throw new o('Unknown option "'+t+'" is met in definition of "'+e+'" YAML type.')})),this.options=t,this.tag=e,this.kind=t.kind||null,this.resolve=t.resolve||function(){return!0},this.construct=t.construct||function(e){return e},this.instanceOf=t.instanceOf||null,this.predicate=t.predicate||null,this.represent=t.represent||null,this.representName=t.representName||null,this.defaultStyle=t.defaultStyle||null,this.multi=t.multi||!1,this.styleAliases=function(e){var t={};return null!==e&&Object.keys(e).forEach((function(n){e[n].forEach((function(e){t[String(e)]=n}))})),t}(t.styleAliases||null),-1===u.indexOf(this.kind))throw new o('Unknown kind "'+this.kind+'" is specified for "'+e+'" YAML type.')};function f(e,t){var n=[];return e[t].forEach((function(e){var t=n.length;n.forEach((function(n,i){n.tag===e.tag&&n.kind===e.kind&&n.multi===e.multi&&(t=i)})),n[t]=e})),n}function d(e){return this.extend(e)}d.prototype.extend=function(e){var t=[],n=[];if(e instanceof p)n.push(e);else if(Array.isArray(e))n=n.concat(e);else{if(!e||!Array.isArray(e.implicit)&&!Array.isArray(e.explicit))throw new o("Schema.extend argument should be a Type, [ Type ], or a schema definition ({ implicit: [...], explicit: [...] })");e.implicit&&(t=t.concat(e.implicit)),e.explicit&&(n=n.concat(e.explicit))}t.forEach((function(e){if(!(e instanceof p))throw new o("Specified list of YAML types (or a single Type object) contains a non-Type object.");if(e.loadKind&&"scalar"!==e.loadKind)throw new o("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.");if(e.multi)throw new o("There is a multi type in the implicit list of a schema. Multi tags can only be listed as explicit.")})),n.forEach((function(e){if(!(e instanceof p))throw new o("Specified list of YAML types (or a single Type object) contains a non-Type object.")}));var i=Object.create(d.prototype);return i.implicit=(this.implicit||[]).concat(t),i.explicit=(this.explicit||[]).concat(n),i.compiledImplicit=f(i,"implicit"),i.compiledExplicit=f(i,"explicit"),i.compiledTypeMap=function(){var e,t,n={scalar:{},sequence:{},mapping:{},fallback:{},multi:{scalar:[],sequence:[],mapping:[],fallback:[]}};function i(e){e.multi?(n.multi[e.kind].push(e),n.multi.fallback.push(e)):n[e.kind][e.tag]=n.fallback[e.tag]=e}for(e=0,t=arguments.length;e<t;e+=1)arguments[e].forEach(i);return n}(i.compiledImplicit,i.compiledExplicit),i};var h=d,g=new p("tag:yaml.org,2002:str",{kind:"scalar",construct:function(e){return null!==e?e:""}}),m=new p("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(e){return null!==e?e:[]}}),y=new p("tag:yaml.org,2002:map",{kind:"mapping",construct:function(e){return null!==e?e:{}}}),b=new h({explicit:[g,m,y]});var A=new p("tag:yaml.org,2002:null",{kind:"scalar",resolve:function(e){if(null===e)return!0;var t=e.length;return 1===t&&"~"===e||4===t&&("null"===e||"Null"===e||"NULL"===e)},construct:function(){return null},predicate:function(e){return null===e},represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"},empty:function(){return""}},defaultStyle:"lowercase"});var v=new p("tag:yaml.org,2002:bool",{kind:"scalar",resolve:function(e){if(null===e)return!1;var t=e.length;return 4===t&&("true"===e||"True"===e||"TRUE"===e)||5===t&&("false"===e||"False"===e||"FALSE"===e)},construct:function(e){return"true"===e||"True"===e||"TRUE"===e},predicate:function(e){return"[object Boolean]"===Object.prototype.toString.call(e)},represent:{lowercase:function(e){return e?"true":"false"},uppercase:function(e){return e?"TRUE":"FALSE"},camelcase:function(e){return e?"True":"False"}},defaultStyle:"lowercase"});function w(e){return 48<=e&&e<=55}function k(e){return 48<=e&&e<=57}var C=new p("tag:yaml.org,2002:int",{kind:"scalar",resolve:function(e){if(null===e)return!1;var t,n,i=e.length,r=0,o=!1;if(!i)return!1;if("-"!==(t=e[r])&&"+"!==t||(t=e[++r]),"0"===t){if(r+1===i)return!0;if("b"===(t=e[++r])){for(r++;r<i;r++)if("_"!==(t=e[r])){if("0"!==t&&"1"!==t)return!1;o=!0}return o&&"_"!==t}if("x"===t){for(r++;r<i;r++)if("_"!==(t=e[r])){if(!(48<=(n=e.charCodeAt(r))&&n<=57||65<=n&&n<=70||97<=n&&n<=102))return!1;o=!0}return o&&"_"!==t}if("o"===t){for(r++;r<i;r++)if("_"!==(t=e[r])){if(!w(e.charCodeAt(r)))return!1;o=!0}return o&&"_"!==t}}if("_"===t)return!1;for(;r<i;r++)if("_"!==(t=e[r])){if(!k(e.charCodeAt(r)))return!1;o=!0}return!(!o||"_"===t)},construct:function(e){var t,n=e,i=1;if(-1!==n.indexOf("_")&&(n=n.replace(/_/g,"")),"-"!==(t=n[0])&&"+"!==t||("-"===t&&(i=-1),t=(n=n.slice(1))[0]),"0"===n)return 0;if("0"===t){if("b"===n[1])return i*parseInt(n.slice(2),2);if("x"===n[1])return i*parseInt(n.slice(2),16);if("o"===n[1])return i*parseInt(n.slice(2),8)}return i*parseInt(n,10)},predicate:function(e){return"[object Number]"===Object.prototype.toString.call(e)&&e%1==0&&!n.isNegativeZero(e)},represent:{binary:function(e){return e>=0?"0b"+e.toString(2):"-0b"+e.toString(2).slice(1)},octal:function(e){return e>=0?"0o"+e.toString(8):"-0o"+e.toString(8).slice(1)},decimal:function(e){return e.toString(10)},hexadecimal:function(e){return e>=0?"0x"+e.toString(16).toUpperCase():"-0x"+e.toString(16).toUpperCase().slice(1)}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}}),x=new RegExp("^(?:[-+]?(?:[0-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$");var I=/^[-+]?[0-9]+e/;var S=new p("tag:yaml.org,2002:float",{kind:"scalar",resolve:function(e){return null!==e&&!(!x.test(e)||"_"===e[e.length-1])},construct:function(e){var t,n;return n="-"===(t=e.replace(/_/g,"").toLowerCase())[0]?-1:1,"+-".indexOf(t[0])>=0&&(t=t.slice(1)),".inf"===t?1===n?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:".nan"===t?NaN:n*parseFloat(t,10)},predicate:function(e){return"[object Number]"===Object.prototype.toString.call(e)&&(e%1!=0||n.isNegativeZero(e))},represent:function(e,t){var i;if(isNaN(e))switch(t){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===e)switch(t){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===e)switch(t){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(n.isNegativeZero(e))return"-0.0";return i=e.toString(10),I.test(i)?i.replace("e",".e"):i},defaultStyle:"lowercase"}),O=b.extend({implicit:[A,v,C,S]}),j=O,T=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),N=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$");var F=new p("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:function(e){return null!==e&&(null!==T.exec(e)||null!==N.exec(e))},construct:function(e){var t,n,i,r,o,a,l,c,s=0,u=null;if(null===(t=T.exec(e))&&(t=N.exec(e)),null===t)throw new Error("Date resolve error");if(n=+t[1],i=+t[2]-1,r=+t[3],!t[4])return new Date(Date.UTC(n,i,r));if(o=+t[4],a=+t[5],l=+t[6],t[7]){for(s=t[7].slice(0,3);s.length<3;)s+="0";s=+s}return t[9]&&(u=6e4*(60*+t[10]+ +(t[11]||0)),"-"===t[9]&&(u=-u)),c=new Date(Date.UTC(n,i,r,o,a,l,s)),u&&c.setTime(c.getTime()-u),c},instanceOf:Date,represent:function(e){return e.toISOString()}});var E=new p("tag:yaml.org,2002:merge",{kind:"scalar",resolve:function(e){return"<<"===e||null===e}}),M="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\n\r";var L=new p("tag:yaml.org,2002:binary",{kind:"scalar",resolve:function(e){if(null===e)return!1;var t,n,i=0,r=e.length,o=M;for(n=0;n<r;n++)if(!((t=o.indexOf(e.charAt(n)))>64)){if(t<0)return!1;i+=6}return i%8==0},construct:function(e){var t,n,i=e.replace(/[\r\n=]/g,""),r=i.length,o=M,a=0,l=[];for(t=0;t<r;t++)t%4==0&&t&&(l.push(a>>16&255),l.push(a>>8&255),l.push(255&a)),a=a<<6|o.indexOf(i.charAt(t));return 0===(n=r%4*6)?(l.push(a>>16&255),l.push(a>>8&255),l.push(255&a)):18===n?(l.push(a>>10&255),l.push(a>>2&255)):12===n&&l.push(a>>4&255),new Uint8Array(l)},predicate:function(e){return"[object Uint8Array]"===Object.prototype.toString.call(e)},represent:function(e){var t,n,i="",r=0,o=e.length,a=M;for(t=0;t<o;t++)t%3==0&&t&&(i+=a[r>>18&63],i+=a[r>>12&63],i+=a[r>>6&63],i+=a[63&r]),r=(r<<8)+e[t];return 0===(n=o%3)?(i+=a[r>>18&63],i+=a[r>>12&63],i+=a[r>>6&63],i+=a[63&r]):2===n?(i+=a[r>>10&63],i+=a[r>>4&63],i+=a[r<<2&63],i+=a[64]):1===n&&(i+=a[r>>2&63],i+=a[r<<4&63],i+=a[64],i+=a[64]),i}}),_=Object.prototype.hasOwnProperty,D=Object.prototype.toString;var U=new p("tag:yaml.org,2002:omap",{kind:"sequence",resolve:function(e){if(null===e)return!0;var t,n,i,r,o,a=[],l=e;for(t=0,n=l.length;t<n;t+=1){if(i=l[t],o=!1,"[object Object]"!==D.call(i))return!1;for(r in i)if(_.call(i,r)){if(o)return!1;o=!0}if(!o)return!1;if(-1!==a.indexOf(r))return!1;a.push(r)}return!0},construct:function(e){return null!==e?e:[]}}),q=Object.prototype.toString;var Y=new p("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:function(e){if(null===e)return!0;var t,n,i,r,o,a=e;for(o=new Array(a.length),t=0,n=a.length;t<n;t+=1){if(i=a[t],"[object Object]"!==q.call(i))return!1;if(1!==(r=Object.keys(i)).length)return!1;o[t]=[r[0],i[r[0]]]}return!0},construct:function(e){if(null===e)return[];var t,n,i,r,o,a=e;for(o=new Array(a.length),t=0,n=a.length;t<n;t+=1)i=a[t],r=Object.keys(i),o[t]=[r[0],i[r[0]]];return o}}),R=Object.prototype.hasOwnProperty;var B=new p("tag:yaml.org,2002:set",{kind:"mapping",resolve:function(e){if(null===e)return!0;var t,n=e;for(t in n)if(R.call(n,t)&&null!==n[t])return!1;return!0},construct:function(e){return null!==e?e:{}}}),K=j.extend({implicit:[F,E],explicit:[L,U,Y,B]}),P=Object.prototype.hasOwnProperty,W=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,H=/[\x85\u2028\u2029]/,$=/[,\[\]\{\}]/,G=/^(?:!|!!|![a-z\-]+!)$/i,V=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i;function Z(e){return Object.prototype.toString.call(e)}function J(e){return 10===e||13===e}function Q(e){return 9===e||32===e}function z(e){return 9===e||32===e||10===e||13===e}function X(e){return 44===e||91===e||93===e||123===e||125===e}function ee(e){var t;return 48<=e&&e<=57?e-48:97<=(t=32|e)&&t<=102?t-97+10:-1}function te(e){return 48===e?"\0":97===e?"":98===e?"\b":116===e||9===e?"\t":110===e?"\n":118===e?"\v":102===e?"\f":114===e?"\r":101===e?"":32===e?" ":34===e?'"':47===e?"/":92===e?"\\":78===e?"":95===e?" ":76===e?"\u2028":80===e?"\u2029":""}function ne(e){return e<=65535?String.fromCharCode(e):String.fromCharCode(55296+(e-65536>>10),56320+(e-65536&1023))}for(var ie=new Array(256),re=new Array(256),oe=0;oe<256;oe++)ie[oe]=te(oe)?1:0,re[oe]=te(oe);function ae(e,t){this.input=e,this.filename=t.filename||null,this.schema=t.schema||K,this.onWarning=t.onWarning||null,this.legacy=t.legacy||!1,this.json=t.json||!1,this.listener=t.listener||null,this.implicitTypes=this.schema.compiledImplicit,this.typeMap=this.schema.compiledTypeMap,this.length=e.length,this.position=0,this.line=0,this.lineStart=0,this.lineIndent=0,this.firstTabInLine=-1,this.documents=[]}function le(e,t){var n={name:e.filename,buffer:e.input.slice(0,-1),position:e.position,line:e.line,column:e.position-e.lineStart};return n.snippet=c(n),new o(t,n)}function ce(e,t){throw le(e,t)}function se(e,t){e.onWarning&&e.onWarning.call(null,le(e,t))}var ue={YAML:function(e,t,n){var i,r,o;null!==e.version&&ce(e,"duplication of %YAML directive"),1!==n.length&&ce(e,"YAML directive accepts exactly one argument"),null===(i=/^([0-9]+)\.([0-9]+)$/.exec(n[0]))&&ce(e,"ill-formed argument of the YAML directive"),r=parseInt(i[1],10),o=parseInt(i[2],10),1!==r&&ce(e,"unacceptable YAML version of the document"),e.version=n[0],e.checkLineBreaks=o<2,1!==o&&2!==o&&se(e,"unsupported YAML version of the document")},TAG:function(e,t,n){var i,r;2!==n.length&&ce(e,"TAG directive accepts exactly two arguments"),i=n[0],r=n[1],G.test(i)||ce(e,"ill-formed tag handle (first argument) of the TAG directive"),P.call(e.tagMap,i)&&ce(e,'there is a previously declared suffix for "'+i+'" tag handle'),V.test(r)||ce(e,"ill-formed tag prefix (second argument) of the TAG directive");try{r=decodeURIComponent(r)}catch(t){ce(e,"tag prefix is malformed: "+r)}e.tagMap[i]=r}};function pe(e,t,n,i){var r,o,a,l;if(t<n){if(l=e.input.slice(t,n),i)for(r=0,o=l.length;r<o;r+=1)9===(a=l.charCodeAt(r))||32<=a&&a<=1114111||ce(e,"expected valid JSON character");else W.test(l)&&ce(e,"the stream contains non-printable characters");e.result+=l}}function fe(e,t,i,r){var o,a,l,c;for(n.isObject(i)||ce(e,"cannot merge mappings; the provided source object is unacceptable"),l=0,c=(o=Object.keys(i)).length;l<c;l+=1)a=o[l],P.call(t,a)||(t[a]=i[a],r[a]=!0)}function de(e,t,n,i,r,o,a,l,c){var s,u;if(Array.isArray(r))for(s=0,u=(r=Array.prototype.slice.call(r)).length;s<u;s+=1)Array.isArray(r[s])&&ce(e,"nested arrays are not supported inside keys"),"object"==typeof r&&"[object Object]"===Z(r[s])&&(r[s]="[object Object]");if("object"==typeof r&&"[object Object]"===Z(r)&&(r="[object Object]"),r=String(r),null===t&&(t={}),"tag:yaml.org,2002:merge"===i)if(Array.isArray(o))for(s=0,u=o.length;s<u;s+=1)fe(e,t,o[s],n);else fe(e,t,o,n);else e.json||P.call(n,r)||!P.call(t,r)||(e.line=a||e.line,e.lineStart=l||e.lineStart,e.position=c||e.position,ce(e,"duplicated mapping key")),"__proto__"===r?Object.defineProperty(t,r,{configurable:!0,enumerable:!0,writable:!0,value:o}):t[r]=o,delete n[r];return t}function he(e){var t;10===(t=e.input.charCodeAt(e.position))?e.position++:13===t?(e.position++,10===e.input.charCodeAt(e.position)&&e.position++):ce(e,"a line break is expected"),e.line+=1,e.lineStart=e.position,e.firstTabInLine=-1}function ge(e,t,n){for(var i=0,r=e.input.charCodeAt(e.position);0!==r;){for(;Q(r);)9===r&&-1===e.firstTabInLine&&(e.firstTabInLine=e.position),r=e.input.charCodeAt(++e.position);if(t&&35===r)do{r=e.input.charCodeAt(++e.position)}while(10!==r&&13!==r&&0!==r);if(!J(r))break;for(he(e),r=e.input.charCodeAt(e.position),i++,e.lineIndent=0;32===r;)e.lineIndent++,r=e.input.charCodeAt(++e.position)}return-1!==n&&0!==i&&e.lineIndent<n&&se(e,"deficient indentation"),i}function me(e){var t,n=e.position;return!(45!==(t=e.input.charCodeAt(n))&&46!==t||t!==e.input.charCodeAt(n+1)||t!==e.input.charCodeAt(n+2)||(n+=3,0!==(t=e.input.charCodeAt(n))&&!z(t)))}function ye(e,t){1===t?e.result+=" ":t>1&&(e.result+=n.repeat("\n",t-1))}function be(e,t){var n,i,r=e.tag,o=e.anchor,a=[],l=!1;if(-1!==e.firstTabInLine)return!1;for(null!==e.anchor&&(e.anchorMap[e.anchor]=a),i=e.input.charCodeAt(e.position);0!==i&&(-1!==e.firstTabInLine&&(e.position=e.firstTabInLine,ce(e,"tab characters must not be used in indentation")),45===i)&&z(e.input.charCodeAt(e.position+1));)if(l=!0,e.position++,ge(e,!0,-1)&&e.lineIndent<=t)a.push(null),i=e.input.charCodeAt(e.position);else if(n=e.line,we(e,t,3,!1,!0),a.push(e.result),ge(e,!0,-1),i=e.input.charCodeAt(e.position),(e.line===n||e.lineIndent>t)&&0!==i)ce(e,"bad indentation of a sequence entry");else if(e.lineIndent<t)break;return!!l&&(e.tag=r,e.anchor=o,e.kind="sequence",e.result=a,!0)}function Ae(e){var t,n,i,r,o=!1,a=!1;if(33!==(r=e.input.charCodeAt(e.position)))return!1;if(null!==e.tag&&ce(e,"duplication of a tag property"),60===(r=e.input.charCodeAt(++e.position))?(o=!0,r=e.input.charCodeAt(++e.position)):33===r?(a=!0,n="!!",r=e.input.charCodeAt(++e.position)):n="!",t=e.position,o){do{r=e.input.charCodeAt(++e.position)}while(0!==r&&62!==r);e.position<e.length?(i=e.input.slice(t,e.position),r=e.input.charCodeAt(++e.position)):ce(e,"unexpected end of the stream within a verbatim tag")}else{for(;0!==r&&!z(r);)33===r&&(a?ce(e,"tag suffix cannot contain exclamation marks"):(n=e.input.slice(t-1,e.position+1),G.test(n)||ce(e,"named tag handle cannot contain such characters"),a=!0,t=e.position+1)),r=e.input.charCodeAt(++e.position);i=e.input.slice(t,e.position),$.test(i)&&ce(e,"tag suffix cannot contain flow indicator characters")}i&&!V.test(i)&&ce(e,"tag name cannot contain such characters: "+i);try{i=decodeURIComponent(i)}catch(t){ce(e,"tag name is malformed: "+i)}return o?e.tag=i:P.call(e.tagMap,n)?e.tag=e.tagMap[n]+i:"!"===n?e.tag="!"+i:"!!"===n?e.tag="tag:yaml.org,2002:"+i:ce(e,'undeclared tag handle "'+n+'"'),!0}function ve(e){var t,n;if(38!==(n=e.input.charCodeAt(e.position)))return!1;for(null!==e.anchor&&ce(e,"duplication of an anchor property"),n=e.input.charCodeAt(++e.position),t=e.position;0!==n&&!z(n)&&!X(n);)n=e.input.charCodeAt(++e.position);return e.position===t&&ce(e,"name of an anchor node must contain at least one character"),e.anchor=e.input.slice(t,e.position),!0}function we(e,t,i,r,o){var a,l,c,s,u,p,f,d,h,g=1,m=!1,y=!1;if(null!==e.listener&&e.listener("open",e),e.tag=null,e.anchor=null,e.kind=null,e.result=null,a=l=c=4===i||3===i,r&&ge(e,!0,-1)&&(m=!0,e.lineIndent>t?g=1:e.lineIndent===t?g=0:e.lineIndent<t&&(g=-1)),1===g)for(;Ae(e)||ve(e);)ge(e,!0,-1)?(m=!0,c=a,e.lineIndent>t?g=1:e.lineIndent===t?g=0:e.lineIndent<t&&(g=-1)):c=!1;if(c&&(c=m||o),1!==g&&4!==i||(d=1===i||2===i?t:t+1,h=e.position-e.lineStart,1===g?c&&(be(e,h)||function(e,t,n){var i,r,o,a,l,c,s,u=e.tag,p=e.anchor,f={},d=Object.create(null),h=null,g=null,m=null,y=!1,b=!1;if(-1!==e.firstTabInLine)return!1;for(null!==e.anchor&&(e.anchorMap[e.anchor]=f),s=e.input.charCodeAt(e.position);0!==s;){if(y||-1===e.firstTabInLine||(e.position=e.firstTabInLine,ce(e,"tab characters must not be used in indentation")),i=e.input.charCodeAt(e.position+1),o=e.line,63!==s&&58!==s||!z(i)){if(a=e.line,l=e.lineStart,c=e.position,!we(e,n,2,!1,!0))break;if(e.line===o){for(s=e.input.charCodeAt(e.position);Q(s);)s=e.input.charCodeAt(++e.position);if(58===s)z(s=e.input.charCodeAt(++e.position))||ce(e,"a whitespace character is expected after the key-value separator within a block mapping"),y&&(de(e,f,d,h,g,null,a,l,c),h=g=m=null),b=!0,y=!1,r=!1,h=e.tag,g=e.result;else{if(!b)return e.tag=u,e.anchor=p,!0;ce(e,"can not read an implicit mapping pair; a colon is missed")}}else{if(!b)return e.tag=u,e.anchor=p,!0;ce(e,"can not read a block mapping entry; a multiline key may not be an implicit key")}}else 63===s?(y&&(de(e,f,d,h,g,null,a,l,c),h=g=m=null),b=!0,y=!0,r=!0):y?(y=!1,r=!0):ce(e,"incomplete explicit mapping pair; a key node is missed; or followed by a non-tabulated empty line"),e.position+=1,s=i;if((e.line===o||e.lineIndent>t)&&(y&&(a=e.line,l=e.lineStart,c=e.position),we(e,t,4,!0,r)&&(y?g=e.result:m=e.result),y||(de(e,f,d,h,g,m,a,l,c),h=g=m=null),ge(e,!0,-1),s=e.input.charCodeAt(e.position)),(e.line===o||e.lineIndent>t)&&0!==s)ce(e,"bad indentation of a mapping entry");else if(e.lineIndent<t)break}return y&&de(e,f,d,h,g,null,a,l,c),b&&(e.tag=u,e.anchor=p,e.kind="mapping",e.result=f),b}(e,h,d))||function(e,t){var n,i,r,o,a,l,c,s,u,p,f,d,h=!0,g=e.tag,m=e.anchor,y=Object.create(null);if(91===(d=e.input.charCodeAt(e.position)))a=93,s=!1,o=[];else{if(123!==d)return!1;a=125,s=!0,o={}}for(null!==e.anchor&&(e.anchorMap[e.anchor]=o),d=e.input.charCodeAt(++e.position);0!==d;){if(ge(e,!0,t),(d=e.input.charCodeAt(e.position))===a)return e.position++,e.tag=g,e.anchor=m,e.kind=s?"mapping":"sequence",e.result=o,!0;h?44===d&&ce(e,"expected the node content, but found ','"):ce(e,"missed comma between flow collection entries"),f=null,l=c=!1,63===d&&z(e.input.charCodeAt(e.position+1))&&(l=c=!0,e.position++,ge(e,!0,t)),n=e.line,i=e.lineStart,r=e.position,we(e,t,1,!1,!0),p=e.tag,u=e.result,ge(e,!0,t),d=e.input.charCodeAt(e.position),!c&&e.line!==n||58!==d||(l=!0,d=e.input.charCodeAt(++e.position),ge(e,!0,t),we(e,t,1,!1,!0),f=e.result),s?de(e,o,y,p,u,f,n,i,r):l?o.push(de(e,null,y,p,u,f,n,i,r)):o.push(u),ge(e,!0,t),44===(d=e.input.charCodeAt(e.position))?(h=!0,d=e.input.charCodeAt(++e.position)):h=!1}ce(e,"unexpected end of the stream within a flow collection")}(e,d)?y=!0:(l&&function(e,t){var i,r,o,a,l,c=1,s=!1,u=!1,p=t,f=0,d=!1;if(124===(a=e.input.charCodeAt(e.position)))r=!1;else{if(62!==a)return!1;r=!0}for(e.kind="scalar",e.result="";0!==a;)if(43===(a=e.input.charCodeAt(++e.position))||45===a)1===c?c=43===a?3:2:ce(e,"repeat of a chomping mode identifier");else{if(!((o=48<=(l=a)&&l<=57?l-48:-1)>=0))break;0===o?ce(e,"bad explicit indentation width of a block scalar; it cannot be less than one"):u?ce(e,"repeat of an indentation width identifier"):(p=t+o-1,u=!0)}if(Q(a)){do{a=e.input.charCodeAt(++e.position)}while(Q(a));if(35===a)do{a=e.input.charCodeAt(++e.position)}while(!J(a)&&0!==a)}for(;0!==a;){for(he(e),e.lineIndent=0,a=e.input.charCodeAt(e.position);(!u||e.lineIndent<p)&&32===a;)e.lineIndent++,a=e.input.charCodeAt(++e.position);if(!u&&e.lineIndent>p&&(p=e.lineIndent),J(a))f++;else{if(e.lineIndent<p){3===c?e.result+=n.repeat("\n",s?1+f:f):1===c&&s&&(e.result+="\n");break}for(r?Q(a)?(d=!0,e.result+=n.repeat("\n",s?1+f:f)):d?(d=!1,e.result+=n.repeat("\n",f+1)):0===f?s&&(e.result+=" "):e.result+=n.repeat("\n",f):e.result+=n.repeat("\n",s?1+f:f),s=!0,u=!0,f=0,i=e.position;!J(a)&&0!==a;)a=e.input.charCodeAt(++e.position);pe(e,i,e.position,!1)}}return!0}(e,d)||function(e,t){var n,i,r;if(39!==(n=e.input.charCodeAt(e.position)))return!1;for(e.kind="scalar",e.result="",e.position++,i=r=e.position;0!==(n=e.input.charCodeAt(e.position));)if(39===n){if(pe(e,i,e.position,!0),39!==(n=e.input.charCodeAt(++e.position)))return!0;i=e.position,e.position++,r=e.position}else J(n)?(pe(e,i,r,!0),ye(e,ge(e,!1,t)),i=r=e.position):e.position===e.lineStart&&me(e)?ce(e,"unexpected end of the document within a single quoted scalar"):(e.position++,r=e.position);ce(e,"unexpected end of the stream within a single quoted scalar")}(e,d)||function(e,t){var n,i,r,o,a,l,c;if(34!==(l=e.input.charCodeAt(e.position)))return!1;for(e.kind="scalar",e.result="",e.position++,n=i=e.position;0!==(l=e.input.charCodeAt(e.position));){if(34===l)return pe(e,n,e.position,!0),e.position++,!0;if(92===l){if(pe(e,n,e.position,!0),J(l=e.input.charCodeAt(++e.position)))ge(e,!1,t);else if(l<256&&ie[l])e.result+=re[l],e.position++;else if((a=120===(c=l)?2:117===c?4:85===c?8:0)>0){for(r=a,o=0;r>0;r--)(a=ee(l=e.input.charCodeAt(++e.position)))>=0?o=(o<<4)+a:ce(e,"expected hexadecimal character");e.result+=ne(o),e.position++}else ce(e,"unknown escape sequence");n=i=e.position}else J(l)?(pe(e,n,i,!0),ye(e,ge(e,!1,t)),n=i=e.position):e.position===e.lineStart&&me(e)?ce(e,"unexpected end of the document within a double quoted scalar"):(e.position++,i=e.position)}ce(e,"unexpected end of the stream within a double quoted scalar")}(e,d)?y=!0:!function(e){var t,n,i;if(42!==(i=e.input.charCodeAt(e.position)))return!1;for(i=e.input.charCodeAt(++e.position),t=e.position;0!==i&&!z(i)&&!X(i);)i=e.input.charCodeAt(++e.position);return e.position===t&&ce(e,"name of an alias node must contain at least one character"),n=e.input.slice(t,e.position),P.call(e.anchorMap,n)||ce(e,'unidentified alias "'+n+'"'),e.result=e.anchorMap[n],ge(e,!0,-1),!0}(e)?function(e,t,n){var i,r,o,a,l,c,s,u,p=e.kind,f=e.result;if(z(u=e.input.charCodeAt(e.position))||X(u)||35===u||38===u||42===u||33===u||124===u||62===u||39===u||34===u||37===u||64===u||96===u)return!1;if((63===u||45===u)&&(z(i=e.input.charCodeAt(e.position+1))||n&&X(i)))return!1;for(e.kind="scalar",e.result="",r=o=e.position,a=!1;0!==u;){if(58===u){if(z(i=e.input.charCodeAt(e.position+1))||n&&X(i))break}else if(35===u){if(z(e.input.charCodeAt(e.position-1)))break}else{if(e.position===e.lineStart&&me(e)||n&&X(u))break;if(J(u)){if(l=e.line,c=e.lineStart,s=e.lineIndent,ge(e,!1,-1),e.lineIndent>=t){a=!0,u=e.input.charCodeAt(e.position);continue}e.position=o,e.line=l,e.lineStart=c,e.lineIndent=s;break}}a&&(pe(e,r,o,!1),ye(e,e.line-l),r=o=e.position,a=!1),Q(u)||(o=e.position+1),u=e.input.charCodeAt(++e.position)}return pe(e,r,o,!1),!!e.result||(e.kind=p,e.result=f,!1)}(e,d,1===i)&&(y=!0,null===e.tag&&(e.tag="?")):(y=!0,null===e.tag&&null===e.anchor||ce(e,"alias node should not have any properties")),null!==e.anchor&&(e.anchorMap[e.anchor]=e.result)):0===g&&(y=c&&be(e,h))),null===e.tag)null!==e.anchor&&(e.anchorMap[e.anchor]=e.result);else if("?"===e.tag){for(null!==e.result&&"scalar"!==e.kind&&ce(e,'unacceptable node kind for !<?> tag; it should be "scalar", not "'+e.kind+'"'),s=0,u=e.implicitTypes.length;s<u;s+=1)if((f=e.implicitTypes[s]).resolve(e.result)){e.result=f.construct(e.result),e.tag=f.tag,null!==e.anchor&&(e.anchorMap[e.anchor]=e.result);break}}else if("!"!==e.tag){if(P.call(e.typeMap[e.kind||"fallback"],e.tag))f=e.typeMap[e.kind||"fallback"][e.tag];else for(f=null,s=0,u=(p=e.typeMap.multi[e.kind||"fallback"]).length;s<u;s+=1)if(e.tag.slice(0,p[s].tag.length)===p[s].tag){f=p[s];break}f||ce(e,"unknown tag !<"+e.tag+">"),null!==e.result&&f.kind!==e.kind&&ce(e,"unacceptable node kind for !<"+e.tag+'> tag; it should be "'+f.kind+'", not "'+e.kind+'"'),f.resolve(e.result,e.tag)?(e.result=f.construct(e.result,e.tag),null!==e.anchor&&(e.anchorMap[e.anchor]=e.result)):ce(e,"cannot resolve a node with !<"+e.tag+"> explicit tag")}return null!==e.listener&&e.listener("close",e),null!==e.tag||null!==e.anchor||y}function ke(e){var t,n,i,r,o=e.position,a=!1;for(e.version=null,e.checkLineBreaks=e.legacy,e.tagMap=Object.create(null),e.anchorMap=Object.create(null);0!==(r=e.input.charCodeAt(e.position))&&(ge(e,!0,-1),r=e.input.charCodeAt(e.position),!(e.lineIndent>0||37!==r));){for(a=!0,r=e.input.charCodeAt(++e.position),t=e.position;0!==r&&!z(r);)r=e.input.charCodeAt(++e.position);for(i=[],(n=e.input.slice(t,e.position)).length<1&&ce(e,"directive name must not be less than one character in length");0!==r;){for(;Q(r);)r=e.input.charCodeAt(++e.position);if(35===r){do{r=e.input.charCodeAt(++e.position)}while(0!==r&&!J(r));break}if(J(r))break;for(t=e.position;0!==r&&!z(r);)r=e.input.charCodeAt(++e.position);i.push(e.input.slice(t,e.position))}0!==r&&he(e),P.call(ue,n)?ue[n](e,n,i):se(e,'unknown document directive "'+n+'"')}ge(e,!0,-1),0===e.lineIndent&&45===e.input.charCodeAt(e.position)&&45===e.input.charCodeAt(e.position+1)&&45===e.input.charCodeAt(e.position+2)?(e.position+=3,ge(e,!0,-1)):a&&ce(e,"directives end mark is expected"),we(e,e.lineIndent-1,4,!1,!0),ge(e,!0,-1),e.checkLineBreaks&&H.test(e.input.slice(o,e.position))&&se(e,"non-ASCII line breaks are interpreted as content"),e.documents.push(e.result),e.position===e.lineStart&&me(e)?46===e.input.charCodeAt(e.position)&&(e.position+=3,ge(e,!0,-1)):e.position<e.length-1&&ce(e,"end of the stream or a document separator is expected")}function Ce(e,t){t=t||{},0!==(e=String(e)).length&&(10!==e.charCodeAt(e.length-1)&&13!==e.charCodeAt(e.length-1)&&(e+="\n"),65279===e.charCodeAt(0)&&(e=e.slice(1)));var n=new ae(e,t),i=e.indexOf("\0");for(-1!==i&&(n.position=i,ce(n,"null byte is not allowed in input")),n.input+="\0";32===n.input.charCodeAt(n.position);)n.lineIndent+=1,n.position+=1;for(;n.position<n.length-1;)ke(n);return n.documents}var xe={loadAll:function(e,t,n){null!==t&&"object"==typeof t&&void 0===n&&(n=t,t=null);var i=Ce(e,n);if("function"!=typeof t)return i;for(var r=0,o=i.length;r<o;r+=1)t(i[r])},load:function(e,t){var n=Ce(e,t);if(0!==n.length){if(1===n.length)return n[0];throw new o("expected a single document in the stream, but found more")}}},Ie=Object.prototype.toString,Se=Object.prototype.hasOwnProperty,Oe=65279,je={0:"\\0",7:"\\a",8:"\\b",9:"\\t",10:"\\n",11:"\\v",12:"\\f",13:"\\r",27:"\\e",34:'\\"',92:"\\\\",133:"\\N",160:"\\_",8232:"\\L",8233:"\\P"},Te=["y","Y","yes","Yes","YES","on","On","ON","n","N","no","No","NO","off","Off","OFF"],Ne=/^[-+]?[0-9_]+(?::[0-9_]+)+(?:\.[0-9_]*)?$/;function Fe(e){var t,i,r;if(t=e.toString(16).toUpperCase(),e<=255)i="x",r=2;else if(e<=65535)i="u",r=4;else{if(!(e<=4294967295))throw new o("code point within a string may not be greater than 0xFFFFFFFF");i="U",r=8}return"\\"+i+n.repeat("0",r-t.length)+t}function Ee(e){this.schema=e.schema||K,this.indent=Math.max(1,e.indent||2),this.noArrayIndent=e.noArrayIndent||!1,this.skipInvalid=e.skipInvalid||!1,this.flowLevel=n.isNothing(e.flowLevel)?-1:e.flowLevel,this.styleMap=function(e,t){var n,i,r,o,a,l,c;if(null===t)return{};for(n={},r=0,o=(i=Object.keys(t)).length;r<o;r+=1)a=i[r],l=String(t[a]),"!!"===a.slice(0,2)&&(a="tag:yaml.org,2002:"+a.slice(2)),(c=e.compiledTypeMap.fallback[a])&&Se.call(c.styleAliases,l)&&(l=c.styleAliases[l]),n[a]=l;return n}(this.schema,e.styles||null),this.sortKeys=e.sortKeys||!1,this.lineWidth=e.lineWidth||80,this.noRefs=e.noRefs||!1,this.noCompatMode=e.noCompatMode||!1,this.condenseFlow=e.condenseFlow||!1,this.quotingType='"'===e.quotingType?2:1,this.forceQuotes=e.forceQuotes||!1,this.replacer="function"==typeof e.replacer?e.replacer:null,this.implicitTypes=this.schema.compiledImplicit,this.explicitTypes=this.schema.compiledExplicit,this.tag=null,this.result="",this.duplicates=[],this.usedDuplicates=null}function Me(e,t){for(var i,r=n.repeat(" ",t),o=0,a=-1,l="",c=e.length;o<c;)-1===(a=e.indexOf("\n",o))?(i=e.slice(o),o=c):(i=e.slice(o,a+1),o=a+1),i.length&&"\n"!==i&&(l+=r),l+=i;return l}function Le(e,t){return"\n"+n.repeat(" ",e.indent*t)}function _e(e){return 32===e||9===e}function De(e){return 32<=e&&e<=126||161<=e&&e<=55295&&8232!==e&&8233!==e||57344<=e&&e<=65533&&e!==Oe||65536<=e&&e<=1114111}function Ue(e){return De(e)&&e!==Oe&&13!==e&&10!==e}function qe(e,t,n){var i=Ue(e),r=i&&!_e(e);return(n?i:i&&44!==e&&91!==e&&93!==e&&123!==e&&125!==e)&&35!==e&&!(58===t&&!r)||Ue(t)&&!_e(t)&&35===e||58===t&&r}function Ye(e,t){var n,i=e.charCodeAt(t);return i>=55296&&i<=56319&&t+1<e.length&&(n=e.charCodeAt(t+1))>=56320&&n<=57343?1024*(i-55296)+n-56320+65536:i}function Re(e){return/^\n* /.test(e)}function Be(e,t,n,i,r,o,a,l){var c,s,u=0,p=null,f=!1,d=!1,h=-1!==i,g=-1,m=De(s=Ye(e,0))&&s!==Oe&&!_e(s)&&45!==s&&63!==s&&58!==s&&44!==s&&91!==s&&93!==s&&123!==s&&125!==s&&35!==s&&38!==s&&42!==s&&33!==s&&124!==s&&61!==s&&62!==s&&39!==s&&34!==s&&37!==s&&64!==s&&96!==s&&function(e){return!_e(e)&&58!==e}(Ye(e,e.length-1));if(t||a)for(c=0;c<e.length;u>=65536?c+=2:c++){if(!De(u=Ye(e,c)))return 5;m=m&&qe(u,p,l),p=u}else{for(c=0;c<e.length;u>=65536?c+=2:c++){if(10===(u=Ye(e,c)))f=!0,h&&(d=d||c-g-1>i&&" "!==e[g+1],g=c);else if(!De(u))return 5;m=m&&qe(u,p,l),p=u}d=d||h&&c-g-1>i&&" "!==e[g+1]}return f||d?n>9&&Re(e)?5:a?2===o?5:2:d?4:3:!m||a||r(e)?2===o?5:2:1}function Ke(e,t,n,i,r){e.dump=function(){if(0===t.length)return 2===e.quotingType?'""':"''";if(!e.noCompatMode&&(-1!==Te.indexOf(t)||Ne.test(t)))return 2===e.quotingType?'"'+t+'"':"'"+t+"'";var a=e.indent*Math.max(1,n),l=-1===e.lineWidth?-1:Math.max(Math.min(e.lineWidth,40),e.lineWidth-a),c=i||e.flowLevel>-1&&n>=e.flowLevel;switch(Be(t,c,e.indent,l,(function(t){return function(e,t){var n,i;for(n=0,i=e.implicitTypes.length;n<i;n+=1)if(e.implicitTypes[n].resolve(t))return!0;return!1}(e,t)}),e.quotingType,e.forceQuotes&&!i,r)){case 1:return t;case 2:return"'"+t.replace(/'/g,"''")+"'";case 3:return"|"+Pe(t,e.indent)+We(Me(t,a));case 4:return">"+Pe(t,e.indent)+We(Me(function(e,t){var n,i,r=/(\n+)([^\n]*)/g,o=(l=e.indexOf("\n"),l=-1!==l?l:e.length,r.lastIndex=l,He(e.slice(0,l),t)),a="\n"===e[0]||" "===e[0];var l;for(;i=r.exec(e);){var c=i[1],s=i[2];n=" "===s[0],o+=c+(a||n||""===s?"":"\n")+He(s,t),a=n}return o}(t,l),a));case 5:return'"'+function(e){for(var t,n="",i=0,r=0;r<e.length;i>=65536?r+=2:r++)i=Ye(e,r),!(t=je[i])&&De(i)?(n+=e[r],i>=65536&&(n+=e[r+1])):n+=t||Fe(i);return n}(t)+'"';default:throw new o("impossible error: invalid scalar style")}}()}function Pe(e,t){var n=Re(e)?String(t):"",i="\n"===e[e.length-1];return n+(i&&("\n"===e[e.length-2]||"\n"===e)?"+":i?"":"-")+"\n"}function We(e){return"\n"===e[e.length-1]?e.slice(0,-1):e}function He(e,t){if(""===e||" "===e[0])return e;for(var n,i,r=/ [^ ]/g,o=0,a=0,l=0,c="";n=r.exec(e);)(l=n.index)-o>t&&(i=a>o?a:l,c+="\n"+e.slice(o,i),o=i+1),a=l;return c+="\n",e.length-o>t&&a>o?c+=e.slice(o,a)+"\n"+e.slice(a+1):c+=e.slice(o),c.slice(1)}function $e(e,t,n,i){var r,o,a,l="",c=e.tag;for(r=0,o=n.length;r<o;r+=1)a=n[r],e.replacer&&(a=e.replacer.call(n,String(r),a)),(Ve(e,t+1,a,!0,!0,!1,!0)||void 0===a&&Ve(e,t+1,null,!0,!0,!1,!0))&&(i&&""===l||(l+=Le(e,t)),e.dump&&10===e.dump.charCodeAt(0)?l+="-":l+="- ",l+=e.dump);e.tag=c,e.dump=l||"[]"}function Ge(e,t,n){var i,r,a,l,c,s;for(a=0,l=(r=n?e.explicitTypes:e.implicitTypes).length;a<l;a+=1)if(((c=r[a]).instanceOf||c.predicate)&&(!c.instanceOf||"object"==typeof t&&t instanceof c.instanceOf)&&(!c.predicate||c.predicate(t))){if(n?c.multi&&c.representName?e.tag=c.representName(t):e.tag=c.tag:e.tag="?",c.represent){if(s=e.styleMap[c.tag]||c.defaultStyle,"[object Function]"===Ie.call(c.represent))i=c.represent(t,s);else{if(!Se.call(c.represent,s))throw new o("!<"+c.tag+'> tag resolver accepts not "'+s+'" style');i=c.represent[s](t,s)}e.dump=i}return!0}return!1}function Ve(e,t,n,i,r,a,l){e.tag=null,e.dump=n,Ge(e,n,!1)||Ge(e,n,!0);var c,s=Ie.call(e.dump),u=i;i&&(i=e.flowLevel<0||e.flowLevel>t);var p,f,d="[object Object]"===s||"[object Array]"===s;if(d&&(f=-1!==(p=e.duplicates.indexOf(n))),(null!==e.tag&&"?"!==e.tag||f||2!==e.indent&&t>0)&&(r=!1),f&&e.usedDuplicates[p])e.dump="*ref_"+p;else{if(d&&f&&!e.usedDuplicates[p]&&(e.usedDuplicates[p]=!0),"[object Object]"===s)i&&0!==Object.keys(e.dump).length?(!function(e,t,n,i){var r,a,l,c,s,u,p="",f=e.tag,d=Object.keys(n);if(!0===e.sortKeys)d.sort();else if("function"==typeof e.sortKeys)d.sort(e.sortKeys);else if(e.sortKeys)throw new o("sortKeys must be a boolean or a function");for(r=0,a=d.length;r<a;r+=1)u="",i&&""===p||(u+=Le(e,t)),c=n[l=d[r]],e.replacer&&(c=e.replacer.call(n,l,c)),Ve(e,t+1,l,!0,!0,!0)&&((s=null!==e.tag&&"?"!==e.tag||e.dump&&e.dump.length>1024)&&(e.dump&&10===e.dump.charCodeAt(0)?u+="?":u+="? "),u+=e.dump,s&&(u+=Le(e,t)),Ve(e,t+1,c,!0,s)&&(e.dump&&10===e.dump.charCodeAt(0)?u+=":":u+=": ",p+=u+=e.dump));e.tag=f,e.dump=p||"{}"}(e,t,e.dump,r),f&&(e.dump="&ref_"+p+e.dump)):(!function(e,t,n){var i,r,o,a,l,c="",s=e.tag,u=Object.keys(n);for(i=0,r=u.length;i<r;i+=1)l="",""!==c&&(l+=", "),e.condenseFlow&&(l+='"'),a=n[o=u[i]],e.replacer&&(a=e.replacer.call(n,o,a)),Ve(e,t,o,!1,!1)&&(e.dump.length>1024&&(l+="? "),l+=e.dump+(e.condenseFlow?'"':"")+":"+(e.condenseFlow?"":" "),Ve(e,t,a,!1,!1)&&(c+=l+=e.dump));e.tag=s,e.dump="{"+c+"}"}(e,t,e.dump),f&&(e.dump="&ref_"+p+" "+e.dump));else if("[object Array]"===s)i&&0!==e.dump.length?(e.noArrayIndent&&!l&&t>0?$e(e,t-1,e.dump,r):$e(e,t,e.dump,r),f&&(e.dump="&ref_"+p+e.dump)):(!function(e,t,n){var i,r,o,a="",l=e.tag;for(i=0,r=n.length;i<r;i+=1)o=n[i],e.replacer&&(o=e.replacer.call(n,String(i),o)),(Ve(e,t,o,!1,!1)||void 0===o&&Ve(e,t,null,!1,!1))&&(""!==a&&(a+=","+(e.condenseFlow?"":" ")),a+=e.dump);e.tag=l,e.dump="["+a+"]"}(e,t,e.dump),f&&(e.dump="&ref_"+p+" "+e.dump));else{if("[object String]"!==s){if("[object Undefined]"===s)return!1;if(e.skipInvalid)return!1;throw new o("unacceptable kind of an object to dump "+s)}"?"!==e.tag&&Ke(e,e.dump,t,a,u)}null!==e.tag&&"?"!==e.tag&&(c=encodeURI("!"===e.tag[0]?e.tag.slice(1):e.tag).replace(/!/g,"%21"),c="!"===e.tag[0]?"!"+c:"tag:yaml.org,2002:"===c.slice(0,18)?"!!"+c.slice(18):"!<"+c+">",e.dump=c+" "+e.dump)}return!0}function Ze(e,t){var n,i,r=[],o=[];for(Je(e,r,o),n=0,i=o.length;n<i;n+=1)t.duplicates.push(r[o[n]]);t.usedDuplicates=new Array(i)}function Je(e,t,n){var i,r,o;if(null!==e&&"object"==typeof e)if(-1!==(r=t.indexOf(e)))-1===n.indexOf(r)&&n.push(r);else if(t.push(e),Array.isArray(e))for(r=0,o=e.length;r<o;r+=1)Je(e[r],t,n);else for(r=0,o=(i=Object.keys(e)).length;r<o;r+=1)Je(e[i[r]],t,n)}function Qe(e,t){return function(){throw new Error("Function yaml."+e+" is removed in js-yaml 4. Use yaml."+t+" instead, which is now safe by default.")}}var ze=p,Xe=h,et=b,tt=O,nt=j,it=K,rt=xe.load,ot=xe.loadAll,at={dump:function(e,t){var n=new Ee(t=t||{});n.noRefs||Ze(e,n);var i=e;return n.replacer&&(i=n.replacer.call({"":i},"",i)),Ve(n,0,i,!0,!0)?n.dump+"\n":""}}.dump,lt=o,ct={binary:L,float:S,map:y,null:A,pairs:Y,set:B,timestamp:F,bool:v,int:C,merge:E,omap:U,seq:m,str:g},st=Qe("safeLoad","load"),ut=Qe("safeLoadAll","loadAll"),pt=Qe("safeDump","dump"),ft={Type:ze,Schema:Xe,FAILSAFE_SCHEMA:et,JSON_SCHEMA:tt,CORE_SCHEMA:nt,DEFAULT_SCHEMA:it,load:rt,loadAll:ot,dump:at,YAMLException:lt,types:ct,safeLoad:st,safeLoadAll:ut,safeDump:pt};e.CORE_SCHEMA=nt,e.DEFAULT_SCHEMA=it,e.FAILSAFE_SCHEMA=et,e.JSON_SCHEMA=tt,e.Schema=Xe,e.Type=ze,e.YAMLException=lt,e.default=ft,e.dump=at,e.load=rt,e.loadAll=ot,e.safeDump=pt,e.safeLoad=st,e.safeLoadAll=ut,e.types=ct,Object.defineProperty(e,"__esModule",{value:!0})}));

</script>
  <script>
    // --- Storage Helper (Defined early for Init) ---

    // ============================================================================
    // 存储层 - IndexedDB + localStorage 双存储
    // ============================================================================

    const safeStorage = {
        _dbName: 'EasyToolsDB',
        _dbVersion: 1,
        _db: null,
        _ready: false,
        _initPromise: null,

        // 初始化IndexedDB
        _init: function() {
            if (this._initPromise) return this._initPromise;

            this._initPromise = new Promise((resolve, reject) => {
                if (!window.indexedDB) {
                    
                    this._ready = true;
                    resolve(null);
                    return;
                }

                const request = indexedDB.open(this._dbName, this._dbVersion);

                request.onerror = () => {
                    
                    this._ready = true;
                    resolve(null);
                };

                request.onsuccess = (event) => {
                    this._db = event.target.result;
                    this._ready = true;
                    resolve(this._db);
                };

                request.onupgradeneeded = (event) => {
                    const db = event.target.result;

                    // 创建历史记录存储
                    if (!db.objectStoreNames.contains('history')) {
                        const historyStore = db.createObjectStore('history', { keyPath: 'id', autoIncrement: true });
                        historyStore.createIndex('type', 'type', { unique: false });
                        historyStore.createIndex('ts', 'ts', { unique: false });
                    }

                    // 创建设置存储
                    if (!db.objectStoreNames.contains('settings')) {
                        db.createObjectStore('settings', { keyPath: 'key' });
                    }

                    // 创建临时数据存储（用于大文本）
                    if (!db.objectStoreNames.contains('tempData')) {
                        db.createObjectStore('tempData', { keyPath: 'key' });
                    }
                };
            });

            return this._initPromise;
        },

        // 等待初始化完成
        _waitForReady: async function() {
            if (this._ready) return this._db;
            await this._init();
            return this._db;
        },

        // 通用数据库操作方法
        _operate: async function(storeName, mode, operation) {
            try {
                await this._waitForReady();
                if (!this._db) {
                    // IndexedDB不可用，回退到localStorage
                    return await this._fallback(storeName, mode, operation);
                }

                const transaction = this._db.transaction([storeName], mode);
                const store = transaction.objectStore(storeName);
                return await operation(store);
            } catch (error) {
                
                // 回退到localStorage
                return await this._fallback(storeName, mode, operation);
            }
        },

        // 回退到localStorage
        _fallback: async function(storeName, mode, operation) {
            if (storeName === 'settings') {
                if (mode === 'readonly') {
                    const mockStore = {
                        get: (key) => window.localStorage.getItem(key) || null
                    };
                    return operation(mockStore);
                } else if (mode === 'readwrite') {
                    const mockStore = {
                        put: (value) => {
                            try {
                                window.localStorage.setItem(value.key, value.value);
                            } catch (e) {}
                            return { result: value.key };
                        },
                        delete: (key) => {
                            try {
                                window.localStorage.removeItem(key);
                            } catch (e) {}
                            return { result: key };
                        }
                    };
                    return operation(mockStore);
                }
            } else if (storeName === 'history') {
                // 历史记录只使用localStorage
                if (mode === 'readonly') {
                    const mockStore = {
                        getAll: () => {
                            try {
                                const v = window.localStorage.getItem('history');
                                return v ? JSON.parse(v) : [];
                            } catch (e) {
                                
                                return [];
                            }
                        }
                    };
                    return operation(mockStore);
                } else if (mode === 'readwrite') {
                    const mockStore = {
                        add: (item) => {
                            try {
                                const v = window.localStorage.getItem('history');
                                const arr = v ? JSON.parse(v) : [];
                                arr.unshift(item); // 新记录在前
                                // 保持倒序排序
                                arr.sort((a, b) => (b.ts || 0) - (a.ts || 0));
                                // 保持最大数量限制（移除末尾旧记录）
                                // 注意：此值应与 HISTORY_MAX (1000) 保持一致
                                const max = 1000;
                                if (arr.length > max) {
                                    arr.length = max;
                                }
                                window.localStorage.setItem('history', JSON.stringify(arr));
                            } catch (e) {
                                
                            }
                            return { result: item };
                        },
                        clear: () => {
                            try {
                                window.localStorage.removeItem('history');
                            } catch (e) {
                                
                            }
                            return { result: true };
                        }
                    };
                    return operation(mockStore);
                }
            }
            return null;
        },

        // 设置相关方法
        async getSetting(key) {
            try {
                const result = await this._operate('settings', 'readonly', (store) => {
                    return new Promise((resolve, reject) => {
                        const request = store.get(key);
                        request.onsuccess = () => resolve(request.result ? request.result.value : null);
                        request.onerror = () => reject(request.error);
                    });
                });
                return result;
            } catch (e) {
                // 回退到localStorage
                return window.localStorage.getItem(key);
            }
        },

        async setSetting(key, value) {
            const data = { key, value };
            try {
                return await this._operate('settings', 'readwrite', (store) => {
                    return new Promise((resolve, reject) => {
                        const request = store.put(data);
                        request.onsuccess = () => resolve(true);
                        request.onerror = () => reject(request.error);
                    });
                });
            } catch (e) {
                // 回退到localStorage
                try {
                    window.localStorage.setItem(key, value);
                    return true;
                } catch (e) {
                    
                    return false;
                }
            }
        },

        async removeSetting(key) {
            try {
                return await this._operate('settings', 'readwrite', (store) => {
                    return new Promise((resolve, reject) => {
                        const request = store.delete(key);
                        request.onsuccess = () => resolve(true);
                        request.onerror = () => reject(request.error);
                    });
                });
            } catch (e) {
                window.localStorage.removeItem(key);
                return true;
            }
        },

        // 历史记录相关方法
        async addHistory(item) {
            try {
                return await this._operate('history', 'readwrite', (store) => {
                    return new Promise((resolve, reject) => {
                        const request = store.add(item);
                        request.onsuccess = () => resolve(request.result);
                        request.onerror = () => reject(request.error);
                    });
                });
            } catch (error) {
                
                return false;
            }
        },

        async getAllHistory() {
            try {
                const result = await this._operate('history', 'readonly', (store) => {
                    return new Promise((resolve, reject) => {
                        const request = store.getAll();
                        request.onsuccess = () => resolve(request.result || []);
                        request.onerror = () => reject(request.error);
                    });
                });
                return result || [];
            } catch (error) {
                
                // 回退到localStorage
                try {
                    const v = window.localStorage.getItem('history');
                    return v ? JSON.parse(v) : [];
                } catch (parseError) {
                    
                    return [];
                }
            }
        },

        async clearHistory() {
            let idbSuccess = false;
            let localStorageSuccess = false;

            try {
                idbSuccess = await this._operate('history', 'readwrite', (store) => {
                    return new Promise((resolve, reject) => {
                        const request = store.clear();
                        request.onsuccess = () => resolve(true);
                        request.onerror = () => reject(request.error);
                    });
                });
            } catch (error) {
                
                // 如果 IndexedDB 清空失败，检查是否真的有数据（可能是已经空的）
                try {
                    const remaining = await this.getAllHistory();
                    if (remaining.length === 0) {
                        idbSuccess = true; // IndexedDB 实际上是空的
                    }
                } catch (e) {
                    // 无法检查，保持失败状态
                }
            }

            // 无论 IndexedDB 是否成功，都尝试删除 localStorage
            try {
                window.localStorage.removeItem('history');
                localStorageSuccess = true;
            } catch (e) {
                
            }

            // 只有两者都成功，或者 localStorage 成功且 IndexedDB 确实为空，才返回成功
            return idbSuccess && localStorageSuccess;
        },

        // 临时数据存储（用于大文本）
        async setTemp(key, value) {
            try {
                return await this._operate('tempData', 'readwrite', (store) => {
                    return new Promise((resolve, reject) => {
                        const request = store.put({ key, value, timestamp: Date.now() });
                        request.onsuccess = () => resolve(true);
                        request.onerror = () => reject(request.error);
                    });
                });
            } catch (e) {
                // 回退到localStorage
                try {
                    window.localStorage.setItem(`temp_${key}`, value);
                    return true;
                } catch (e2) {
                    return false;
                }
            }
        },

        async getTemp(key) {
            try {
                return await this._operate('tempData', 'readonly', (store) => {
                    return new Promise((resolve, reject) => {
                        const request = store.get(key);
                        request.onsuccess = () => resolve(request.result ? request.result.value : null);
                        request.onerror = () => reject(request.error);
                    });
                });
            } catch (e) {
                return window.localStorage.getItem(`temp_${key}`);
            }
        },

        // 兼容旧的safeStorage接口 - 使用IndexedDB作为主存储
        get(key) {
            try {
                return window.localStorage.getItem(key);
            } catch (e) {
                return null;
            }
        },

        set(key, value) {
            // 1. 同步保存到localStorage（快速）
            try {
                window.localStorage.setItem(key, value);
            } catch (e) {}

            // 2. 异步保存到IndexedDB（持久化），等待初始化完成
            if (this._ready && this._db) {
                this.setSetting(key, value).catch(() => {});
            } else {
                this._init().then(() => {
                    if (this._db) {
                        this.setSetting(key, value).catch(() => {});
                    }
                }).catch(() => {});
            }
        },

        remove(key) {
            try {
                window.localStorage.removeItem(key);
                if (this._ready && this._db) {
                    this.removeSetting(key).catch(() => {});
                }
            } catch (e) {}
        }
    };

    // IndexedDB 测试和验证函数 - 可在控制台调用
    window.testIndexedDB = async function() {
        // 检查IndexedDB支持
        if (!window.indexedDB) {
            
            return false;
        }

        // 等待初始化完成
        await safeStorage._waitForReady();
        if (!safeStorage._db) {
            
            return false;
        }

        // 测试设置存储
        try {
            safeStorage.set('test-setting', 'test-value');
            // 等待异步完成
            await new Promise(resolve => setTimeout(resolve, 100));
            const testValue = await safeStorage.getSetting('test-setting');
            if (testValue === 'test-value') {
            } else {
                
                return false;
            }
        } catch (e) {
            
            return false;
        }

        // 测试历史记录存储
        try {
            const testHistory = { type: 'test', full: 'test content', ts: Date.now() };
            await safeStorage.addHistory(testHistory);
            const allHistory = await safeStorage.getAllHistory();
            const found = allHistory.some(h => h.type === 'test' && h.full === 'test content');
            if (found) {
            } else {
                
                return false;
            }
        } catch (e) {
            
            return false;
        }

        // 测试临时数据存储
        try {
            await safeStorage.setTemp('test-temp', 'large data test');
            const tempValue = await safeStorage.getTemp('test-temp');
            if (tempValue === 'large data test') {
            } else {
                
                return false;
            }
        } catch (e) {
            
            return false;
        }

        return true;
    };

    // 显示IndexedDB状态信息
    window.idbStatus = function() {
        return {
            supported: !!window.indexedDB,
            initialized: safeStorage._ready,
            database: safeStorage._db ? '可用' : '不可用',
            usingIndexedDB: safeStorage._db !== null,
            // 保留策略配置
            retention: {
                maxItems: HISTORY_MAX,
                retentionDays: HISTORY_RETENTION_DAYS,
                maxSizeMB: 50 // IndexedDB通常支持50MB+
            },
            // 检查实际存储情况
            checkStorage: async () => {
                if (!safeStorage._db) return '无IndexedDB';
                const history = await safeStorage.getAllHistory();
                const now = Date.now();
                const sevenDaysAgo = now - (HISTORY_RETENTION_DAYS * 24 * 60 * 60 * 1000);
                const recentCount = history.filter(h => h.ts >= sevenDaysAgo).length;
                return `IndexedDB: ${history.length} 条总记录，${recentCount} 条最近7天，限制: ${HISTORY_MAX}条`;
            },
            // 测试localStorage容量
            testLocalStorageLimit: async () => {
                try {
                    // 尝试写入大量数据直到超出限制
                    const testData = 'x'.repeat(5000000); // 5MB
                    let count = 0;
                    while (count < 20) {
                        window.localStorage.setItem(`test${count}`, testData);
                        count++;
                        await new Promise(resolve => setTimeout(resolve, 10));
                    }
                    return `localStorage测试通过，写入了 ${count} 次`;
                } catch (e) {
                    return `localStorage超出限制: ${e.message}，IndexedDB将接管存储`;
                }
            }
        };
    };

    // 预渲染初始化，避免首屏闪烁（FOUC）
    (function() {
      try {
        const allowedThemes = new Set(['dark', 'light', 'dracula', 'forest', 'warm', 'neon', 'cosmic', 'monokai', 'nord', 'synthwave', 'matrix']);
        const rawTheme = safeStorage.get('theme') || 'dark';
        const theme = allowedThemes.has(rawTheme) ? rawTheme : 'dark';
        document.documentElement.setAttribute('data-et-theme', theme);
        
        const layout = safeStorage.get('layoutMode') || 'top';
        if (layout === 'left') document.documentElement.setAttribute('data-layout', 'left');

        const font = safeStorage.get('font') || 'JetBrains Mono';
        const fontSize = safeStorage.get('fontSize') || '16px';
        const fontStack = `"${font}", "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace`;
        
        document.documentElement.style.setProperty('--code-font', fontStack);
        document.documentElement.style.fontSize = fontSize;
      } catch(e) {  }
    })();
  </script>
</head>
<body id="app-body">
  <div id="et-app">

  <header>
    <div class="app-toolbar">
      <button class="scroll-btn hidden" id="scroll-left" onclick="scrollTabs(-1)" title="向左滚动">
        <svg viewBox="0 0 24 24"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>
      </button>
      <div class="tab-list" role="tablist" id="main-tab-list">
        <button class="tab-trigger is-active" data-tab="json" draggable="true">JSON</button>
        <button class="tab-trigger" data-tab="xml" draggable="true">XML</button>
        <button class="tab-trigger" data-tab="sql" draggable="true">SQL</button>
        <button class="tab-trigger" data-tab="html" draggable="true">HTML</button>
        <button class="tab-trigger" data-tab="timestamp" draggable="true">时间戳</button>
        <button class="tab-trigger" data-tab="base64" draggable="true">图片Base64</button>
        <button class="tab-trigger" data-tab="diff" draggable="true">文本对比</button>
        <button class="tab-trigger" data-tab="javascript" draggable="true">JS</button>
        <button class="tab-trigger" data-tab="css" draggable="true">CSS</button>
        <button class="tab-trigger" data-tab="yaml" draggable="true">YAML</button>
        <button class="tab-trigger" data-tab="network" draggable="true">网络测试</button>
        <button class="tab-trigger" data-tab="regex" draggable="true">正则测试</button>
        <button class="tab-trigger" data-tab="url" draggable="true">URL编解码</button>
        <button class="tab-trigger" data-tab="jwt" draggable="true">JWT解码</button>
        <button class="tab-trigger" data-tab="cron" draggable="true">Cron</button>
        <button class="tab-trigger" data-tab="crypto" draggable="true">加密/哈希</button>
        <button class="tab-trigger" data-tab="mock" draggable="true">人员生成</button>
        <button class="tab-trigger" data-tab="other" draggable="true">其它</button>
      </div>
      <button class="scroll-btn hidden" id="scroll-right" onclick="scrollTabs(1)" title="向右滚动">
        <svg viewBox="0 0 24 24"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/></svg>
      </button>
      <div class="header-actions">
        <button class="icon-btn" id="btn-layout" title="切换布局 (顶部/左侧)">◫</button>
        <button class="icon-btn" id="btn-toggle-nav" title="折叠菜单" aria-expanded="true">▼</button>
        <button class="icon-btn" id="btn-history" title="历史记录">🕒</button>
        <button class="icon-btn" id="btn-settings" title="设置">⚙️</button>
        <button class="icon-btn" id="btn-theme" title="切换主题">🌗</button>
      </div>
    </div>
  </header>
  <script>
    function scrollTabs(dir) {
        const list = document.getElementById('main-tab-list');
        if(list) {
            const amount = Math.max(100, list.clientWidth * 0.6);
            list.scrollBy({ left: dir * amount, behavior: 'smooth' });
        }
    }
    function checkTabScroll() {
        const list = document.getElementById('main-tab-list');
        const lBtn = document.getElementById('scroll-left');
        const rBtn = document.getElementById('scroll-right');
        if(!list || !lBtn || !rBtn) return;
        
        // Use 1px buffer to handle potential float rounding errors
        const maxScroll = list.scrollWidth - list.clientWidth;
        const canScroll = maxScroll > 1;
        
        lBtn.classList.toggle('hidden', !canScroll || list.scrollLeft <= 1);
        rBtn.classList.toggle('hidden', !canScroll || list.scrollLeft >= maxScroll - 1);
    }
    
    (function() {
        const list = document.getElementById('main-tab-list');
        if(list) {
            list.addEventListener('scroll', checkTabScroll);
            window.addEventListener('resize', checkTabScroll);
            // Use ResizeObserver for more robust detection (e.g. sidebar toggle)
            if (window.ResizeObserver) {
                new ResizeObserver(checkTabScroll).observe(list);
            }
            checkTabScroll();
            setTimeout(checkTabScroll, 200);
            
            const obs = new MutationObserver(checkTabScroll);
            obs.observe(document.documentElement, { attributes: true, attributeFilter: ['data-layout'] });
        }
    })();
  </script>

  <main>
    <!-- JSON Panel -->
    <section id="panel-json" class="tab-panel is-active">
      <div class="panel-grid">
        <div class="panel">
          <div class="toolbar">
            <h2>JSON 输入</h2>
            <div class="hint-row">
              <button class="btn-purple" data-action="json-sample">示例</button>
              <button class="btn-teal" data-action="paste-json">粘贴</button>
              <button class="btn-blue" data-action="copy-json-input">复制</button>
              <button class="danger" data-action="clear-json">清空</button>
            </div>
          </div>
          <textarea id="json-input" placeholder="输入 JSON 或拖入文件..."></textarea>
          <div class="actions">
            <button data-action="json-format">格式化</button>
            <button class="warning" data-action="json-minify">去空格</button>
            <button class="btn-purple" data-action="json-minify-escape">去空+转义</button>
            <button class="btn-teal" data-action="json-unescape">去转义</button>
            <button class="success" data-action="json-to-xml">转 XML</button>
          </div>
        </div>
        <div class="panel">
          <div class="toolbar">
            <h2>JSON 结果</h2>
            <div class="hint-row">
              <div class="search-box-mini" style="display:flex; align-items:center; gap:4px; margin-right:8px; display:none;" id="json-search-bar">
                  <button class="btn-mini" id="json-search-case" title="区分大小写 (Alt+C)" style="font-weight:bold; font-family:serif;">Aa</button>
                  <input type="text" id="json-search-input" placeholder="搜索..." class="std-input" style="height:26px; padding:0 6px; width:120px; font-size:0.8rem;">
                  <button class="btn-mini" id="json-search-prev" title="上一个 (Shift+Enter)">▲</button>
                  <button class="btn-mini" id="json-search-next" title="下一个 (Enter)">▼</button>
                  <span id="json-search-count" style="font-size:0.75rem; color:var(--muted); min-width:40px; text-align:center;"></span>
                  <button class="btn-mini danger" id="json-search-close" title="关闭">×</button>
              </div>
              <button class="btn-mini" id="json-search-toggle" title="搜索 (Ctrl+F)">🔍</button>
              <button class="danger" id="btn-json-clear-output">清空</button>
              <button data-action="json-expand">展开</button>
              <button class="secondary" data-action="json-collapse">折叠</button>
              <button class="success" data-action="copy-json">复制</button>
            </div>
          </div>
          <div id="json-output" class="code-viewer" tabindex="0"></div>
        </div>
      </div>
    </section>

    <!-- XML Panel -->
    <section id="panel-xml" class="tab-panel">
      <div class="panel-grid">
        <div class="panel">
          <div class="toolbar">
            <h2>XML 输入</h2>
            <div class="hint-row">
              <button class="btn-purple" data-action="xml-sample">示例</button>
              <button class="btn-teal" data-action="paste-xml">粘贴</button>
              <button class="btn-orange" data-action="copy-xml-input">复制</button>
              <button class="danger" data-action="clear-xml">清空</button>
            </div>
          </div>
          <textarea id="xml-input" placeholder="输入 XML..."></textarea>
          <div class="actions">
            <button data-action="xml-format">格式化</button>
            <button class="warning" data-action="xml-minify">压缩</button>
            <button class="success" data-action="xml-to-json">转 JSON</button>
          </div>
        </div>
        <div class="panel">
          <div class="toolbar">
            <h2>XML 结果</h2>
            <div class="hint-row">
              <div class="search-box-mini" style="display:flex; align-items:center; gap:4px; margin-right:8px; display:none;" id="xml-search-bar">
                  <button class="btn-mini" id="xml-search-case" title="区分大小写 (Alt+C)" style="font-weight:bold; font-family:serif;">Aa</button>
                  <input type="text" id="xml-search-input" placeholder="搜索..." class="std-input" style="height:26px; padding:0 6px; width:120px; font-size:0.8rem;">
                  <button class="btn-mini" id="xml-search-prev" title="上一个 (Shift+Enter)">▲</button>
                  <button class="btn-mini" id="xml-search-next" title="下一个 (Enter)">▼</button>
                  <span id="xml-search-count" style="font-size:0.75rem; color:var(--muted); min-width:40px; text-align:center;"></span>
                  <button class="btn-mini danger" id="xml-search-close" title="关闭">×</button>
              </div>
              <button class="btn-mini" id="xml-search-toggle" title="搜索 (Ctrl+F)">🔍</button>
              <button class="danger" id="btn-xml-clear-output" data-action="clear-xml-output">清空</button>
              <button data-action="xml-expand">展开</button>
              <button class="secondary" data-action="xml-collapse">折叠</button>
              <button class="success" data-action="copy-xml">复制</button>
            </div>
          </div>
          <div id="xml-output" class="code-viewer" tabindex="0"></div>
        </div>
      </div>
    </section>

    <!-- SQL Panel -->
    <section id="panel-sql" class="tab-panel">
      <div class="panel-grid">
        <div class="panel">
          <div class="toolbar">
            <h2>SQL 输入</h2>
            <div class="hint-row">
              <select id="sql-examples" class="std-input" style="width:auto;">
                  <option value="">-- 常用示例 (CRUD) --</option>
                  <optgroup label="1. CREATE (建表)">
                      <option value="create_user">系统用户表 (User)</option>
                      <option value="create_order">电商订单表 (Order)</option>
                      <option value="create_article">CMS文章表 (Article)</option>
                  </optgroup>
                  <optgroup label="2. INSERT (增)">
                      <option value="insert_batch">批量插入 (Batch)</option>
                      <option value="insert_select">归档/复制 (Insert Select)</option>
                      <option value="insert_upsert">存在更新 (Upsert)</option>
                  </optgroup>
                  <optgroup label="3. DELETE (删)">
                      <option value="delete_join">去重删除 (Join Delete)</option>
                      <option value="delete_limit">分批清理 (Limit)</option>
                      <option value="delete_sub">级联清理 (Subquery)</option>
                  </optgroup>
                  <optgroup label="4. UPDATE (改)">
                      <option value="update_case">逻辑更新 (Case When)</option>
                      <option value="update_join">级联更新 (Join Update)</option>
                      <option value="update_calc">计算更新 (Calculation)</option>
                  </optgroup>
                  <optgroup label="5. SELECT (查)">
                      <option value="select_report">统计报表 (Report)</option>
                      <option value="select_window">排名分析 (Window Func)</option>
                      <option value="select_join">复杂关联 (Multi-Join)</option>
                  </optgroup>
              </select>
              <button class="btn-teal" data-action="paste-sql">粘贴</button>
              <button class="btn-lime" data-action="copy-sql-input">复制</button>
              <button class="danger" data-action="clear-sql">清空</button>
            </div>
          </div>
          <textarea id="sql-input" placeholder="输入 SQL..."></textarea>
          <div class="actions">
            <button class="btn-indigo" data-action="sql-format">格式化</button>
            <button class="btn-pink" data-action="sql-minify">压缩</button>
            <button class="btn-lime" data-action="sql-upper">大写</button>
            <button class="btn-blue-grey" data-action="sql-lower">小写</button>
            <button class="btn-purple" data-action="sql-to-java">转 Java</button>
            <button class="btn-teal" data-action="sql-to-csharp">转 C#</button>
            <button class="btn-blue" data-action="sql-to-go">转 Go</button>
            <button class="btn-orange" data-action="sql-to-python">转 Python</button>
          </div>
        </div>
        <div class="panel">
          <div class="toolbar">
            <h2>SQL 结果</h2>
            <div class="hint-row">
              <button class="danger" data-action="clear-sql-output">清空</button>
              <button class="success" data-action="copy-sql">复制</button>
            </div>
          </div>
          <div id="sql-output" class="code-viewer" tabindex="0"></div>
        </div>
      </div>
    </section>

    <!-- YAML Panel -->
    <section id="panel-yaml" class="tab-panel">
      <div class="panel-grid">
        <div class="panel">
          <div class="toolbar">
            <h2>YAML 输入</h2>
            <div class="hint-row">
              <button class="btn-purple" data-action="yaml-sample">示例</button>
              <button class="btn-teal" data-action="paste-yaml">粘贴</button>
              <button class="danger" data-action="clear-yaml">清空</button>
            </div>
          </div>
          <textarea id="yaml-input" placeholder="输入 YAML..."></textarea>
          <div class="actions">
            <button data-action="yaml-format">格式化</button>
            <button class="warning" data-action="yaml-minify">压缩 (JSON)</button>
            <button class="btn-purple" data-action="yaml-to-json">转 JSON</button>
          </div>
        </div>
        <div class="panel">
          <div class="toolbar">
            <h2>转换结果</h2>
            <div class="hint-row">
              <button class="danger" id="btn-yaml-clear-output">清空</button>
              <button class="success" data-action="copy-yaml">复制</button>
            </div>
          </div>
          <div id="yaml-output" class="code-viewer" tabindex="0"></div>
        </div>
      </div>
    </section>

    <!-- HTML Panel (Format + Convert) -->
    <section id="panel-html" class="tab-panel">
      <div class="panel-grid">
        <div class="panel">
          <div class="toolbar">
            <h2>HTML 输入</h2>
            <div class="hint-row">
              <button class="btn-purple" data-action="html-sample">示例</button>
              <button class="btn-teal" data-action="paste-html-fmt">粘贴</button>
              <button class="danger" data-action="clear-html-fmt">清空</button>
            </div>
          </div>
          <textarea id="html-fmt-input" placeholder="输入 HTML..."></textarea>
          <div class="actions">
            <button data-action="html-format">格式化</button>
            <button class="warning" data-action="html-minify">压缩</button>
            <button class="btn-purple" id="btn-quote-single" style="opacity: 1; background: #10b981; border-color: #059669;">单引号转JS</button>
            <button class="btn-purple" id="btn-quote-double" style="opacity: 0.7; background: #f59e0b; border-color: #d97706;">双引号转JS</button>
          </div>
        </div>
        <div class="panel">
          <div class="toolbar">
            <h2>结果</h2>
            <div class="hint-row">
              <button class="danger" id="btn-html-clear-output">清空</button>
              <button class="success" data-action="copy-html-fmt">复制</button>
            </div>
          </div>
          <div id="html-fmt-output" class="code-viewer" tabindex="0"></div>
        </div>
      </div>
    </section>

    <!-- JavaScript Panel -->
    <section id="panel-javascript" class="tab-panel">
      <div class="panel-grid">
        <div class="panel">
          <div class="toolbar">
            <h2>JavaScript 输入</h2>
            <div class="hint-row">
              <button class="btn-purple" data-action="js-sample">示例</button>
              <button class="btn-teal" data-action="paste-js">粘贴</button>
              <button class="danger" data-action="clear-js">清空</button>
            </div>
          </div>
          <textarea id="js-input" placeholder="输入 JavaScript..."></textarea>
          <div class="actions">
            <button data-action="js-format">格式化</button>
            <button class="warning" data-action="js-minify">压缩</button>
          </div>
        </div>
        <div class="panel">
          <div class="toolbar">
            <h2>JS 结果</h2>
            <div class="hint-row">
              <button class="danger" id="btn-js-clear-output">清空</button>
              <button class="success" data-action="copy-js">复制</button>
            </div>
          </div>
          <div id="js-output" class="code-viewer" tabindex="0"></div>
        </div>
      </div>
    </section>

    <!-- CSS Panel -->
    <section id="panel-css" class="tab-panel">
      <div class="panel-grid">
        <div class="panel">
          <div class="toolbar">
            <h2>CSS 输入</h2>
            <div class="hint-row">
              <button class="btn-purple" data-action="css-sample">示例</button>
              <button class="btn-teal" data-action="paste-css">粘贴</button>
              <button class="danger" data-action="clear-css">清空</button>
            </div>
          </div>
          <textarea id="css-input" placeholder="输入 CSS..."></textarea>
          <div class="actions">
            <button data-action="css-format">格式化</button>
            <button class="warning" data-action="css-minify">压缩</button>
          </div>
        </div>
        <div class="panel">
          <div class="toolbar">
            <h2>CSS 结果</h2>
            <div class="hint-row">
              <button class="danger" id="btn-css-clear-output">清空</button>
              <button class="success" data-action="copy-css">复制</button>
            </div>
          </div>
          <div id="css-output" class="code-viewer" tabindex="0"></div>
        </div>
      </div>
    </section>

    <!-- Timestamp Panel -->
    <section id="panel-timestamp" class="tab-panel">
      <div class="panel-grid">
        <div class="panel">
          <div class="toolbar">
            <h2>时间戳转换</h2>
            <div class="hint-row">
              <button id="btn-ts-pause" class="warning">暂停</button>
              <button class="secondary" id="btn-copy-date">复制时间</button>
              <button class="danger" id="btn-ts-clear">清空</button>
            </div>
          </div>
          <div class="ts-body">
             <div class="form-group">
                 <label>当前时间</label>
                 <div style="display:flex; gap:0.5rem; align-items:center; margin-bottom: 0.5rem;">
                     <div id="ts-now-date" style="font-family:var(--code-font); font-size:1.2rem; color:var(--accent); font-weight:bold; flex: 1;">--</div>
                 </div>
                 
                 <div class="result-row" style="padding: 0.3rem 0; border-bottom: 1px dashed var(--border);">
                    <span class="result-label">13位 (毫秒)</span>
                    <div style="display:flex; align-items:center;">
                        <span id="ts-now-ms-val" class="result-value">--</span>
                        <span class="copy-icon" id="btn-copy-ms">📋</span>
                    </div>
                 </div>
                 <div class="result-row" style="padding: 0.3rem 0;">
                    <span class="result-label">10位 (秒)</span>
                    <div style="display:flex; align-items:center;">
                        <span id="ts-now-sec-val" class="result-value">--</span>
                        <span class="copy-icon" id="btn-copy-sec">📋</span>
                    </div>
                 </div>
             </div>
             
             <div class="form-group">
                 <label>时间戳 转 日期</label>
                 <div style="display:flex; gap:0.5rem;">
                    <input type="text" id="ts-input" placeholder="输入10位或13位时间戳">
                    <button id="btn-ts-to-date">转换 >></button>
                 </div>
             </div>

             <div class="form-group">
                 <label>日期 转 时间戳</label>
                 <div style="display:flex; gap:0.5rem;">
                    <input type="text" id="date-input" placeholder="YYYY-MM-DD HH:mm:ss">
                    <button class="warning" id="btn-date-to-ts">转换 >></button>
                 </div>
             </div>
          </div>
        </div>
        <div class="panel">
          <div class="toolbar">
             <h2>转换结果</h2>
             <div class="hint-row">
                <button class="success" id="btn-ts-result-copy">复制结果</button>
             </div>
           </div>
          <div id="ts-result" class="code-viewer"></div>
        </div>
      </div>
    </section>

    <!-- Base64 Panel -->
    <section id="panel-base64" class="tab-panel">
      <div class="panel-grid">
        <div class="panel" style="gap:0;">
          <div class="toolbar">
             <h2>图片转 Base64</h2>
             <div class="hint-row">
                 <button id="btn-img-copy" class="success">复制 Base64</button>
                 <button id="btn-img-clear" class="danger">清空</button>
             </div>
          </div>
          <div style="padding:0.5rem; display:flex; flex-direction:column; flex:1; overflow:hidden;">
             <div class="file-drop-area" id="img-drop-zone">
                <div class="file-msg">
                   <span class="icon">📁</span>
                   <span class="text">点击选择文件 或 拖拽图片到这里</span>
                </div>
                <input type="file" id="img-file-input" accept="image/*">
             </div>
             
             <div style="margin-bottom:0.5rem; display:flex; align-items:center; gap:0.5rem; font-size:0.9rem; color:var(--muted);">
                <label style="width:70px;">压缩质量:</label>
                <input type="range" id="img-quality" min="1" max="100" step="1" value="100" style="flex:1;">
                <input type="number" id="img-quality-num" min="1" max="100" step="1" value="100" style="width:60px; padding:0.2rem;">
                <span>%</span>
             </div>

             <div style="margin-bottom:0.5rem; display:flex; align-items:center; gap:0.5rem; font-size:0.9rem; color:var(--muted);">
                <label style="width:70px;">缩放比例:</label>
                <input type="range" id="img-scale" min="1" max="100" step="1" value="100" style="flex:1;">
                <input type="number" id="img-scale-num" min="1" max="100" step="1" value="100" style="width:60px; padding:0.2rem;">
                <span>%</span>
             </div>

             <div id="img-size-info" style="font-size:0.85rem; color:var(--accent); margin-bottom:0.5rem; display:none; line-height: 1.5;">
                 <div>原始: <span id="size-original">0 KB</span> (<span id="dim-original">0x0</span>)</div>
                 <div>压缩: <span id="size-compressed">0 KB</span> (<span id="dim-compressed">0x0</span>)</div>
             </div>

             <textarea id="img-base64-output" placeholder="Base64 结果将显示在这里..." style="flex:1; margin-bottom:0;"></textarea>
          </div>
        </div>
        <div class="panel" style="gap:0;">
          <div class="toolbar">
             <h2>预览与解码</h2>
             <div class="hint-row">
                 <button class="btn-purple" data-action="base64-sample">示例</button>
                 <button class="btn-teal" data-action="paste-base64-img">粘贴</button>
                 <button class="btn-blue" data-action="copy-base64-img">复制</button>
                 <button class="btn-cyan" id="btn-base64-preview">显示预览</button>
                 <button id="btn-base64-download" class="success">下载</button>
                 <button class="danger" id="btn-base64-clear">清空</button>
             </div>
          </div>
          <div style="padding:0.5rem; display:flex; flex-direction:column; flex:1; overflow:hidden;">
             <textarea id="base64-img-input" placeholder="在此粘贴 Base64 字符串以解码预览... (压缩结果会自动预览)" style="flex:1; margin-bottom:0.5rem; resize: none;"></textarea>
             <div id="img-preview-area" style="flex:1; border:1px dashed var(--border); border-radius:6px; display:flex; overflow:auto; background:var(--bg-2); margin-top: 0; position: relative;">
                <span style="color:var(--muted); margin: auto;">图片预览区</span>
             </div>
          </div>
        </div>
      </div>
    </section>

    <!-- URL Panel -->
    <section id="panel-url" class="tab-panel">
        <div class="panel">
             <div class="toolbar">
                <h2>URL 编解码 & 解析</h2>
                <div class="hint-row">
                    <select id="url-examples" class="std-input" style="width:auto;">
                        <option value="">-- 常用示例 --</option>
                        <option value="simple">基础 URL</option>
                        <option value="params">复杂参数 URL</option>
                        <option value="auth_port">带认证/端口</option>
                        <option value="hash">带锚点 (Hash)</option>
                        <option value="chinese">中文参数 URL</option>
                        <option value="ipv4">IPv4 地址</option>
                        <option value="ipv6">IPv6 地址</option>
                        <option value="jdbc">JDBC 连接串</option>
                        <option value="encoded">已编码 URL</option>
                    </select>
                    <button class="btn-teal" data-action="paste-url">粘贴 URL</button>
                    <button class="btn-blue" data-action="url-encode">编码</button>
                    <button class="btn-orange" data-action="url-decode">解码</button>
                    <button class="btn-teal" data-action="url-copy-params">复制参数</button>
                    <button class="btn-indigo" data-action="url-paste-params">粘贴参数</button>
                    <button class="danger" data-action="clear-url">清空</button>
                </div>
            </div>
            
            <div style="display: flex; flex-direction: column; gap: 0.5rem; flex: 1; min-height: 0; overflow: hidden;">
                <div class="form-group" style="margin-bottom:0;">
                    <textarea id="url-input" style="height: 60px;" placeholder="输入 URL..."></textarea>
                </div>
                
                <div class="form-grid" style="padding: 0; gap: 0.5rem; margin-bottom: 0.5rem; flex-shrink: 0;">
                          <div class="form-group">
                          <label>Protocol</label>
                          <input type="text" id="url-protocol" class="std-input">
                      </div>
                      <div class="form-group">
                          <label>Host</label>
                          <input type="text" id="url-host" class="std-input">
                      </div>
                      <div class="form-group">
                          <label>Port</label>
                          <input type="text" id="url-port" class="std-input">
                      </div>
                      <div class="form-group">
                          <label>Path</label>
                          <input type="text" id="url-path" class="std-input">
                      </div>
                      <div class="form-group">
                          <label>Hash</label>
                          <input type="text" id="url-hash" class="std-input">
                      </div>
                 </div>
                
                <div class="form-group" style="flex: 1; display: flex; flex-direction: column; overflow: hidden; margin-bottom: 0;">
                    <label>Query Parameters</label>
                    <div style="flex: 1; overflow-y: auto; border: 1px solid var(--border); border-radius: 4px; background: var(--bg-2);">
                        <table class="url-table" style="margin: 0; width: 100%; table-layout: fixed;">
                            <colgroup>
                                <col style="width: 35%">
                                <col>
                                <col style="width: 50px">
                            </colgroup>
                            <thead>
                                <tr>
                                    <th style="position: sticky; top: 0; z-index: 5; border-top: none; border-left: none; border-right: 1px solid var(--border); border-bottom: 1px solid var(--border); background: linear-gradient(var(--panel), var(--panel)), var(--bg-2); color: var(--text);">Key</th>
                                    <th style="position: sticky; top: 0; z-index: 5; border-top: none; border-left: none; border-right: 1px solid var(--border); border-bottom: 1px solid var(--border); background: linear-gradient(var(--panel), var(--panel)), var(--bg-2); color: var(--text);">Value</th>
                                    <th class="action-col" style="position: sticky; top: 0; z-index: 5; border-top: none; border-left: none; border-right: none; border-bottom: 1px solid var(--border); background: linear-gradient(var(--panel), var(--panel)), var(--bg-2); color: var(--text);">Op</th>
                                </tr>
                            </thead>
                            <tbody id="url-params-body"></tbody>
                        </table>
                        <div class="url-table" style="margin-top: 0; border: none;">
                                <div class="btn-add" data-action="url-add-param" style="margin: 0.5rem; border-radius: 4px;">+ 添加参数</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Network Panel -->
    <section id="panel-network" class="tab-panel">
      <div class="panel-grid">
        <div class="panel">
          <div class="toolbar">
            <h2>请求配置</h2>
            <div class="hint-row">
               <select id="net-type" class="std-input" style="width:auto;">
                 <option value="http">HTTP 请求</option>
                 <option value="ws">WebSocket</option>
                 <option value="mqtt">MQTT 客户端</option>
                 <option value="ping">Ping (ICMP模拟)</option>
                 <option value="telnet">Telnet (端口探测)</option>
               </select>
               <select id="net-examples" class="std-input" style="width:auto;" onchange="if(this.value){setNetExample(this.value); this.value='';}">
                 <option value="">-- 常用示例 --</option>
                 <option value="get_json">GET JSON</option>
                 <option value="post_json">POST JSON</option>
                 <option value="ws_echo">WS Echo</option>
               </select>
               <button class="btn-teal" data-action="net-paste-url">粘贴 URL</button>
               <button class="danger" data-action="net-clear">清空</button>
             </div>
           </div>
          
          <div style="display:flex; flex-direction:column; gap:0.8rem; overflow-y:auto; flex:1; padding:0.5rem;">
             <!-- Common URL Bar -->
             <div style="display:flex; gap:0.5rem; align-items: center;">
                <select id="net-method" class="std-input" style="width:100px;">
                  <option value="GET">GET</option>
                  <option value="POST">POST</option>
                  <option value="PUT">PUT</option>
                  <option value="DELETE">DELETE</option>
                  <option value="PATCH">PATCH</option>
                </select>
                <input type="text" id="net-url" class="std-input" placeholder="输入 URL (http://... 或 ws://...)" style="flex:1;">
                <button id="net-send" style="min-width:80px;">发送</button>
             </div>
             
             <!-- Proxy Settings (Collapsible) -->
             <div style="border: 1px dashed var(--border); padding: 0.5rem; border-radius: 4px; background: var(--bg-glass); backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px);">
                <div style="display:flex; align-items:center; gap:0.5rem;">
                    <input type="checkbox" id="use-local-proxy">
                    <label for="use-local-proxy" style="margin:0; cursor:pointer; font-weight:bold; font-size:0.9rem;">启用本地 CORS 代理</label>
                    <span style="font-size:0.8rem; color:var(--text-muted); margin-left:auto;">
                        解决 "Failed to fetch" 跨域问题
                    </span>
                    <button class="secondary" id="btn-show-proxy-help" style="padding: 0.1rem 0.5rem; font-size: 0.8rem;">获取代理脚本</button>
                </div>
                <div id="proxy-help-area" style="display:none; margin-top:0.5rem; padding-top:0.5rem; border-top:1px dashed var(--border); font-size:0.85rem; color:var(--text);">
                    <p style="margin:0 0 0.5rem 0;">纯前端无法直接绕过浏览器跨域限制。请在本地运行一个简单的 Node.js 代理服务器：</p>
                    <ol style="margin:0 0 0.5rem 1.5rem; padding:0;">
                        <li>确保已安装 <a href="https://nodejs.org/" target="_blank">Node.js</a></li>
                        <li>点击 <button id="btn-copy-proxy-code" class="success" style="padding:0.1rem 0.4rem; font-size:0.8rem;">复制 server.js 代码</button></li>
                        <li>在任意文件夹新建 <code>server.js</code> 并粘贴代码</li>
                        <li>在终端运行: <code>node server.js</code></li>
                        <li>勾选上方的"启用本地 CORS 代理"即可发送请求</li>
                    </ol>
                </div>
             </div>

             <!-- HTTP Headers / Body -->
             <div id="net-http-opts" style="display:flex; flex-direction:column; gap:0.8rem;">
                <!-- Proxy Option Removed as per request -->
                <div class="form-group">
                   <label>Headers (JSON格式)</label>
                   <textarea id="net-headers" style="height:80px; font-size:0.85rem;" placeholder='{"Content-Type": "application/json"}'></textarea>
                   <div style="display:flex; gap:0.5rem; margin-top:0.2rem;">
                       <button class="secondary" style="font-size:0.75rem; padding:2px 6px;" data-action="net-add-header-ua">+ User-Agent</button>
                       <button class="secondary" style="font-size:0.75rem; padding:2px 6px;" data-action="net-add-header-json">+ JSON</button>
                       <button class="secondary" style="font-size:0.75rem; padding:2px 6px;" data-action="net-add-header-form">+ Form</button>
                   </div>
                </div>
                <div class="form-group">
                   <label>Body (请求体)</label>
                   <textarea id="net-body" style="height:120px; font-size:0.85rem;" placeholder="POST/PUT 请求体..."></textarea>
                </div>
                <!-- Iframe Preview Toggle -->
                <div class="form-group" style="flex-direction:row; align-items:center; gap:0.5rem; display:flex;">
                   <input type="checkbox" id="use-iframe-preview" checked>
                   <label for="use-iframe-preview" style="margin-bottom:0; cursor:pointer;">启用浏览器预览 (Iframe)</label>
                   <span style="font-size:0.8rem; color:var(--text-muted); margin-left:auto;">
                       支持 Form 提交 (可绕过 CORS 但无法读取返回值)
                   </span>
                </div>
                
                <!-- No-CORS Toggle -->
                <div class="form-group" style="flex-direction:row; align-items:center; gap:0.5rem; display:flex;">
                   <input type="checkbox" id="use-no-cors">
                   <label for="use-no-cors" style="margin-bottom:0; cursor:pointer;">强制发送 (No-CORS 模式)</label>
                   <span style="font-size:0.8rem; color:var(--text-muted); margin-left:auto;">
                       可绕过跨域报错，但<b>无法看到返回结果</b>
                   </span>
                </div>
             </div>

             <!-- WebSocket Opts -->
             <div id="net-ws-opts" style="display:none; flex-direction:column; gap:0.8rem;">
                <div style="display:flex; gap:0.5rem;">
                   <button id="net-ws-connect" class="success">连接</button>
                   <button id="net-ws-disconnect" class="danger" disabled>断开</button>
                   <div id="net-ws-status" style="display:flex; align-items:center; margin-left:1rem; font-size:0.9rem; color:var(--muted);">
                      <span style="width:8px; height:8px; border-radius:50%; background:var(--muted); margin-right:5px;" id="net-ws-indicator"></span>
                      <span id="net-ws-status-text">未连接</span>
                   </div>
                </div>
                <div class="form-group">
                   <label>发送消息</label>
                   <textarea id="net-ws-msg" style="height:80px; font-size:0.85rem;" placeholder="输入要发送的消息..."></textarea>
                   <button id="net-ws-send" class="secondary" style="margin-top:0.5rem;" disabled>发送消息</button>
                </div>
             </div>

             <!-- MQTT Opts -->
             <div id="net-mqtt-opts" style="display:none; flex-direction:column; gap:0.8rem;">
                <div style="display:flex; gap:0.5rem; flex-wrap:wrap;">
                    <input type="text" id="mqtt-client-id" class="std-input" placeholder="Client ID (可选)" style="flex:1; min-width:120px;">
                    <input type="text" id="mqtt-user" class="std-input" placeholder="Username (可选)" style="flex:1; min-width:120px;">
                    <input type="password" id="mqtt-pass" class="std-input" placeholder="Password (可选)" style="flex:1; min-width:120px;">
                </div>
                <div style="display:flex; gap:0.5rem;">
                    <button id="mqtt-connect" class="success">连接</button>
                    <button id="mqtt-disconnect" class="danger" disabled>断开</button>
                    <div id="mqtt-status" style="display:flex; align-items:center; margin-left:1rem; font-size:0.9rem; color:var(--muted);">
                       <span style="width:8px; height:8px; border-radius:50%; background:var(--muted); margin-right:5px;" id="mqtt-indicator"></span>
                       <span id="mqtt-status-text">未连接</span>
                    </div>
                </div>
                <div class="form-group">
                    <label>订阅主题 (Subscribe)</label>
                    <div style="display:flex; gap:0.5rem;">
                        <input type="text" id="mqtt-sub-topic" class="std-input" placeholder="Topic (e.g. test/topic)" style="flex:1;">
                        <button id="mqtt-sub-btn" class="secondary" disabled>订阅</button>
                    </div>
                </div>
                <div class="form-group">
                    <label>发布消息 (Publish)</label>
                    <input type="text" id="mqtt-pub-topic" class="std-input" placeholder="Topic" style="margin-bottom:0.5rem;">
                    <textarea id="mqtt-pub-msg" style="height:60px; font-size:0.85rem;" placeholder="Message..."></textarea>
                    <button id="mqtt-pub-btn" class="secondary" style="margin-top:0.5rem;" disabled>发布</button>
                </div>
             </div>

             <!-- Ping/Telnet Opts -->
             <div id="net-ping-opts" style="display:none; flex-direction:column; gap:0.8rem;">
                 <div style="background:var(--bg-2); padding:0.8rem; border-radius:4px; font-size:0.9rem; color:var(--muted); line-height:1.5;">
                     <strong style="color:var(--warn);">注意：</strong> 纯前端受浏览器安全策略限制。<br>
                     • <strong>Ping (ICMP):</strong> 模拟 HTTP Head 请求或 WebSocket 连接耗时。<br>
                     • <strong>Telnet (TCP):</strong> 尝试连接目标端口 (HTTP/WS) 或加载资源。无法建立原始 TCP 连接。<br>
                     <span id="ping-hint-proxy" style="display:none; color:var(--success);">已启用本地代理，尝试通过代理转发...</span>
                 </div>
                 
                 <div id="telnet-port-group" style="display:none;">
                    <label>端口 (Port)</label>
                    <input type="number" id="net-port" class="std-input" value="80" placeholder="Port">
                 </div>

                 <div style="display:flex; gap:0.5rem; align-items:center;">
                     <button id="btn-ping-test" style="flex:1;">开始探测</button>
                 </div>
             </div>
          </div>
        </div>

        <div class="panel" style="padding:0; gap:0;">
          <div style="display:flex; flex-direction:column; flex:1; min-height:0; padding:0.5rem; gap:0.5rem;">
              <div class="toolbar">
                <h2>响应 / 日志</h2>
                <div class="hint-row">
                   <button class="danger" id="net-clear-log">清空</button>
                </div>
              </div>
              <div id="net-log" class="code-viewer" style="padding:0.5rem; font-size:0.85rem; line-height:1.6; border:none; border-radius:0;">
                 <div style="color:var(--muted); text-align:center; margin-top:2rem;">等待请求...</div>
              </div>
          </div>
          
          <!-- Preview Container (Bottom Right) -->
          <div id="net-preview-container" style="display:none; flex-direction:column; height:50%; border-top:1px solid var(--border); padding:0.5rem; background:var(--bg);">
               <div class="toolbar" style="margin-bottom:0.5rem;">
                   <h2>页面预览 (Iframe)</h2>
                   <button class="icon-btn" data-action="net-preview-close">✕</button>
               </div>
               <iframe id="net-preview-frame" name="net-preview-frame" style="width:100%; height:100%; border:none; background:#fff; border-radius:4px;"></iframe>
          </div>
        </div>
      </div>
    </section>


    <!-- Crypto Panel -->
    <section id="panel-crypto" class="tab-panel">
      <div class="panel-grid">
        <div class="panel">
          <div class="toolbar">
             <h2>文本输入</h2>
             <div class="hint-row">
                 <select id="crypto-examples" class="std-input" style="width:auto; margin-right: 0.5rem;">
                    <option value="">-- 加载示例 --</option>
                    <option value="simple">简单文本 (Hello World)</option>
                    <option value="number">数字/密码 (123456)</option>
                    <option value="chinese">中文内容 (你好世界)</option>
                    <option value="json">JSON 数据 (API 签名)</option>
                    <option value="long">长文本 (段落)</option>
                 </select>
                  <button class="btn-teal" data-action="crypto-paste">粘贴</button>
                 <button class="success" id="btn-crypto-md5">MD5</button>
                 <button class="warning" id="btn-crypto-sha1">SHA1</button>
                 <button id="btn-crypto-sha256">SHA256</button>
                 <button class="secondary" id="btn-crypto-sha512">SHA512</button>
                 <button class="danger" id="crypto-clear">清空</button>
             </div>
          </div>
          <textarea id="crypto-input" placeholder="输入需要加密/哈希的文本..."></textarea>
        </div>
        <div class="panel">
          <div class="toolbar">
             <h2>计算结果</h2>
             <div class="hint-row">
                 <label style="display:flex; align-items:center; gap:0.5rem; font-size:0.9rem; font-weight:bold; color:var(--accent); cursor:pointer; margin-right:0.5rem; padding: 2px 8px; border: 1px solid var(--border); border-radius: 4px; background: var(--bg-2);">
                    <input type="checkbox" id="crypto-uppercase"> 大写输出
                 </label>
             </div>
          </div>
          <div style="display:flex; flex-direction:column; gap:0.5rem; overflow-y:auto; padding:0.5rem;">
             <div class="form-group">
                <label>Result</label>
                <div class="input-group">
                    <input type="text" id="crypto-output" class="std-input" readonly placeholder="结果...">
                    <button class="secondary" id="btn-crypto-copy">复制</button>
                </div>
             </div>
             <div class="form-group">
                <label>Hash Info</label>
                <div id="crypto-info" style="font-size:0.85rem; color:var(--muted);">等待计算...</div>
             </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Regex Panel -->
    <section id="panel-regex" class="tab-panel">
      <div class="panel-grid">
        <div class="panel">
          <div class="toolbar">
             <h2>正则表达式 & 文本</h2>
             <div class="hint-row">
                <select id="regex-examples" class="std-input" style="width:auto;">
                    <option value="">-- 常用示例 --</option>
                    <option value="email">Email 邮箱</option>
                    <option value="phone">手机号 (CN)</option>
                    <option value="url">URL 网址</option>
                    <option value="date">日期 (YYYY-MM-DD)</option>
                    <option value="time">时间 (HH:mm:ss)</option>
                    <option value="ipv4">IPv4 地址</option>
                    <option value="ipv6">IPv6 地址</option>
                    <option value="idcard">身份证 (18位)</option>
                    <option value="chinese">中文汉字</option>
                    <option value="password">强密码 (大小写数字特殊字符)</option>
                    <option value="html_tag">HTML 标签</option>
                    <option value="blank_line">空行</option>
                    <option value="hex_color">Hex 颜色</option>
                    <option value="number">数字 (整数/小数)</option>
                    <option value="slug">URL Slug</option>
                </select>
                  <button class="btn-teal" data-action="regex-paste-text">粘贴文本</button>
                <button class="danger" data-action="regex-clear">清空</button>
                <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Regular_Expressions" target="_blank" rel="noopener noreferrer" style="color:var(--accent); font-size:0.8rem; text-decoration:none; margin-left:0.5rem;">JS正则语法参考</a>
             </div>
          </div>
          <div style="display:flex; flex-direction:column; gap:0.5rem; flex:1; min-height:0; overflow:hidden;">
              <div style="display:flex; gap:0.5rem; align-items:center;">
                 <span style="font-family:var(--code-font); color:var(--muted); width: 10px; text-align: center;">/</span>
                 <input type="text" id="regex-pattern" class="std-input" placeholder="正则模式 (例如: \d+)" style="font-family:var(--code-font); flex: 1;">
                 <span style="font-family:var(--code-font); color:var(--muted); width: 10px; text-align: center;">/</span>
                 <input type="text" id="regex-flags" class="std-input" value="gm" placeholder="flags" style="width:60px; font-family:var(--code-font);" title="g: 全局, i: 忽略大小写, m: 多行">
              </div>
              <div style="display:flex; gap:0.5rem; align-items:center;">
                 <span style="font-family:var(--code-font); color:var(--muted); width: 10px; text-align: center;">R</span>
                 <input type="text" id="regex-replace-str" class="std-input" placeholder="替换文本 (支持 $1...)" style="font-family:var(--code-font); flex: 1;">
                 <button id="btn-regex-replace" class="btn-teal small" style="white-space: nowrap;">替换</button>
              </div>
              <textarea id="regex-text" placeholder="输入测试文本..." style="flex:1;"></textarea>
          </div>
        </div>
        <div class="panel">
          <div class="toolbar">
             <h2>匹配结果</h2>
             <div class="hint-row">
                 <span id="regex-count" style="color:var(--success);">0 处匹配</span>
             </div>
          </div>
          <div id="regex-output" class="code-viewer" style="white-space:pre-wrap; word-break:break-all; flex: 1;"></div>
          
          <div id="regex-replace-container" style="display:none; flex-direction: column; flex: 1; border-top: 1px dashed var(--border); padding-top: 0.5rem; margin-top: 0.5rem;">
               <div class="toolbar" style="min-height: auto; margin-bottom: 0.5rem;">
                   <h3 style="font-size: 0.9rem; margin: 0;">替换结果</h3>
                  <button class="small" data-action="regex-copy-replace">复制</button>
               </div>
               <textarea id="regex-replace-result" class="std-input" style="flex: 1; resize: none; font-family: var(--code-font);" readonly></textarea>
          </div>
        </div>
      </div>
    </section>

    <!-- Mock Panel -->
    <section id="panel-mock" class="tab-panel">
      <div class="panel-grid">
        <div class="panel">
          <div class="toolbar" style="margin-bottom: 0;">
            <h2>生成配置</h2>
            <div class="hint-row">
              <select id="mock-presets" class="std-input" style="width:auto; margin-right: 0.5rem;" onchange="if(this.value){setMockPreset(this.value); this.value='';}">
                <option value="">-- 快速预设 --</option>
                <option value="random">随机配置</option>
                <option value="male_young">年轻男性 (18-30)</option>
                <option value="female_young">年轻女性 (18-30)</option>
                <option value="elder">老年人 (>60)</option>
              </select>
              <button class="btn-blue" id="btn-generate">⚡ 生成信息</button>
              <button class="danger" id="mock-reset">重置</button>
            </div>
          </div>
          <div style="overflow-y: auto; flex: 1; padding: 0.5rem; padding-top: 0.2rem;">
             <div class="form-grid">
               <div class="form-group full-width">
                 <label>行政区划 (省/市/区)</label>
                 <div style="display: flex; gap: 0.5rem;">
                   <select id="mock-province" style="flex:1;"><option>加载中...</option></select>
                   <select id="mock-city" style="flex:1;"><option>--</option></select>
                   <select id="mock-district" style="flex:1;"><option>--</option></select>
                 </div>
               </div>
               <div class="form-group">
                 <label>年龄 (18-80)</label>
                 <input type="number" id="mock-age" value="25" min="18" max="80">
               </div>
               <div class="form-group">
                 <label>性别</label>
                 <select id="mock-gender">
                   <option value="M">男</option>
                   <option value="F">女</option>
                 </select>
               </div>
               <div class="form-group full-width">
                 <label>银行</label>
                <div class="custom-select-container" id="bank-select-container">
                  <div class="selected-option" id="bank-selected-display">
                    <span style="display:flex; align-items:center;">
                        <span class="bank-logo" style="background:#888;">?</span>
                        <span>请选择银行</span>
                    </span>
                    <span style="font-size: 0.8rem; color: var(--muted);">▼</span>
                  </div>
                  <div class="options-dropdown" id="bank-options-dropdown">
                    <div class="search-box">
                      <input type="text" id="bank-search-input" placeholder="搜索银行名称..." autocomplete="off">
                    </div>
                    <div class="options-list" id="bank-options-list">
                      <!-- Options will be populated here -->
                    </div>
                  </div>
                </div>
                <input type="hidden" id="mock-bank" value="">
               </div>
               <div class="form-group">
                 <label>卡种</label>
                 <select id="mock-card-type">
                   <option value="DC">储蓄卡 (Debit)</option>
                   <option value="CC">信用卡 (Credit)</option>
                 </select>
               </div>
             </div>
             <div style="padding: 0.5rem 0; display:none;"></div>
          </div>
        </div>
        <div class="panel">
          <div class="toolbar">
            <h2>生成结果</h2>
            <div class="hint-row">
               <button class="success" id="btn-copy-all">复制全部 (JSON)</button>
            </div>
          </div>
          <div id="mock-output" style="overflow-y: auto; padding: 0.5rem;">
             <div style="color: var(--muted); text-align: center; margin-top: 2rem;">点击左侧生成按钮</div>
          </div>
        </div>
      </div>
    </section>
    
    <!-- Other Tools Panel -->
    <section id="panel-other" class="tab-panel">
      <div class="panel-grid">
        <div class="panel">
          <div class="toolbar">
            <h2>❄️ 雪花ID生成器</h2>
            <div class="hint-row">
              <button class="success" id="btn-gen-snow">⚡ 生成</button>
              <button class="secondary" id="btn-copy-snow">复制</button>
              <button class="danger" id="btn-snow-reset">重置</button>
            </div>
          </div>
          <div class="form-group-row">
            <div class="form-group">
               <label>快速预设</label>
               <select id="snow-presets" class="std-input" onchange="if(this.value){setSnowPreset(this.value); this.value='';}">
                <option value="">-- 选择模式 --</option>
                <option value="default">默认 (1, 1)</option>
                <option value="max">最大值 (31, 31)</option>
                <option value="random">随机 ID</option>
              </select>
            </div>
            <div class="form-group">
              <label>数据中心 ID (0-31)</label>
              <input type="number" id="snow-datacenter" class="std-input" value="1" min="0" max="31">
            </div>
            <div class="form-group">
              <label>工作节点 ID (0-31)</label>
              <input type="number" id="snow-worker" class="std-input" value="1" min="0" max="31">
            </div>
          </div>
          <div class="form-group" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; margin: 0.5rem 0; padding: 1rem; background: var(--bg); border-radius: 8px; border: 1px solid var(--border);">
              <label style="display: flex; align-items: center; cursor: pointer;" title="生成兼容 JavaScript Number 类型 (最大 2^53-1) 的 16 位短 ID">
                <input type="checkbox" id="snow-js-safe"> 兼容 JS (53位)
              </label>
              <label style="display: flex; align-items: center; cursor: pointer;" title="将生成的 ID 转换为 Base62 字符串 (0-9, a-z, A-Z)">
                <input type="checkbox" id="snow-short"> Base62 编码
              </label>
          </div>
          <div class="actions" style="display:none;"></div>
          <div class="result-area" style="margin-top: 1rem;">
             <label>生成结果</label>
             <div class="input-group">
               <input type="text" id="snow-output" class="std-input" readonly placeholder="等待生成...">
             </div>
             <div id="snow-info" style="font-size: 0.85rem; color: var(--muted); margin-top: 0.5rem; line-height: 1.4;"></div>
          </div>
          <div class="usage-note" style="margin-top: 1.5rem; font-size: 0.85rem; border-top: 1px solid var(--border); padding-top: 1rem;">
            <strong>说明：</strong> Snowflake 是 Twitter 开源的分布式 ID 生成算法，生成的 ID 是一个 64 位的长整型，具有全局唯一且趋势递增的特点。<br>
            <strong>结构：</strong> 1位符号位 + 41位时间戳 + 5位数据中心 + 5位工作节点 + 12位序列号。
          </div>
        </div>

        <div class="panel">
          <div class="toolbar">
            <h2>🆔 GUID/UUID 生成器</h2>
            <div class="hint-row">
              <button class="success" id="btn-gen-uuid">⚡ 生成</button>
              <button class="secondary" id="btn-copy-uuid">复制</button>
              <button class="danger" id="btn-uuid-reset">重置</button>
            </div>
          </div>
          <div class="form-group-row">
            <div class="form-group">
               <label>快速预设</label>
               <select id="uuid-presets" class="std-input" onchange="if(this.value){document.getElementById('uuid-count').value=this.value; this.value='';}">
                <option value="">-- 选择数量 --</option>
                <option value="1">1 个</option>
                <option value="5">5 个</option>
                <option value="10">10 个</option>
                <option value="50">50 个</option>
              </select>
            </div>
            <div class="form-group">
              <label>生成数量</label>
              <input type="number" id="uuid-count" class="std-input" value="10" min="1" max="100">
            </div>
          </div>
          <div class="form-group" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; margin: 0.5rem 0; padding: 1rem; background: var(--bg); border-radius: 8px; border: 1px solid var(--border);">
              <label style="display: flex; align-items: center; cursor: pointer;">
                <input type="checkbox" id="uuid-no-hyphen"> 不带连字符 (-)
              </label>
              <label style="display: flex; align-items: center; cursor: pointer;">
                <input type="checkbox" id="uuid-upper"> 大写输出 (UPPER)
              </label>
          </div>
          <div class="actions" style="display:none;"></div>
          <textarea id="uuid-output" style="height: 180px; margin-top: 1rem;" readonly placeholder="生成的 UUID 将显示在这里..."></textarea>

          <div class="usage-note" style="margin-top: 1.5rem; font-size: 0.85rem; border-top: 1px solid var(--border); padding-top: 1rem;">
            <strong>说明：</strong> 生成符合 RFC 4122 标准的 UUID v4（完全随机生成）。支持批量生成，每行一个。
          </div>
        </div>

        <div class="panel">
          <div class="toolbar">
            <h2>🔐 密码生成器</h2>
            <div class="hint-row">
              <button class="success" id="btn-gen-pwd">⚡ 生成</button>
              <button class="secondary" id="btn-copy-pwd">复制</button>
              <button class="danger" id="btn-pwd-reset">重置</button>
            </div>
          </div>
          <div class="form-group-row">
             <div class="form-group">
                <label>快速预设</label>
                <select id="pwd-presets" class="std-input" onchange="if(this.value){setPwdPreset(this.value); this.value='';}">
                  <option value="">-- 选择类型 --</option>
                  <option value="strong">强密码 (16位)</option>
                  <option value="simple">中等强度 (12位)</option>
                  <option value="pin">PIN 码 (6位数字)</option>
                </select>
             </div>
             <div class="form-group">
               <label>密码长度 (<span id="pwd-len-val">16</span>)</label>
               <input type="range" id="pwd-length" min="8" max="64" value="16" style="width: 100%; margin: 0.5rem 0;">
             </div>
          </div>
          <div class="form-group" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; margin: 0.5rem 0; padding: 1rem; background: var(--bg); border-radius: 8px; border: 1px solid var(--border);">
            <label style="display: flex; align-items: center; cursor: pointer;">
              <input type="checkbox" id="pwd-upper" checked> 包含大写字母 (A-Z)
            </label>
            <label style="display: flex; align-items: center; cursor: pointer;">
              <input type="checkbox" id="pwd-lower" checked> 包含小写字母 (a-z)
            </label>
            <label style="display: flex; align-items: center; cursor: pointer;">
              <input type="checkbox" id="pwd-number" checked> 包含数字 (0-9)
            </label>
            <label style="display: flex; align-items: center; cursor: pointer;">
              <input type="checkbox" id="pwd-special" checked> 包含特殊字符 (!@#$%^&*)
            </label>
          </div>
          <div class="actions" style="display:none;"></div>
          <div class="result-area" style="margin-top: 1rem;">
             <label>生成结果</label>
             <div class="input-group">
               <input type="text" id="pwd-output" class="std-input" readonly placeholder="等待生成...">
             </div>
          </div>
          <div class="usage-note" style="margin-top: 1.5rem; font-size: 0.85rem; border-top: 1px solid var(--border); padding-top: 1rem;">
            <strong>说明：</strong> 采用浏览器原生加密级随机数生成器 (crypto.getRandomValues) 确保密码安全性。
          </div>
        </div>
      </div>
    </section>

    <!-- Diff Panel -->
    <section id="panel-diff" class="tab-panel">
        <div class="panel" style="gap: 0;">
            <div class="toolbar">
                <h2>文本/代码对比</h2>
                <div class="hint-row">
                    <select id="diff-examples" class="std-input" style="width:auto;">
                        <option value="">-- 常用示例 --</option>
                        <option value="code">代码对比 (JS)</option>
                        <option value="config">配置对比 (JSON)</option>
                        <option value="text">文章对比 (中文)</option>
                    </select>
                    <button class="success" id="btn-diff-run">执行对比</button>
                    <button class="danger" id="btn-diff-clear">清空</button>
                </div>
            </div>
            <div class="form-grid" style="flex: 1; overflow: hidden; padding: 0; gap: 0;">
                <div style="display: flex; flex-direction: column; border-right: 1px solid var(--border); padding: 0.5rem; padding-top: 0;">
                     <label style="color: var(--muted); font-size: 0.8rem; display:flex; justify-content:space-between; align-items:center;">
                        原始文本 (Left)
                        <span class="btn-icon" style="cursor:pointer; font-size:1rem;" data-action="paste-diff-left" title="粘贴">📋</span>
                     </label>
                     <textarea id="diff-left" style="flex: 1; resize: none;" placeholder="粘贴旧版本..."></textarea>
                </div>
                <div style="display: flex; flex-direction: column; padding: 0.5rem; padding-top: 0;">
                     <label style="color: var(--muted); font-size: 0.8rem; display:flex; justify-content:space-between; align-items:center;">
                        新文本 (Right)
                        <span class="btn-icon" style="cursor:pointer; font-size:1rem;" data-action="paste-diff-right" title="粘贴">📋</span>
                     </label>
                     <textarea id="diff-right" style="flex: 1; resize: none;" placeholder="粘贴新版本..."></textarea>
                </div>
            </div>
            <div style="flex: 1; display: flex; flex-direction: column; padding: 0.5rem; border-top: 1px solid var(--border); overflow: hidden;">
                 <label style="color: var(--muted); font-size: 0.8rem; margin-bottom: 0.5rem;">差异结果</label>
                 <div id="diff-output" class="diff-output" style="flex: 1;"></div>
            </div>
        </div>
    </section>

    <!-- JWT Panel -->
    <section id="panel-jwt" class="tab-panel">
        <div class="panel-grid">
            <div class="panel">
                <div class="toolbar">
                    <h2>JWT Token</h2>
                    <div class="hint-row">
                         <select id="jwt-examples" class="std-input" style="width:auto;">
                            <option value="">-- 常用示例 --</option>
                            <option value="hs256">HS256 (标准)</option>
                            <option value="rs256">RS256 (公钥)</option>
                            <option value="expired">已过期 Token</option>
                            <option value="complex">复杂 Payload</option>
                         </select>
                        <button class="btn-teal" data-action="jwt-paste">粘贴 Token</button>
                          <button class="danger" data-action="jwt-clear">清空</button>
                    </div>
                </div>
                <textarea id="jwt-input" placeholder="粘贴 Encoded JWT (eyJ...)..." style="flex: 1;"></textarea>
            </div>
            <div class="panel" style="overflow-y: auto;">
                <div class="toolbar">
                    <h2>解码结果</h2>
                </div>
                <div class="info-block" style="border-left: 3px solid #e06c75;">
                    <span class="info-label">HEADER: Algorithm & Token Type</span>
                    <pre id="jwt-header" class="info-value jwt-header"></pre>
                </div>
                <div class="info-block" style="border-left: 3px solid #98c379;">
                    <span class="info-label">PAYLOAD: Data</span>
                    <pre id="jwt-payload" class="info-value jwt-payload"></pre>
                </div>
                <div class="info-block" style="border-left: 3px solid #61afef;">
                    <span class="info-label">SIGNATURE</span>
                    <pre id="jwt-signature" class="info-value jwt-signature" style="white-space: pre-wrap;"></pre>
                </div>
                <div class="usage-note" style="margin-top: 1rem; font-size: 0.85rem;">
                    <strong>注意：</strong> 仅在本地解码，不会验证签名有效性。不要粘贴真实的生产环境 Token。
                </div>
            </div>
        </div>
    </section>

    <!-- Cron Panel -->
    <section id="panel-cron" class="tab-panel">
         <div class="panel">
             <div class="toolbar">
                 <h2>Cron 表达式生成/解析</h2>
                 <div class="hint-row">
                    <select id="cron-examples" class="std-input" style="width: auto;">
                        <option value="">-- 常用示例 --</option>
                        <option value="every_min">每分钟 (* * * * *)</option>
                        <option value="every_5min">每5分钟 (*/5 * * * *)</option>
                        <option value="every_15min">每15分钟 (*/15 * * * *)</option>
                        <option value="every_30min">每30分钟 (*/30 * * * *)</option>
                        <option value="every_hour">每小时 (0 * * * *)</option>
                        <option value="every_2hour">每2小时 (0 */2 * * *)</option>
                        <option value="work_hour">工作时间 (0 9-18 * * *)</option>
                        <option value="daily_midnight">每天午夜 (0 0 * * *)</option>
                        <option value="daily_noon">每天中午 (0 12 * * *)</option>
                        <option value="weekly_mon">每周一 (0 0 * * 1)</option>
                        <option value="weekly_fri">每周五 (0 0 * * 5)</option>
                        <option value="weekend">周末 (0 0 * * 6,0)</option>
                        <option value="weekday">工作日 (0 0 * * 1-5)</option>
                        <option value="monthly_first">每月1号 (0 0 1 * *)</option>
                        <option value="monthly_last">每月最后一天 (0 0 L * *)</option>
                        <option value="quarterly">每季度 (0 0 1 1,4,7,10 *)</option>
                        <option value="yearly">每年1月1号 (0 0 1 1 *)</option>
                    </select>
                    <button class="btn-purple" id="btn-cron-parse">解析 / 生成</button>
                     <button class="danger" data-action="cron-clear">清空</button>
                 </div>
             </div>
            <div class="cron-body">
              <div class="form-group-row" style="margin-top: 1rem;">
                  <input type="text" id="cron-input" class="std-input" placeholder="输入 Cron 表达式 (如: 0 12 * * *)" style="width: 100%; font-family: var(--code-font); font-size: 1.2rem; letter-spacing: 1px;">
              </div>
              <div class="info-block" id="cron-result" style="display: none; margin-top: 1rem;">
                  <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; text-align: center; margin-bottom: 1rem;">
                      <div style="background: var(--bg); padding: 5px; border-radius: 4px;">
                          <div style="color: var(--accent); font-weight: bold;" id="cron-v1">*</div>
                          <div style="font-size: 0.75rem; color: var(--muted);">分钟</div>
                      </div>
                      <div style="background: var(--bg); padding: 5px; border-radius: 4px;">
                          <div style="color: var(--accent); font-weight: bold;" id="cron-v2">*</div>
                          <div style="font-size: 0.75rem; color: var(--muted);">小时</div>
                      </div>
                      <div style="background: var(--bg); padding: 5px; border-radius: 4px;">
                          <div style="color: var(--accent); font-weight: bold;" id="cron-v3">*</div>
                          <div style="font-size: 0.75rem; color: var(--muted);">日期</div>
                      </div>
                      <div style="background: var(--bg); padding: 5px; border-radius: 4px;">
                          <div style="color: var(--accent); font-weight: bold;" id="cron-v4">*</div>
                          <div style="font-size: 0.75rem; color: var(--muted);">月份</div>
                      </div>
                      <div style="background: var(--bg); padding: 5px; border-radius: 4px;">
                          <div style="color: var(--accent); font-weight: bold;" id="cron-v5">*</div>
                          <div style="font-size: 0.75rem; color: var(--muted);">星期</div>
                      </div>
                  </div>
                  <div style="border-top: 1px dashed var(--border); padding-top: 10px;">
                      <span class="info-label">说明</span>
                      <div id="cron-desc" class="info-value" style="white-space: pre-wrap;"></div>
                  </div>
                  <div style="border-top: 1px dashed var(--border); padding-top: 10px; margin-top: 10px;">
                      <span class="info-label">下一次运行</span>
                      <div id="cron-next" class="info-value"></div>
                  </div>
              </div>
              <div class="usage-note" style="margin-top: auto;">
                   <table style="width: 100%; font-size: 0.85rem; color: var(--muted); border-collapse: collapse;">
                       <tr><td>*</td><td>任意值</td></tr>
                       <tr><td>,</td><td>值列表分隔 (1,3,5)</td></tr>
                       <tr><td>-</td><td>范围 (1-5)</td></tr>
                       <tr><td>/</td><td>步长 (*/5)</td></tr>
                   </table>
              </div>
            </div>
         </div>
     </section>

  </main>
  </div>

  <!-- Modals -->
  <div id="modal-history" class="modal-backdrop">
    <div class="modal">
      <div class="modal-header">
        <h3>历史记录</h3>
        <button class="icon-btn close-modal">✕</button>
      </div>
      <div style="padding: 0.5rem 1rem; border-bottom: 1px solid var(--border);">
         <input type="text" id="history-search" class="std-input" placeholder="搜索历史记录 (内容)...">
      </div>
      <div class="modal-body" id="history-list"></div>
      <div class="modal-footer">
        <button class="secondary" id="clear-history">清空历史</button>
      </div>
    </div>
  </div>

  <div id="modal-settings" class="modal-backdrop">
    <div class="modal">
      <div class="modal-header">
        <h3>设置</h3>
        <button class="icon-btn close-modal">✕</button>
      </div>
      <div class="modal-body">
        <label style="display:block; margin-bottom:0.5rem">缩进大小</label>
        <select id="setting-indent" class="std-input">
          <option value="2">2 空格</option>
          <option value="4">4 空格</option>
          <option value="tab">Tab</option>
        </select>

        <label style="display:block; margin:1rem 0 0.5rem">代码字体</label>
        <select id="setting-font" class="std-input">
          <option value="JetBrains Mono">JetBrains Mono</option>
          <option value="Fira Code">Fira Code</option>
          <option value="Consolas">Consolas</option>
          <option value="Source Code Pro">Source Code Pro</option>
          <option value="Courier New">Courier New</option>
          <option value="Monaco">Monaco</option>
        </select>

        <label style="display:block; margin:1rem 0 0.5rem">字体大小 (全局)</label>
        <select id="setting-size" class="std-input">
          <option value="14px">小</option>
          <option value="16px" selected>中 (默认)</option>
          <option value="18px">大</option>
        </select>

        <div style="margin-top:1rem; padding-top:1rem; border-top:1px solid var(--border); display:flex; align-items:center; justify-content:space-between;">
            <label>开启历史记录</label>
            <input type="checkbox" id="setting-history-enabled" checked>
        </div>
        <div style="margin-top:0.35rem; font-size:0.8rem; color:var(--muted); line-height:1.4;">
          提示：历史记录保存在浏览器本地存储（localStorage），可能包含敏感内容；需要时再开启。
        </div>

        <div style="margin-top:1rem; padding-top:1rem; border-top:1px solid var(--border); text-align: center;">
            <button class="danger" id="reset-app" style="width: 100%">重置所有数据 (清除缓存)</button>
        </div>
      </div>
    </div>
  </div>

  <div id="toast" class="toast"></div>

  <script>
    
    // --- Storage Helper ---
    // Moved to <head> to support early initialization
    // const safeStorage = { ... };

    // --- 状态与配置 ---
    const HISTORY_MAX = 1000; // 最大保存1000条
    const HISTORY_RETENTION_DAYS = 7; // 保留最近7天
    const HISTORY_ITEM_MAX_CHARS = 50000;
    const HISTORY_PREVIEW_MAX_CHARS = 140;
    const HISTORY_SKIP_BATCH = 6;

    // --- 工具函数 ---

    // HTML 转义函数，防止 XSS 攻击
    function escapeHtml(unsafe) {
        if (typeof unsafe !== 'string') return '';
        return unsafe
            .replace(/&/g, '&amp;')
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;')
            .replace(/"/g, '&quot;')
            .replace(/'/g, '&#039;');
    }

    // 防抖函数
    function debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
            const later = () => {
                clearTimeout(timeout);
                func(...args);
            };
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
        };
    }

    // 节流函数
    function throttle(func, limit) {
        let inThrottle;
        return function(...args) {
            if (!inThrottle) {
                func.apply(this, args);
                inThrottle = true;
                setTimeout(() => inThrottle = false, limit);
            }
        };
    }

    let mousePos = { x: window.innerWidth * 0.5, y: window.innerHeight * 0.35 };
    let mouseRaf = 0;
    function commitMouseVars() {
      mouseRaf = 0;
      document.documentElement.style.setProperty('--mx', mousePos.x + 'px');
      document.documentElement.style.setProperty('--my', mousePos.y + 'px');
    }
    document.documentElement.style.setProperty('--mx', mousePos.x + 'px');
    document.documentElement.style.setProperty('--my', mousePos.y + 'px');
    document.addEventListener('mousemove', (e) => {
      mousePos.x = e.clientX;
      mousePos.y = e.clientY;
      if (!mouseRaf) mouseRaf = requestAnimationFrame(commitMouseVars);
    });

    function normalizeHistory(raw) {
      if (!raw || !Array.isArray(raw)) {
        console.warn('normalizeHistory: 无效的输入数据');
        return [];
      }
      const mapped = raw.map((it) => {
        if (!it || typeof it !== 'object') return null;
        const type = typeof it.type === 'string' ? it.type : '';
        const full = typeof it.full === 'string'
          ? it.full
          : (typeof it.content === 'string' ? it.content : '');
        const ts = Number.isFinite(it.ts) ? it.ts
          : (Number.isFinite(it.timestamp) ? it.timestamp : Date.now());
        const meta = it.meta && typeof it.meta === 'object' ? it.meta : undefined;
        if (!type || !full) return null;
        const item = { type, full, ts };
        if (meta) item.meta = meta;
        return item;
      }).filter(Boolean);
      // 初始化时不截断，由 filterHistory 处理
      return mapped;
    }

    // 从localStorage读取初始数据（同步，用于快速启动）
    let parsedHistory = [];
    try {
      const data = JSON.parse(safeStorage.get('history') || '[]');
      // 验证数据是否为数组
      if (Array.isArray(data)) {
        parsedHistory = data;
      } else {
        
        parsedHistory = [];
      }
    } catch (e) {
      
      parsedHistory = [];
    }
    const normalizedHistory = normalizeHistory(parsedHistory);
    // 应用保留策略（7天+1000条限制）和倒序排序
    const filteredHistory = filterHistory(normalizedHistory);
    // 如果数据被过滤，保存清理后的结果
    if (filteredHistory.length !== parsedHistory.length) {
      // 只保存到 localStorage，避免与后续 IndexedDB 加载冲突
      try {
        safeStorage.set('history', JSON.stringify(filteredHistory));
      } catch (e) {
        
      }
    }

    const storedIndent = safeStorage.get('indent');
    const state = {
      theme: safeStorage.get('theme') || 'dark',
      layoutMode: safeStorage.get('layoutMode') || 'top',
      navCollapsed: safeStorage.get('navCollapsed') === 'true',
      indent: storedIndent === 'tab' ? 'tab' : (parseInt(storedIndent) || 2),
      font: safeStorage.get('font') || 'JetBrains Mono',
      fontSize: safeStorage.get('fontSize') || '16px',
      enableHistory: safeStorage.get('enableHistory') !== 'false', // 默认开启
      history: filteredHistory, // 初始值来自localStorage，IndexedDB加载后会优先使用
      skipHistoryCount: 0,
      skipNextHistory: false
    };

    // 异步初始化IndexedDB并加载历史记录（IndexedDB优先）
    (async function initIndexedDBAndLoadHistory() {
        try {
            // 等待IndexedDB初始化
            await safeStorage._init();

            if (safeStorage._db) {
                // 从IndexedDB加载历史记录
                try {
                    const idbHistory = await safeStorage.getAllHistory();

                    if (idbHistory && idbHistory.length > 0) {
                        // 应用保留策略
                        const normalizedHistory = normalizeHistory(idbHistory);
                        const filteredIdbHistory = filterHistory(normalizedHistory);

                        // 合并策略：合并 IndexedDB 数据和当前 state.history，避免丢失加载期间的新记录
                        // 使用完整内容作为键，避免碰撞
                        const mergedMap = new Map();
                        const mergeKey = (item) => `${item.ts}_${item.type}_${item.full}`;
                        for (const item of filteredIdbHistory) {
                            mergedMap.set(mergeKey(item), item);
                        }
                        // state.history 中的记录（可能包含加载期间新增的）
                        for (const item of state.history) {
                            mergedMap.set(mergeKey(item), item);
                        }
                        const mergedHistory = Array.from(mergedMap.values());

                        // 再次过滤以确保符合保留策略
                        const finalHistory = filterHistory(mergedHistory);

                        // 检查是否需要保存：只在数据被过滤清理或有新增记录时才保存
                        const idbNormalized = normalizeHistory(idbHistory);
                        const idbFiltered = filterHistory(idbNormalized);
                        const needsSave = finalHistory.length !== idbFiltered.length ||
                                          JSON.stringify(finalHistory) !== JSON.stringify(idbFiltered);

                        state.history = finalHistory;
                        renderHistory();

                        // 只在需要时同步到存储（避免刷新时重复保存）
                        if (needsSave) {
                            saveHistoryArray(finalHistory);
                        }
                    } else {
                        // 如果IndexedDB为空但有localStorage数据，同步到IndexedDB
                        if (state.history.length > 0) {
                            saveHistoryArray(state.history);
                        }
                    }
                } catch (loadError) {
                    
                }
            }
        } catch (error) {
            
        }
    })();

    function updateIndentConfig() {
        const val = state.indent;
        // 文本域缩进对齐
        let tabSize = 2;
        if (val === 4) tabSize = 4;
        if (val === 'tab') tabSize = 4;
        
        document.querySelectorAll('textarea, .code-viewer').forEach(el => {
            el.style.tabSize = tabSize;
        });
    }

    function updateFontConfig() {
        const font = state.font;
        const size = state.fontSize;
        const fontStack = `"${font}", "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace`;
        
        document.documentElement.style.setProperty('--code-font', fontStack);
        document.documentElement.style.fontSize = size;
    }

    function updateLayout() {
        const btn = document.getElementById('btn-layout');
        // Reset scroll position to prevent content from being hidden when switching from vertical (scrolled) to horizontal
        const tabList = document.getElementById('main-tab-list') || document.querySelector('.tab-list');
        if (tabList) {
            tabList.scrollTop = 0;
            tabList.scrollLeft = 0;
        }

        if (state.layoutMode === 'left') {
            document.documentElement.setAttribute('data-layout', 'left');
            if(btn) {
                btn.innerHTML = '◫'; 
                btn.title = "切换布局 (当前: 左侧导航)";
                btn.classList.add('is-active'); // 高亮当前激活按钮
            }
        } else {
            document.documentElement.removeAttribute('data-layout');
            if(btn) {
                btn.innerHTML = '☰'; 
                btn.title = "切换布局 (当前: 顶部导航)";
                btn.classList.remove('is-active');
            }
        }
        updateNavCollapseUI();
    }

    function updateNavCollapseUI() {
        const body = document.body;
        if (state.layoutMode === 'left' && state.navCollapsed) {
            body.setAttribute('data-nav-collapsed', 'true');
        } else {
            body.removeAttribute('data-nav-collapsed');
        }
        const navBtn = document.getElementById('btn-toggle-nav');
        if (!navBtn) return;
        const expanded = state.layoutMode !== 'left' ? true : !state.navCollapsed;
        navBtn.setAttribute('aria-expanded', expanded ? 'true' : 'false');
        navBtn.textContent = state.navCollapsed ? '▼' : '▲';
        navBtn.title = state.navCollapsed ? '展开侧边导航' : '折叠菜单';
    }

    function toggleLayout() {
        state.layoutMode = state.layoutMode === 'left' ? 'top' : 'left';
        saveSetting('layoutMode', state.layoutMode);
        updateLayout();
    }

    function toggleNavCollapse() {
        if (state.layoutMode !== 'left') return;
        state.navCollapsed = !state.navCollapsed;
        saveSetting('navCollapsed', state.navCollapsed ? 'true' : 'false');
        updateNavCollapseUI();
    }

    // 通用设置保存函数 - 使用safeStorage（自动处理IndexedDB和localStorage）
    function saveSetting(key, value) {
        safeStorage.set(key, value);
    }

    // 输入内容保存函数 - 使用safeStorage（自动处理IndexedDB和localStorage）
    function saveInput(key, value) {
        safeStorage.set(key, value);
    }

    // 应用历史记录保留策略：7天 + 1000条限制
    function filterHistory(historyArray) {
        // 空值检查
        if (!historyArray || !Array.isArray(historyArray)) {
            console.warn('filterHistory: 无效的输入数据');
            return [];
        }

        const now = Date.now();
        const sevenDaysAgo = now - (HISTORY_RETENTION_DAYS * 24 * 60 * 60 * 1000);

        // 先按时间过滤（保留最近7天），同时过滤无效项
        let filteredHistory = historyArray.filter(item => {
            if (!item || typeof item !== 'object') return false;
            const ts = Number.isFinite(item.ts) ? item.ts : 0;
          return ts >= sevenDaysAgo;
        });

        // 倒序排序：最新的在前面（时间戳大的在前）
        filteredHistory.sort((a, b) => {
          const aTs = Number.isFinite(a.ts) ? a.ts : 0;
          const bTs = Number.isFinite(b.ts) ? b.ts : 0;
          return bTs - aTs;
        });

        // 如果超过1000条，保留最近的1000条（由于已倒序，取前1000条）
        if (filteredHistory.length > HISTORY_MAX) {
            filteredHistory = filteredHistory.slice(0, HISTORY_MAX);
        }

        return filteredHistory;
    }

    // 保存锁，防止并发保存
    let saveHistoryLock = false;
    let pendingSaveData = null;
    let hasPendingSave = false;
    let initWaitingCount = 0; // 等待初始化的请求数统计

    // 保存锁超时机制
    const LOCK_TIMEOUT = 5000; // 5秒超时
    let lockTimer = null;

    function acquireSaveLock() {
        if (saveHistoryLock) {
            const elapsed = lockTimer ? (Date.now() - lockTimer.timestamp) : LOCK_TIMEOUT + 1;
            if (elapsed > LOCK_TIMEOUT) {
                console.warn('保存锁超时，强制释放');
                if (lockTimer && lockTimer.timeoutId) {
                    clearTimeout(lockTimer.timeoutId);
                }
                saveHistoryLock = false;
            } else {
                return false;
            }
        }
        saveHistoryLock = true;
        lockTimer = {
            timestamp: Date.now(),
            timeoutId: setTimeout(() => {
                if (saveHistoryLock) {
                    console.error('保存锁超时！');
                    saveHistoryLock = false;
                }
            }, LOCK_TIMEOUT)
        };
        return true;
    }

    function releaseSaveLock() {
        if (lockTimer && lockTimer.timeoutId) {
            clearTimeout(lockTimer.timeoutId);
        }
        saveHistoryLock = false;
        lockTimer = null;
    }

    // 历史记录保存函数 - 专门处理大数组
    function saveHistoryArray(historyArray, retryCount = 0) {
        const MAX_RETRY = 2;
        if (retryCount > MAX_RETRY) {
            return;
        }

        if (!historyArray || !Array.isArray(historyArray)) {
            console.error('saveHistoryArray: 无效的输入数据');
            return;
        }

        const historyString = JSON.stringify(historyArray);

        // 1. 尝试保存到localStorage
        let localStorageSuccess = false;
        let arrayToSave = historyArray;

        try {
            safeStorage.set('history', historyString);
            localStorageSuccess = true;
        } catch (e) {
            if (e.name === 'QuotaExceededError') {
                const recentHistory = historyArray.slice(0, 100);
                const recentString = JSON.stringify(recentHistory);
                try {
                    safeStorage.set('history', recentString);
                    localStorageSuccess = true;
                } catch (e2) {
                    showToast('localStorage空间不足，将保存到本地数据库');
                }
            }
        }

        // 2. 异步保存到IndexedDB
        if (!acquireSaveLock()) {
            // 锁已被占用，合并待保存的数据
            if (hasPendingSave) {
                const mergedMap = new Map();
                const addKey = (item) => `${item.ts}_${item.type}`;
                for (const item of pendingSaveData) {
                    mergedMap.set(addKey(item), item);
                }
                for (const item of historyArray) {
                    mergedMap.set(addKey(item), item);
                }
                pendingSaveData = Array.from(mergedMap.values());
            } else {
                pendingSaveData = historyArray;
                hasPendingSave = true;
            }
            return;
        }

        hasPendingSave = false;

        // 等待 IndexedDB 初始化完成
        if (!safeStorage._ready) {
            initWaitingCount = Math.min(initWaitingCount + 1, 100);

            if (safeStorage._initPromise) {
                safeStorage._initPromise.then(() => {
                    initWaitingCount = 0;
                    releaseSaveLock();
                    saveHistoryArray(historyArray, retryCount + 1);
                }).catch(err => {
                    initWaitingCount = 0;
                    releaseSaveLock();
                    console.error('IndexedDB初始化失败', err);
                });
            } else {
                safeStorage._init().then(() => {
                    initWaitingCount = 0;
                    releaseSaveLock();
                    saveHistoryArray(historyArray, retryCount + 1);
                }).catch(err => {
                    initWaitingCount = 0;
                    releaseSaveLock();
                    console.error('IndexedDB初始化失败', err);
                });
            }
            return;
        }

        // 清空后重新保存所有记录到IndexedDB
        safeStorage.clearHistory().then((cleared) => {
            if (!cleared) {
                console.error('清空历史记录失败，取消保存操作');
                releaseSaveLock();
                return;
            }

            const batchSize = 50;
            let failedCount = 0;
            const saveBatch = async (startIndex) => {
                const batch = arrayToSave.slice(startIndex, startIndex + batchSize);
                if (batch.length === 0) return;

                for (const item of batch) {
                    try {
                        await safeStorage.addHistory(item);
                    } catch (e) {
                        failedCount++;
                    }
                }

                if (startIndex + batchSize < arrayToSave.length) {
                    await saveBatch(startIndex + batchSize);
                }
            };

            return saveBatch(0);
        }).then(() => {
            if (!localStorageSuccess) {
                showToast('历史记录已保存到本地数据库');
            }
        }).catch(idbError => {
            console.error('IndexedDB保存失败', idbError);
            if (!localStorageSuccess) {
                showToast('历史记录保存失败，请检查浏览器存储权限');
            }
        }).finally(() => {
            releaseSaveLock();

            if (hasPendingSave && pendingSaveData !== null) {
                const dataToSave = pendingSaveData;
                pendingSaveData = null;
                hasPendingSave = false;
                const filteredData = filterHistory(dataToSave);
                saveHistoryArray(filteredData, 0);
            }
        });
    }

    // --- Worker 设置 ---
    const workerCode = `
self.onmessage = function(e) {
  var data = e.data || {};
  var type = data.type;
  var content = data.content;
  var options = data.options || {};
  var indentSize = (options && options.indent != null) ? options.indent : 2;
  if (indentSize === 'tab') indentSize = '\\t';
  var indentChar = typeof indentSize === 'number' ? ' '.repeat(indentSize) : indentSize;

  try {
    var result;
    switch (type) {
      case 'json-format':
        var obj = JSON.parse(content);
        result = JSON.stringify(obj, null, indentSize);
        self.postMessage({ type: type, result: result, data: obj, success: true });
        break;
      case 'json-minify':
        var minObj = JSON.parse(content);
        result = JSON.stringify(minObj);
        self.postMessage({ type: type, result: result, data: minObj, success: true });
        break;
      case 'json-minify-escape':
        var objEsc = JSON.parse(content);
        var minified = JSON.stringify(objEsc);
        // 转义：即再次 stringify
        result = JSON.stringify(minified);
        self.postMessage({ type: type, result: result, data: objEsc, success: true });
        break;
      case 'json-unescape':
        var unescaped = jsonUnescapeLogic(content, indentSize);
        self.postMessage({ type: type, result: unescaped.result, data: unescaped.data, success: true });
        break;
      case 'sql-format':
        result = beautifySql(content, indentChar);
        self.postMessage({ type: type, result: result, success: true });
        break;
      case 'sql-minify':
        result = (content || '').replace(/\\s+/g, ' ').trim();
        self.postMessage({ type: type, result: result, success: true });
        break;
      case 'sql-upper':
        result = (content || '').toUpperCase();
        self.postMessage({ type: type, result: result, success: true });
        break;
      case 'sql-lower':
        result = (content || '').toLowerCase();
        self.postMessage({ type: type, result: result, success: true });
        break;
      default:
        self.postMessage({ type: type, error: 'Unknown action', success: false });
    }
  } catch (err) {
    self.postMessage({ type: type, error: (err && err.message) ? err.message : String(err), success: false });
  }
};

${beautifySql.toString()}
${jsonUnescapeLogic.toString()}
`;

    let worker;
    try {
      const blob = new Blob([workerCode], { type: 'text/javascript' });
      const workerUrl = URL.createObjectURL(blob);
      worker = new Worker(workerUrl);
      try { URL.revokeObjectURL(workerUrl); } catch (_) {}
      worker.onmessage = handleWorkerMessage;
      worker.onerror = (e) => {
        try { if (e && typeof e.preventDefault === 'function') e.preventDefault(); } catch (_) {}
        
        try { if (worker && typeof worker.terminate === 'function') worker.terminate(); } catch (_) {}
        worker = null;
      };
    } catch (e) {
      
      worker = null;
    }

    // --- 模拟数据生成 ---
    const mockData = {
        banks: {
            "ICBC": { name: "中国工商银行", bin: ["622202", "622208", "621225", "621226", "620058", "621281"], len: 19, color: "#C8102E" },
            "ABC": { name: "中国农业银行", bin: ["622848", "622845", "622828", "622837", "622848"], len: 19, color: "#009174" },
            "BOC": { name: "中国银行", bin: ["621660", "621661", "621663", "621667"], len: 19, color: "#B22222" },
            "CCB": { name: "中国建设银行", bin: ["622700", "622280", "621700", "436742", "436745"], len: 19, color: "#093687" },
            "BCOM": { name: "交通银行", bin: ["622260", "622262", "601428", "622261"], len: 17, color: "#003366" },
            "PSBC": { name: "中国邮政储蓄银行", bin: ["621095", "621096", "621098", "622188", "95580"], len: 19, color: "#007E3E" },
            "CMB": { name: "招商银行", bin: ["622580", "622588", "621483", "621485", "622575"], len: 16, color: "#BF1E2D" },
            "CEB": { name: "光大银行", bin: ["622660", "622670", "622680"], len: 16, color: "#6a1683" },
            "HXB": { name: "华夏银行", bin: ["622630", "622632", "622633"], len: 16, color: "#FF0000" },
            "CMSB": { name: "民生银行", bin: ["622622", "622600", "622602"], len: 16, color: "#0073B7" },
            "GDB": { name: "广发银行", bin: ["622568", "622556", "622568"], len: 16, color: "#E60012" },
            "PAB": { name: "平安银行", bin: ["622298", "622908", "622909"], len: 16, color: "#EA5504" },
            "CIB": { name: "兴业银行", bin: ["622901", "622908", "622909"], len: 18, color: "#004185" },
            "SPDB": { name: "浦发银行", bin: ["622521", "622522", "622523"], len: 16, color: "#002D72" },
            "CITIC": { name: "中信银行", bin: ["622689", "622690", "622691"], len: 16, color: "#D7000F" }
        }
    };

    let regionTree = null;

    // 离线数据集（简化版本，方便离线使用）
    const OFFLINE_REGION_DATA = [
      { name: "北京市", code: "110000", children: [{ name: "市辖区", code: "110100", areaCode: "010", children: [{ name: "东城区", code: "110101" }, { name: "西城区", code: "110102" }, { name: "朝阳区", code: "110105" }, { name: "丰台区", code: "110106" }, { name: "海淀区", code: "110108" }] }] },
      { name: "天津市", code: "120000", children: [{ name: "市辖区", code: "120100", areaCode: "022", children: [{ name: "和平区", code: "120101" }, { name: "河东区", code: "120102" }, { name: "南开区", code: "120104" }] }] },
      { name: "河北省", code: "130000", children: [{ name: "石家庄市", code: "130100", areaCode: "0311", children: [{ name: "长安区", code: "130102" }, { name: "桥西区", code: "130104" }] }, { name: "唐山市", code: "130200", areaCode: "0315", children: [{ name: "路南区", code: "130202" }, { name: "路北区", code: "130203" }] }] },
      { name: "山西省", code: "140000", children: [{ name: "太原市", code: "140100", areaCode: "0351", children: [{ name: "小店区", code: "140105" }, { name: "迎泽区", code: "140106" }] }] },
      { name: "辽宁省", code: "210000", children: [{ name: "沈阳市", code: "210100", areaCode: "024", children: [{ name: "和平区", code: "210102" }, { name: "沈河区", code: "210103" }] }, { name: "大连市", code: "210200", areaCode: "0411", children: [{ name: "中山区", code: "210202" }, { name: "西岗区", code: "210203" }] }] },
      { name: "上海市", code: "310000", children: [{ name: "市辖区", code: "310100", areaCode: "021", children: [{ name: "黄浦区", code: "310101" }, { name: "徐汇区", code: "310104" }, { name: "长宁区", code: "310105" }, { name: "静安区", code: "310106" }, { name: "浦东新区", code: "310115" }] }] },
      { name: "江苏省", code: "320000", children: [{ name: "南京市", code: "320100", areaCode: "025", children: [{ name: "玄武区", code: "320102" }, { name: "秦淮区", code: "320104" }] }, { name: "苏州市", code: "320500", areaCode: "0512", children: [{ name: "姑苏区", code: "320508" }, { name: "吴中区", code: "320506" }] }] },
      { name: "浙江省", code: "330000", children: [{ name: "杭州市", code: "330100", areaCode: "0571", children: [{ name: "上城区", code: "330102" }, { name: "拱墅区", code: "330105" }, { name: "西湖区", code: "330106" }] }, { name: "宁波市", code: "330200", areaCode: "0574", children: [{ name: "海曙区", code: "330203" }, { name: "江北区", code: "330205" }] }] },
      { name: "福建省", code: "350000", children: [{ name: "福州市", code: "350100", areaCode: "0591", children: [{ name: "鼓楼区", code: "350102" }, { name: "台江区", code: "350103" }] }, { name: "厦门市", code: "350200", areaCode: "0592", children: [{ name: "思明区", code: "350203" }, { name: "海沧区", code: "350205" }] }] },
      { name: "山东省", code: "370000", children: [{ name: "济南市", code: "370100", areaCode: "0531", children: [{ name: "历下区", code: "370102" }, { name: "市中区", code: "370103" }] }, { name: "青岛市", code: "370200", areaCode: "0532", children: [{ name: "市南区", code: "370202" }, { name: "市北区", code: "370203" }] }] },
      { name: "河南省", code: "410000", children: [{ name: "郑州市", code: "410100", areaCode: "0371", children: [{ name: "中原区", code: "410102" }, { name: "二七区", code: "410103" }, { name: "金水区", code: "410105" }] }] },
      { name: "湖北省", code: "420000", children: [{ name: "武汉市", code: "420100", areaCode: "027", children: [{ name: "江岸区", code: "420102" }, { name: "江汉区", code: "420103" }, { name: "武昌区", code: "420106" }] }] },
      { name: "湖南省", code: "430000", children: [{ name: "长沙市", code: "430100", areaCode: "0731", children: [{ name: "芙蓉区", code: "430102" }, { name: "天心区", code: "430103" }] }] },
      { name: "广东省", code: "440000", children: [{ name: "广州市", code: "440100", areaCode: "020", children: [{ name: "荔湾区", code: "440103" }, { name: "越秀区", code: "440104" }, { name: "海珠区", code: "440105" }, { name: "天河区", code: "440106" }] }, { name: "深圳市", code: "440300", areaCode: "0755", children: [{ name: "罗湖区", code: "440303" }, { name: "福田区", code: "440304" }, { name: "南山区", code: "440305" }] }] },
      { name: "重庆市", code: "500000", children: [{ name: "市辖区", code: "500100", areaCode: "023", children: [{ name: "万州区", code: "500101" }, { name: "涪陵区", code: "500102" }, { name: "渝中区", code: "500103" }] }] },
      { name: "四川省", code: "510000", children: [{ name: "成都市", code: "510100", areaCode: "028", children: [{ name: "锦江区", code: "510104" }, { name: "青羊区", code: "510105" }, { name: "武侯区", code: "510107" }] }] },
      { name: "陕西省", code: "610000", children: [{ name: "西安市", code: "610100", areaCode: "029", children: [{ name: "新城区", code: "610102" }, { name: "碑林区", code: "610103" }, { name: "雁塔区", code: "610113" }] }] }
    ];

    function loadRegionData() {
        const provinceSelect = document.getElementById('mock-province');
        const citySelect = document.getElementById('mock-city');
        const districtSelect = document.getElementById('mock-district');
        
        try {
            regionTree = OFFLINE_REGION_DATA;
            
            provinceSelect.innerHTML = '';
            regionTree.forEach((p, idx) => {
                 const opt = document.createElement('option');
                 opt.value = idx;
                 opt.textContent = p.name;
                 provinceSelect.appendChild(opt);
            });
            
            provinceSelect.onchange = () => {
                 const pIdx = provinceSelect.value;
                 safeStorage.set('mock-province', pIdx); // Save Province
                 const cities = regionTree[pIdx].children || [];
                 citySelect.innerHTML = '';
                 cities.forEach((c, cIdx) => {
                     const opt = document.createElement('option');
                     opt.value = cIdx;
                     opt.textContent = c.name;
                     citySelect.appendChild(opt);
                 });
                 if(cities.length > 0) {
                    citySelect.selectedIndex = Math.floor(Math.random() * cities.length);
                    citySelect.onchange();
                 } else {
                     citySelect.innerHTML = '<option value="-1">--</option>';
                     districtSelect.innerHTML = '<option value="-1">--</option>';
                     safeStorage.set('mock-city', '-1');
                     safeStorage.set('mock-district', '-1');
                 }
            };

            citySelect.onchange = () => {
                 const pIdx = provinceSelect.value;
                 const cIdx = citySelect.value;
                 safeStorage.set('mock-city', cIdx); // Save City
                 if(cIdx == -1) return;
                 const districts = regionTree[pIdx].children[cIdx].children || [];
                 districtSelect.innerHTML = '';
                 districts.forEach((d, dIdx) => {
                     const opt = document.createElement('option');
                     opt.value = dIdx;
                     opt.textContent = d.name;
                     districtSelect.appendChild(opt);
                 });
                 if(districts.length > 0) {
                     districtSelect.selectedIndex = Math.floor(Math.random() * districts.length);
                 } else {
                     districtSelect.innerHTML = '<option value="-1">--</option>';
                 }
                 // Trigger district save
                 districtSelect.onchange(); 
            };
            
            districtSelect.onchange = () => {
                safeStorage.set('mock-district', districtSelect.value);
            };

            // 初始化地区选择（优先使用本地保存，否则随机）
            const savedP = safeStorage.get('mock-province');
            if (savedP !== null && regionTree[savedP]) {
                provinceSelect.value = savedP;
                provinceSelect.onchange();
                const savedC = safeStorage.get('mock-city');
                if (savedC !== null && citySelect.options[savedC]) {
                    citySelect.value = savedC;
                    citySelect.onchange();
                    const savedD = safeStorage.get('mock-district');
                    if (savedD !== null && districtSelect.options[savedD]) {
                        districtSelect.value = savedD;
                    }
                }
            } else {
                provinceSelect.selectedIndex = Math.floor(Math.random() * regionTree.length);
                provinceSelect.onchange();
            }
            
        } catch (e) {
            
            provinceSelect.innerHTML = '<option>加载失败</option>';
        }
    }

    function initMock() {
        const bankInput = document.getElementById('mock-bank');
        const container = document.getElementById('bank-select-container');
        const display = document.getElementById('bank-selected-display');
        const dropdown = document.getElementById('bank-options-dropdown');
        const searchInput = document.getElementById('bank-search-input');
        const optionsList = document.getElementById('bank-options-list');
        
        // 准备银行列表数据
        const banks = Object.keys(mockData.banks).map(k => ({ key: k, ...mockData.banks[k] }));
        
        // 按 key 字母排序
        banks.sort((a, b) => a.key.localeCompare(b.key));

        // 渲染下拉选项
        function renderOptions(filter = '') {
            optionsList.innerHTML = '';
            const f = filter.toLowerCase();
            banks.filter(b => b.name.includes(f) || b.key.toLowerCase().includes(f)).forEach(b => {
                const div = document.createElement('div');
                div.className = 'option-item';
                if(b.key === bankInput.value) div.classList.add('selected');
                div.innerHTML = `
                    <div class="bank-logo" style="background:${b.color}">${b.key[0]}</div>
                    <div>${b.name}</div>
                `;
                div.onclick = (e) => {
                    e.stopPropagation();
                    selectBank(b.key);
                    dropdown.classList.remove('show');
                };
                optionsList.appendChild(div);
            });
            if(optionsList.children.length === 0) {
                 optionsList.innerHTML = '<div style="padding:0.5rem; color:var(--muted); text-align:center;">无匹配结果</div>';
            }
        }

        function selectBank(key) {
            bankInput.value = key;
            const b = mockData.banks[key];
            if(b) {
                display.innerHTML = `
                    <span style="display:flex; align-items:center;">
                        <span class="bank-logo" style="background:${b.color}">${key[0]}</span>
                        <span>${b.name}</span>
                    </span>
                    <span style="font-size: 0.8rem; color: var(--muted);">▼</span>
                `;
            }
        }

        // 下拉交互事件
        display.onclick = (e) => {
            e.stopPropagation();
            dropdown.classList.toggle('show');
            if(dropdown.classList.contains('show')) {
                searchInput.value = '';
                renderOptions();
                searchInput.focus();
            }
        };

        searchInput.oninput = (e) => {
            renderOptions(e.target.value);
        };
        
        searchInput.onclick = (e) => e.stopPropagation();

        document.addEventListener('click', (e) => {
            if(!container.contains(e.target)) {
                dropdown.classList.remove('show');
            }
        });

        // 初始化随机选择或使用已保存的银行
        const savedBank = safeStorage.get('mock-bank');
        if (savedBank && mockData.banks[savedBank]) {
            selectBank(savedBank);
        } else {
            const randomKey = banks[Math.floor(Math.random() * banks.length)].key;
            selectBank(randomKey);
        }
        
        // 加载其他 Mock 相关设置
        const ageInput = document.getElementById('mock-age');
        const genderInput = document.getElementById('mock-gender');
        const cardTypeInput = document.getElementById('mock-card-type');
        
        if (ageInput) ageInput.value = safeStorage.get('mock-age') || '25';
        if (genderInput) genderInput.value = safeStorage.get('mock-gender') || 'M';
        if (cardTypeInput) cardTypeInput.value = safeStorage.get('mock-card-type') || 'DC';

        document.getElementById('mock-reset').onclick = () => {
            if(regionTree) {
                 const pSel = document.getElementById('mock-province');
                 pSel.selectedIndex = Math.floor(Math.random() * pSel.options.length);
                 pSel.onchange();
            }
            const ageInput = document.getElementById('mock-age');
            const genderInput = document.getElementById('mock-gender');
            ageInput.value = 18 + Math.floor(Math.random() * 60);
            genderInput.value = Math.random() > 0.5 ? 'M' : 'F';
            
            safeStorage.set('mock-age', ageInput.value);
            safeStorage.set('mock-gender', genderInput.value);

            const rKey = banks[Math.floor(Math.random() * banks.length)].key;
            selectBank(rKey);
            safeStorage.set('mock-bank', rKey);
            
            showToast('已重置为随机值');
        };

        document.getElementById('btn-generate').onclick = generateInfo;
        document.getElementById('btn-copy-all').onclick = () => {
            const output = document.getElementById('mock-output');
            const data = output.dataset.json;
            if(data) copyText(data);
        };
        
        loadRegionData();
    }

    function generateInfo() {
        if(!regionTree) return showToast('行政区划数据未加载');
        
        const pIdx = document.getElementById('mock-province').value;
        const cIdx = document.getElementById('mock-city').value;
        const dIdx = document.getElementById('mock-district').value;
        
        const province = regionTree[pIdx];
        const city = province.children[cIdx];
        const district = city && city.children ? city.children[dIdx] : null;
        
        if(!province || !city) return showToast('请选择有效的省市区');

        const age = parseInt(document.getElementById('mock-age').value);
        const gender = document.getElementById('mock-gender').value;
        const bankKey = document.getElementById('mock-bank').value;
        const cardType = document.getElementById('mock-card-type').value;

        // 保存当前 Mock 参数设置
        safeStorage.set('mock-province', pIdx);
        safeStorage.set('mock-city', cIdx);
        safeStorage.set('mock-district', dIdx);
        safeStorage.set('mock-age', age);
        safeStorage.set('mock-gender', gender);
        safeStorage.set('mock-bank', bankKey);
        safeStorage.set('mock-card-type', cardType);

          // 生日
        const year = new Date().getFullYear() - age;
        const month = Math.floor(Math.random() * 12) + 1;
        const day = Math.floor(Math.random() * 28) + 1;
        const dob = `${year}${month.toString().padStart(2,'0')}${day.toString().padStart(2,'0')}`;
        
          // 身份证号
        const regionCode = district ? district.code : city.code; 
        const idCard = generateIDCard(regionCode, dob, gender);
        
          // 地址
        const roads = ['人民路', '建设路', '解放路', '和平路', '中华路', '长安街', '南京路', '中山路', '北京路'];
        const communities = ['幸福小区', '阳光花园', '锦绣家园', '金地国际', '万科城', '恒大绿洲', '碧桂园'];
        const road = roads[Math.floor(Math.random() * roads.length)];
        const comm = communities[Math.floor(Math.random() * communities.length)];
        const no = Math.floor(Math.random() * 900) + 1;
        const room = Math.floor(Math.random() * 30) + 1 + '0' + (Math.floor(Math.random() * 5) + 1);
        
        const addressRegion = `${province.name}${city.name}${district ? district.name : ''}`;
        const addressStreet = `${road}${no}号`;
        const addressDetail = `${comm}${room}室`;
        const address = `${addressRegion}${addressStreet}${addressDetail}`;
        
        // 银行卡号
        const bank = mockData.banks[bankKey];
        const bankCard = generateBankCard(bank, cardType);
        
        // 姓名
        const commonSurnames = "李王张刘陈杨赵黄周吴徐孙胡朱高林何郭马罗".split("");
        const allSurnames = "赵钱孙李周吴郑王冯陈褚卫蒋沈韩杨朱秦尤许何吕施张孔曹严华金魏陶姜戚谢邹喻柏水窦章云苏潘葛奚范彭郎鲁韦昌马苗凤花方俞任袁柳酆鲍史唐费廉岑薛雷贺倪汤滕殷罗毕郝邬安常乐于时傅皮卞齐康伍余元卜顾孟平黄和穆萧尹姚邵湛汪祁毛禹狄米贝明臧计伏成戴谈宋茅庞熊纪舒屈项祝董梁杜阮蓝闵席季麻强贾路娄危江童颜郭梅盛林刁钟徐邱骆高夏蔡田樊胡凌霍虞万支柯昝管卢莫经房裘缪干解应宗丁宣贲邓郁单杭洪包诸左石崔吉钮龚".split("");
        
        // 80% 概率使用常见前二十姓氏
        const surname = Math.random() < 0.8 
            ? commonSurnames[Math.floor(Math.random() * commonSurnames.length)]
            : allSurnames[Math.floor(Math.random() * allSurnames.length)];

        const names = "伟刚勇军磊洋艳杰娟强明霞秀兰英华敏静丽强平邦军建文奇正欣海龙晨宇帆婷瑞雪".split("");
        const name = surname + 
                     names[Math.floor(Math.random() * names.length)] + 
                     (Math.random() > 0.5 ? names[Math.floor(Math.random() * names.length)] : '');

        // 手机号与邮箱
        const mobile = '1' + (3 + Math.floor(Math.random() * 7)) + Math.floor(Math.random() * 1000000000).toString().substring(0, 9);
        const domains = ['163.com', 'qq.com', '126.com', 'sina.com', 'aliyun.com', 'sohu.com'];
        const domain = domains[Math.floor(Math.random() * domains.length)];
          // 使用随机字符串作为邮箱用户名部分以更逼真
        const userPart = Math.random().toString(36).substring(2, 8 + Math.floor(Math.random() * 4)); 
        const email = `${userPart}@${domain}`;

          // 邮编：根据地区编码生成（前 4 位 + 随机 2 位数字）
        const baseCode = district ? district.code.substring(0, 4) : city.code.substring(0, 4);
        const postalCode = baseCode + (Math.floor(Math.random() * 90) + 10);

        const resultObj = {
            name,
            gender: gender === 'M' ? '男' : '女',
            age,
            idCard,
            mobile,
            email,
            postalCode,
            addressRegion,
            addressStreet,
            addressDetail,
            address,
            bank: bank.name,
            bankCard
        };
        
        addToHistory('mock', JSON.stringify(resultObj, null, 2));
        renderMockResult(resultObj);
    }

    function generateIDCard(regionCode, dob, gender) {
        let base = regionCode + dob;
        
        // 顺序码 3 位，第 17 位奇数表示男，偶数表示女
        let seqNum = Math.floor(Math.random() * 500) * 2; // 0..998（偶数）
        if (gender === 'M') seqNum += 1; // 1..999（奇数）
        
        let seq = seqNum.toString().padStart(3, '0');
        base += seq;
        
        const weights = [7, 9, 10, 5, 8, 4, 2, 1, 6, 3, 7, 9, 10, 5, 8, 4, 2];
        const codes = ['1', '0', 'X', '9', '8', '7', '6', '5', '4', '3', '2'];
        let sum = 0;
        for(let i=0; i<17; i++) {
            sum += parseInt(base[i]) * weights[i];
        }
        const check = codes[sum % 11];
        return base + check;
    }

    function generateBankCard(bank, type) {
        const bin = bank.bin[Math.floor(Math.random() * bank.bin.length)];
        const len = bank.len;
        let card = bin;
        while(card.length < len - 1) {
            card += Math.floor(Math.random() * 10);
        }
        
        let sum = 0;
        let isEven = true;
        for (let i = card.length - 1; i >= 0; i--) {
            let digit = parseInt(card.charAt(i));
            if (isEven) {
                digit *= 2;
                if (digit > 9) digit -= 9;
            }
            sum += digit;
            isEven = !isEven;
        }
        const check = (10 - (sum % 10)) % 10;
        return card + check;
    }

    function renderMockResult(data) {
        const container = document.getElementById('mock-output');
        container.innerHTML = '';
        container.dataset.json = JSON.stringify(data, null, 2);
        
        const groups = [
            { title: '基本信息', items: [
                { k: '姓名', v: data.name },
                { k: '性别', v: data.gender },
                { k: '年龄', v: data.age + '岁' },
                { k: '手机号', v: data.mobile },
                { k: '电子邮箱', v: data.email },
                { k: '身份证号', v: data.idCard }
            ]},
            { title: '地址信息', items: [
                { k: '邮政编码', v: data.postalCode },
                { k: '行政区划', v: data.addressRegion },
                { k: '街道信息', v: data.addressStreet },
                { k: '详细住址', v: data.addressDetail },
                { k: '完整地址', v: data.address }
            ]},
            { title: '银行卡信息', items: [
                { k: '开户行', v: data.bank },
                { k: '卡号', v: data.bankCard }
            ]}
        ];
        
        groups.forEach(g => {
            const card = document.createElement('div');
            card.className = 'result-card';
            
            const title = document.createElement('div');
            title.className = 'result-group-title';
            title.textContent = g.title;
            card.appendChild(title);
            
            g.items.forEach(item => {
                const row = document.createElement('div');
                row.className = 'result-row';
                
                const label = document.createElement('span');
                label.className = 'result-label';
                label.textContent = item.k;
                
                const valDiv = document.createElement('div');
                valDiv.style.display = 'flex';
                valDiv.style.alignItems = 'center';
                
                const val = document.createElement('span');
                val.className = 'result-value';
                val.textContent = item.v;
                
                const copy = document.createElement('span');
                copy.className = 'copy-icon';
                copy.textContent = '📋';
                copy.title = '复制';
                copy.onclick = () => copyText(item.v);
                
                valDiv.appendChild(val);
                valDiv.appendChild(copy);
                
                row.appendChild(label);
                row.appendChild(valDiv);
                card.appendChild(row);
            });
            
            container.appendChild(card);
        });
        showToast('生成成功');
    }

    // --- 导航栏排序 ---
    function initNavSort() {
        const tabList = document.querySelector('.tab-list');
        if (!tabList) return;

        // 先用 localStorage 快速恢复，避免页面闪烁
        const localStorageOrder = localStorage.getItem('nav-order');
        if (localStorageOrder) {
            try {
                const order = JSON.parse(localStorageOrder);
                if (Array.isArray(order) && order.length > 0) {
                    applyNavOrder(tabList, order);
                }
            } catch (e) {
                console.warn('解析 localStorage 导航顺序失败', e);
            }
        }

        // 然后 async 从 IndexedDB 读取最新值（可能覆盖 localStorage 的旧值）
        safeStorage.getSetting('nav-order').then(idbOrder => {
            if (idbOrder && idbOrder !== localStorageOrder) {
                try {
                    const order = JSON.parse(idbOrder);
                    if (Array.isArray(order) && order.length > 0) {
                        // 同步到 localStorage
                        localStorage.setItem('nav-order', idbOrder);
                        applyNavOrder(tabList, order);
                    }
                } catch (e) {
                    console.warn('从 IndexedDB 恢复导航顺序失败', e);
                }
            }
        }).catch(() => {});

        function applyNavOrder(tabList, order) {
            const buttonMap = new Map();
            tabList.children.forEach(btn => {
                if (btn.dataset.tab) buttonMap.set(btn.dataset.tab, btn);
            });

            // 按保存的顺序重新排列元素
            order.forEach(tabId => {
                const btn = buttonMap.get(tabId);
                if (btn) tabList.appendChild(btn);
            });
            // 确保没有漏掉的按钮
            buttonMap.forEach(btn => {
                if (!order.includes(btn.dataset.tab)) {
                    tabList.appendChild(btn);
                }
            });
        }

        const isTouch = (window.matchMedia && window.matchMedia('(pointer: coarse)').matches) || ('ontouchstart' in window);
        if (isTouch) {
            tabList.querySelectorAll('.tab-trigger').forEach((btn) => {
                btn.draggable = false;
                btn.setAttribute('draggable', 'false');
            });
        }

        // 2. 绑定拖拽事件
        let draggedItem = null;
        const dropIndicator = document.createElement('div');
        dropIndicator.className = 'tab-drop-indicator';
        tabList.appendChild(dropIndicator);

        function updateDropPosition(target, clientX, clientY) {
            if (!target || target === draggedItem || !draggedItem) return;
            const rect = target.getBoundingClientRect();
            const isVertical = getComputedStyle(tabList).flexDirection === 'column';
            const next = isVertical
              ? (clientY - rect.top) > (rect.height / 2)
              : (clientX - rect.left) > (rect.width / 2);
            if (next) {
                tabList.insertBefore(draggedItem, target.nextSibling);
            } else {
                tabList.insertBefore(draggedItem, target);
            }
            // å®šä½ç‚«é…·æŒ‡ç¤ºçº?
            const listRect = tabList.getBoundingClientRect();
            const pos = next ? rect.right - listRect.left : rect.left - listRect.left;
            dropIndicator.style.transform = isVertical
              ? `translateY(${(next ? rect.bottom - listRect.top : rect.top - listRect.top)}px)`
              : `translateX(${pos}px)`;
            dropIndicator.classList.add('active');
        }

        if (isTouch) {
            let dragging = false;
            let activePointerId = null;
            let pressTimer = null;
            let startX = 0;
            let startY = 0;
            let suppressClickUntil = 0;
            const longPressMs = 300;
            const moveCancelThreshold = 8;

            function startDragging(item) {
                dragging = true;
                draggedItem = item;
                draggedItem.classList.add('dragging');
                tabList.classList.add('dragging');
                tabList.style.touchAction = 'none';
                tabList.style.userSelect = 'none';
                try { if (navigator.vibrate) navigator.vibrate(50); } catch(_) {}
            }

            function stopDragging() {
                if (pressTimer) {
                    clearTimeout(pressTimer);
                    pressTimer = null;
                }
                if (dragging && draggedItem) {
                    draggedItem.classList.remove('dragging');
                    tabList.classList.remove('dragging');
                    dropIndicator.classList.remove('active');
                    dropIndicator.style.transform = '';
                    saveNavOrder();
                    suppressClickUntil = Date.now() + 350;
                }
                dragging = false;
                draggedItem = null;
                activePointerId = null;
                tabList.style.touchAction = '';
                tabList.style.userSelect = '';
                
                // Cleanup Global Listeners
                document.removeEventListener('pointermove', onPointerMove);
                document.removeEventListener('pointerup', onPointerUp);
                document.removeEventListener('pointercancel', onPointerUp);
                document.removeEventListener('touchmove', onTouchMove);
                document.removeEventListener('touchend', onTouchEnd);
                document.removeEventListener('touchcancel', onTouchEnd);
            }

            tabList.addEventListener('click', (e) => {
                if (Date.now() < suppressClickUntil) {
                    const btn = e.target.closest('.tab-trigger');
                    if (btn) {
                        e.preventDefault();
                        e.stopPropagation();
                    }
                }
            }, true);

            // --- Pointer Events Handlers ---
            const onPointerMove = (e) => {
                if (activePointerId == null || e.pointerId !== activePointerId) return;
                if (!dragging) {
                    const dx = Math.abs(e.clientX - startX);
                    const dy = Math.abs(e.clientY - startY);
                    if (dx > moveCancelThreshold || dy > moveCancelThreshold) {
                        clearTimeout(pressTimer);
                        pressTimer = null;
                        // Movement detected before long press, cancel drag wait but keep ID for scroll?
                        // Actually better to release everything to allow native scroll
                        activePointerId = null;
                        document.removeEventListener('pointermove', onPointerMove);
                        document.removeEventListener('pointerup', onPointerUp);
                        document.removeEventListener('pointercancel', onPointerUp);
                    }
                    return;
                }
                e.preventDefault();
                const el = document.elementFromPoint(e.clientX, e.clientY);
                const target = el && el.closest ? el.closest('.tab-trigger') : null;
                updateDropPosition(target, e.clientX, e.clientY);
            };

            const onPointerUp = (e) => {
                if (activePointerId != null && e.pointerId === activePointerId) {
                    stopDragging();
                }
            };

            // --- Touch Events Handlers (Fallback) ---
            const onTouchMove = (e) => {
                if (activePointerId == null) return;
                let touch = null;
                for (let i = 0; i < e.changedTouches.length; i++) {
                    if (e.changedTouches[i].identifier === activePointerId) {
                        touch = e.changedTouches[i];
                        break;
                    }
                }
                if (!touch) return;

                if (!dragging) {
                    const dx = Math.abs(touch.clientX - startX);
                    const dy = Math.abs(touch.clientY - startY);
                    if (dx > moveCancelThreshold || dy > moveCancelThreshold) {
                        clearTimeout(pressTimer);
                        pressTimer = null;
                        activePointerId = null;
                        document.removeEventListener('touchmove', onTouchMove);
                        document.removeEventListener('touchend', onTouchEnd);
                        document.removeEventListener('touchcancel', onTouchEnd);
                    }
                    return;
                }
                if (e.cancelable) e.preventDefault();
                const el = document.elementFromPoint(touch.clientX, touch.clientY);
                const target = el && el.closest ? el.closest('.tab-trigger') : null;
                updateDropPosition(target, touch.clientX, touch.clientY);
            };

            const onTouchEnd = (e) => {
                if (activePointerId == null) return;
                for (let i = 0; i < e.changedTouches.length; i++) {
                    if (e.changedTouches[i].identifier === activePointerId) {
                        stopDragging();
                        return;
                    }
                }
            };

            if ('PointerEvent' in window) {
                tabList.addEventListener('pointerdown', (e) => {
                    const btn = e.target.closest('.tab-trigger');
                    if (!btn || (e.button !== undefined && e.button !== 0)) return;
                    
                    // Auto-recovery: force reset if state is stuck
                    if (activePointerId !== null) stopDragging();

                    activePointerId = e.pointerId;
                    startX = e.clientX;
                    startY = e.clientY;

                    try { btn.setPointerCapture(activePointerId); } catch (_) {}
                    
                    // Bind to document to catch release outside element
                    document.addEventListener('pointermove', onPointerMove, { passive: false });
                    document.addEventListener('pointerup', onPointerUp);
                    document.addEventListener('pointercancel', onPointerUp);

                    pressTimer = setTimeout(() => startDragging(btn), longPressMs);
                });
            } else {
                tabList.addEventListener('touchstart', (e) => {
                    const touch = e.changedTouches && e.changedTouches[0];
                    if (!touch) return;
                    const btn = e.target.closest('.tab-trigger');
                    if (!btn) return;
                    
                    if (activePointerId !== null) stopDragging();

                    activePointerId = touch.identifier;
                    startX = touch.clientX;
                    startY = touch.clientY;
                    
                    document.addEventListener('touchmove', onTouchMove, { passive: false });
                    document.addEventListener('touchend', onTouchEnd);
                    document.addEventListener('touchcancel', onTouchEnd);

                    pressTimer = setTimeout(() => startDragging(btn), longPressMs);
                }, { passive: true });
            }

            return;
        }

        tabList.addEventListener('dragstart', (e) => {
            if (e.target.classList.contains('tab-trigger')) {
                draggedItem = e.target;
                e.target.classList.add('dragging');
                tabList.classList.add('dragging');
                e.dataTransfer.effectAllowed = 'move';
            }
        });

        tabList.addEventListener('dragend', (e) => {
            if (e.target.classList.contains('tab-trigger')) {
                e.target.classList.remove('dragging');
                tabList.classList.remove('dragging');
                dropIndicator.classList.remove('active');
                dropIndicator.style.transform = '';
                draggedItem = null;
                saveNavOrder();
            }
        });

        tabList.addEventListener('dragover', (e) => {
            e.preventDefault(); 
            const target = e.target.closest('.tab-trigger');
            if (target && target !== draggedItem && draggedItem) {
                const rect = target.getBoundingClientRect();
                const isVertical = getComputedStyle(tabList).flexDirection === 'column';
                const next = isVertical
                  ? (e.clientY - rect.top) > (rect.height / 2)
                  : (e.clientX - rect.left) > (rect.width / 2);
                if (next) {
                    tabList.insertBefore(draggedItem, target.nextSibling);
                } else {
                    tabList.insertBefore(draggedItem, target);
                }
                // 定位炫酷指示线
                const listRect = tabList.getBoundingClientRect();
                const pos = next ? rect.right - listRect.left : rect.left - listRect.left;
                dropIndicator.style.transform = isVertical
                  ? `translateY(${(next ? rect.bottom - listRect.top : rect.top - listRect.top)}px)`
                  : `translateX(${pos}px)`;
                dropIndicator.classList.add('active');
            }
        });
        
        if (typeof checkTabScroll === 'function') checkTabScroll();
    }

    function saveNavOrder() {
        const tabList = document.querySelector('.tab-list');
        if (!tabList) return;
        const order = Array.from(tabList.children)
            .filter(btn => btn.dataset.tab)
            .map(btn => btn.dataset.tab);
        const orderJson = JSON.stringify(order);

        // 使用 saveSetting 统一保存（和其他设置保持一致）
        saveSetting('nav-order', orderJson);
    }

    // --- DOM 元素引用 ---
    const els = {
      json: { input: document.getElementById('json-input'), output: document.getElementById('json-output') },
      xml: { input: document.getElementById('xml-input'), output: document.getElementById('xml-output') },
      sql: { input: document.getElementById('sql-input'), output: document.getElementById('sql-output') },
      yaml: { input: document.getElementById('yaml-input'), output: document.getElementById('yaml-output') },
      html: { input: document.getElementById('html-fmt-input'), output: document.getElementById('html-fmt-output') },
      javascript: { input: document.getElementById('js-input'), output: document.getElementById('js-output') },
      css: { input: document.getElementById('css-input'), output: document.getElementById('css-output') },
      url: { input: document.getElementById('url-input') },
      timestamp: { input: document.getElementById('ts-input') },
      base64: { input: document.getElementById('base64-img-input') },
      toast: document.getElementById('toast'),
      historyList: document.getElementById('history-list')
    };

    // --- 初始化 ---
    document.documentElement.setAttribute('data-et-theme', state.theme);
    document.getElementById('setting-indent').value = state.indent;
    document.getElementById('setting-font').value = state.font;
    document.getElementById('setting-size').value = state.fontSize;
    document.getElementById('setting-history-enabled').checked = state.enableHistory;

    // 从 localStorage 载入已有输入
    if (els.json.input) els.json.input.value = safeStorage.get('json-input') || '';
    if (els.xml.input) els.xml.input.value = safeStorage.get('xml-input') || '';
    if (els.sql.input) els.sql.input.value = safeStorage.get('sql-input') || '';
    if (els.yaml.input) els.yaml.input.value = safeStorage.get('yaml-input') || '';
    if (els.html.input) els.html.input.value = safeStorage.get('html-fmt-input') || '';
    if (els.javascript.input) els.javascript.input.value = safeStorage.get('js-input') || '';
    if (els.css.input) els.css.input.value = safeStorage.get('css-input') || '';

    updateIndentConfig();
    updateFontConfig();
    updateLayout();
    renderHistory();
    if (typeof initMock === 'function') initMock();
    if (typeof initTools === 'function') initTools();
    if (typeof initJsonSearch === 'function') initJsonSearch();
    if (typeof initXmlSearch === 'function') initXmlSearch();
    initNavSort();

    // 恢复上次使用的工具页
    try {
      const lastTab = safeStorage.get('active-tab');
      if (lastTab && document.querySelector(`.tab-trigger[data-tab="${lastTab}"]`) && document.getElementById(`panel-${lastTab}`)) {
        switchTab(lastTab);
      }
    } catch (_) {}

    // --- 事件监听绑定 ---
    document.querySelectorAll('[data-tab]').forEach(b => b.onclick = () => switchTab(b.dataset.tab));
    document.querySelectorAll('[data-action]').forEach(b => b.onclick = () => handleAction(b.dataset.action));
    
    // 输入变更时自动保存
    const inputSaveTimers = Object.create(null);
    const inputTypes = [
        { type: 'json', key: 'json-input' },
        { type: 'xml', key: 'xml-input' },
        { type: 'sql', key: 'sql-input' },
        { type: 'yaml', key: 'yaml-input' },
        { type: 'html', key: 'html-fmt-input' },
        { type: 'javascript', key: 'js-input' },
        { type: 'css', key: 'css-input' }
    ];
    inputTypes.forEach(({ type, key }) => {
        if (els[type] && els[type].input) {
            els[type].input.addEventListener('input', (e) => {
                clearTimeout(inputSaveTimers[key]);
                inputSaveTimers[key] = setTimeout(() => saveInput(key, e.target.value), 300);
            });
        }
    });
    document.getElementById('btn-theme').onclick = toggleTheme;
    document.getElementById('btn-layout').onclick = toggleLayout;
    document.getElementById('btn-toggle-nav').onclick = toggleNavCollapse;
    document.getElementById('btn-history').onclick = () => toggleModal('modal-history', true);
    document.getElementById('btn-settings').onclick = () => toggleModal('modal-settings', true);
    document.querySelectorAll('.close-modal').forEach(b => b.onclick = (e) => toggleModal(e.target.closest('.modal-backdrop').id, false));
    document.querySelectorAll('.modal-backdrop').forEach((backdrop) => {
      backdrop.addEventListener('mousedown', (e) => {
        if (e.target === backdrop) toggleModal(backdrop.id, false);
      });
    });
    document.addEventListener('keydown', (e) => {
      if (e.key !== 'Escape') return;
      document.querySelectorAll('.modal-backdrop.active').forEach((backdrop) => toggleModal(backdrop.id, false));
    });
    document.getElementById('setting-indent').onchange = (e) => {
      const val = e.target.value;
      state.indent = val === 'tab' ? 'tab' : parseInt(val);
      saveSetting('indent', state.indent);
      updateIndentConfig();
      
      // 如当前输入非空则自动重新格式化
      const active = document.querySelector('.tab-trigger.is-active');
      const currentTab = active ? active.dataset.tab : '';
      if (els[currentTab] && els[currentTab].input && els[currentTab].input.value) process(currentTab, currentTab + '-format');
    };
    document.getElementById('setting-font').onchange = (e) => {
      state.font = e.target.value;
      saveSetting('font', state.font);
      updateFontConfig();
    };
    document.getElementById('setting-size').onchange = (e) => {
      state.fontSize = e.target.value;
      saveSetting('fontSize', state.fontSize);
      updateFontConfig();
    };
    document.getElementById('setting-history-enabled').onchange = (e) => {
        state.enableHistory = e.target.checked;
        saveSetting('enableHistory', state.enableHistory);
        renderHistory();
        showToast(state.enableHistory ? '历史记录已开启' : '历史记录已关闭');
    };

    document.getElementById('reset-app').onclick = () => {
        if (confirm('确定要重置所有数据吗？这将清除所有缓存、历史记录和偏好设置，并刷新页面。')) {
            let cleared = false;
            // 清理IndexedDB
            try {
                if (safeStorage._db) {
                    const req = indexedDB.deleteDatabase('EasyToolsDB');
                    req.onsuccess = () => {};
                    req.onerror = () => {}
                }
            } catch (e) {}
            // 清理localStorage
            try {
                localStorage.clear();
                cleared = true;
            } catch (e) {}
            // 清理cookies（不再使用）
            // try {
            //     safeStorage._cookieAllow.forEach((k) => safeStorage._delCookie(safeStorage._ck(k)));
            //     cleared = true;
            // } catch (e) {}
            if (!cleared) return showToast('清除失败');
            showToast('数据已清除，即将刷新...');
            setTimeout(() => location.reload(), 1000);
        }
    };

    document.getElementById('clear-history').onclick = async () => {
      if (!confirm('确定要清空全部历史记录吗？')) return;

      // 先清空存储，成功后再清空状态
      const cleared = await safeStorage.clearHistory();
      if (cleared) {
        state.history = [];
        renderHistory();
        showToast('已清空历史');
      } else {
        showToast('清空失败，部分数据可能未清除');
        // 清空失败时重新加载数据，确保 UI 状态正确
        try {
          const history = await safeStorage.getAllHistory();
          state.history = filterHistory(normalizeHistory(history));
          renderHistory();
        } catch (e) {
          
        }
      }
    };
    
    // 历史记录搜索
    let historySearchTimer = 0;
    const historySearchEl = document.getElementById('history-search');
    if (historySearchEl) {
      historySearchEl.oninput = () => {
        clearTimeout(historySearchTimer);
        historySearchTimer = setTimeout(() => renderHistory(), 120);
      };
    }

    // 全局拖拽与释放
    document.body.addEventListener('dragover', (e) => { e.preventDefault(); });
    document.body.addEventListener('drop', (e) => {
      e.preventDefault();
      const file = e.dataTransfer.files[0];
      if (file) {
          if (file.type.startsWith('image/')) {
              showToast('请将图片拖拽到 Base64 工具的上传区域');
              return;
          }
          readFile(file);
      }
    });

    // --- Actions ---
    const ACTION_HANDLERS = {
      'json-format': () => process('json', 'json-format'),
      'json-minify': () => process('json', 'json-minify'),
      'json-minify-escape': () => process('json', 'json-minify-escape'),
      'json-unescape': () => process('json', 'json-unescape'),
      'json-sample': () => fillSample('json'),
      'json-expand': () => expandAll(els.json.output),
      'json-collapse': () => collapseAll(els.json.output),
      'copy-json': () => copyText(els.json.output.dataset.raw),
      'clear-json': () => { els.json.input.value = ''; saveInput('json-input', ''); showToast('已清空', 'success'); },
      'paste-json': () => pasteToEl(els.json.input, 'json-input'),
      'copy-json-input': () => copyText(els.json.input.value),

      'xml-format': () => process('xml', 'xml-format'),
      'xml-minify': () => process('xml', 'xml-minify'),
      'xml-sample': () => fillSample('xml'),
      'xml-expand': () => expandAll(els.xml.output),
      'xml-collapse': () => collapseAll(els.xml.output),
      'copy-xml': () => copyText(els.xml.output.dataset.raw),
      'clear-xml': () => {
        els.xml.input.value = '';
        saveInput('xml-input', '');
        // Also clear search state
        if (typeof currentXmlSearchMatches !== 'undefined') {
            currentXmlSearchMatches = [];
            currentXmlSearchIndex = -1;
            const countEl = document.getElementById('xml-search-count');
            if(countEl) countEl.textContent = '';
        }
        showToast('已清空');
      },
      'clear-xml-output': () => {
        els.xml.output.innerHTML = '';
        els.xml.output.dataset.raw = '';
        // Clear XML search state
        if (typeof currentXmlSearchMatches !== 'undefined') {
            currentXmlSearchMatches = [];
            currentXmlSearchIndex = -1;
            const countEl = document.getElementById('xml-search-count');
            if(countEl) countEl.textContent = '';
        }
        showToast('已清空结果');
      },
      'paste-xml': () => pasteToEl(els.xml.input, 'xml-input'),
      'copy-xml-input': () => copyText(els.xml.input.value),

      'sql-format': () => process('sql', 'sql-format'),
      'sql-minify': () => process('sql', 'sql-minify'),
      'sql-upper': () => process('sql', 'sql-upper'),
      'sql-lower': () => process('sql', 'sql-lower'),
      'sql-to-java': () => generateEntity('java'),
      'sql-to-csharp': () => generateEntity('csharp'),
      'sql-to-go': () => generateEntity('go'),
      'sql-to-python': () => generateEntity('python'),
      'sql-sample': () => fillSample('sql'),
      'copy-sql': () => copyText(els.sql.output.dataset.raw),
      'clear-sql': () => { els.sql.input.value = ''; safeStorage.set('sql-input', ''); showToast('已清空'); },
      'clear-sql-output': () => { els.sql.output.innerHTML = ''; els.sql.output.dataset.raw = ''; showToast('已清空结果'); },
      'paste-sql': () => pasteToEl(els.sql.input, 'sql-input'),
      'copy-sql-input': () => copyText(els.sql.input.value),

      'base64-sample': () => fillSample('base64'),
      'paste-base64-img': () => pasteTo('base64-img-input', 'base64-img-input'),
      'copy-base64-img': () => copyText(document.getElementById('base64-img-input') ? document.getElementById('base64-img-input').value.trim() : ''),

      'url-sample': () => fillSample('url'),
      'url-encode': () => { if (typeof urlEncodeDecode === 'function') urlEncodeDecode('encode'); },
      'url-decode': () => { if (typeof urlEncodeDecode === 'function') urlEncodeDecode('decode'); },
      'url-copy-params': () => { if (typeof copyUrlParamsJson === 'function') copyUrlParamsJson(); },
      'url-paste-params': () => { if (typeof pasteUrlParamsJson === 'function') pasteUrlParamsJson(); },
      'url-add-param': () => { if (typeof addUrlParam === 'function') addUrlParam(); },
      'clear-url': () => {
        if (typeof clearUrlPanel === 'function') {
          clearUrlPanel();
          showToast('已清空');
          return;
        }
        els.url.input.value = '';
        safeStorage.set('url-input', '');
        showToast('已清空');
      },
      'paste-url': () => pasteToEl(els.url.input, 'url-input', () => { if (typeof parseUrl === 'function') parseUrl(); }),

      // html-to-js 功能已合并到引号按钮中，无需单独处理

      'json-to-xml': () => jsonToXml(),
      'xml-to-json': () => xmlToJson(),

      'net-clear': () => {
        const urlEl = document.getElementById('net-url');
        const headersEl = document.getElementById('net-headers');
        const bodyEl = document.getElementById('net-body');
        if (urlEl) urlEl.value = '';
        if (headersEl) headersEl.value = '';
        if (bodyEl) bodyEl.value = '';
        safeStorage.set('net-url', '');
        safeStorage.set('net-headers', '');
        safeStorage.set('net-body', '');
        try { if (urlEl) urlEl.dispatchEvent(new Event('input')); } catch (_) {}
        showToast('已清空配置');
      },
      'net-paste-url': () => pasteTo('net-url', 'net-url'),
      'net-add-header-ua': () => { if (typeof addHeader === 'function') addHeader('ua'); },
      'net-add-header-json': () => { if (typeof addHeader === 'function') addHeader('json'); },
      'net-add-header-form': () => { if (typeof addHeader === 'function') addHeader('form'); },
      'net-preview-close': () => {
        const container = document.getElementById('net-preview-container');
        if (container) container.style.display = 'none';
        const useIframePreview = document.getElementById('use-iframe-preview');
        if (useIframePreview) useIframePreview.checked = false;
      },

      'regex-clear': () => {
        const patternEl = document.getElementById('regex-pattern');
        const textEl = document.getElementById('regex-text');
        const replaceEl = document.getElementById('regex-replace-str');
        if (patternEl) patternEl.value = '';
        if (textEl) textEl.value = '';
        if (replaceEl) replaceEl.value = '';
        safeStorage.set('regex-pattern', '');
        safeStorage.set('regex-text', '');
        safeStorage.set('regex-replace-str', '');

        const outEl = document.getElementById('regex-output');
        if (outEl) outEl.innerHTML = '';
        const countEl = document.getElementById('regex-count');
        if (countEl) {
          countEl.textContent = '0 处匹配';
          countEl.style.color = 'var(--success)';
        }
        const replaceContainer = document.getElementById('regex-replace-container');
        if (replaceContainer) replaceContainer.style.display = 'none';
        const replaceResult = document.getElementById('regex-replace-result');
        if (replaceResult) replaceResult.value = '';
        showToast('已清空');
      },
      'regex-paste-text': () => pasteTo('regex-text', 'regex-text'),
      'regex-copy-replace': () => {
        const el = document.getElementById('regex-replace-result');
        copyText(el ? el.value : '');
      },

      'jwt-clear': () => {
        const inputEl = document.getElementById('jwt-input');
        if (inputEl) {
          inputEl.value = '';
          try { inputEl.dispatchEvent(new Event('input')); } catch (_) {}
        }
        showToast('已清空');
      },
      'jwt-paste': () => pasteTo('jwt-input'),

      'crypto-paste': () => pasteTo('crypto-input', 'crypto-input'),
      'cron-clear': () => {
        const inputEl = document.getElementById('cron-input');
        if (inputEl) inputEl.value = '';
        safeStorage.set('cron-input', '');
        const resultEl = document.getElementById('cron-result');
        if (resultEl) resultEl.style.display = 'none';
        const descEl = document.getElementById('cron-desc');
        if (descEl) descEl.textContent = '';
        const nextEl = document.getElementById('cron-next');
        if (nextEl) nextEl.textContent = '';
        ['cron-v1', 'cron-v2', 'cron-v3', 'cron-v4', 'cron-v5'].forEach((id) => {
          const el = document.getElementById(id);
          if (el) el.textContent = '*';
        });
        showToast('已清空');
      },

      'paste-diff-left': () => pasteTo('diff-left', 'diff-left'),
      'paste-diff-right': () => pasteTo('diff-right', 'diff-right'),
      
      // YAML Handlers
      'yaml-sample': () => fillSample('yaml'),
      'paste-yaml': () => readClipboardTo('yaml'),
      'clear-yaml': () => clearInput('yaml'),
      'yaml-format': () => process('yaml', 'yaml-format'),
      'yaml-minify': () => process('yaml', 'yaml-minify'),
      'yaml-to-json': () => process('yaml', 'yaml-to-json'),
      'copy-yaml': () => copyText(els.yaml.output.textContent),

      // HTML Handlers
      'html-sample': () => fillSample('html'),
      'paste-html-fmt': () => readClipboardTo('html'),
      'clear-html-fmt': () => clearInput('html'),
      'html-format': () => process('html', 'html-format'),
      'html-minify': () => process('html', 'html-minify'),
      'copy-html-fmt': () => copyText(els.html.output.textContent),

      // JS Handlers
      'js-sample': () => fillSample('javascript'),
      'paste-js': () => readClipboardTo('javascript'),
      'clear-js': () => clearInput('javascript'),
      'js-format': () => process('javascript', 'js-format'),
      'js-minify': () => process('javascript', 'js-minify'),
      'copy-js': () => copyText(els.javascript.output.textContent),

      // CSS Handlers
      'css-sample': () => fillSample('css'),
      'paste-css': () => readClipboardTo('css'),
      'clear-css': () => clearInput('css'),
      'css-format': () => process('css', 'css-format'),
      'css-minify': () => process('css', 'css-minify'),
      'copy-css': () => copyText(els.css.output.textContent)
    };

    function handleAction(action) {
      const handler = ACTION_HANDLERS[action];
      if (typeof handler === 'function') handler();
      // Fallback for dynamic actions handled by specific logic in old handleAction if any
      // but here we moved everything to ACTION_HANDLERS or specific bindings in initPanels
      // The original code had a big if-else block in handleAction which is now mostly covered by ACTION_HANDLERS
      // However, let's keep the dynamic dispatch for safety if any action is missing from ACTION_HANDLERS
      else if (action.startsWith('json-')) process('json', action);
      else if (action.startsWith('xml-')) process('xml', action);
      else if (action.startsWith('sql-')) process('sql', action);
    }

    function process(type, action) {
      if (!els[type] || !els[type].input) {
        return showToast(`未找到 ${type} 输入框`, 'error');
      }
      if (!els[type].output) {
        return showToast(`未找到 ${type} 输出框`, 'error');
      }
      const input = els[type].input.value.trim();
      if (!input) return showToast('请输入内容');

      // 输入验证：限制输入大小，防止恶意大输入导致性能问题
      const MAX_INPUT_SIZE = 10 * 1024 * 1024; // 10MB
      if (input.length > MAX_INPUT_SIZE) {
        return showToast(`输入内容过大（最大 ${MAX_INPUT_SIZE / 1024 / 1024}MB）`, 'error');
      }

      // 历史记录将在处理完成后保存（在 handleWorkerMessage 或 fallbackProcess 中）
      els[type].output.innerHTML = '<span style="color:var(--muted)">处理中...</span>';

      // XML 使用 DOMParser，Worker 中不可用，因此在主线程处理
      // YAML/HTML/JS/CSS 库在主线程加载，且 Worker 未集成，也需主线程处理
      if (worker && (action.startsWith('json') || action.startsWith('sql'))) {
        worker.postMessage({
          type: action,
          content: input,
          options: { indent: state.indent }
        });
      } else {
        // file:// 环境、无 worker 或 不支持的类型时的回退处理
        setTimeout(() => fallbackProcess(type, action, input), 10);
      }
    }

    function handleWorkerMessage(e) {
      const { type, result, data, error } = e.data;
      const category = type.split('-')[0]; // json, xml, sql
      const container = els[category].output;

      if (error) {
        container.textContent = error; // 使用 textContent 避免 XSS
        container.style.color = '#ef4444';
        showToast('处理失败', 'error');
        return;
      }

      container.dataset.raw = result;

      if (category === 'json') {
        // 联动：用格式化/压缩结果回写输入框
        if (type === 'json-format' || type === 'json-minify' || type === 'json-minify-escape' || type === 'json-unescape') {
          els.json.input.value = result;
          safeStorage.set('json-input', result);
        }
        let treeData = data;
        if (!treeData) {
            try { treeData = JSON.parse(result); } catch(e) { treeData = result; }
        }
        renderJsonTree(container, treeData);
        // 保存结果到历史记录
        addToHistory('json', result);
      } else if (category === 'sql') {
        // 联动：用处理结果回写输入框
        if (type === 'sql-format' || type === 'sql-minify' || type === 'sql-upper' || type === 'sql-lower') {
          els.sql.input.value = result;
          safeStorage.set('sql-input', result);
        }
        renderSql(container, result);
        // 保存结果到历史记录
        addToHistory('sql', result);
      } else {
        container.textContent = result;
      }
      showToast('处理完成', 'success');
    }

    // --- 回退逻辑 ---
    function fallbackProcess(type, action, content) {
      try {
        let result, data;
        // state.indent 可能是 'tab' 字符串
        const indentChar = state.indent === 'tab' ? '\t' : (typeof state.indent === 'number' ? ' '.repeat(state.indent) : '  ');
        const indentSize = state.indent === 'tab' ? '\t' : state.indent;
        
        if (action === 'json-format') {
          data = JSON.parse(content);
          result = JSON.stringify(data, null, indentSize);
          els.json.input.value = result; // 联动更新
          safeStorage.set('json-input', result);
          renderJsonTree(els.json.output, data);
          addToHistory('json', result);
        } else if (action === 'json-minify') {
          data = JSON.parse(content);
          result = JSON.stringify(data);
          els.json.input.value = result; // 联动更新
          safeStorage.set('json-input', result);
          renderJsonTree(els.json.output, data);
          addToHistory('json', result);
        } else if (action === 'json-minify-escape') {
          const objEsc = JSON.parse(content);
          const minified = JSON.stringify(objEsc);
          result = JSON.stringify(minified);
          els.json.input.value = result;
          renderJsonTree(els.json.output, objEsc);
        } else if (action === 'json-unescape') {
          const unescaped = jsonUnescapeLogic(content, indentSize);
          result = unescaped.result;
          els.json.input.value = result;
          safeStorage.set('json-input', result);
          renderJsonTree(els.json.output, unescaped.data);
        } else if (action === 'sql-format') {
          // SQL 格式化回退
          result = beautifySql(content, indentChar);
          els.sql.input.value = result;
          safeStorage.set('sql-input', result);
          renderSql(els.sql.output, result);
          addToHistory('sql', result);
        } else if (action === 'sql-minify') {
          result = content.replace(/\s+/g, ' ').trim();
          els.sql.input.value = result;
          safeStorage.set('sql-input', result);
          renderSql(els.sql.output, result);
          addToHistory('sql', result);
        } else if (action === 'sql-upper') {
          result = content.toUpperCase();
          els.sql.input.value = result;
          safeStorage.set('sql-input', result);
          renderSql(els.sql.output, result);
          addToHistory('sql', result);
        } else if (action === 'sql-lower') {
          result = content.toLowerCase();
          els.sql.input.value = result;
          safeStorage.set('sql-input', result);
          renderSql(els.sql.output, result);
          addToHistory('sql', result);
        } else if (action.startsWith('xml')) {
           if (action === 'xml-format') {
             const doc = new DOMParser().parseFromString(content, 'application/xml');
             const err = doc.querySelector('parsererror');
             if (err) throw new Error('XML Error: ' + err.textContent);
             
              // 1. 更新输入（联动）
              result = formatXml(content, indentChar);
              els.xml.input.value = result;
              safeStorage.set('xml-input', result);

              // 2. 渲染树
              renderXmlTree(els.xml.output, doc.documentElement);
              addToHistory('xml', result);
             
           } else if (action === 'xml-minify') {
             // 1. 更新输入（联动）
             result = content.replace(/>\s+</g, '><').trim();
             els.xml.input.value = result;
             safeStorage.set('xml-input', result);

             // 2. 渲染树
             const doc = new DOMParser().parseFromString(result, 'application/xml');
             if (!doc.querySelector('parsererror')) {
                renderXmlTree(els.xml.output, doc.documentElement);
              addToHistory('xml', result);
             }
           }
        } else if (action === 'yaml-format') {
             const obj = jsyaml.load(content);
             result = jsyaml.dump(obj, { indent: 2 });
             els.yaml.input.value = result;
             safeStorage.set('yaml-input', result);
             els.yaml.output.textContent = result;
             if (window.hljs) hljs.highlightElement(els.yaml.output);
             addToHistory('yaml', result);
        } else if (action === 'yaml-minify') {
             const obj = jsyaml.load(content);
             result = JSON.stringify(obj);
             els.yaml.output.textContent = result;
             addToHistory('yaml', result);
        } else if (action === 'yaml-to-json') {
             const obj = jsyaml.load(content);
             result = JSON.stringify(obj, null, 2);
             els.yaml.output.textContent = result;
             if (window.hljs) hljs.highlightElement(els.yaml.output);
             addToHistory('yaml', content);
        } else if (action === 'html-format') {
             result = html_beautify(content, { indent_size: indentSize === '\t' ? 1 : indentSize, indent_char: indentSize === '\t' ? '\t' : ' ', preserve_newlines: false });
             els.html.input.value = result;
             safeStorage.set('html-fmt-input', result);
             els.html.output.textContent = result;
             if (window.hljs) hljs.highlightElement(els.html.output);
             addToHistory('html', result);
        } else if (action === 'html-minify') {
             result = content.replace(/\s+/g, ' ').replace(/>\s+</g, '><').trim();
             els.html.output.textContent = result;
             addToHistory('html', result);
        } else if (action === 'js-format') {
             result = js_beautify(content, { indent_size: indentSize === '\t' ? 1 : indentSize, indent_char: indentSize === '\t' ? '\t' : ' ' });
             els.javascript.input.value = result;
             safeStorage.set('js-input', result);
             els.javascript.output.textContent = result;
             if (window.hljs) hljs.highlightElement(els.javascript.output);
             addToHistory('js', result);
        } else if (action === 'js-minify') {
             result = content.replace(/\/\*[\s\S]*?\*\/|([^\\:]|^)\/\/.*$/gm, '$1').replace(/\s+/g, ' ');
             els.javascript.output.textContent = result;
             addToHistory('js', result);
        } else if (action === 'css-format') {
             result = css_beautify(content, { indent_size: indentSize === '\t' ? 1 : indentSize, indent_char: indentSize === '\t' ? '\t' : ' ' });
             els.css.input.value = result;
             safeStorage.set('css-input', result);
             els.css.output.textContent = result;
             if (window.hljs) hljs.highlightElement(els.css.output);
             addToHistory('css', result);
        } else if (action === 'css-minify') {
             result = content.replace(/\/\*[\s\S]*?\*\//g, '').replace(/\s+/g, ' ').replace(/\s*([{}:;,])\s*/g, '$1').trim();
             els.css.output.textContent = result;
             addToHistory('css', result);
        }
        
        if (result) els[type].output.dataset.raw = result;
        showToast('完成');
      } catch (err) {
        els[type].output.textContent = err.message; // 使用 textContent 避免 XSS
        els[type].output.style.color = '#ef4444';
      }
    }

    // 简易 XML 格式化（回退用）
    function formatXml(xml, indentChar = '  ') {
      let formatted = '';
      // 先压缩以移除现有格式
      xml = xml.replace(/>\s+</g, '><').trim();
      
      let reg = /(>)(<)(\/*)/g;
      xml = xml.replace(reg, '$1\r\n$2$3');
      let pad = 0;
      xml.split('\r\n').forEach((node) => {
        let indent = 0;
        if (node.match(/.+<\/\w[^>]*>$/)) {
          indent = 0;
        } else if (node.match(/^<\/\w/)) {
          if (pad != 0) pad -= 1;
        } else if (node.match(/^<\w[^>]*[^\/]>.*$/)) {
          indent = 1;
        } else {
          indent = 0;
        }
        let padding = '';
        for (let i = 0; i < pad; i++) padding += indentChar;
        formatted += padding + node + '\r\n';
        pad += indent;
      });
      return formatted.trim();
    }

    // JSON 去转义逻辑 (Worker 复用)
    function jsonUnescapeLogic(content, indentSize) {
        var str = (content || '').trim();
        var finalObj;
        try {
            var parsed = JSON.parse(str);
            if (typeof parsed === 'string') {
                str = parsed;
            } else {
                finalObj = parsed;
            }
        } catch (e) {
            try {
                str = JSON.parse('"' + str + '"');
            } catch (e2) {
                throw new Error('无法解析为字符串或JSON');
            }
        }

        try {
            if (!finalObj) finalObj = JSON.parse(str);
            return { result: JSON.stringify(finalObj, null, indentSize), data: finalObj };
        } catch (e) {
            return { result: str, data: str };
        }
    }

    // 高级 SQL 格式化（同 Worker）
    function beautifySql(sql, indent) {
      // 标准化空白字符
      var cleanSql = (sql || '').replace(/\s+/g, ' ').trim();
      
      // 分词
      var regex = /'[^']*'|"[^"]*"|`[^`]*`|\b(SELECT|FROM|WHERE|INSERT INTO|VALUES|UPDATE|SET|DELETE FROM|JOIN|LEFT JOIN|RIGHT JOIN|INNER JOIN|OUTER JOIN|ON|ORDER BY|GROUP BY|HAVING|LIMIT|OFFSET|UNION|UNION ALL|AND|OR|CASE|WHEN|THEN|ELSE|END)\b|[(),;]|\w+|\S/gi;
      
      var tokens = cleanSql.match(regex);
      if (!tokens) return sql;

      var out = '';
      var depth = 0;
      var newline = true;
      var stack = []; // 跟踪括号：'func' 或 'block'
      
      var keywords = ['SELECT', 'FROM', 'WHERE', 'INSERT INTO', 'VALUES', 'UPDATE', 'SET', 'DELETE FROM', 'JOIN', 'LEFT JOIN', 'RIGHT JOIN', 'INNER JOIN', 'OUTER JOIN', 'ORDER BY', 'GROUP BY', 'HAVING', 'LIMIT', 'OFFSET', 'UNION', 'UNION ALL'];
      
      for (var i = 0; i < tokens.length; i++) {
          var t = tokens[i];
          var up = t.toUpperCase();
          
          if (t === '.') {
              if (out && out[out.length - 1] === ' ') out = out.slice(0, -1);
              out += t;
              continue;
          }
          
          if(up === '(') {
              var prev = i > 0 ? tokens[i-1].toUpperCase() : '';
              var isFunc = /^[A-Z0-9_]+$/.test(prev) && keywords.indexOf(prev) === -1 && ['AND', 'OR', 'ON', 'CASE', 'WHEN', 'THEN', 'ELSE', 'END'].indexOf(prev) === -1;
              
              if(isFunc) {
                  out += t;
                  stack.push('func');
              } else {
                  depth++;
                  stack.push('block');
                  out += ' ' + t;
                  // 检查下一个是否为 SELECT（子查询）
                  if(i+1 < tokens.length && tokens[i+1].toUpperCase() === 'SELECT') {
                      out += '\n' + indent.repeat(depth);
                      newline = true;
                  }
              }
          } else if (up === ')') {
              if (out && out[out.length - 1] === ' ') out = out.slice(0, -1);
              var type = stack.pop();
              if(type === 'block') {
                  depth--;
                  out += t; 
              } else {
                  out += t;
              }
          } else if (up === ',') {
              if (out && out[out.length - 1] === ' ') out = out.slice(0, -1);
              out += t;
              if(stack[stack.length-1] !== 'func') {
                  out += '\n' + indent.repeat(depth + 1);
                  newline = true;
              } else {
                  out += ' ';
              }
          } else if (up === ';') {
              if (out && out[out.length - 1] === ' ') out = out.slice(0, -1);
              out += t + '\n';
              newline = true;
          } else if (keywords.indexOf(up) !== -1) {
              if (!newline) out += '\n';
              out += indent.repeat(depth) + up + ' ';
              newline = false;
          } else if (up === 'AND' || up === 'OR') {
              out += '\n' + indent.repeat(depth + 1) + up + ' ';
              newline = false;
          } else if (up === 'ON') {
              out += ' ' + up + ' ';
          } else {
              if(newline) {
                  out += indent.repeat(depth);
                  newline = false;
              }
              out += t + ' ';
          }
      }
      return out.replace(/ \n/g, '\n').replace(/\n\s*\n/g, '\n').trim();
    }


    // --- Search Logic ---
    let currentSearchMatches = [];
    let currentSearchIndex = -1;

    function initJsonSearch() {
        const bar = document.getElementById('json-search-bar');
        const input = document.getElementById('json-search-input');
        const toggleBtn = document.getElementById('json-search-toggle');
        const closeBtn = document.getElementById('json-search-close');
        const prevBtn = document.getElementById('json-search-prev');
        const nextBtn = document.getElementById('json-search-next');
        const caseBtn = document.getElementById('json-search-case');

        toggleBtn.onclick = () => {
            bar.style.display = 'flex';
            toggleBtn.style.display = 'none';
            input.focus();
        };

        closeBtn.onclick = () => {
            bar.style.display = 'none';
            toggleBtn.style.display = 'inline-flex';
            input.value = '';
            performJsonSearch(); // Clear
        };
        
        caseBtn.onclick = () => {
            caseBtn.classList.toggle('active');
            performJsonSearch();
        };

        input.onkeydown = (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                if (e.shiftKey) navigateSearch(-1);
                else navigateSearch(1);
            } else if (e.key === 'Escape') {
                closeBtn.click();
            } else if (e.altKey && (e.key === 'c' || e.key === 'C')) {
                caseBtn.click();
            }
        };
        
        input.oninput = () => {
            // Debounce
            if(input.searchTimer) clearTimeout(input.searchTimer);
            input.searchTimer = setTimeout(performJsonSearch, 300);
        };

        prevBtn.onclick = () => navigateSearch(-1);
        nextBtn.onclick = () => navigateSearch(1);
        
        // Global Ctrl+F
        document.addEventListener('keydown', (e) => {
            if ((e.ctrlKey || e.metaKey) && e.key === 'f') {
                if (document.getElementById('panel-json').classList.contains('is-active')) {
                    e.preventDefault();
                    toggleBtn.click();
                }
            }
        });
        
        // Clear Output Button
        const btnClear = document.getElementById('btn-json-clear-output');
        if(btnClear) {
            btnClear.onclick = () => {
                document.getElementById('json-output').innerHTML = '';
                // Clear search state
                currentSearchMatches = [];
                currentSearchIndex = -1;
                const countEl = document.getElementById('json-search-count');
                if(countEl) countEl.textContent = '';
                showToast('已清空结果');
            };
        }
    }

    function performJsonSearch() {
        const input = document.getElementById('json-search-input');
        const caseBtn = document.getElementById('json-search-case');
        const isCaseSensitive = caseBtn && caseBtn.classList.contains('active');
        
        let query = input.value;
        if (!isCaseSensitive) query = query.toLowerCase();
        
        const container = document.getElementById('json-output');
        const countEl = document.getElementById('json-search-count');
        
        // Clear previous highlights (simple restore)
        // Note: Replacing nodes might break tree structure if not careful, but here we modify leaf tokens only.
        container.querySelectorAll('.highlight-match, .highlight-current').forEach(el => {
            const parent = el.parentNode;
            if (parent) parent.textContent = parent.textContent; // Merge text back
        });
        // Also clear search-focus class from rows
        container.querySelectorAll('.tree-row.search-focus').forEach(el => {
            el.classList.remove('search-focus');
        });
        
        currentSearchMatches = [];
        currentSearchIndex = -1;
        
        if (!query) {
            countEl.textContent = '';
            return;
        }
        
        const targets = container.querySelectorAll('.token-key, .token-string, .token-number, .token-boolean, .token-null');
        
        targets.forEach(node => {
            const text = node.textContent;
            const matchText = isCaseSensitive ? text : text.toLowerCase();
            
            if (!matchText.includes(query)) return;
            
            // Rebuild node content with highlights
            node.innerHTML = '';
            let lastIdx = 0;
            let idx = matchText.indexOf(query);
            
            while(idx !== -1) {
                if (idx > lastIdx) {
                    node.appendChild(document.createTextNode(text.substring(lastIdx, idx)));
                }
                const span = document.createElement('span');
                span.className = 'highlight-match';
                span.textContent = text.substring(idx, idx + query.length);
                node.appendChild(span);
                currentSearchMatches.push(span);
                
                lastIdx = idx + query.length;
                idx = matchText.indexOf(query, lastIdx);
            }
            if (lastIdx < text.length) {
                node.appendChild(document.createTextNode(text.substring(lastIdx)));
            }
        });

        if (currentSearchMatches.length > 0) {
            navigateSearch(1);
        } else {
            countEl.textContent = '0/0';
        }
    }

    function navigateSearch(dir) {
        if (currentSearchMatches.length === 0) return;
        
        // Remove previous active highlights
        if (currentSearchIndex >= 0 && currentSearchMatches[currentSearchIndex]) {
            currentSearchMatches[currentSearchIndex].classList.remove('highlight-current');
            const row = currentSearchMatches[currentSearchIndex].closest('.tree-row');
            if (row) row.classList.remove('search-focus');
        }
        
        currentSearchIndex += dir;
        if (currentSearchIndex >= currentSearchMatches.length) currentSearchIndex = 0;
        if (currentSearchIndex < 0) currentSearchIndex = currentSearchMatches.length - 1;
        
        const el = currentSearchMatches[currentSearchIndex];
        // Skip detached elements (defensive)
        if (!el.isConnected) {
             document.getElementById('json-search-count').textContent = 'DOM Changed - Researching...';
             return performJsonSearch();
        }

        el.classList.add('highlight-current');
        
        // Highlight row
        const row = el.closest('.tree-row');
        if (row) row.classList.add('search-focus');
        
        // Auto expand all parents
        let parent = el.closest('.tree-children');
        while(parent) {
            if(parent.classList.contains('collapsed')) {
                parent.classList.remove('collapsed');
                // Sync icon state
                const wrapper = parent.parentElement;
                if(wrapper) {
                    const icon = wrapper.querySelector('.tree-icon');
                    if(icon) icon.classList.remove('collapsed');
                    // Also ensure wrapper footer is visible if we have that logic
                    const footer = wrapper.querySelector('.tree-footer');
                    if(footer) footer.style.display = 'flex';
                }
            }
            // Move up to next container
            parent = parent.parentElement ? parent.parentElement.closest('.tree-children') : null;
        }
        
        // Scroll into view with a slight delay to ensure layout is updated
        setTimeout(() => {
            el.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }, 10);
        
        document.getElementById('json-search-count').textContent = `${currentSearchIndex + 1}/${currentSearchMatches.length}`;
    }

    // --- XML Search Logic ---
    let currentXmlSearchMatches = [];
    let currentXmlSearchIndex = -1;

    function initXmlSearch() {
        const bar = document.getElementById('xml-search-bar');
        const input = document.getElementById('xml-search-input');
        const toggleBtn = document.getElementById('xml-search-toggle');
        const closeBtn = document.getElementById('xml-search-close');
        const prevBtn = document.getElementById('xml-search-prev');
        const nextBtn = document.getElementById('xml-search-next');
        const caseBtn = document.getElementById('xml-search-case');

        toggleBtn.onclick = () => {
            bar.style.display = 'flex';
            toggleBtn.style.display = 'none';
            input.focus();
        };

        closeBtn.onclick = () => {
            bar.style.display = 'none';
            toggleBtn.style.display = 'inline-flex';
            input.value = '';
            performXmlSearch(); // Clear
        };

        caseBtn.onclick = () => {
            caseBtn.classList.toggle('active');
            performXmlSearch();
        };

        input.onkeydown = (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                if (e.shiftKey) navigateXmlSearch(-1);
                else navigateXmlSearch(1);
            } else if (e.key === 'Escape') {
                closeBtn.click();
            } else if (e.altKey && (e.key === 'c' || e.key === 'C')) {
                caseBtn.click();
            }
        };

        input.oninput = () => {
            // Debounce
            if(input.searchTimer) clearTimeout(input.searchTimer);
            input.searchTimer = setTimeout(performXmlSearch, 300);
        };

        prevBtn.onclick = () => navigateXmlSearch(-1);
        nextBtn.onclick = () => navigateXmlSearch(1);

        // Global Ctrl+F for XML
        document.addEventListener('keydown', (e) => {
            if ((e.ctrlKey || e.metaKey) && e.key === 'f') {
                const panel = document.getElementById('panel-xml');
                if (panel && panel.classList.contains('is-active')) {
                    e.preventDefault();
                    toggleBtn.click();
                }
            }
        });
    }

    function performXmlSearch() {
        const input = document.getElementById('xml-search-input');
        const caseBtn = document.getElementById('xml-search-case');
        const isCaseSensitive = caseBtn && caseBtn.classList.contains('active');

        let query = input.value;
        if (!isCaseSensitive) query = query.toLowerCase();

        const container = document.getElementById('xml-output');
        const countEl = document.getElementById('xml-search-count');

        // Error handling
        if (!container || !countEl) {
            
            return;
        }

        // Clear previous highlights
        container.querySelectorAll('.highlight-match, .highlight-current').forEach(el => {
            const parent = el.parentNode;
            if (parent) parent.textContent = parent.textContent; // Merge text back
        });
        // Also clear search-focus class from rows
        container.querySelectorAll('.tree-row.search-focus').forEach(el => {
            el.classList.remove('search-focus');
        });

        currentXmlSearchMatches = [];
        currentXmlSearchIndex = -1;

        if (!query) {
            countEl.textContent = '';
            return;
        }

        // Search in XML tags, attributes, and content
        const targets = container.querySelectorAll('.xml-tag, .xml-attr, .xml-string, .xml-content');

        targets.forEach(node => {
            const text = node.textContent;
            const matchText = isCaseSensitive ? text : text.toLowerCase();

            if (!matchText.includes(query)) return;

            // Rebuild node content with highlights
            node.innerHTML = '';
            let lastIdx = 0;
            let idx = matchText.indexOf(query);

            while(idx !== -1) {
                if (idx > lastIdx) {
                    node.appendChild(document.createTextNode(text.substring(lastIdx, idx)));
                }
                const span = document.createElement('span');
                span.className = 'highlight-match';
                span.textContent = text.substring(idx, idx + query.length);
                node.appendChild(span);
                currentXmlSearchMatches.push(span);

                lastIdx = idx + query.length;
                idx = matchText.indexOf(query, lastIdx);
            }
            if (lastIdx < text.length) {
                node.appendChild(document.createTextNode(text.substring(lastIdx)));
            }
        });

        if (currentXmlSearchMatches.length > 0) {
            navigateXmlSearch(1); // This will update the count to "1/N"
        } else {
            countEl.textContent = '0/0';
        }
    }

    function navigateXmlSearch(dir) {
        if (currentXmlSearchMatches.length === 0) return;

        // Remove previous active highlights
        if (currentXmlSearchIndex >= 0 && currentXmlSearchMatches[currentXmlSearchIndex]) {
            currentXmlSearchMatches[currentXmlSearchIndex].classList.remove('highlight-current');
            const row = currentXmlSearchMatches[currentXmlSearchIndex].closest('.tree-row');
            if (row) row.classList.remove('search-focus');
        }

        currentXmlSearchIndex += dir;
        if (currentXmlSearchIndex >= currentXmlSearchMatches.length) currentXmlSearchIndex = 0;
        if (currentXmlSearchIndex < 0) currentXmlSearchIndex = currentXmlSearchMatches.length - 1;

        const el = currentXmlSearchMatches[currentXmlSearchIndex];
        // Skip detached elements (defensive)
        if (!el.isConnected) {
             document.getElementById('xml-search-count').textContent = 'DOM Changed - Researching...';
             return performXmlSearch();
        }

        el.classList.add('highlight-current');

        // Highlight row
        const row = el.closest('.tree-row');
        if (row) row.classList.add('search-focus');

        // Auto expand all parents
        let parent = el.closest('.tree-children');
        while(parent) {
            if(parent.classList.contains('collapsed')) {
                parent.classList.remove('collapsed');
                // Sync icon state
                const wrapper = parent.parentElement;
                if(wrapper) {
                    const icon = wrapper.querySelector('.tree-icon');
                    if(icon) icon.classList.remove('collapsed');
                    // Also ensure wrapper footer is visible
                    const footer = wrapper.querySelector('.tree-footer');
                    if(footer) footer.style.display = 'flex';
                }
            }
            // Move up to next container
            parent = parent.parentElement ? parent.parentElement.closest('.tree-children') : null;
        }

        // Scroll into view with a slight delay to ensure layout is updated
        setTimeout(() => {
            el.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }, 10);

        document.getElementById('xml-search-count').textContent = `${currentXmlSearchIndex + 1}/${currentXmlSearchMatches.length}`;
    }

    // --- Context Menu ---
    const contextMenu = document.createElement('div');
    contextMenu.className = 'context-menu';
    document.body.appendChild(contextMenu);

    let currentContextData = null;

    document.addEventListener('click', () => { 
        contextMenu.classList.remove('active');
        // Delay hiding to allow animation if needed, but display:none is immediate in CSS if class removed
        setTimeout(() => contextMenu.style.display = 'none', 100); 
    });
    
    function showContextMenu(e, data) {
        e.preventDefault();
        e.stopPropagation();
        currentContextData = data;

        contextMenu.innerHTML = '';

        // Determine if this is XML or JSON based on data structure
        const isXml = data.type === 'xml-node' || data.type === 'xml-leaf';

        // Set labels based on data type
        const keyLabel = isXml ? '复制标签名' : '复制 Key';
        const valueLabel = isXml ? '复制属性' : '复制 Value';
        const kvLabel = isXml ? '复制标签+属性' : '复制 Key & Value';

        // For XML, only show value-related actions if there are actual attributes
        // For JSON, show if value exists (even if empty string)
        const hasValue = isXml ? (data.value && data.value.length > 0) : !!data.value;
        const hasInnerValue = isXml && data.innerValue && data.innerValue.length > 0;

        const actions = [
            // Copy actions - same functionality, different labels
            { label: keyLabel, action: "copy-key", visible: !!data.key },
            { label: valueLabel, action: "copy-value", visible: hasValue },
            { label: kvLabel, action: "copy-kv", visible: !!data.key && (isXml || hasValue) },
            { label: "复制内部文本", action: "copy-inner", visible: hasInnerValue },
            { label: "复制 Path", action: "copy-path", visible: false },

            // Tree actions - both JSON and XML
            // Note: XML nodes always have children (complex) or are simple (no children needed)
            // For XML, we only show tree actions for complex nodes
            { separator: true, visible: data.type === 'json-node' || data.type === 'json-leaf' || data.type === 'xml-node' },
            { label: '收起所有子节点', action: 'collapse-children', visible: data.type === 'json-node' || data.type === 'xml-node' },
            { label: '收起所有节点', action: 'collapse-all', visible: data.type === 'json-node' || data.type === 'json-leaf' || data.type === 'xml-node' },
            { label: '展开所有子节点', action: 'expand-children', visible: data.type === 'json-node' || data.type === 'xml-node' },
            { label: '展开所有节点', action: 'expand-all', visible: data.type === 'json-node' || data.type === 'json-leaf' || data.type === 'xml-node' }
        ];
        
        let hasVisible = false;
        actions.forEach(item => {
            if (!item.visible) return;
            hasVisible = true;
            const el = document.createElement('div');
            if (item.separator) {
                el.className = 'context-menu-separator';
            } else {
                el.className = 'context-menu-item';
                el.textContent = item.label;
                el.onclick = () => {
                    handleContextAction(item.action);
                    contextMenu.classList.remove('active');
                    contextMenu.style.display = 'none';
                };
            }
            contextMenu.appendChild(el);
        });
        
        if (!hasVisible) return;

        const x = e.clientX;
        const y = e.clientY;
        
        contextMenu.style.display = 'block';
        // Force reflow for animation
        void contextMenu.offsetWidth; 
        contextMenu.classList.add('active');
        
        const rect = contextMenu.getBoundingClientRect();
        
        let left = x;
        let top = y;
        
        if (left + rect.width > window.innerWidth) left = window.innerWidth - rect.width - 10;
        if (top + rect.height > window.innerHeight) top = window.innerHeight - rect.height - 10;
        
        contextMenu.style.left = `${left}px`;
        contextMenu.style.top = `${top}px`;
    }
    
    function toggleNodeRecursively(element, expand, recursive) {
        if (!element) return;
        const childrenContainer = element.querySelector('.tree-children');
        const icon = element.querySelector('.tree-icon');
        
        if (childrenContainer) {
            childrenContainer.classList.toggle('collapsed', !expand);
            if(icon) icon.classList.toggle('collapsed', !expand);
            
            if (recursive) {
                // Find immediate child wrappers
                Array.from(childrenContainer.children).forEach(childRow => {
                    // childRow is either .tree-row (leaf) or a wrapper div (node)
                    // createJsonNode returns wrapper for complex, row for simple
                    // But wait, createJsonNode returns wrapper div for complex types
                    // So childrenContainer contains wrappers directly?
                    // Yes: wrapper.appendChild(children); children.appendChild(createJsonNode(...))
                    
                    // Recursive call on child wrappers
                    if (childRow.tagName === 'DIV' && !childRow.classList.contains('tree-row')) {
                         toggleNodeRecursively(childRow, expand, true);
                    }
                });
            }
        }
    }

    // XML specific recursive toggle function
    function toggleXmlNodeRecursively(element, expand, recursive) {
        if (!element) return;
        const childrenContainer = element.querySelector('.tree-children');
        const icon = element.querySelector('.tree-icon');
        const footer = element.querySelector('.tree-footer');

        if (childrenContainer) {
            childrenContainer.classList.toggle('collapsed', !expand);
            if(icon) icon.classList.toggle('collapsed', !expand);
            if(footer) footer.style.display = expand ? 'flex' : 'none';

            if (recursive) {
                // Find immediate child wrappers
                Array.from(childrenContainer.children).forEach(childRow => {
                    // For XML, childRow can be:
                    // - A wrapper div (complex node)
                    // - A tree-row div (simple node with text content)
                    // Only recurse on wrapper divs that contain tree-children

                    if (childRow.tagName === 'DIV' && !childRow.classList.contains('tree-row')) {
                        toggleXmlNodeRecursively(childRow, expand, true);
                    } else if (childRow.classList.contains('tree-row') && childRow.querySelector('.tree-children')) {
                        // This might be a wrapper, recurse
                        toggleXmlNodeRecursively(childRow, expand, true);
                    }
                });
            }
        }
    }

    function handleContextAction(action) {
        if (!currentContextData) return;
        const { key, value, element, type, innerValue } = currentContextData;

        // Check if this is XML context
        const isXml = type === "xml-node" || type === "xml-leaf" || (key && value !== undefined && !type);

        switch(action) {
            // Common copy actions - same functionality for both JSON and XML
            case "copy-key": copyText(key); break;
            case "copy-value": copyText(value); break;
            case "copy-kv":
                if (isXml) {
                    // For XML: "tag attr1="value1" attr2="value2"" or just "tag" if no attrs
                    const kvText = value ? `${key} ${value}` : key;
                    copyText(kvText);
                } else {
                    // For JSON: "key": value
                    copyText(`"${key}": ${value}`);
                }
                break;
            case "copy-inner":
                // XML only: copy the inner text content
                copyText(innerValue);
                break;

            // Tree actions - both JSON and XML
            case "collapse-children":
                if (isXml) {
                    toggleXmlNodeRecursively(element, false, true);
                } else {
                    toggleNodeRecursively(element, false, true);
                }
                break;
            case "expand-children":
                if (isXml) {
                    toggleXmlNodeRecursively(element, true, true);
                } else {
                    toggleNodeRecursively(element, true, true);
                }
                break;
            case "collapse-all":
                if (isXml) {
                    collapseAll(document.getElementById("xml-output"));
                } else {
                    collapseAll(document.getElementById("json-output"));
                }
                break;
            case "expand-all":
                if (isXml) {
                    expandAll(document.getElementById("xml-output"));
                } else {
                    expandAll(document.getElementById("json-output"));
                }
                break;
        }
    }

    // --- 渲染器（JSON/XML/SQL） ---
    // 大文件渲染性能优化配置
    const LAZY_RENDER_THRESHOLD = 100; // 超过100个子节点时启用懒加载
    const BATCH_RENDER_SIZE = 50; // 每批渲染50个节点

    function renderJsonTree(container, data) {
      container.innerHTML = '';
      container.appendChild(createJsonNode(data, null, false));

      // 如果搜索栏可见且有搜索词，自动重新搜索
      const searchBar = document.getElementById('json-search-bar');
      const searchInput = document.getElementById('json-search-input');
      if (searchBar && searchBar.style.display !== 'none' && searchInput && searchInput.value) {
        setTimeout(() => performJsonSearch(), 50);
      } else {
        // 否则重置搜索状态
        currentSearchMatches = [];
        currentSearchIndex = -1;
        const countEl = document.getElementById('json-search-count');
        if(countEl) countEl.textContent = '';
      }
    }

    function createJsonNode(data, key = null, isLast = true, depth = 0) {
      const isComplex = (Array.isArray(data) || (typeof data === 'object' && data !== null));
      const isEmpty = isComplex && (Array.isArray(data) ? data.length === 0 : Object.keys(data).length === 0);

      const comma = !isLast ? ',' : '';

      // 情况 1：基础类型或空复合类型
      if (!isComplex || isEmpty) {
        const row = document.createElement('div');
        row.className = 'tree-row';
        row.oncontextmenu = (e) => {
            const valStr = data === null ? 'null' : String(data);
            showContextMenu(e, { key: key, value: valStr, type: 'json-leaf', element: row });
        };

        // 用占位元素对齐
        const spacer = document.createElement('span');
        spacer.className = 'tree-spacer';
        row.appendChild(spacer);

        // 键名
        if (key !== null) {
            row.appendChild(createSpan(`"${key}"`, 'token-key'));
            row.appendChild(createSpan(': ', 'token-punctuation'));
        }

        // 键值
        if (data === null) row.appendChild(createSpan('null', 'token-null'));
        else if (typeof data === 'boolean') row.appendChild(createSpan(String(data), 'token-boolean'));
        else if (typeof data === 'number') row.appendChild(createSpan(String(data), 'token-number'));
        else if (typeof data === 'string') row.appendChild(createSpan(`"${data}"`, 'token-string'));
        else if (isEmpty) {
            const open = Array.isArray(data) ? '[' : '{';
            const close = Array.isArray(data) ? ']' : '}';
            row.appendChild(createSpan(open + close));
        }

        // 逗号
        if (comma) row.appendChild(createSpan(comma, 'token-punctuation'));

        return row;
      }

      // 情况 2：非空复杂类型（对象/数组）
      const isArray = Array.isArray(data);
      const open = isArray ? '[' : '{';
      const close = isArray ? ']' : '}';
      const childCount = isArray ? data.length : Object.keys(data).length;

      const wrapper = document.createElement('div');
      // 容器本身不渲染树行

      // 头部
      const header = document.createElement('div');
      header.className = 'tree-row';
      header.oncontextmenu = (e) => {
          const valStr = JSON.stringify(data, null, 2);
          showContextMenu(e, { key: key, value: valStr, type: 'json-node', element: wrapper });
      };

      // 类型图标（作为切换开关）
      const typeIcon = document.createElement('span');
      typeIcon.className = 'tree-icon';
      typeIcon.textContent = isArray ? '[]' : '{}';
      typeIcon.title = isArray ? `Array (${childCount})` : `Object (${childCount})`;

      // 判断是否需要懒加载（节点数超过阈值且深度较大）
      const shouldLazyLoad = childCount > LAZY_RENDER_THRESHOLD && depth > 2;
      const defaultCollapsed = shouldLazyLoad;

      const toggleFn = (e) => {
         const kids = wrapper.querySelector('.tree-children');
         const isCollapsed = kids.classList.toggle('collapsed');
         typeIcon.classList.toggle('collapsed', isCollapsed);

         // 懒加载：首次展开时渲染子节点
         if (!isCollapsed && kids.dataset.lazy === 'true') {
           kids.dataset.lazy = 'false';
           renderJsonChildren(kids, data, isArray);
         }

         if(e.altKey) {
             wrapper.querySelectorAll('.tree-children, .tree-icon').forEach(el => {
               if (el.dataset.lazy !== 'true') {
                 el.classList.toggle('collapsed', isCollapsed);
               }
             });
         }
      };

      typeIcon.onclick = toggleFn;
      header.appendChild(typeIcon);

      // 键
      if (key !== null) {
        header.appendChild(createSpan(`"${key}"`, 'token-key'));
        header.appendChild(createSpan(': ', 'token-punctuation'));
      }

      // 左括号
      header.appendChild(document.createTextNode(open));
      wrapper.appendChild(header);

      // 子节点容器
      const children = document.createElement('div');
      children.className = 'tree-children';

      if (defaultCollapsed) {
        // 默认折叠状态，使用懒加载
        children.classList.add('collapsed');
        children.dataset.lazy = 'true';
        typeIcon.classList.add('collapsed');
      } else {
        // 立即渲染子节点
        renderJsonChildren(children, data, isArray, depth + 1);
      }

      wrapper.appendChild(children);

      // 页脚
      const footer = document.createElement('div');
      footer.className = 'tree-row';
      footer.oncontextmenu = (e) => {
          const valStr = JSON.stringify(data, null, 2);
          showContextMenu(e, { key: key, value: valStr, type: 'json-node', element: wrapper });
      };

      // 页脚对齐占位符
      const fSpacer = document.createElement('span');
      fSpacer.className = 'tree-spacer';
      footer.appendChild(fSpacer);

      footer.appendChild(document.createTextNode(close + comma));
      wrapper.appendChild(footer);

      return wrapper;
    }

    // 渲染 JSON 子节点（支持分批渲染）
    function renderJsonChildren(container, data, isArray, depth = 0) {
      const items = isArray ? data : Object.keys(data);
      const total = items.length;

      // 小数量直接渲染
      if (total <= BATCH_RENDER_SIZE) {
        if (isArray) {
          data.forEach((item, i) => {
            const isLastItem = i === data.length - 1;
            container.appendChild(createJsonNode(item, null, isLastItem, depth));
          });
        } else {
          Object.keys(data).forEach((k, i, keys) => {
            const isLastItem = i === keys.length - 1;
            container.appendChild(createJsonNode(data[k], k, isLastItem, depth));
          });
        }
        return;
      }

      // 大数量分批渲染
      let rendered = 0;

      function renderBatch() {
        const start = rendered;
        const end = Math.min(start + BATCH_RENDER_SIZE, total);

        for (let i = start; i < end; i++) {
          if (isArray) {
            const isLastItem = i === data.length - 1;
            container.appendChild(createJsonNode(data[i], null, isLastItem, depth));
          } else {
            const k = items[i];
            const keys = items;
            const isLastItem = i === keys.length - 1;
            container.appendChild(createJsonNode(data[k], k, isLastItem, depth));
          }
        }

        rendered = end;

        // 继续渲染剩余节点
        if (rendered < total) {
          requestAnimationFrame(renderBatch);
        }
      }

      renderBatch();
    }

    // XML 渲染器（主线程）
    function renderXmlTree(container, node) {
      container.innerHTML = '';
      container.appendChild(createXmlTree(node));

      // 如果搜索栏可见且有搜索词，自动重新搜索
      const searchBar = document.getElementById('xml-search-bar');
      const searchInput = document.getElementById('xml-search-input');
      if (searchBar && searchBar.style.display !== 'none' && searchInput && searchInput.value) {
        setTimeout(() => performXmlSearch(), 50);
      } else {
        // 否则重置搜索状态
        currentXmlSearchMatches = [];
        currentXmlSearchIndex = -1;
        const countEl = document.getElementById('xml-search-count');
        if(countEl) countEl.textContent = '';
      }
    }

    function createXmlTree(node, depth = 0) {
      // 1. 处理文本节点（叶子）
      if (node.nodeType === 3) {
          const text = node.textContent.trim();
          return text ? createSpan(text, 'xml-content') : document.createTextNode('');
      }
      if (node.nodeType !== 1) return document.createTextNode('');

      const wrapper = document.createElement('div');

      // 判断是否为"简单"节点（仅文本子节点或为空）或"复杂"节点（包含元素子节点）
      let isComplex = false;
      let hasText = false;
      const childNodes = Array.from(node.childNodes);
      for(let child of childNodes) {
          if(child.nodeType === 1) { isComplex = true; break; }
          if(child.nodeType === 3 && child.textContent.trim()) hasText = true;
      }

      const header = document.createElement("div");
      // 提取属性用于上下文菜单
      const attrs = Array.from(node.attributes).map(a => `${a.name}="${a.value}"`).join(" ");
      const xmlType = isComplex ? "xml-node" : "xml-leaf";

      // 获取内部文本值（递归获取所有文本内容）
      const innerText = node.textContent.trim();
      const innerValue = innerText.length > 0 ? innerText : null;

      const tagContext = {
          key: node.tagName,
          value: attrs.length > 0 ? attrs : null,
          innerValue: innerValue,
          type: xmlType,
          element: wrapper  // 添加 element 引用用于树操作
      };

      header.oncontextmenu = (e) => showContextMenu(e, tagContext);

      // 图标
      const icon = document.createElement('span');
      if (isComplex) {
          icon.className = 'tree-icon';
          icon.textContent = '<>';

          // 计算子节点数量
          const childElementCount = childNodes.filter(c => c.nodeType === 1).length;

          // 判断是否需要懒加载（子元素数量超过阈值且深度较大）
          const shouldLazyLoad = childElementCount > LAZY_RENDER_THRESHOLD && depth > 2;
          const defaultCollapsed = shouldLazyLoad;

          // 切换逻辑
          const toggleFn = (e) => {
              const kids = wrapper.querySelector('.tree-children');
              const isCollapsed = kids.classList.toggle('collapsed');
              icon.classList.toggle('collapsed', isCollapsed);
              // 切换页脚可见性
              const footer = wrapper.querySelector('.tree-footer');
              if(footer) footer.style.display = isCollapsed ? 'none' : 'flex';

              // 懒加载：首次展开时渲染子节点
              if (!isCollapsed && kids.dataset.lazy === 'true') {
                kids.dataset.lazy = 'false';
                renderXmlChildren(kids, node);
              }

              if(e.altKey) {
                  wrapper.querySelectorAll('.tree-children, .tree-icon').forEach(el => {
                    if (el.dataset.lazy !== 'true') {
                      el.classList.toggle('collapsed', isCollapsed);
                    }
                  });
                  // 是否处理所有页脚一起收起/展开
                  wrapper.querySelectorAll('.tree-footer').forEach(el => {
                     el.style.display = isCollapsed ? 'none' : 'flex';
                  });
              }
          };
          icon.onclick = toggleFn;
          icon.dataset.defaultCollapsed = defaultCollapsed ? 'true' : 'false';
      } else {
          // 用图标占位对齐
          icon.className = 'tree-spacer';
      }
      header.appendChild(icon);

      // 内容容器（避免 Flex 布局导致空格丢失）
      const contentSpan = document.createElement('span');
      header.appendChild(contentSpan);

      // 开始标签
      contentSpan.appendChild(createSpan('<', 'token-punctuation'));
      contentSpan.appendChild(createSpan(node.tagName, 'xml-tag'));
      Array.from(node.attributes).forEach(attr => {
        contentSpan.appendChild(document.createTextNode(' '));
        contentSpan.appendChild(createSpan(attr.name, 'xml-attr'));
        contentSpan.appendChild(createSpan('="', 'token-punctuation'));
        contentSpan.appendChild(createSpan(attr.value, 'xml-string'));
        contentSpan.appendChild(createSpan('"', 'token-punctuation'));
      });

      // 处理内容
      if (!isComplex) {
          // 简单节点：<tag>内容</tag> 或 <tag />
          if (hasText) {
              contentSpan.appendChild(createSpan('>', 'token-punctuation'));
              contentSpan.appendChild(createSpan(node.textContent.trim(), 'xml-content'));
              contentSpan.appendChild(createSpan('</', 'token-punctuation'));
              contentSpan.appendChild(createSpan(node.tagName, 'xml-tag'));
              contentSpan.appendChild(createSpan('>', 'token-punctuation'));
          } else {
              contentSpan.appendChild(createSpan(' />', 'token-punctuation'));
          }
          wrapper.appendChild(header);
      } else {
          // 复杂节点：<tag> ... 子节点 ... </tag>
          contentSpan.appendChild(createSpan('>', 'token-punctuation'));
          wrapper.appendChild(header);

          const children = document.createElement('div');
          children.className = 'tree-children';

          // 判断是否需要懒加载
          const childElementCount = childNodes.filter(c => c.nodeType === 1).length;
          const shouldLazyLoad = childElementCount > LAZY_RENDER_THRESHOLD && depth > 2;

          if (shouldLazyLoad) {
            // 默认折叠状态，使用懒加载
            children.classList.add('collapsed');
            children.dataset.lazy = 'true';
            icon.classList.add('collapsed');
          } else {
            // 立即渲染子节点
            renderXmlChildren(children, node, depth + 1);
          }

          wrapper.appendChild(children);

          // 页脚
          const footer = document.createElement('div');
          footer.className = 'tree-row tree-footer';
          if (shouldLazyLoad) {
            footer.style.display = 'none';
          }
          footer.oncontextmenu = (e) => showContextMenu(e, tagContext);

          const fSpacer = document.createElement('span');
          fSpacer.className = 'tree-spacer';
          footer.appendChild(fSpacer);

          const fContent = document.createElement('span');
          footer.appendChild(fContent);

          fContent.appendChild(createSpan('</', 'token-punctuation'));
          fContent.appendChild(createSpan(node.tagName, 'xml-tag'));
          fContent.appendChild(createSpan('>', 'token-punctuation'));
          wrapper.appendChild(footer);
      }

      return wrapper;
    }

    // 渲染 XML 子节点（支持分批渲染）
    function renderXmlChildren(container, parentNode, depth = 0) {
      const childNodes = Array.from(parentNode.childNodes);
      const total = childNodes.length;

      // 小数量直接渲染
      if (total <= BATCH_RENDER_SIZE) {
        childNodes.forEach(child => {
           const childNode = createXmlTree(child, depth);
           if (childNode.nodeType === 3 && !childNode.textContent) return;

           if (child.nodeType === 3) {
               const t = child.textContent.trim();
               if(!t) return;
               const row = document.createElement('div');
               row.className = 'tree-row';
               const sp = document.createElement('span');
               sp.className = 'tree-spacer';
               row.appendChild(sp);
               row.appendChild(createSpan(t, 'xml-content'));
               container.appendChild(row);
           } else if (child.nodeType === 1) {
               container.appendChild(childNode);
           }
        });
        return;
      }

      // 大数量分批渲染
      let rendered = 0;

      function renderBatch() {
        const start = rendered;
        const end = Math.min(start + BATCH_RENDER_SIZE, total);

        for (let i = start; i < end; i++) {
           const child = childNodes[i];
           const childNode = createXmlTree(child, depth);
           if (childNode.nodeType === 3 && !childNode.textContent) continue;

           if (child.nodeType === 3) {
               const t = child.textContent.trim();
               if(!t) continue;
               const row = document.createElement('div');
               row.className = 'tree-row';
               const sp = document.createElement('span');
               sp.className = 'tree-spacer';
               row.appendChild(sp);
               row.appendChild(createSpan(t, 'xml-content'));
               container.appendChild(row);
           } else if (child.nodeType === 1) {
               container.appendChild(childNode);
           }
        }

        rendered = end;

        // 继续渲染剩余节点
        if (rendered < total) {
          requestAnimationFrame(renderBatch);
        }
      }

      renderBatch();
    }

    // SQL 渲染器（简单分词器）
    function renderSql(container, sql) {
      container.innerHTML = '';
      // 支持转义字符的字符串匹配
      const tokens = sql.split(/(\s+|'[^'\\]*(?:\\.[^'\\]*)*'|"[^"\\]*(?:\\.[^"\\]*)*"|[(),;])/);
      tokens.forEach(t => {
        if (!t) return;
        let cls = '';
        const up = t.toUpperCase();
        if (/^(SELECT|FROM|WHERE|INSERT|UPDATE|DELETE|JOIN|LEFT|RIGHT|INNER|OUTER|ON|AND|OR|ORDER|GROUP|BY|LIMIT|VALUES|SET|AS|IN|IS|NULL|NOT|LIKE)$/.test(up)) cls = 'sql-keyword';
        else if (/^(COUNT|SUM|AVG|MAX|MIN|NOW|DATE)$/.test(up)) cls = 'sql-function';
        else if (/^['"]/.test(t)) cls = 'sql-string';
        else if (/^\d+/.test(t)) cls = 'token-number';
        container.appendChild(createSpan(t, cls));
      });
    }

    // --- 辅助函数 ---
    function createSpan(text, cls, style) {
      const s = document.createElement('span');
      s.textContent = text;
      if (cls) s.className = cls;
      if (style) Object.assign(s.style, style);
      return s;
    }

    function escapeHtml(unsafe) {
      if (typeof unsafe !== 'string') return unsafe;
      return unsafe
         .replace(/&/g, "&amp;")
         .replace(/</g, "&lt;")
         .replace(/>/g, "&gt;")
         .replace(/"/g, "&quot;")
         .replace(/'/g, "&#039;");
    }

    function switchTab(tab) {
      document.querySelectorAll('.tab-trigger').forEach(b => b.classList.toggle('is-active', b.dataset.tab === tab));
      document.querySelectorAll('.tab-panel').forEach(p => p.classList.toggle('is-active', p.id === `panel-${tab}`));
      saveSetting('active-tab', tab);
    }

    const THEMES = ['dark', 'light', 'dracula', 'forest', 'warm', 'neon', 'cosmic', 'monokai', 'nord', 'synthwave', 'matrix'];

    function toggleTheme() {
      const idx = THEMES.indexOf(state.theme);
      const next = (idx + 1) % THEMES.length;
      state.theme = THEMES[next];
      document.documentElement.setAttribute('data-et-theme', state.theme);
      saveSetting('theme', state.theme);
      showToast('主题切换: ' + state.theme);
    }

    function toggleModal(id, show) {
      document.getElementById(id).classList.toggle('active', show);
    }

    // 历史记录保存队列，解决竞态条件
    const historySaveQueue = {
      _queue: [],
      _processing: false,

      enqueue(newHistory) {
        this._queue.push(newHistory);
        if (!this._processing) {
          this._processing = true;
          this._process();
        }
      },

      async _process() {
        while (this._queue.length > 0) {
          const historyToSave = this._queue.shift();
          try {
            await new Promise((resolve) => {
              saveHistoryArray(historyToSave);
              setTimeout(resolve, 50);
            });
          } catch (e) {
            console.error('历史记录保存失败', e);
          }
        }
        this._processing = false;
      }
    };

    function addToHistory(type, content, meta) {
      if (!state.enableHistory) return;
      if (state.skipHistoryCount && state.skipHistoryCount > 0) {
        state.skipHistoryCount--;
        return;
      }
      if (state.skipNextHistory) {
        state.skipNextHistory = false;
        return;
      }
      const full = typeof content === 'string' ? content : String(content || '');
      const maxChars = type === 'base64' ? 20000 : HISTORY_ITEM_MAX_CHARS;
      if (!type || !full || full.length > maxChars) return;

      // 查重：检查最近3条记录，避免短时间内重复操作
      if (state.history.length > 0) {
        const checkCount = Math.min(3, state.history.length);
        for (let i = 0; i < checkCount; i++) {
          const last = state.history[i];
          const lastFull = typeof last.full === 'string' ? last.full : '';
          if (last.type === type && lastFull === full) return;
        }
      }

      const now = Date.now();
      const item = { type, full, ts: now };
      if (meta && typeof meta === 'object') item.meta = meta;

      // 先应用保留策略，再添加新记录，避免状态不一致
      const filteredHistory = filterHistory([...state.history, item]);

      // 更新状态和渲染
      state.history = filteredHistory;
      renderHistory();

      // 使用队列机制保存，避免竞态条件
      historySaveQueue.enqueue(filteredHistory);
    }

    function skipHistoryEntries(count = HISTORY_SKIP_BATCH) {
        state.skipHistoryCount = Math.max(0, parseInt(count, 10) || 0);
    }

    function renderHistory() {
      const list = els.historyList;
      list.innerHTML = '';
      const searchVal = document.getElementById('history-search') ? document.getElementById('history-search').value.toLowerCase() : '';

      if (!state.enableHistory) {
        list.innerHTML = '<div style="padding:1rem; text-align:center; color:var(--muted)">历史记录已关闭</div>';
        return;
      }

      // 显示保留策略信息（只计算一次）
      if (state.history.length > 0) {
        const now = Date.now();
        const sevenDaysAgo = now - (HISTORY_RETENTION_DAYS * 24 * 60 * 60 * 1000);
        // 复用后续的过滤结果，避免重复遍历
        let recentCount = state.history.length;
        let hasOldItems = false;

        // 先检查是否有需要显示策略信息的情况
        if (state.history.length >= HISTORY_MAX) {
          // 计算最近7天的数量
          recentCount = state.history.filter(h => h.ts >= sevenDaysAgo).length;
          hasOldItems = true;
        } else {
          // 快速检查是否有旧数据
          for (let i = 0; i < state.history.length; i++) {
            if (state.history[i].ts < sevenDaysAgo) {
              hasOldItems = true;
              recentCount = state.history.filter(h => h.ts >= sevenDaysAgo).length;
              break;
            }
          }
        }

        if (hasOldItems || state.history.length >= HISTORY_MAX) {
          const infoDiv = document.createElement('div');
          infoDiv.style.cssText = 'padding:0.5rem; background:var(--bg-soft); border-radius:4px; margin:0.5rem; font-size:0.85rem; color:var(--muted);';
          infoDiv.innerHTML = `保留策略: 最近${HISTORY_RETENTION_DAYS}天 + 最多${HISTORY_MAX}条 (当前: ${state.history.length}条, 最近7天: ${recentCount}条)`;
          list.appendChild(infoDiv);
        }
      }

      const filtered = state.history.filter(item => {
          if (!searchVal) return true;
          const fullStr = (item.full || '').toLowerCase();
          const typeStr = (item.type || '').toLowerCase();
          const timeStr = item.ts ? new Date(item.ts).toLocaleString().toLowerCase() : '';
          return fullStr.includes(searchVal) || typeStr.includes(searchVal) || timeStr.includes(searchVal);
      });

      if (filtered.length === 0) {
          const emptyMsg = searchVal
              ? `<div style="padding:1rem; text-align:center; color:var(--muted)">无匹配记录<br><small style="opacity:0.7">搜索条件: "${searchVal}"</small></div>`
              : '<div style="padding:1rem; text-align:center; color:var(--muted)">无记录</div>';
          list.innerHTML = emptyMsg;
          return;
      }

      let lastDate = null;
      let currentGroupBody = null;

      const typeLabels = {
        json: 'JSON',
        xml: 'XML',
        sql: 'SQL',
        diff: 'DIFF',
        timestamp: '时间戳',
        base64: 'Base64',
        network: '网络',
        html: 'HTML',
        regex: '正则',
        url: 'URL',
        jwt: 'JWT',
        crypto: '加密',
        cron: 'Cron',
        mock: 'Mock',
        snowflake: '雪花ID',
        uuid: 'UUID',
        password: '密码'
      };
      const typeToTab = { snowflake: 'other', uuid: 'other', password: 'other' };

      function restoreHistoryItem(item) {
        const type = item.type;

        if (type === 'mock') {
          skipHistoryEntries();
          switchTab(typeToTab[type] || type);
          try {
            const parsed = JSON.parse(item.full);
            renderMockResult(parsed);
          } catch (e) {
            
            showToast('Mock数据解析失败，可能已损坏');
            return false;
          }
          const out = document.getElementById('mock-output');
          if (out) out.scrollIntoView({ block: 'center' });
          return true;
        }

        if (type === 'snowflake') {
          skipHistoryEntries();
          switchTab(typeToTab[type] || type);
          const meta = item.meta && typeof item.meta === 'object' ? item.meta : null;
          const snowOutput = document.getElementById('snow-output');
          if (meta && meta.raw && document.getElementById('snow-datacenter') && document.getElementById('snow-worker')) {
            document.getElementById('snow-datacenter').value = String(meta.dc ?? '1');
            document.getElementById('snow-worker').value = String(meta.worker ?? '1');
            if (document.getElementById('snow-js-safe')) document.getElementById('snow-js-safe').checked = !!meta.jsSafe;
            if (document.getElementById('snow-short')) document.getElementById('snow-short').checked = !!meta.base62;
            try { lastSnowRawID = BigInt(meta.raw); } catch (e) { lastSnowRawID = null; }
            renderSnowflakeOutput();
            const info = document.getElementById('snow-info');
            if (info && lastSnowRawID !== null) {
              const isJsSafe = !!meta.jsSafe;
              const ts = isJsSafe ? Number((lastSnowRawID >> 12n) + SNOW_EPOCH) : Number((lastSnowRawID >> 22n) + SNOW_EPOCH);
              const date = new Date(ts);
              const bitInfo = isJsSafe ? '53位 (JS安全)' : '64位 (标准)';
              info.innerHTML = `<strong>模式:</strong> ${bitInfo} &nbsp; <strong>时间戳:</strong> ${ts}<br><strong>解析日期:</strong> ${date.toLocaleString()}.${date.getMilliseconds()}`;
            }
          } else if (snowOutput) {
            snowOutput.value = item.full;
          }
          const el = document.getElementById('snow-output');
          if (el) el.scrollIntoView({ block: 'center' });
          return true;
        }

        if (type === 'uuid') {
          skipHistoryEntries();
          switchTab(typeToTab[type] || type);
          const out = document.getElementById('uuid-output');
          if (out) out.value = item.full;
          const meta = item.meta && typeof item.meta === 'object' ? item.meta : null;
          if (meta) {
            if (document.getElementById('uuid-count') && meta.count != null) document.getElementById('uuid-count').value = String(meta.count);
            if (document.getElementById('uuid-no-hyphen') && meta.noHyphen != null) document.getElementById('uuid-no-hyphen').checked = !!meta.noHyphen;
            if (document.getElementById('uuid-upper') && meta.upper != null) document.getElementById('uuid-upper').checked = !!meta.upper;
          }
          if (document.getElementById('uuid-output')) document.getElementById('uuid-output').scrollIntoView({ block: 'center' });
          return true;
        }

        if (type === 'password') {
          skipHistoryEntries();
          switchTab(typeToTab[type] || type);
          const out = document.getElementById('pwd-output');
          if (out) out.value = item.full;
          const meta = item.meta && typeof item.meta === 'object' ? item.meta : null;
          if (meta) {
            if (document.getElementById('pwd-length') && meta.len != null) {
              document.getElementById('pwd-length').value = String(meta.len);
              const v = document.getElementById('pwd-len-val');
              if (v) v.textContent = String(meta.len);
            }
            if (document.getElementById('pwd-upper') && meta.upper != null) document.getElementById('pwd-upper').checked = !!meta.upper;
            if (document.getElementById('pwd-lower') && meta.lower != null) document.getElementById('pwd-lower').checked = !!meta.lower;
            if (document.getElementById('pwd-number') && meta.number != null) document.getElementById('pwd-number').checked = !!meta.number;
            if (document.getElementById('pwd-special') && meta.special != null) document.getElementById('pwd-special').checked = !!meta.special;
          }
          if (document.getElementById('pwd-output')) document.getElementById('pwd-output').scrollIntoView({ block: 'center' });
          return true;
        }

        // 处理其他类型：network, regex, jwt, diff, crypto, cron
        // 这些类型没有专门的输入框，只显示结果，不恢复输入
        if (type === 'network' || type === 'regex' || type === 'jwt' ||
            type === 'diff' || type === 'crypto' || type === 'cron') {
          // 这些类型通常没有输入框需要恢复
          // 只是记录结果，所以直接返回true表示处理成功
          // 用户可以通过点击历史记录来复制结果
          return true;
        }

        // 通用处理：有input元素的类型
        if (els[type] && els[type].input) {
          skipHistoryEntries();
          switchTab(typeToTab[type] || type);
          els[type].input.value = item.full;
          try { els[type].input.dispatchEvent(new Event('input')); } catch (_) {}
          els[type].input.scrollIntoView({ block: 'center' });
          return true;
        }

        return false;
      }

      filtered.forEach(item => {
          let dateStr = '更早以前';
          if (item.ts) {
             dateStr = new Date(item.ts).toLocaleDateString();
          }

          if (dateStr !== lastDate) {
              const group = document.createElement('div');
              group.className = 'history-date-group';
              
              const header = document.createElement('div');
              header.className = 'history-date-header';
              header.innerHTML = `<span>${dateStr}</span><span class="arrow">▼</span>`;
              header.onclick = () => {
                  body.classList.toggle('collapsed');
                  header.classList.toggle('collapsed');
              };

              const body = document.createElement('div');
              body.className = 'history-date-body';
              
              group.appendChild(header);
              group.appendChild(body);
              list.appendChild(group);
              
              currentGroupBody = body;
              lastDate = dateStr;
          }

          const div = document.createElement('div');
          div.className = 'history-item';
          const timeStr = item.ts ? new Date(item.ts).toLocaleTimeString() : '';
          const label = typeLabels[item.type] || (item.type || '').toUpperCase();
          const preview = (item.full || '').length > HISTORY_PREVIEW_MAX_CHARS ? (item.full || '').slice(0, HISTORY_PREVIEW_MAX_CHARS) + '…' : (item.full || '');
          const titleText = (item.full || '').length > 2000 ? (item.full || '').slice(0, 2000) + '…' : (item.full || '');
          
          div.innerHTML = `
            <div class="history-content-wrapper">
                <span class="history-time"><span class="history-badge">${escapeHtml(label)}</span> • ${escapeHtml(timeStr)}</span>
                <span class="history-meta" title="${escapeHtml(titleText)}">${escapeHtml(preview)}</span>
            </div>
            <div class="history-actions">
                <button class="btn-mini btn-copy-hist">复制</button>
                <button class="btn-mini danger btn-del-hist">删除</button>
            </div>
          `;
          
          div.onclick = (e) => {
            // Prevent triggering if clicking action buttons
            if (e.target.closest('.history-actions')) return;
            const restored = restoreHistoryItem(item);
            toggleModal('modal-history', false);
            if (restored) showToast('已恢复记录');
            else copyText(item.full, '已复制记录');
          };

          const btnCopy = div.querySelector('.btn-copy-hist');
          btnCopy.onclick = (e) => {
              e.stopPropagation();
              copyText(item.full);
          };

          const btnDel = div.querySelector('.btn-del-hist');
          btnDel.onclick = (e) => {
              e.stopPropagation();
              // 从状态中移除
              state.history = state.history.filter(h => h !== item);
              // 应用保留策略并保存
              state.history = filterHistory(state.history);
              saveHistoryArray(state.history);
              renderHistory();
              showToast('已删除');
          };

          currentGroupBody.appendChild(div);
      });
    }

    function readFile(file) {
      const reader = new FileReader();
      reader.onload = (e) => {
        const content = e.target.result;
        const trimmed = (content || '').trim();
        // 简单判断：根据内容首字符选择类型
        if (trimmed.startsWith('<')) {
           switchTab('xml');
           els.xml.input.value = content;
           try { els.xml.input.dispatchEvent(new Event('input')); } catch (_) {}
        } else if (/^(SELECT|INSERT|UPDATE|DELETE|WITH|CREATE|ALTER|DROP|TRUNCATE|REPLACE)\b/i.test(trimmed)) {
           switchTab('sql');
           els.sql.input.value = content;
           try { els.sql.input.dispatchEvent(new Event('input')); } catch (_) {}
        } else {
           switchTab('json');
           els.json.input.value = content;
           try { els.json.input.dispatchEvent(new Event('input')); } catch (_) {}
        }
        showToast('文件已导入');
      };
      reader.readAsText(file);
    }

    function requestPasteText() {
      const promptFallback = () => {
        const val = prompt('请粘贴内容：');
        return val === null ? null : val;
      };

      const isMobile = (() => {
        try {
          const ua = navigator.userAgent || '';
          return /Android|iPhone|iPad|iPod|Mobi/i.test(ua);
        } catch (_) {
          return false;
        }
      })();

      // 移动端/部分浏览器对剪贴板读取限制更严格（异步后 user-activation 也可能丢失），优先使用手动粘贴兜底，避免报错。
      if (isMobile) return Promise.resolve(promptFallback());

      try {
        if (navigator.clipboard && typeof navigator.clipboard.readText === 'function' && window.isSecureContext) {
          return navigator.clipboard.readText().catch(() => Promise.resolve(promptFallback()));
        }
      } catch (_) {}

      return Promise.resolve(promptFallback());
    }

    function pasteTo(id, storageKey, after) {
      const el = document.getElementById(id);
      if (!el) return showToast('未找到输入框');
      return pasteToEl(el, storageKey, after);
    }

    function pasteToEl(el, storageKey, after) {
      return requestPasteText().then((t) => {
        if (t == null) return;
        if ('value' in el) el.value = t;
        else el.textContent = t;
        if (storageKey) safeStorage.set(storageKey, t);
        if (typeof after === 'function') after(t);
        try { el.dispatchEvent(new Event('input')); } catch (_) {}
        showToast('已粘贴', 'success');
      }).catch((e) => showToast('粘贴失败: ' + (e && e.message ? e.message : String(e)), 'error'));
    }

    // 清空输入框
    function clearInput(type) {
        const typeMap = {
            'yaml': 'yaml',
            'html': 'html',
            'javascript': 'js',
            'css': 'css'
        };
        const key = typeMap[type] || type;
        if (els[key] && els[key].input) {
            els[key].input.value = '';
            const storageKey = key === 'html' ? 'html-fmt-input' : key + '-input';
            safeStorage.set(storageKey, '');
            showToast('已清空');
        }
    }

    // 读取剪贴板内容到输入框
    function readClipboardTo(type) {
        const typeMap = {
            'yaml': 'yaml',
            'html': 'html',
            'javascript': 'js',
            'css': 'css'
        };
        const key = typeMap[type] || type;
        if (els[key] && els[key].input) {
            return pasteToEl(els[key].input, key === 'html' ? 'html-fmt-input' : key + '-input', () => {
                // 对于 HTML，自动触发格式化
                if (type === 'html' && els.html.input.value) {
                    process('html', 'html-format');
                }
            });
        }
        return Promise.reject('未找到输入框');
    }

    function copyText(text, okMsg) {
      if (!text) return showToast('无内容可复制', 'warning');
      const fallbackCopy = () => {
        try {
          const ta = document.createElement('textarea');
          ta.value = text;
          ta.setAttribute('readonly', '');
          ta.style.position = 'fixed';
          ta.style.top = '-9999px';
          ta.style.left = '-9999px';
          document.body.appendChild(ta);
          ta.select();
          ta.setSelectionRange(0, ta.value.length);
          const ok = document.execCommand && document.execCommand('copy');
          document.body.removeChild(ta);
          if (ok) showToast(okMsg || '复制成功', 'success');
          else showToast('复制失败', 'error');
        } catch (_) {
          showToast('复制失败', 'error');
        }
      };

      if (navigator.clipboard && typeof navigator.clipboard.writeText === 'function' && window.isSecureContext) {
        navigator.clipboard.writeText(text).then(() => showToast(okMsg || '复制成功', 'success')).catch(() => fallbackCopy());
        return;
      }
      fallbackCopy();
    }

    // 统一提示系统
    function showToast(msg, type = 'info') {
      // 支持类型: 'success', 'error', 'warning', 'info'
      // 兼容旧调用方式: showToast(msg) 或 showToast(msg, type)
      if (typeof type !== 'string') type = 'info';

      // 清除之前的类型类
      els.toast.classList.remove('toast-success', 'toast-error', 'toast-warning', 'toast-info');
      els.toast.classList.add('toast-' + type);
      els.toast.textContent = msg;
      els.toast.classList.add('visible');

      if (els.toast.timeout) clearTimeout(els.toast.timeout);

      // 根据类型设置不同的显示时长
      const duration = type === 'error' ? 3000 : (type === 'success' ? 2000 : 2500);
      els.toast.timeout = setTimeout(() => {
        els.toast.classList.remove('visible');
        // 延迟移除类型类，等待动画完成
        setTimeout(() => {
          els.toast.classList.remove('toast-success', 'toast-error', 'toast-warning', 'toast-info');
        }, 300);
      }, duration);
    }

    // 便捷方法：显示错误提示
    function showError(msg, originalError) {
      if (originalError && originalError.message) {
        msg = `${msg}: ${originalError.message}`;
      }
      showToast(msg, 'error');
    }

    // 便捷方法：显示成功提示
    function showSuccess(msg) {
      showToast(msg, 'success');
    }

    // 便捷方法：显示警告提示
    function showWarning(msg) {
      showToast(msg, 'warning');
    }

    function expandAll(container) { container.querySelectorAll('.tree-children').forEach(e => e.classList.remove('collapsed')); container.querySelectorAll('.tree-toggle').forEach(e => e.classList.remove('collapsed')); }
    function collapseAll(container) { container.querySelectorAll('.tree-children').forEach(e => e.classList.add('collapsed')); container.querySelectorAll('.tree-toggle').forEach(e => e.classList.add('collapsed')); }

    // --- 示例数据 ---
    const sampleData = {
      base64: [
          'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMDAwIiBoZWlnaHQ9IjIwMDAiIHZpZXdCb3g9IjAgMCAyMDAwIDIwMDAiPgo8cmVjdCB3aWR0aD0iMjAwMCIgaGVpZ2h0PSIyMDAwIiBmaWxsPSIjZWVlZmZmIi8+CjxsaW5lIHgxPSIwIiB5MT0iMCIgeDI9IjIwMDAiIHkyPSIyMDAwIiBzdHJva2U9InJlZCIgc3Ryb2tlLXdpZHRoPSIxMCIvPgo8bGluZSB4MT0iMjAwMCIgeTE9IjAiIHgyPSIwIiB5Mj0iMjAwMCIgc3Ryb2tlPSJibHVlIiBzdHJva2Utd2lkdGg9IjEwIi8+CjxyZWN0IHg9IjEwIiB5PSIxMCIgd2lkdGg9IjE5ODAiIGhlaWdodD0iMTk4MCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSJncmVlbiIgc3Ryb2tlLXdpZHRoPSIyMCIvPgo8dGV4dCB4PSIxMDAwIiB5PSIxMDAiIGZvbnQtc2l6ZT0iMTAwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSJibGFjayI+TGFyZ2UgU2FtcGxlIEltYWdlICgyMDAweDIwMDApPC90ZXh0Pgo8dGV4dCB4PSIxMDAwIiB5PSIxOTAwIiBmb250LXNpemU9IjEwMCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZmlsbD0iYmxhY2siPkJvdHRvbSBUZXh0PC90ZXh0Pgo8L3N2Zz4=',
          'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0MDAiIGhlaWdodD0iMzAwIiB2aWV3Qm94PSIwIDAgNDAwIDMwMCI+PGRlZnM+PGxpbmVhckdyYWRpZW50IGlkPSJncmFkMSIgeDE9IjAlIiB5MT0iMCUiIHgyPSIxMDAlIiB5Mj0iMTAwJSI+PHN0b3Agb2Zmc2V0PSIwJSIgc3R5bGU9InN0b3AtY29sb3I6I2ZmOWE5ZTtzdG9wLW9wYWNpdHk6MSIgLz48c3RvcCBvZmZzZXQ9IjEwMCUiIHN0eWxlPSJzdG9wLWNvbG9yOiNmZWNmZWY7c3RvcC1vcGFjaXR5OjEiIC8+PC9saW5lYXJHcmFkaWVudD48L2RlZnM+PHJlY3Qgd2lkdGg9IjQwMCIgaGVpZ2h0PSIzMDAiIGZpbGw9InVybCgjZ3JhZDEpIiAvPjxjaXJjbGUgY3g9IjIwMCIgY3k9IjE1MCIgcj0iODAiIGZpbGw9InJnYmEoMjU1LDI1NSwyNTUsMC4zKSIgLz48dGV4dCB4PSI1MCUiIHk9IjUwJSIgZG9taW5hbnQtYmFzZWxpbmU9Im1pZGRsZSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIiBmb250LXNpemU9IjI0IiBmaWxsPSJ3aGl0ZSIgZm9udC13ZWlnaHQ9ImJvbGQiPkJlYXV0aWZ1bCBHcmFkaWVudDwvdGV4dD48L3N2Zz4=',
          'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0MDAiIGhlaWdodD0iMzAwIiB2aWV3Qm94PSIwIDAgNDAwIDMwMCI+PHJlY3Qgd2lkdGg9IjQwMCIgaGVpZ2h0PSIzMDAiIGZpbGw9IiMxYTFhMmUiIC8+PHBhdGggZD0iTTAsMTUwIFExMDAsNTAgMjAwLDE1MCBUNDAwLDE1MCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjZTk0NTYwIiBzdHJva2Utd2lkdGg9IjUiIC8+PHBhdGggZD0iTTAsMTgwIFExMDAsODAgMjAwLDE4MCBUNDAwLDE4MCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMGYzNDYwIiBzdHJva2Utd2lkdGg9IjUiIC8+PGNpcmNsZSBjeD0iNTAiIGN5PSI1MCIgcj0iMjAiIGZpbGw9IiMxNjIxM2UiIC8+PGNpcmNsZSBjeD0iMzUwIiBjeT0iMjUwIiByPSIzMCIgZmlsbD0iIzE2MjEzZSIgLz48dGV4dCB4PSIzODAiIHk9IjI4MCIgdGV4dC1hbmNob3I9ImVuZCIgZm9udC1mYW1pbHk9IkNvdXJpZXIgTmV3LCBtb25vc3BhY2UiIGZvbnQtc2l6ZT0iMTYiIGZpbGw9IiNlOTQ1NjAiPjovL0N5YmVyLldhdmU8L3RleHQ+PC9zdmc+',
          'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0MDAiIGhlaWdodD0iMzAwIiB2aWV3Qm94PSIwIDAgNDAwIDMwMCI+PHJlY3Qgd2lkdGg9IjQwMCIgaGVpZ2h0PSIzMDAiIGZpbGw9IiNmZmZmZmYiIC8+PHJlY3QgeD0iNTAiIHk9IjUwIiB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iI2ZmNmI2YiIgcng9IjEwIiAvPjxyZWN0IHg9IjEyMCIgeT0iODAiIHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjZmVjYTU3IiByeD0iMTAiIGZpbGwtb3BhY2l0eT0iMC44IiAvPjxyZWN0IHg9IjE5MCIgeT0iMTEwIiB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iIzQ4ZGJmYiIgcng9IjEwIiBmaWxsLW9wYWNpdHk9IjAuOCIgLz48cmVjdCB4PSIyNjAiIHk9IjE0MCIgd2lkdGg9IjEwMCIgaGVpZ2h0PSIxMDAiIGZpbGw9IiNmZjlmZjMiIHJ4PSIxMCIgZmlsbC1vcGFjaXR5PSIwLjgiIC8+PHRleHQgeD0iMjAiIHk9IjI4MCIgZm9udC1mYW1pbHk9IkhlbHZldGljYSwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIyMCIgZmlsbD0iIzU3NjU3NCIgZm9udC13ZWlnaHQ9ImJvbGQiPk1vZGVybiBTaGFwZXM8L3RleHQ+PC9zdmc+'
      ],
      url: [
          'https://www.google.com/search?q=EasyTools&hl=zh-CN&tbm=isch&source=hp',
          'https://api.example.com/v1/users?filters[role]=admin&filters[status]=active&include=profile,permissions&sort=-created_at',
          'https://example.com/callback?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9&redirect_url=https%3A%2F%2Fapp.example.com%2Fdashboard%3Fref%3Dlogin',
          'ftp://user:password@ftp.example.com:2121/path/to/file.txt?mode=binary',
          'https://www.example.com/search?q=前端开发&category=tools'
      ],
      json: [
        '{"appConfig":{"version":"2.5.0","isDebug":true,"server_url":"https://api.prod.example.com","maxRetries":5,"features":{"darkMode":true,"BetaFeature":false},"supported_regions":["US","EU","CN"]},"UserPreferences":{"theme":"Solarized Dark","notifications_enabled":true,"RecentFiles":["report_2024.pdf","data.csv"]}}',
        '{"status":"success","code":200,"data":{"userId":1024,"UserName":"AdminUser","email":"admin@example.com","is_verified":true,"lastLogin":null,"roles":[{"roleId":"R_01","RoleName":"Administrator","permissions":["read","write","delete"]},{"roleId":"R_02","RoleName":"Auditor","permissions":["read"]}],"meta_info":{"created_at":"2023-12-01T10:00:00Z","login_count":42}}}',
        '{"product_id":"PROD-9988","Name":"Ergonomic Chair","price_info":{"currency":"USD","amount":299.99,"discount":0.1},"in_stock":true,"specs":{"Material":"Mesh","ColorOptions":["Black","Grey","Blue"],"Dimensions":{"width":60,"height":110,"depth":60}},"reviews":[{"user":"Alice","rating":5,"comment":"Excellent support!"},{"user":"Bob","rating":4,"comment":"Good value."}]}',
        '{"apiResponse":{"totalCount":156,"page":1,"pageSize":20,"items":[{"id":"A001","name":"Product A","category":"Electronics","price":99.99,"available":true,"tags":["new","featured"]},{"id":"B002","name":"Product B","category":"Home","price":49.99,"available":false,"tags":["sale"]}],"filters":{"priceRange":"0-500","categories":["Electronics","Home"],"sort":"price_asc"}}}',
        '{"dashboard":{"stats":{"totalUsers":12500,"activeUsers":8900,"revenue":456000.50,"growthRate":12.5},"charts":[{"type":"line","title":"User Growth","dataPoints":[120,150,180,220,280,350]},{"type":"bar","title":"Revenue","dataPoints":[45000,52000,61000,78000]}],"alerts":[{"level":"warning","message":"Server load high"},{"level":"info","message":"New user milestone"}]}}'
      ],
      xml: [
        '<?xml version="1.0" encoding="UTF-8"?><soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope" xmlns:m="http://www.example.org/stock"><soap:Header><m:TransactionID>UUID-1234-5678</m:TransactionID></soap:Header><soap:Body><m:GetStockPrice><m:StockName>IBM</m:StockName><m:DateRange start="2023-01-01" end="2023-12-31"/></m:GetStockPrice></soap:Body></soap:Envelope>',
        '<?xml version="1.0" encoding="UTF-8"?><Configuration environment="Production"><Database><Host>db.example.com</Host><Port>5432</Port><User>admin</User><Password encrypted="true">Xk9s8!=</Password></Database><Logging level="DEBUG"><File path="/var/log/app.log" rotate="daily"/><Console enabled="true"/></Logging><Features><Feature name="NewUI" enabled="true"/><Feature name="BetaAPI" enabled="false"/></Features></Configuration>',
        '<?xml version="1.0"?><catalog><book id="bk101"><author>Gambardella, Matthew</author><title>XML Developer\'s Guide</title><genre>Computer</genre><price>44.95</price><publish_date>2000-10-01</publish_date><description>An in-depth look at creating applications with XML.</description></book><book id="bk102"><author>Ralls, Kim</author><title>Midnight Rain</title><genre>Fantasy</genre><price>5.95</price><publish_date>2000-12-16</publish_date><description>A former architect battles corporate zombies.</description></book></catalog>',
        '<svg width="400" height="110" xmlns="http://www.w3.org/2000/svg"><rect width="300" height="100" style="fill:rgb(0,0,255);stroke-width:3;stroke:rgb(0,0,0)" /><circle cx="50" cy="50" r="40" stroke="green" stroke-width="4" fill="yellow" /><text x="150" y="55" fill="white" font-size="24" font-family="Verdana">Complex SVG</text><path d="M150 0 L75 200 L225 200 Z" fill="orange" transform="translate(100,0) scale(0.5)"/></svg>',
        '<?xml version="1.0" encoding="UTF-8"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Tech Insider</title><link>https://www.techinsider.io</link><description>Deep dives into technology.</description><language>en-us</language><lastBuildDate>Mon, 06 Sep 2024 00:01:00 +0000</lastBuildDate><item><title>The Future of AI</title><link>https://www.techinsider.io/future-of-ai</link><guid isPermaLink="true">https://www.techinsider.io/future-of-ai</guid><pubDate>Sun, 05 Sep 2024 12:00:00 +0000</pubDate><category>Artificial Intelligence</category></item></channel></rss>'
      ],
      sql: [
        'SELECT u.id, u.username, COUNT(o.id) as order_count, SUM(o.total) as total_spent FROM users u LEFT JOIN orders o ON u.id = o.user_id WHERE u.created_at >= "2023-01-01" GROUP BY u.id, u.username HAVING total_spent > 1000 ORDER BY total_spent DESC;',
        'WITH RankedSales AS (SELECT salesperson_id, amount, RANK() OVER (PARTITION BY region_id ORDER BY amount DESC) as rank FROM sales) SELECT * FROM RankedSales WHERE rank <= 3;',
        'CREATE TABLE employees (id INT PRIMARY KEY AUTO_INCREMENT, first_name VARCHAR(50) NOT NULL, last_name VARCHAR(50) NOT NULL, email VARCHAR(100) UNIQUE, department_id INT, hire_date DATE DEFAULT CURRENT_DATE, CONSTRAINT fk_department FOREIGN KEY (department_id) REFERENCES departments(id));',
        'INSERT INTO products (name, category, price, stock) VALUES ("Laptop", "Electronics", 999.99, 10), ("Smartphone", "Electronics", 699.00, 25), ("Desk Chair", "Furniture", 150.50, 5), ("Coffee Mug", "Accessories", 12.99, 100);',
        'UPDATE inventory SET stock = stock - 1, last_updated = NOW() WHERE product_id = 101 AND stock > 0;'
      ],
      yaml: [
        'name: EasyTools\nversion: 1.0.0\ndescription: Developer Tools\nfeatures:\n  - json\n  - xml\n  - yaml\nsettings:\n  theme: dark\n  debug: true',
        'apiVersion: v1\nkind: Pod\nmetadata:\n  name: nginx\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.14.2\n    ports:\n    - containerPort: 80',
        'server:\n  port: 8080\n  host: 0.0.0.0\ndatabase:\n  url: jdbc:mysql://localhost:3306/db\n  username: root\n  password: password',
        'docker-compose:\n  version: "3.8"\n  services:\n    web:\n      build: .\n      ports:\n        - "5000:5000"\n      volumes:\n        - .:/code\n      environment:\n        FLASK_ENV: development\n    redis:\n      image: redis:alpine\n      ports:\n        - "6379:6379"',
        'spring:\n  application:\n    name: myapp\n  datasource:\n    url: jdbc:postgresql://localhost:5432/mydb\n    username: user\n    password: pass\n  jpa:\n    hibernate:\n      ddl-auto: update\n    show-sql: true\n  server:\n    port: 8080'
      ],
      html: [
        '<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>示例页面</title><style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;line-height:1.6}.container{max-width:1200px;margin:0 auto;padding:20px}.header{background:#007bff;color:#fff;padding:20px;text-align:center}.content{padding:20px;background:#f5f5f5;margin-top:20px;border-radius:8px}</style></head><body><div class="header"><h1>欢迎</h1><p>这是一个标准的 HTML5 页面示例</p></div><div class="container"><div class="content"><h2>主要内容</h2><p>包含响应式设计、语义化标签和现代样式</p></div></div></body></html>',
        '<div class="card shadow-sm"><div class="card-header d-flex justify-content-between align-items-center"><h5 class="mb-0">卡片组件</h5><span class="badge bg-primary">新</span></div><div class="card-body"><p class="card-text">这是一个使用 Bootstrap 风格的卡片组件示例，包含标题、徽章和内容区域。</p><button type="button" class="btn btn-primary">操作按钮</button></div></div>',
        '<form id="loginForm" class="needs-validation" novalidate><div class="mb-3"><label for="email" class="form-label">邮箱地址</label><input type="email" class="form-control" id="email" placeholder="name@example.com" required><div class="invalid-feedback">请输入有效的邮箱地址</div></div><div class="mb-3"><label for="password" class="form-label">密码</label><input type="password" class="form-control" id="password" required></div><button type="submit" class="btn btn-primary w-100">登录</button></form>',
        '<nav class="navbar navbar-expand-lg navbar-dark bg-dark"><div class="container-fluid"><a class="navbar-brand" href="#">品牌</a><button class="navbar-toggler" type="button" data-bs-toggle="collapse"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse"><ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link active" href="#">首页</a></li><li class="nav-item"><a class="nav-link" href="#">产品</a></li><li class="nav-item"><a class="nav-link" href="#">关于</a></li></ul></div></div></nav>',
        '<table class="table table-striped table-hover"><thead class="table-dark"><tr><th scope="col">ID</th><th scope="col">姓名</th><th scope="col">部门</th><th scope="col">状态</th><th scope="col">操作</th></tr></thead><tbody><tr><th scope="row">1</th><td>张三</td><td>技术部</td><td><span class="badge bg-success">在职</span></td><td><button class="btn btn-sm btn-info">编辑</button></td></tr><tr><th scope="row">2</th><td>李四</td><td>市场部</td><td><span class="badge bg-warning">休假</span></td><td><button class="btn btn-sm btn-info">编辑</button></td></tr></tbody></table>'
      ],
      javascript: [
        'function add(a,b){return a+b;} const obj={x:1,y:2};',
        'const users = [{id:1,name:"Alice"},{id:2,name:"Bob"}]; const names = users.map(u => u.name);',
        'async function fetchData(url) { try { const res = await fetch(url); const data = await res.json(); return data; } catch(e) { console.error(e); } }',
        'class Calculator { constructor() { this.result = 0; } add(n) { this.result += n; return this; } subtract(n) { this.result -= n; return this; } multiply(n) { this.result *= n; return this; } getResult() { return this.result; } } const calc = new Calculator(); console.log(calc.add(10).multiply(2).subtract(5).getResult());',
        'const app = { init() { this.setupEventListeners(); this.loadData(); }, setupEventListeners() { document.addEventListener("DOMContentLoaded", () => this.render()); }, async loadData() { const response = await fetch("/api/data"); this.data = await response.json(); }, render() { return `<div class="app">${JSON.stringify(this.data)}</div>`} }; app.init();'
      ],
      css: [
        'body{margin:0;padding:0;font-family:sans-serif;} .container{width:100%;max-width:1200px;margin:0 auto;} .btn{background:#007bff;color:#fff;border:none;padding:10px 20px;}',
        '#header { background: #333; color: white; } #header h1 { margin: 0; padding: 20px; }',
        '@media (max-width: 768px) { .sidebar { display: none; } .content { width: 100%; } }',
        '.card { box-shadow: 0 4px 6px rgba(0,0,0,0.1); border-radius: 8px; overflow: hidden; transition: transform 0.3s ease; } .card:hover { transform: translateY(-5px); box-shadow: 0 8px 15px rgba(0,0,0,0.2); }',
        ':root { --primary-color: #007bff; --secondary-color: #6c757d; --success-color: #28a745; --danger-color: #dc3545; --warning-color: #ffc107; --info-color: #17a2b8; --light-color: #f8f9fa; --dark-color: #343a40; } .btn { background: var(--primary-color); color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; } .btn:hover { opacity: 0.8; }'
      ]
    };

    function fillSample(type) {
      const list = sampleData[type];
      if (!list) return;

      // 智能随机：尽量避免与当前值重复
      let candidates = list;
      if (els[type] && els[type].input) {
          const current = els[type].input.value;
          const filtered = list.filter(item => item !== current);
          if (filtered.length > 0) candidates = filtered;
      }

      const randomItem = candidates[Math.floor(Math.random() * candidates.length)];

      // 示例操作不写入历史 - 使用 try-finally 确保状态总是被重置
      state.skipNextHistory = true;
      try {
          if (type === 'base64') {
              // Base64 特殊处理：填充输入并触发预览
              els[type].input.value = randomItem;
              document.getElementById('btn-base64-preview').click();
              return;
          }

          els[type].input.value = randomItem;

          // 部分类型自动触发处理
          if (['json', 'xml', 'sql', 'yaml', 'javascript', 'css'].includes(type)) {
             process(type, type + '-format');
          } else if (type === 'html') {
             // HTML 示例自动触发格式化
             if (els.html.input.value) {
                 process('html', 'html-format');
             }
          } else if (type === 'url') {
             // URL 示例自动触发编码
             handleAction('url-encode');
          }
      } finally {
          state.skipNextHistory = false;
      }
    }
    
    function jsonToXml() {
       try {
         const val = els.json.input.value.trim();
         if(!val) return showToast('请输入 JSON');
         const json = JSON.parse(val);
         
         const escape = (s) => String(s).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
         
         const toXml = (v, name) => {
           if (v === null) return name ? `<${name} nil="true"/>` : '';
           if (Array.isArray(v)) {
              // 数组场景：每个元素重复同一标签
               // 根数组且无名称时使用默认标签名 item
             const tagName = name || 'item';
             return v.map(item => toXml(item, tagName)).join('');
           }
           if (typeof v === 'object') {
             let attrs = '';
             let children = '';
             let text = '';

             Object.entries(v).forEach(([key, value]) => {
                  // 属性以 @ 开头（无损互转的关键：区分属性和子元素）
                  if (key.startsWith('@')) {
                      const attrName = key.slice(1);
                      attrs += ` ${attrName}="${escape(value)}"`;
                  } else if (key === '#text') {
                      text += escape(value);
                  } else {
                     // 清洗标签名
                     let tag = key.replace(/[^a-zA-Z0-9_\u00C0-\uFFFF:\.\-]/g, '_');
                     if (/^[^a-zA-Z_\u00C0-\uFFFF:]/.test(tag)) tag = '_' + tag;
                     children += toXml(value, tag);
                 }
             });

             if (!name) return children;
             
             if (!children && !text) return `<${name}${attrs}/>`;
             return `<${name}${attrs}>${text}${children}</${name}>`;
           }
            // 基础类型
           return `<${name}>${escape(v)}</${name}>`;
         };

         // 智能判断是否需要 wrap root
         // 如果是单键对象（忽略 @属性 和 #text），则该键直接作为根节点
         let useRootWrapper = true;
         if (!Array.isArray(json) && typeof json === 'object' && json !== null) {
            const keys = Object.keys(json);
            // 过滤掉属性 key (@...) 和文本 key (#text)
            const elementKeys = keys.filter(k => !k.startsWith('@') && k !== '#text');
            
            if (elementKeys.length === 1) {
                useRootWrapper = false;
            }
         }

         let result = '';
         if (Array.isArray(json)) {
            result = json.map(item => toXml(item, 'item')).join('');
         } else if (typeof json === 'object' && json !== null) {
            result = toXml(json, null);
         } else {
            result = toXml(json, 'item');
         }
         
         const xmlContent = useRootWrapper 
            ? `<root>\n${result}\n</root>`
            : result;

         els.xml.input.value = `<?xml version="1.0" encoding="UTF-8"?>\n${xmlContent}`;
         switchTab('xml');
         process('xml', 'xml-format');
       } catch(e) {
           showToast('转换失败: ' + e.message, 'error');
       }
    }

    function xmlToJson() {
      try {
        const val = els.xml.input.value.trim();
        if (!val) return showToast('请输入 XML', 'warning');

        const parser = new DOMParser();
        const doc = parser.parseFromString(val, 'text/xml');
        if (doc.querySelector('parsererror')) throw new Error('XML 解析错误');

        const xmlToObj = (node) => {
           // 处理 nil="true" 或 xsi:nil="true" -> null
           if (node.nodeType === 1 && (node.getAttribute('nil') === 'true' || node.getAttribute('xsi:nil') === 'true')) {
               return null;
           }

           if (node.nodeType === 3) return node.nodeValue.trim();

           if (node.nodeType === 1) {
               const obj = {};

               // 属性
               if (node.attributes.length > 0) {
                   for (let i = 0; i < node.attributes.length; i++) {
                       const attr = node.attributes[i];
                       // 添加 @ 前缀以区别于子元素（如 @id vs <id>），确保 JSON 转回 XML 时结构不变
                       obj[`@${attr.name}`] = attr.value;
                   }
               }

               // 子节点
               let hasElements = false;
               const childMap = {};
               let textContent = '';

               for (let child of node.childNodes) {
                   if (child.nodeType === 1) {
                       hasElements = true;
                       const name = child.tagName;
                       if (!childMap[name]) childMap[name] = [];
                       childMap[name].push(child);
                   } else if (child.nodeType === 3) {
                       textContent += child.nodeValue.trim();
                   }
               }

               if (hasElements) {
                   for (let name in childMap) {
                       const list = childMap[name].map(xmlToObj);
                       if (list.length === 1) obj[name] = list[0];
                       else obj[name] = list;
                   }
               } else {
                    // 无子元素时，尝试类型转换
                   const tryParse = (str) => {
                       if (str === 'true') return true;
                       if (str === 'false') return false;
                       if (str === 'null') return null;
                       // 数字检测：非空，是数字，且不是以0开头的长整数字符串（防止邮编等被转）
                       // 允许 0, 0.5, -1
                       if (str && !isNaN(Number(str))) {
                           // 简单正则排除 "0123" 这种
                           if (/^0[0-9]+/.test(str)) return str;
                           return Number(str);
                       }
                       return str;
                   };

                   // 仅返回文本或文本字段
                   if (textContent && Object.keys(obj).length === 0) return tryParse(textContent);
                   if (textContent) obj['#text'] = tryParse(textContent);
               }

               return obj;
           }
           return null;
        };

        // 根节点
        const root = doc.documentElement;
        const result = {};
        result[root.tagName] = xmlToObj(root);

        els.json.input.value = JSON.stringify(result, null, 2);
        switchTab('json');
        process('json', 'json-format');

      } catch (e) {
          showToast('转换失败: ' + e.message, 'error');
      }
    }
    // --- 其他工具逻辑 ---
    function initTools() {
        // 时间戳工具
        let tsTimer;
        const tsInput = document.getElementById('ts-input');
        const dateInput = document.getElementById('date-input');
        
        // 加载时间戳相关设置
        if (tsInput) tsInput.value = safeStorage.get('ts-input') || '';
        if (dateInput) dateInput.value = safeStorage.get('date-input') || '';

        function updateNow() {
            const now = new Date();
            const ts = now.getTime();
            const sec = Math.floor(ts / 1000);
            
              // 格式化当前日期
            const dateStr = now.getFullYear() + '-' + 
               String(now.getMonth() + 1).padStart(2, '0') + '-' + 
               String(now.getDate()).padStart(2, '0') + ' ' + 
               String(now.getHours()).padStart(2, '0') + ':' + 
               String(now.getMinutes()).padStart(2, '0') + ':' + 
               String(now.getSeconds()).padStart(2, '0');
            
            const dateEl = document.getElementById('ts-now-date');
            const msEl = document.getElementById('ts-now-ms-val');
            const secEl = document.getElementById('ts-now-sec-val');

            if(dateEl) dateEl.textContent = dateStr;
            if(msEl) msEl.textContent = ts;
            if(secEl) secEl.textContent = sec;
        }
        tsTimer = setInterval(updateNow, 1000);
        updateNow();
        
        document.getElementById('btn-ts-pause').onclick = (e) => {
            if (tsTimer) {
                clearInterval(tsTimer);
                tsTimer = null;
                e.target.textContent = '继续';
            } else {
                tsTimer = setInterval(updateNow, 1000);
                updateNow();
                e.target.textContent = '暂停';
            }
        };

        // 时间戳结果复制按钮
        document.getElementById('btn-copy-date').onclick = () => {
             copyText(document.getElementById('ts-now-date').textContent);
        };
        document.getElementById('btn-copy-ms').onclick = () => {
             copyText(document.getElementById('ts-now-ms-val').textContent);
        };
        document.getElementById('btn-copy-sec').onclick = () => {
             copyText(document.getElementById('ts-now-sec-val').textContent);
        };
        document.getElementById('btn-ts-result-copy').onclick = () => {
             const rows = document.querySelectorAll('#ts-result .result-row');
             if(rows.length === 0) return copyText(document.getElementById('ts-result').textContent);
             
             let text = [];
             rows.forEach(row => {
                 const label = row.querySelector('.result-label').textContent;
                 const val = row.querySelector('.result-value').textContent;
                 text.push(`${label}: ${val}`);
             });
             copyText(text.join('\n'));
        };

        // Helper for Timestamp Result
        function renderTsResult(items) {
            const container = document.getElementById('ts-result');
            container.innerHTML = '';

            const frag = document.createDocumentFragment();
            items.forEach(item => {
                const row = document.createElement('div');
                row.className = 'result-row';

                const label = document.createElement('span');
                label.className = 'result-label';
                label.textContent = item.label;

                const valContainer = document.createElement('div');
                valContainer.className = 'ts-result-val';

                const val = document.createElement('span');
                val.className = 'result-value';
                val.textContent = item.value;

                const copyBtn = document.createElement('span');
                copyBtn.className = 'copy-icon';
                copyBtn.textContent = '📋';
                copyBtn.title = '复制';
                copyBtn.onclick = () => copyText(item.value);

                valContainer.appendChild(val);
                valContainer.appendChild(copyBtn);

                row.appendChild(label);
                row.appendChild(valContainer);
                frag.appendChild(row);
            });
            container.appendChild(frag);
        }

        document.getElementById('btn-ts-clear').onclick = () => {
            tsInput.value = '';
            dateInput.value = '';
            safeStorage.set('ts-input', '');
            safeStorage.set('date-input', '');
            document.getElementById('ts-result').innerHTML = '<span style="color:var(--muted)">结果区域</span>';
            showToast('已清空');
        };

        document.getElementById('btn-ts-to-date').onclick = () => {
            let val = tsInput.value.trim();
            if (!val) return showToast('请输入时间戳');
            safeStorage.set('ts-input', val);
            addToHistory('timestamp', val);
            let numVal;
            if (val.length === 10) numVal = parseInt(val) * 1000;
            else numVal = parseInt(val);
            
            const date = new Date(numVal);
            if (isNaN(date.getTime())) return showToast('无效的时间戳');
            
            const res = date.getFullYear() + '-' + 
                String(date.getMonth() + 1).padStart(2, '0') + '-' + 
                String(date.getDate()).padStart(2, '0') + ' ' + 
                String(date.getHours()).padStart(2, '0') + ':' + 
                String(date.getMinutes()).padStart(2, '0') + ':' + 
                String(date.getSeconds()).padStart(2, '0');
                
            renderTsResult([
                { label: '日期', value: res },
                { label: '13位时间戳', value: date.getTime().toString() },
                { label: '10位时间戳', value: Math.floor(date.getTime()/1000).toString() },
                { label: 'ISO', value: date.toISOString() }
            ]);
        };

        document.getElementById('btn-date-to-ts').onclick = () => {
            const val = dateInput.value.trim();
            if (!val) return showToast('请输入日期');
            safeStorage.set('date-input', val);
            addToHistory('timestamp', val);
            const date = new Date(val);
            if (isNaN(date.getTime())) return showToast('无效的日期格式');
            
            const ts = date.getTime();
            
            const res = date.getFullYear() + '-' + 
                String(date.getMonth() + 1).padStart(2, '0') + '-' + 
                String(date.getDate()).padStart(2, '0') + ' ' + 
                String(date.getHours()).padStart(2, '0') + ':' + 
                String(date.getMinutes()).padStart(2, '0') + ':' + 
                String(date.getSeconds()).padStart(2, '0');

            renderTsResult([
                { label: '日期', value: res },
                { label: '13位时间戳', value: ts.toString() },
                { label: '10位时间戳', value: Math.floor(ts/1000).toString() },
                { label: 'ISO', value: date.toISOString() }
            ]);
        };

        // Base64 图片工具
        // Base64 文本工具
        const imgInput = document.getElementById('img-file-input');
        const imgDropZone = document.getElementById('img-drop-zone');
        const imgQualityRange = document.getElementById('img-quality');
        const imgQualityNum = document.getElementById('img-quality-num');
        const imgScaleRange = document.getElementById('img-scale');
        const imgScaleNum = document.getElementById('img-scale-num');
        const imgSizeInfo = document.getElementById('img-size-info');
        
        // 记录当前文件，便于再次压缩
        let currentImgFile = null;

        // 同步质量滑块与数值输入
        imgQualityRange.value = safeStorage.get('img-quality') || '100';
        imgQualityNum.value = imgQualityRange.value;
        const syncQuality = (val, source) => {
            val = parseInt(val);
            if(isNaN(val)) val = 100;
            if(val < 1) val = 1;
            if(val > 100) val = 100;
            
            if(source !== 'range') imgQualityRange.value = val;
            if(source !== 'num') imgQualityNum.value = val;
            safeStorage.set('img-quality', val);
            
            if (currentImgFile) processImage(currentImgFile);
        };
        imgQualityRange.oninput = (e) => syncQuality(e.target.value, 'range');
        imgQualityNum.oninput = (e) => syncQuality(e.target.value, 'num');

        // 同步缩放滑块与数值输入
        imgScaleRange.value = safeStorage.get('img-scale') || '100';
        imgScaleNum.value = imgScaleRange.value;
        const syncScale = (val, source) => {
            val = parseInt(val);
            if(isNaN(val)) val = 100;
            if(val < 1) val = 1;
            if(val > 100) val = 100;
            
            if(source !== 'range') imgScaleRange.value = val;
            if(source !== 'num') imgScaleNum.value = val;
            safeStorage.set('img-scale', val);
            
            if (currentImgFile) processImage(currentImgFile);
        };
        imgScaleRange.oninput = (e) => syncScale(e.target.value, 'range');
        imgScaleNum.oninput = (e) => syncScale(e.target.value, 'num');

        const formatSize = (bytes) => {
            if (bytes < 1024) return bytes + ' B';
            else if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(2) + ' KB';
            else return (bytes / (1024 * 1024)).toFixed(2) + ' MB';
        };

        const updatePreviewAndSize = (originalSize, originalW, originalH, resultBase64, compressedW, compressedH) => {
             const base64Len = resultBase64.length;
             const compressedSize = Math.round((base64Len * 3) / 4); 
             
             document.getElementById('img-base64-output').value = resultBase64;
             
        // 更新尺寸信息
             imgSizeInfo.style.display = 'block';
             document.getElementById('size-original').textContent = formatSize(originalSize);
             document.getElementById('dim-original').textContent = `${originalW}x${originalH}`;
             
             document.getElementById('size-compressed').textContent = formatSize(compressedSize);
             document.getElementById('dim-compressed').textContent = `${compressedW}x${compressedH}`;
             
             // 自动预览
             document.getElementById('base64-img-input').value = resultBase64;
             safeStorage.set('base64-img-input', resultBase64);
             document.getElementById('img-preview-area').innerHTML = `<img src="${resultBase64}" style="margin:auto; display:block;">`;
        };

        const processImage = (file) => {
             // 显示加载状态
             document.getElementById('img-preview-area').innerHTML = '<span style="color:var(--accent)">处理中...</span>';
             
             const quality = parseInt(imgQualityRange.value) / 100; // 0.01 - 1.0
             const scale = parseInt(imgScaleRange.value) / 100;     // 0.01 - 1.0
             
             const reader = new FileReader();
             reader.onload = (evt) => {
                 const img = new Image();
                 img.onload = () => {
                     const originalW = img.width;
                     const originalH = img.height;
                     
                     // 优化：质量与缩放均为 100% 时复用原文件
                     if (quality === 1.0 && scale === 1.0) {
                         updatePreviewAndSize(file.size, originalW, originalH, evt.target.result, originalW, originalH);
                         return;
                     }
                     
                     const targetW = Math.max(1, Math.floor(originalW * scale));
                     const targetH = Math.max(1, Math.floor(originalH * scale));
                     
                     const canvas = document.createElement('canvas');
                     canvas.width = targetW;
                     canvas.height = targetH;
                     const ctx = canvas.getContext('2d');
                     
                     // 高质量缩放
                     ctx.imageSmoothingEnabled = true;
                     ctx.imageSmoothingQuality = 'high';
                     ctx.drawImage(img, 0, 0, targetW, targetH);
                     
                     let type = file.type;
                     // 若类型非 WebP 且需要压缩（quality < 1）则强制导出 JPEG
                     // 或 toDataURL 不支持目标类型时退回 JPEG
                     if (type !== 'image/webp' && (type === 'image/png' || quality < 1.0)) {
                         type = 'image/jpeg';
                     }
                     
                     let dataUrl = canvas.toDataURL(type, quality);
                     
                     updatePreviewAndSize(file.size, originalW, originalH, dataUrl, targetW, targetH);
                 };
                 img.onerror = () => {
                    document.getElementById('img-preview-area').innerHTML = '<span style="color:var(--danger)">无法加载图片，请检查文件是否损坏</span>';
                 };
                 img.src = evt.target.result;
             };
             reader.readAsDataURL(file);
        };

        const handleFile = (file) => {
             if (!file) return;
             if (!file.type.startsWith('image/')) return showToast('请选择图片文件');
             
             currentImgFile = file;
             // 更新界面提示
             imgDropZone.querySelector('.text').textContent = file.name;
             
             processImage(file);
        };

        imgInput.onchange = (e) => {
            handleFile(e.target.files[0]);
        };
        
        // 图片区域拖拽与释放
          imgDropZone.addEventListener('dragover', (e) => { 
            e.preventDefault(); 
            e.stopPropagation(); // 阻止触发全局拖拽处理
            imgDropZone.classList.add('active'); 
        });
        imgDropZone.addEventListener('dragleave', (e) => { 
            e.preventDefault(); 
            e.stopPropagation(); 
            imgDropZone.classList.remove('active'); 
        });
        imgDropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            e.stopPropagation(); // 阻止触发全局拖拽处理
            imgDropZone.classList.remove('active');
            handleFile(e.dataTransfer.files[0]);
        });

        document.getElementById('btn-img-copy').onclick = () => {
            copyText(document.getElementById('img-base64-output').value);
        };
        document.getElementById('btn-img-clear').onclick = () => {
             imgInput.value = '';
             document.getElementById('img-base64-output').value = '';
             imgDropZone.querySelector('.text').textContent = '点击选择文件 或 拖拽图片到这里';
             currentImgFile = null;
             
             // 重置压缩控制
             imgQualityRange.value = 100;
             imgQualityNum.value = 100;
             imgScaleRange.value = 100;
             imgScaleNum.value = 100;
             safeStorage.set('img-quality', 100);
             safeStorage.set('img-scale', 100);
             
             imgSizeInfo.style.display = 'none';
             showToast('已清空');
        };
        const normalizeImageDataUrl = (raw) => {
            let val = (raw || '').trim();
            if (!val) return '';
            if (val.startsWith('data:image')) return val;
            let mime = 'image/png'; // 默认 MIME
            if (val.startsWith('/9j/')) mime = 'image/jpeg';
            else if (val.startsWith('R0lGOD')) mime = 'image/gif';
            else if (val.startsWith('UklGR')) mime = 'image/webp';
            else if (val.startsWith('Qk0')) mime = 'image/bmp';
            return `data:${mime};base64,${val}`;
        };

        const renderBase64Preview = (raw, addHistoryFlag, flash) => {
            const original = (raw || '').trim();
            if (!original) return;

            // 保存历史：手动预览立即保存，自动预览防抖保存
            if (addHistoryFlag) {
                addToHistory('base64', original);
            } else {
                if (renderBase64Preview.saveTimer) clearTimeout(renderBase64Preview.saveTimer);
                renderBase64Preview.saveTimer = setTimeout(() => {
                    addToHistory('base64', original);
                }, 3000);
            }

            const dataUrl = normalizeImageDataUrl(original);
            const area = document.getElementById('img-preview-area');
            const img = new Image();
            img.style.margin = 'auto';
            img.style.display = 'block';
            if (flash) img.className = 'preview-flash';
            img.onerror = () => {
                area.innerHTML = '<span style="color:var(--danger)">无法预览：Base64 不是有效的图片数据</span>';
            };
            area.innerHTML = '';
            area.appendChild(img);
            img.src = dataUrl;
        };

        const base64InputEl = document.getElementById('base64-img-input');
        let base64AutoPreviewTimer = null;
        let lastBase64AutoPreview = '';

        if (base64InputEl) {
            base64InputEl.addEventListener('input', () => {
                safeStorage.set('base64-img-input', base64InputEl.value);
                clearTimeout(base64AutoPreviewTimer);
                base64AutoPreviewTimer = setTimeout(() => {
                    const val = base64InputEl.value.trim();
                    if (!val || val === lastBase64AutoPreview) return;
                    if (val.length < 32) return;
                    lastBase64AutoPreview = val;
                    renderBase64Preview(val, false, false);
                }, 350);
            });
        }

        document.getElementById('btn-base64-preview').onclick = () => {
            const val = base64InputEl ? base64InputEl.value.trim() : '';
            lastBase64AutoPreview = val;
            renderBase64Preview(val, true, true);
        };
        
        document.getElementById('btn-base64-download').onclick = () => {
             let base64Data = document.getElementById('base64-img-input').value.trim();
             if (!base64Data) {
                 showToast('没有可下载的图片数据');
                 return;
             }
             
             if (!base64Data.startsWith('data:image')) {
                let mime = 'image/png'; 
                if (base64Data.startsWith('/9j/')) mime = 'image/jpeg';
                else if (base64Data.startsWith('R0lGOD')) mime = 'image/gif';
                else if (base64Data.startsWith('UklGR')) mime = 'image/webp';
                else if (base64Data.startsWith('Qk0')) mime = 'image/bmp';
                
                base64Data = `data:${mime};base64,${base64Data}`;
             }

             const a = document.createElement('a');
             a.href = base64Data;
             let ext = 'png';
             if (base64Data.startsWith('data:image/jpeg')) ext = 'jpg';
             else if (base64Data.startsWith('data:image/gif')) ext = 'gif';
             else if (base64Data.startsWith('data:image/webp')) ext = 'webp';
             else if (base64Data.startsWith('data:image/bmp')) ext = 'bmp';
             
             a.download = `preview_image.${ext}`;
             document.body.appendChild(a);
             a.click();
             document.body.removeChild(a);
        };
        document.getElementById('btn-base64-clear').onclick = () => {
             const inputEl = document.getElementById('base64-img-input');
             if (inputEl) inputEl.value = '';
             safeStorage.set('base64-img-input', '');

             lastBase64AutoPreview = '';
             clearTimeout(base64AutoPreviewTimer);

             document.getElementById('img-preview-area').innerHTML = '<span style="color:var(--muted); margin:auto;">图片预览区</span>';
             showToast('已清空');
        };

        // HTML 引号转 JS
        const convertHtmlToJsQuote = (quoteType) => {
            const html = els.html.input.value;
            if (!html) return;
            const q = quoteType === 'single' ? "'" : '"';

            const lines = html.split('\n');
            let result = '';
            lines.forEach((line, index) => {
                let escaped = line.replace(/\\/g, '\\\\').replace(new RegExp(q, 'g'), '\\' + q);
                const isLast = index === lines.length - 1;
                result += `${q}${escaped}${q}` + (isLast ? ';' : ' +') + '\n';
            });

            els.html.output.textContent = result;
            if (window.hljs) hljs.highlightElement(els.html.output);
            addToHistory('html', html);
        };

        document.getElementById('btn-quote-single').onclick = () => convertHtmlToJsQuote('single');
        document.getElementById('btn-quote-double').onclick = () => convertHtmlToJsQuote('double');

        // 清空按钮事件绑定
        const clearOutputBtn = document.getElementById('btn-yaml-clear-output');
        if (clearOutputBtn) {
            clearOutputBtn.onclick = () => {
                if (els.yaml.output) {
                    els.yaml.output.textContent = '';
                    delete els.yaml.output.dataset.raw;
                    showToast('已清空结果');
                }
            };
        }

        const htmlClearOutputBtn = document.getElementById('btn-html-clear-output');
        if (htmlClearOutputBtn) {
            htmlClearOutputBtn.onclick = () => {
                if (els.html.output) {
                    els.html.output.textContent = '';
                    delete els.html.output.dataset.raw;
                    showToast('已清空结果');
                }
            };
        }

        const jsClearOutputBtn = document.getElementById('btn-js-clear-output');
        if (jsClearOutputBtn) {
            jsClearOutputBtn.onclick = () => {
                if (els.javascript.output) {
                    els.javascript.output.textContent = '';
                    delete els.javascript.output.dataset.raw;
                    showToast('已清空结果');
                }
            };
        }

        const cssClearOutputBtn = document.getElementById('btn-css-clear-output');
        if (cssClearOutputBtn) {
            cssClearOutputBtn.onclick = () => {
                if (els.css.output) {
                    els.css.output.textContent = '';
                    delete els.css.output.dataset.raw;
                    showToast('已清空结果');
                }
            };
        }

        // URL
        const urlInput = document.getElementById('url-input');
        if (urlInput) urlInput.value = safeStorage.get('url-input') || '';


        // 初始化时间戳默认值
        const nowTs = new Date();
        document.getElementById('ts-input').value = nowTs.getTime();
        
        const initDateStr = nowTs.getFullYear() + '-' + 
            String(nowTs.getMonth() + 1).padStart(2, '0') + '-' + 
            String(nowTs.getDate()).padStart(2, '0') + ' ' + 
            String(nowTs.getHours()).padStart(2, '0') + ':' + 
            String(nowTs.getMinutes()).padStart(2, '0') + ':' + 
            String(nowTs.getSeconds()).padStart(2, '0');
        document.getElementById('date-input').value = initDateStr;
        
        // 触发默认转换 (不写入历史)
        state.skipNextHistory = true;
        document.getElementById('btn-ts-to-date').click();

        // --- 网络工具逻辑 ---
        let ws = null;
        const netLog = document.getElementById('net-log');
        const netUrlInput = document.getElementById('net-url');
        const netTypeSelect = document.getElementById('net-type');
        const netMethodSelect = document.getElementById('net-method');
        const netPortInput = document.getElementById('net-port');
        const useIframeCheck = document.getElementById('use-iframe-preview');
        const useLocalProxyCheck = document.getElementById('use-local-proxy');
        const useNoCorsCheck = document.getElementById('use-no-cors');
        const netHeadersInput = document.getElementById('net-headers');
        const netBodyInput = document.getElementById('net-body');
        const mqttClientIdInput = document.getElementById('mqtt-client-id');
        const mqttUserInput = document.getElementById('mqtt-user');
        const mqttPassInput = document.getElementById('mqtt-pass');
        const mqttSubTopicInput = document.getElementById('mqtt-sub-topic');
        const mqttPubTopicInput = document.getElementById('mqtt-pub-topic');
        const mqttPubMsgInput = document.getElementById('mqtt-pub-msg');
        const netWsMsgInput = document.getElementById('net-ws-msg');

        // 加载网络请求相关设置
        if (netUrlInput) netUrlInput.value = safeStorage.get('net-url') || '';
        if (netTypeSelect) {
            netTypeSelect.value = safeStorage.get('net-type') || 'http';
            // 触发 change 以刷新界面
            setTimeout(() => netTypeSelect.dispatchEvent(new Event('change')), 10);
        }
        if (netMethodSelect) netMethodSelect.value = safeStorage.get('net-method') || 'GET';
        if (netPortInput) netPortInput.value = safeStorage.get('net-port') || '80';
        if (useIframeCheck) useIframeCheck.checked = safeStorage.get('net-iframe') !== 'false'; // Default true
        if (useLocalProxyCheck) useLocalProxyCheck.checked = safeStorage.get('net-proxy') === 'true';
        if (useNoCorsCheck) useNoCorsCheck.checked = safeStorage.get('net-no-cors') === 'true';
        if (netHeadersInput) netHeadersInput.value = safeStorage.get('net-headers') || '';
        if (netBodyInput) netBodyInput.value = safeStorage.get('net-body') || '';
        if (mqttClientIdInput) mqttClientIdInput.value = safeStorage.get('mqtt-client-id') || '';
        if (mqttUserInput) mqttUserInput.value = safeStorage.get('mqtt-user') || '';
        if (mqttPassInput) mqttPassInput.value = safeStorage.get('mqtt-pass') || '';
        if (mqttSubTopicInput) mqttSubTopicInput.value = safeStorage.get('mqtt-sub-topic') || '';
        if (mqttPubTopicInput) mqttPubTopicInput.value = safeStorage.get('mqtt-pub-topic') || '';
        if (mqttPubMsgInput) mqttPubMsgInput.value = safeStorage.get('mqtt-pub-msg') || '';
        if (netWsMsgInput) netWsMsgInput.value = safeStorage.get('net-ws-msg') || '';

        // Debounced save for network settings
        let netSaveTimer = null;
        function saveNetSettings() {
            clearTimeout(netSaveTimer);
            netSaveTimer = setTimeout(() => {
                safeStorage.set('net-url', netUrlInput.value);
                safeStorage.set('net-type', netTypeSelect.value);
                safeStorage.set('net-method', netMethodSelect.value);
                safeStorage.set('net-port', netPortInput.value);
                safeStorage.set('net-iframe', useIframeCheck.checked);
                safeStorage.set('net-proxy', useLocalProxyCheck.checked);
                safeStorage.set('net-no-cors', useNoCorsCheck.checked);
                safeStorage.set('net-headers', netHeadersInput.value);
                safeStorage.set('net-body', netBodyInput.value);
                safeStorage.set('mqtt-client-id', mqttClientIdInput.value);
                safeStorage.set('mqtt-user', mqttUserInput.value);
                safeStorage.set('mqtt-pass', mqttPassInput.value);
                safeStorage.set('mqtt-sub-topic', mqttSubTopicInput.value);
                safeStorage.set('mqtt-pub-topic', mqttPubTopicInput.value);
                safeStorage.set('mqtt-pub-msg', mqttPubMsgInput.value);
                safeStorage.set('net-ws-msg', netWsMsgInput.value);
            }, 300);
        }

        // 输入或切换时自动保存（防抖）
        [netUrlInput, netPortInput, netHeadersInput, netBodyInput, mqttClientIdInput, mqttUserInput, mqttPassInput,
         mqttSubTopicInput, mqttPubTopicInput, mqttPubMsgInput, netWsMsgInput].forEach(el => {
            if (el) el.oninput = saveNetSettings;
        });
        [netTypeSelect, netMethodSelect, useIframeCheck, useLocalProxyCheck, useNoCorsCheck].forEach(el => {
            if (el) el.onchange = saveNetSettings;
        });

        // 切换 HTTP/WS/MQTT/Ping/Telnet 显示与控制
        netTypeSelect.onchange = (e) => {
            saveNetSettings();
            const type = e.target.value;
            document.getElementById('net-http-opts').style.display = type === 'http' ? 'flex' : 'none';
            document.getElementById('net-ws-opts').style.display = type === 'ws' ? 'flex' : 'none';
            document.getElementById('net-mqtt-opts').style.display = type === 'mqtt' ? 'flex' : 'none';
            document.getElementById('net-ping-opts').style.display = (type === 'ping' || type === 'telnet') ? 'flex' : 'none';
            const telnetGroup = document.getElementById('telnet-port-group');
            if (telnetGroup) telnetGroup.style.display = type === 'telnet' ? 'block' : 'none';
            
            // 控制 Method 选择可见性
            document.getElementById('net-method').style.display = type === 'http' ? 'block' : 'none';
            // 发送按钮仅 HTTP 可见
            document.getElementById('net-send').style.display = type === 'http' ? 'block' : 'none';
            
            // 更新 URL 占位提示
            const urlInput = document.getElementById('net-url');
            if (type === 'http') urlInput.placeholder = '输入 URL (http://...)';
            else if (type === 'ws') urlInput.placeholder = '输入 WebSocket URL (ws://...)';
            else if (type === 'mqtt') urlInput.placeholder = '输入 MQTT Broker URL (ws://broker...:8083/mqtt)';
            else if (type === 'ping') urlInput.placeholder = '输入目标 Host 或 URL';
            else if (type === 'telnet') urlInput.placeholder = '输入目标 Host';
        };

        function appendNetLog(type, msg, isError = false) {
            if (netLog.children.length > 50) netLog.removeChild(netLog.firstElementChild); // 超过 50 条移除最早一条
            if (netLog.innerHTML.includes('等待请求...')) netLog.innerHTML = '';

            const div = document.createElement('div');
            div.style.borderBottom = '1px solid var(--border)';
            div.style.padding = '0.3rem 0';
            div.style.wordBreak = 'break-all';
            
            const time = new Date().toLocaleTimeString();
            const color = isError ? 'var(--danger)' : (type === 'REQ' || type === 'SEND' ? 'var(--accent)' : 'var(--success)');
            
            div.innerHTML = `<span style="color:var(--muted); font-size:0.75rem;">[${time}]</span> <strong style="color:${color}">${type}</strong>: ${msg}`;
            netLog.appendChild(div);
            netLog.scrollTop = netLog.scrollHeight;
        }

        // HTTP 发送
        document.getElementById('net-send').onclick = async () => {
            saveNetSettings();
            const type = netTypeSelect.value;
            if (type !== 'http') return; // 仅 HTTP 模式允许发送

            const method = netMethodSelect.value;
            let url = netUrlInput.value.trim();
            const headersStr = document.getElementById('net-headers').value.trim();
            const bodyStr = document.getElementById('net-body').value.trim();

            if (!url) return showToast('请输入 URL');

            addToHistory('network', `HTTP ${method}: ${url}`);


            // --- 代理逻辑（Iframe/Fetch 之前应用） ---
            const useProxy = document.getElementById('use-local-proxy').checked;
            if (useProxy && type === 'http') {
                const targetUrl = url;
                url = 'http://localhost:3000/proxy?target=' + encodeURIComponent(targetUrl);
                  // 说明：仅改 URL，方法/头/体由代理转发
            }

            // Iframe 预览模式 / 表单提交模式
            const useIframe = document.getElementById('use-iframe-preview').checked;
            const iframeContainer = document.getElementById('net-preview-container');
            const iframe = document.getElementById('net-preview-frame');
            
            if (useIframe) {
                // 显示 iframe，同时保留日志区域
                document.getElementById('net-log').style.display = 'block';
                iframeContainer.style.display = 'flex';
                
                // Clear previous content
                try { iframe.contentWindow.location.replace('about:blank'); } catch(e){}

                if (method === 'GET') {
                    iframe.src = url;
                    appendNetLog('INFO', `正在通过 Iframe 加载: ${escapeHtml(url)}<br><small style="color:var(--muted)">结果将显示在左侧预览窗口中</small>`);
                } else {
                    // Dynamic Form Submission for POST/PUT/etc.
                    // Use static name matching the HTML to prevent new tab opening
                    const uniqueTarget = 'net-preview-frame';
                    iframe.name = uniqueTarget; 
                    
                    const form = document.createElement('form');
                    form.method = method;
                    form.action = url;
                    form.target = uniqueTarget;
                    form.style.display = 'none';
                    
                    // Handle Body
                    if (bodyStr) {
                        try {
                            // Try to parse JSON and create input fields
                            const jsonBody = JSON.parse(bodyStr);
                            
                            // If it's a simple object, flatten to inputs
                            if (typeof jsonBody === 'object' && jsonBody !== null && !Array.isArray(jsonBody)) {
                                form.enctype = 'application/x-www-form-urlencoded';
                                for (const key in jsonBody) {
                                    const input = document.createElement('input');
                                    input.name = key;
                                    input.value = (typeof jsonBody[key] === 'object') ? JSON.stringify(jsonBody[key]) : jsonBody[key];
                                    form.appendChild(input);
                                }
                            } else {
                                // Array or other JSON: cannot map to key-value pairs easily for urlencoded
                                // Use text/plain? standard forms don't support raw body well without key
                                // We'll warn user
                                appendNetLog('WARN', 'Form 提交模式下，JSON 数组无法完美映射。将尝试作为纯文本发送。');
                                form.enctype = 'text/plain';
                                const input = document.createElement('input');
                                input.name = 'body'; // Some servers might ignore this
                                input.value = bodyStr;
                                form.appendChild(input);
                            }
                        } catch(e) {
                             // Not JSON, assume raw string or urlencoded string
                             // e.g. "a=1&b=2"
                             // We can't easily inject raw body into form unless we parse it
                             // or use text/plain
                             form.enctype = 'application/x-www-form-urlencoded';
                              // 根据 body 查询参数字符串拆分并生成对应的隐藏输入字段
                             if (bodyStr.includes('=')) {
                                 bodyStr.split('&').forEach(part => {
                                     const [k, v] = part.split('=');
                                     if (k) {
                                        const input = document.createElement('input');
                                        input.name = decodeURIComponent(k);
                                        input.value = decodeURIComponent(v || '');
                                        form.appendChild(input);
                                     }
                                 });
                             } else {
                                 // Just raw text
                                 form.enctype = 'text/plain';
                                 const input = document.createElement('input');
                                 input.name = 'data';
                                 input.value = bodyStr;
                                 form.appendChild(input);
                             }
                        }
                    }
                    
                    document.body.appendChild(form);
                    form.submit();
                    document.body.removeChild(form);
                    
                    appendNetLog('INFO', `已通过 Form 表单向 Iframe 提交 ${method} 请求。<br>请在下方预览窗口查看结果 (JS无法读取跨域返回值)。`);
                }
                return; 
            } else {
                // For non-GET or if preview disabled, use Fetch
                iframeContainer.style.display = 'none';
                document.getElementById('net-log').style.display = 'block';
            }

            let headers = {};
            if (headersStr) {
                try {
                    headers = JSON.parse(headersStr);
                } catch(e) {
                    return showToast('Headers 格式错误 (必须是 JSON)');
                }
            }

            const opts = { method, headers };
            if (['POST', 'PUT', 'PATCH'].includes(method) && bodyStr) {
                opts.body = bodyStr;
            }

            // Remove Content-Type if body is empty to avoid server confusion
            if (!bodyStr && headers['Content-Type']) {
                 delete headers['Content-Type'];
            }

            // Fix: Add credentials 'omit' to match browser's simple request behavior if possible
            // and remove any potential auto-added headers that might trigger preflight or server errors
            // opts.credentials = 'omit'; // Commented out to test defaults
            
            // Explicitly set mode to 'cors' to ensure we handle it correctly
            // opts.mode = 'cors'; // Commented out to test defaults 
            
            // If headers are empty, we can try 'no-cors' if the user is just probing
            // BUT 'no-cors' only works for GET/HEAD/POST and limits headers significantly.
            // It also results in an "opaque" response (status 0, no body).
            // Since the user saw 500, it means the request reached the server.
            
            // Simplest possible request to mimic browser behavior
            // Remove 'mode' and 'credentials' to let browser decide defaults
            if (Object.keys(headers).length === 0) {
                  delete opts.headers;
            }
            
            // Do not manually set Accept header, let browser default
            opts.referrerPolicy = 'no-referrer'; // Don't send Referer header

            // --- Proxy Logic ---
            // 已上移到顶部处理
            const useNoCors = document.getElementById('use-no-cors').checked;
            
            // --- No-CORS Logic ---
            if (useNoCors) {
                opts.mode = 'no-cors';
                // Note: 'no-cors' restricts headers. Content-Type cannot be application/json.
                // It must be application/x-www-form-urlencoded, multipart/form-data, or text/plain.
                // We should warn the user if they try to send JSON with no-cors.
                if (headers['Content-Type'] && headers['Content-Type'].includes('json')) {
                    appendNetLog('WARN', 'No-CORS 模式不支持 application/json。浏览器将忽略此 Header。建议使用 text/plain 或 form-data。');
                }
            }

            appendNetLog('REQ', `${method} ${useProxy ? '(Proxy) ' : ''}${escapeHtml(document.getElementById('net-url').value)} ${useNoCors ? '(No-CORS)' : ''}`);
            
            const startTime = Date.now();
            try {
                const res = await fetch(url, opts);
                const time = Date.now() - startTime;
                
                // If No-CORS, res.type is 'opaque', status is 0, body is null
                if (res.type === 'opaque' || useNoCors) {
                     appendNetLog('RES', `请求已发送 (模式: No-CORS)<br><small style="color:var(--text-muted)">注意: 由于浏览器安全限制，无法读取跨域请求的返回内容(Status/Body)。但服务端应该已经收到了请求。</small>`, false);
                     return;
                }

                const text = await res.text();
                let displayBody = text;
                try {
                     // Pretty print JSON
                     displayBody = JSON.stringify(JSON.parse(text), null, 2);
                } catch(e) {}

                // Differentiate Proxy Error vs Target Error
                let isError = !res.ok;
                let statusColor = isError ? 'var(--danger)' : 'var(--success)';
                let statusMsg = `Status: ${res.status} (${time}ms)`;
                
                if (res.status === 500 && useProxy) {
                    statusMsg += ' <span style="color:var(--warn); font-size:0.8em;">(目标服务器返回 500, 非代理故障)</span>';
                }

                appendNetLog('RES', `<span style="color:${statusColor}">${statusMsg}</span><br><pre style="margin:0.5rem 0; background:var(--bg-2); padding:0.5rem; border-radius:4px; overflow-x:auto;">${displayBody.replace(/</g, '&lt;')}</pre>`, isError);
            } catch(e) {
                let msg = e.message;
                if (msg === 'Failed to fetch') {
                    if (useProxy) {
                         msg += '<br><small style="color:var(--warn)">连接本地代理失败。<br>请确保已运行 <code>node server.js</code> 且端口为 3000。</small>';
                    } else {
                         msg += '<br><small style="color:var(--text-muted)">可能原因: 跨域(CORS)限制。<br>建议：<br>1. 启用上方“本地 CORS 代理”(Node.js)<br>2. 或让服务端开启 CORS<br>3. 若使用 file:// 打开，可改用本地静态服务器方式访问</small>';
                     }
                 }
                 appendNetLog('ERR', msg, true);
             }
        };
        
        // Helper to add headers
        window.addHeader = (type) => {
            const el = document.getElementById('net-headers');
            let current = {};
            try { current = JSON.parse(el.value || '{}'); } catch(e){}
            
            if (type === 'ua') {
                current['User-Agent'] = 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36';
            } else if (type === 'json') {
                current['Content-Type'] = 'application/json';
            } else if (type === 'form') {
                current['Content-Type'] = 'application/x-www-form-urlencoded';
            }
            
            el.value = JSON.stringify(current, null, 2);
        };

        // Proxy Help Logic
        const proxyCode = `const http = require('http');
const https = require('https');
const url = require('url');

const PORT = 3000;

const server = http.createServer((req, res) => {
    // 1. Handle CORS for the proxy itself
    res.setHeader('Access-Control-Allow-Origin', '*');
    res.setHeader('Access-Control-Allow-Methods', 'GET, POST, PUT, DELETE, PATCH, OPTIONS');
    res.setHeader('Access-Control-Allow-Headers', '*');

    if (req.method === 'OPTIONS') {
        res.writeHead(204);
        res.end();
        return;
    }

    // 2. Parse Target URL
    const reqUrl = url.parse(req.url, true);
    let targetUrl = reqUrl.query.target;
    
    // Support target in header for cleaner URLs
    if (!targetUrl && req.headers['x-target-url']) {
        targetUrl = req.headers['x-target-url'];
    }

    if (!targetUrl) {
        // Fallback: If URL path looks like a full URL (e.g. /http://...)
        // Sometimes used by other proxies
        if (req.url.startsWith('/http')) {
             targetUrl = req.url.substring(1);
        } else {
            res.writeHead(400, { 'Content-Type': 'text/plain; charset=utf-8' });
            res.end('Missing target URL. Usage: ?target=https://example.com');
            return;
        }
    }

    try {
        const parsedTarget = url.parse(targetUrl);
        const lib = parsedTarget.protocol === 'https:' ? https : http;
        
        // Prepare headers
        const headers = { ...req.headers };
        delete headers['x-target-url'];
        delete headers.host;
        headers.host = parsedTarget.host;

        const proxyReq = lib.request(targetUrl, {
            method: req.method,
            headers: headers
        }, (proxyRes) => {
            // Forward status and headers
            // We must not forward Access-Control-Allow-Origin from target if we set it ourselves above
            // But actually we are the server now.
            // Let's strip CORS headers from target to avoid conflicts?
            // Usually not needed if we set ours.
            
            res.writeHead(proxyRes.statusCode, proxyRes.headers);
            proxyRes.pipe(res);
        });

        proxyReq.on('error', (e) => {
            
            res.writeHead(502, { 'Content-Type': 'text/plain' });
            res.end('Proxy Error: ' + e.message);
        });

        // Forward body
        req.pipe(proxyReq);

    } catch (e) {
        res.writeHead(500);
        res.end('Internal Error: ' + e.message);
    }
});

server.listen(PORT, () => {
});`;

        document.getElementById('btn-show-proxy-help').onclick = () => {
            const area = document.getElementById('proxy-help-area');
            area.style.display = area.style.display === 'none' ? 'block' : 'none';
        };

        document.getElementById('btn-copy-proxy-code').onclick = () => {
            copyText(proxyCode);
            showToast('代码已复制，请保存为 server.js 并运行');
        };

        // WebSocket Logic
        const updateWsStatus = (status) => {
            const ind = document.getElementById('net-ws-indicator');
            const txt = document.getElementById('net-ws-status-text');
            const btnCon = document.getElementById('net-ws-connect');
            const btnDis = document.getElementById('net-ws-disconnect');
            const btnSend = document.getElementById('net-ws-send');

            if (status === 'connected') {
                ind.style.background = 'var(--success)';
                txt.textContent = '已连接';
                btnCon.disabled = true;
                btnDis.disabled = false;
                btnSend.disabled = false;
            } else if (status === 'connecting') {
                ind.style.background = 'var(--warn)';
                txt.textContent = '连接中...';
                btnCon.disabled = true;
                btnDis.disabled = true;
                btnSend.disabled = true;
            } else {
                ind.style.background = 'var(--muted)';
                txt.textContent = '未连接';
                btnCon.disabled = false;
                btnDis.disabled = true;
                btnSend.disabled = true;
            }
        };

        document.getElementById('net-ws-connect').onclick = () => {
            saveNetSettings();
            const url = netUrlInput.value.trim();
            if (!url) return showToast('请输入 WebSocket URL');
            
            addToHistory('network', `WS Connect: ${url}`);
            
            updateWsStatus('connecting');
            appendNetLog('WS', `Connecting to ${escapeHtml(url)}...`);

            try {
                ws = new WebSocket(url);
                
                ws.onopen = () => {
                    updateWsStatus('connected');
                    appendNetLog('WS', 'Connected');
                };
                
                ws.onmessage = (e) => {
                    appendNetLog('MSG', escapeHtml(e.data));
                };
                
                ws.onclose = (e) => {
                    updateWsStatus('disconnected');
                    appendNetLog('WS', `Disconnected (Code: ${e.code})`, e.code !== 1000);
                    ws = null;
                };
                
                ws.onerror = (e) => {
                    updateWsStatus('disconnected');
                    appendNetLog('WS', 'Error occurred', true);
                };
            } catch(e) {
                updateWsStatus('disconnected');
                appendNetLog('WS', `Connection failed: ${escapeHtml(e.message)}`, true);
            }
        };

        document.getElementById('net-ws-disconnect').onclick = () => {
            if (ws) ws.close();
        };

        document.getElementById('net-ws-send').onclick = () => {
            if (!ws || ws.readyState !== WebSocket.OPEN) return showToast('WebSocket 未连接');
            const msg = document.getElementById('net-ws-msg').value;
            if (!msg) return;
            
            ws.send(msg);
            addToHistory('network', `WS Send: ${msg}`);
            appendNetLog('SEND', escapeHtml(msg));
        };

        // MQTT Logic
        let mqttClient = null;
        const updateMqttStatus = (status) => {
            const ind = document.getElementById('mqtt-indicator');
            const txt = document.getElementById('mqtt-status-text');
            const btnCon = document.getElementById('mqtt-connect');
            const btnDis = document.getElementById('mqtt-disconnect');
            const btnSub = document.getElementById('mqtt-sub-btn');
            const btnPub = document.getElementById('mqtt-pub-btn');

            if (status === 'connected') {
                ind.style.background = 'var(--success)';
                txt.textContent = '已连接';
                btnCon.disabled = true;
                btnDis.disabled = false;
                btnSub.disabled = false;
                btnPub.disabled = false;
            } else if (status === 'connecting') {
                ind.style.background = 'var(--warn)';
                txt.textContent = '连接中...';
                btnCon.disabled = true;
                btnDis.disabled = true;
                btnSub.disabled = true;
                btnPub.disabled = true;
            } else {
                ind.style.background = 'var(--muted)';
                txt.textContent = '未连接';
                btnCon.disabled = false;
                btnDis.disabled = true;
                btnSub.disabled = true;
                btnPub.disabled = true;
            }
        };

        document.getElementById('mqtt-connect').onclick = () => {
            saveNetSettings();
            const url = netUrlInput.value.trim();
            if (!url) return showToast('请输入 Broker URL');
            
            addToHistory('network', `MQTT Connect: ${url}`);
            
            updateMqttStatus('connecting');
            appendNetLog('MQTT', `Connecting to ${escapeHtml(url)}...`);
            
            const options = {
                clientId: document.getElementById('mqtt-client-id').value || 'easytools_' + Math.random().toString(16).substr(2, 8),
                username: document.getElementById('mqtt-user').value || undefined,
                password: document.getElementById('mqtt-pass').value || undefined,
            };

            try {
                if (typeof mqtt === 'undefined') throw new Error('MQTT library not loaded (Offline Mode)');
                mqttClient = mqtt.connect(url, options);
                
                mqttClient.on('connect', () => {
                    updateMqttStatus('connected');
                    appendNetLog('MQTT', 'Connected');
                });
                
                mqttClient.on('message', (topic, message) => {
                    appendNetLog('MSG', `[${escapeHtml(topic)}] ${escapeHtml(message.toString())}`);
                });
                
                mqttClient.on('error', (err) => {
                    appendNetLog('MQTT', `Error: ${escapeHtml(err.message)}`, true);
                    updateMqttStatus('disconnected');
                });
                
                mqttClient.on('close', () => {
                    updateMqttStatus('disconnected');
                    appendNetLog('MQTT', 'Disconnected');
                });
            } catch(e) {
                updateMqttStatus('disconnected');
                appendNetLog('MQTT', `Connection failed: ${escapeHtml(e.message)}`, true);
            }
        };

        document.getElementById('mqtt-disconnect').onclick = () => {
            if (mqttClient) mqttClient.end();
        };

        document.getElementById('mqtt-sub-btn').onclick = () => {
            if (!mqttClient || !mqttClient.connected) return showToast('MQTT 未连接');
            const topic = document.getElementById('mqtt-sub-topic').value.trim();
            if (!topic) return;
            
            mqttClient.subscribe(topic, (err) => {
                if (!err) {
                    appendNetLog('SUB', `Subscribed to ${escapeHtml(topic)}`);
                    addToHistory('network', `MQTT Sub: ${topic}`);
                }
                else appendNetLog('MQTT', `Subscribe failed: ${escapeHtml(err.message)}`, true);
            });
        };

        document.getElementById('mqtt-pub-btn').onclick = () => {
            if (!mqttClient || !mqttClient.connected) return showToast('MQTT 未连接');
            const topic = document.getElementById('mqtt-pub-topic').value.trim();
            const msg = document.getElementById('mqtt-pub-msg').value;
            if (!topic) return showToast('请输入 Topic');
            
            mqttClient.publish(topic, msg);
            addToHistory('network', `MQTT Pub: ${topic} ${msg}`);
            appendNetLog('PUB', `[${escapeHtml(topic)}] ${escapeHtml(msg)}`);
        };

        // Ping/Telnet Logic
        document.getElementById('btn-ping-test').onclick = async () => {
            const type = document.getElementById('net-type').value;
            let url = document.getElementById('net-url').value.trim();
            if (!url) return showToast('请输入目标地址');
            
            addToHistory('network', `${type.toUpperCase()} Probe: ${url}`);
            
            // Auto-add protocol if missing
            if (!url.startsWith('http') && !url.startsWith('ws') && !url.includes('://')) {
                // For Telnet/Ping, we might just want the host
                // But fetch needs protocol.
            }

            if (type === 'telnet') {
                 const port = document.getElementById('net-port').value || 80;
                 // Clean host
                 let host = url.replace(/^https?:\/\//, '').replace(/^ws:\/\//, '').replace(/\/$/, '');
                 appendNetLog('TELNET', `Probing ${escapeHtml(host)}:${port}...`);
                 
                 const start = performance.now();
                 let isOpen = false;
                 
                 // 1. Try Image Probe (for GET-able endpoints)
                 // 2. Try Fetch (HEAD)
                 // 3. Try WebSocket
                 
                 const targetHttp = `http://${host}:${port}/`;
                 try {
                     const controller = new AbortController();
                     const id = setTimeout(() => controller.abort(), 2000);
                     await fetch(targetHttp, { method: 'HEAD', mode: 'no-cors', signal: controller.signal });
                     clearTimeout(id);
                     isOpen = true;
                     const duration = (performance.now() - start).toFixed(2);
                     appendNetLog('TELNET', `Port ${port} Open (HTTP Probe) - ${duration}ms`);
                 } catch (e) {
                     // Try WebSocket as backup
                     try {
                         await new Promise((resolve, reject) => {
                             const ws = new WebSocket(`ws://${host}:${port}/`);
                             const to = setTimeout(() => { ws.close(); reject(); }, 3000);
                             ws.onopen = () => { clearTimeout(to); ws.close(); resolve(); };
                             ws.onerror = () => { clearTimeout(to); reject(); };
                         });
                         isOpen = true;
                         const duration = (performance.now() - start).toFixed(2);
                         appendNetLog('TELNET', `Port ${port} Open (WS Probe) - ${duration}ms`);
                     } catch(e2) {
                         // Failed
                     }
                 }
                 
                 if (!isOpen) {
                     appendNetLog('TELNET', `Port ${port} Unreachable or Timed Out`, true);
                 }
                 return;
            }
            
            // Ping Logic (Existing)
            if (!url.startsWith('http') && !url.startsWith('ws')) {
                url = 'http://' + url; // Default to http
            }
            
            appendNetLog('PING', `Pinging ${escapeHtml(url)}...`);
            
            const start = performance.now();
            try {
                if (url.startsWith('http')) {
                    const controller = new AbortController();
                    const id = setTimeout(() => controller.abort(), 5000);
                    await fetch(url, { method: 'HEAD', mode: 'no-cors', signal: controller.signal });
                    clearTimeout(id);
                } else {
                    // WS Ping
                    await new Promise((resolve, reject) => {
                        const ws = new WebSocket(url);
                        const to = setTimeout(() => { ws.close(); reject(new Error('Timeout')); }, 5000);
                        ws.onopen = () => { clearTimeout(to); ws.close(); resolve(); };
                        ws.onerror = (e) => { clearTimeout(to); reject(new Error('Connection failed')); };
                    });
                }
                const duration = (performance.now() - start).toFixed(2);
                appendNetLog('PING', `Success! Latency: ${duration}ms`);
            } catch (e) {
                const duration = (performance.now() - start).toFixed(2);
                appendNetLog('PING', `Failed (${duration}ms): ${escapeHtml(e.message)}`, true);
            }
        };

        document.getElementById('net-clear-log').onclick = () => {
            document.getElementById('net-log').innerHTML = '<div style="color:var(--muted); text-align:center; margin-top:2rem;">等待请求...</div>';
            showToast('日志已清空');
        };

        // Initialize view based on default selection
        const netTypeEl = document.getElementById('net-type');
        if (netTypeEl) {
             netTypeEl.dispatchEvent(new Event('change'));
        }

        // --- Crypto Logic ---
        const cryptoInput = document.getElementById('crypto-input');
        const cryptoOutput = document.getElementById('crypto-output');
        const cryptoInfo = document.getElementById('crypto-info');
        const cryptoUppercase = document.getElementById('crypto-uppercase');

        // Load Crypto settings
        if (cryptoInput) cryptoInput.value = safeStorage.get('crypto-input') || '';
        if (cryptoUppercase) cryptoUppercase.checked = safeStorage.get('crypto-upper') === 'true';

        async function doCrypto(algo) {
            const text = cryptoInput.value;
            if (!text) return showToast('请输入文本');

            // Save settings
            safeStorage.set('crypto-input', text);
            safeStorage.set('crypto-upper', cryptoUppercase.checked);

            let result = '';
            const start = performance.now();

            try {
                if (algo === 'MD5') {
                     // Check if md5 is loaded
                     if (typeof md5 === 'function') {
                         result = md5(text);
                     } else if (typeof window.md5 === 'function') {
                         result = window.md5(text);
                     } else {
                         return showToast('MD5 库未加载');
                     }
                } else {
                    // SHA-1, SHA-256, SHA-512
                    const msgBuffer = new TextEncoder().encode(text);
                    const hashBuffer = await crypto.subtle.digest(algo, msgBuffer);
                    const hashArray = Array.from(new Uint8Array(hashBuffer));
                    result = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
                }

                if (cryptoUppercase.checked) result = result.toUpperCase();
                addToHistory('crypto', `${algo}: ${result}`);

                cryptoOutput.value = result;
                const time = (performance.now() - start).toFixed(2);
                cryptoInfo.textContent = `${algo} calculated in ${time}ms. Length: ${result.length}`;
            } catch (e) {
                showToast('Error: ' + e.message);
            }
        }

        document.getElementById('btn-crypto-md5').onclick = () => doCrypto('MD5');
        document.getElementById('btn-crypto-sha1').onclick = () => doCrypto('SHA-1');
        document.getElementById('btn-crypto-sha256').onclick = () => doCrypto('SHA-256');
        document.getElementById('btn-crypto-sha512').onclick = () => doCrypto('SHA-512');
        document.getElementById('btn-crypto-copy').onclick = () => copyText(cryptoOutput.value);
        
        // Auto-save Crypto input with debounce
        let cryptoSaveTimer = null;
        if (cryptoInput) cryptoInput.oninput = () => {
            clearTimeout(cryptoSaveTimer);
            cryptoSaveTimer = setTimeout(() => safeStorage.set('crypto-input', cryptoInput.value), 300);
        };

        document.getElementById('crypto-clear').onclick = () => { 
            cryptoInput.value = ''; 
            cryptoOutput.value = ''; 
            cryptoInfo.textContent = '等待计算...';
            safeStorage.set('crypto-input', '');
            showToast('已清空');
        };

        if (cryptoUppercase) {
            cryptoUppercase.onchange = () => {
                const val = cryptoOutput.value;
                if (!val) return;
                
                if (cryptoUppercase.checked) {
                    cryptoOutput.value = val.toUpperCase();
                } else {
                    cryptoOutput.value = val.toLowerCase();
                }
                safeStorage.set('crypto-upper', cryptoUppercase.checked);
            };
        }
        
        // Crypto Examples
        const cryptoExamplesData = {
            'simple': 'Hello World 123456',
            'number': '123456',
            'chinese': '你好，世界！This is a test.',
            'json': '{"id": 1001, "name": "EasyTools", "timestamp": 1699999999}',
            'long': 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.'
        };

        document.getElementById('crypto-examples').onchange = (e) => {
            const key = e.target.value;
            if (key && cryptoExamplesData[key]) {
                cryptoInput.value = cryptoExamplesData[key];
                showToast('已加载示例: ' + e.target.options[e.target.selectedIndex].text);
            }
            e.target.value = ''; // Reset select
        };

        // --- Regex Logic ---
        const regexPattern = document.getElementById('regex-pattern');
        const regexFlags = document.getElementById('regex-flags');
        const regexText = document.getElementById('regex-text');
        const regexOutput = document.getElementById('regex-output');
        const regexCount = document.getElementById('regex-count');
        const regexReplaceStr = document.getElementById('regex-replace-str');
        const regexReplaceContainer = document.getElementById('regex-replace-container');
        const regexReplaceResult = document.getElementById('regex-replace-result');
        const btnRegexReplace = document.getElementById('btn-regex-replace');
        
        // Regex Examples
        const regexExamplesData = {
            'email': { pattern: '[\\w\\.-]+@[\\w\\.-]+\\.\\w+', flags: 'gm', text: 'Contact us: support@example.com\nCEO: john.doe@company.org' },
            'phone': { pattern: '1[3-9]\\d{9}', flags: 'gm', text: '我的手机号是 13800138000。\n客服电话 15912345678。' },
            'url': { pattern: 'https?:\\/\\/[\\w\\-\\.]+(?::\\d+)?(?:\\/[\\w\\-._~:/?#[\\]@!$&\'()*+,;=]*)?', flags: 'gm', text: 'Visit https://www.google.com or http://localhost:8080/test' },
            'date': { pattern: '\\d{4}-\\d{2}-\\d{2}', flags: 'gm', text: '今天是 2023-10-01。\n会议时间: 2024-01-15' },
            'time': { pattern: '([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d', flags: 'gm', text: 'Current time: 14:30:00\nAlarm set for 07:00:00' },
            'ipv4': { pattern: '((25[0-5]|(2[0-4]|1\\d|[1-9]|)\\d)\\.?\\b){4}', flags: 'gm', text: 'Localhost: 127.0.0.1\nDNS: 8.8.8.8' },
            'ipv6': { pattern: '([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}', flags: 'gm', text: '2001:0db8:85a3:0000:0000:8a2e:0370:7334\n::1' },
            'idcard': { pattern: '[1-9]\\d{5}(18|19|20)\\d{2}((0[1-9])|(1[0-2]))(([0-2][1-9])|10|20|30|31)\\d{3}[0-9Xx]', flags: 'gm', text: '身份证: 110101199003071234\n伪造号: 123456789012345678' },
            'chinese': { pattern: '[\\u4e00-\\u9fa5]+', flags: 'gm', text: 'Hello 世界\nThis is a test 测试' },
            'password': { pattern: '^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)(?=.*[@$!%*?&])[A-Za-z\\d@$!%*?&]{8,}$', flags: 'gm', text: 'Password123!\nweak\nNoSpecialChar1' },
            'html_tag': { pattern: '<[^>]+>', flags: 'gm', text: '<div><h1>Title</h1><p>Content</p></div>' },
            'blank_line': { pattern: '^\\s*$', flags: 'gm', text: 'Line 1\n\nLine 2\n  \nLine 3' },
            'hex_color': { pattern: '#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})', flags: 'gm', text: 'Colors: #ff0000, #0f0, #123456' },
            'number': { pattern: '-?\\d+(\\.\\d+)?', flags: 'gm', text: 'Values: 123, -45.67, 0, 3.14159' },
            'slug': { pattern: '^[a-z0-9]+(?:-[a-z0-9]+)*$', flags: 'gm', text: 'my-blog-post\nINVALID_SLUG\nanother-slug-123' }
        };
        
        document.getElementById('regex-examples').onchange = (e) => {
            const key = e.target.value;
            if (!key || !regexExamplesData[key]) return;
            
            const data = regexExamplesData[key];
            regexPattern.value = data.pattern;
            regexFlags.value = data.flags;
            regexText.value = data.text;
            
            updateRegex();
            showToast('已加载示例: ' + e.target.options[e.target.selectedIndex].text);
            e.target.value = ''; // Reset select
        };

        // Load Regex settings
        if (regexPattern) regexPattern.value = safeStorage.get('regex-pattern') || '';
        if (regexFlags) regexFlags.value = safeStorage.get('regex-flags') || 'gm';
        if (regexText) regexText.value = safeStorage.get('regex-text') || '';

        function escapeHtml(str) {
            return str.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
        }

        // Debounced save for regex settings
        let regexSaveTimer = null;
        function saveRegexSettings() {
            clearTimeout(regexSaveTimer);
            regexSaveTimer = setTimeout(() => {
                safeStorage.set('regex-pattern', regexPattern.value);
                safeStorage.set('regex-flags', regexFlags.value);
                safeStorage.set('regex-text', regexText.value);
            }, 300);
        }

        function updateRegex() {
            const pattern = regexPattern.value;
            const flags = regexFlags.value;
            const text = regexText.value;

            // Debounced save
            saveRegexSettings();

            if (!pattern || !text) {
                regexOutput.textContent = text || '';
                regexCount.textContent = '0 处匹配';
                return;
            }

            try {
                const re = new RegExp(pattern, flags);
                let matchCount = 0;
                let html = '';

                // If global flag is present, find all matches
                if (flags.includes('g')) {
                    const matches = [...text.matchAll(re)];
                    matchCount = matches.length;
                    
                    if (matches.length === 0) {
                        html = escapeHtml(text);
                    } else {
                        let lastIdx = 0;
                        for (const m of matches) {
                             const start = m.index;
                             const end = start + m[0].length;
                             // Text before match
                             html += escapeHtml(text.substring(lastIdx, start));
                             // Match
                             html += `<span style="background:var(--accent); color:#fff; border-radius:2px; box-shadow:0 0 2px rgba(0,0,0,0.5);">${escapeHtml(m[0])}</span>`;
                             lastIdx = end;
                        }
                        // Remaining text
                        html += escapeHtml(text.substring(lastIdx));
                    }
                } else {
                    // Single match
                    const match = re.exec(text);
                    if (match) {
                        matchCount = 1;
                        const m = match[0];
                        const start = match.index;
                        const end = start + m.length;
                        
                        html += escapeHtml(text.substring(0, start));
                        html += `<span style="background:var(--accent); color:#fff; border-radius:2px; box-shadow:0 0 2px rgba(0,0,0,0.5);">${escapeHtml(m)}</span>`;
                        html += escapeHtml(text.substring(end));
                    } else {
                        html = escapeHtml(text);
                    }
                }

                regexOutput.innerHTML = html;
                regexCount.textContent = `${matchCount} 处匹配`;
                regexCount.style.color = matchCount > 0 ? 'var(--success)' : 'var(--muted)';
                
                // 保存到历史记录（仅在有匹配时）
                if (matchCount > 0 && pattern.length <= HISTORY_ITEM_MAX_CHARS) {
                    addToHistory('regex', `/${pattern}/${flags} => ${matchCount} matches`);
                }

            } catch (e) {
                regexCount.textContent = '正则错误';
                regexCount.style.color = 'var(--danger)';
                regexOutput.innerHTML = `<span style="color:var(--danger)">${escapeHtml(e.message)}</span>`;
            }
        }

        regexPattern.oninput = updateRegex;
        regexFlags.oninput = updateRegex;
        regexText.oninput = updateRegex;

        function replaceRegex() {
            const pattern = regexPattern.value;
            const flags = regexFlags.value;
            const text = regexText.value;
            const replacement = regexReplaceStr.value || '';
            
            if (!pattern) return;
            
            try {
                const re = new RegExp(pattern, flags);
                const result = text.replace(re, replacement);
                
                // 保存到历史记录
                if (result !== text && pattern.length <= HISTORY_ITEM_MAX_CHARS) {
                    addToHistory('regex', `/${pattern}/${flags} => replace with "${replacement}"`);
                }
                
                regexReplaceResult.value = result;
                regexReplaceContainer.style.display = 'flex';
            } catch (e) {
                showToast('Replace Error: ' + e.message);
            }
        }
        
        if (btnRegexReplace) btnRegexReplace.onclick = replaceRegex;

        // Trigger initial update if there's saved content
        if (regexPattern.value || regexText.value) {
            state.skipNextHistory = true;
            updateRegex();
        }

        // --- Snowflake ID Generator ---
        let lastSnowTimestamp = -1n;
        let snowSequence = 0n;
        let lastSnowRawID = null;
        const SNOW_EPOCH = 1640995200000n; // 2022-01-01 00:00:00 UTC
        const BASE62_CHARS = "0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";

        function encodeBase62(num) {
            let s = '';
            if (num === 0n) return '0';
            while (num > 0n) {
                s = BASE62_CHARS[Number(num % 62n)] + s;
                num /= 62n;
            }
            return s;
        }

        // Load Snowflake settings
        const snowDcInput = document.getElementById('snow-datacenter');
        const snowWorkerInput = document.getElementById('snow-worker');
        const snowShortInput = document.getElementById('snow-short');
        const snowJsSafeInput = document.getElementById('snow-js-safe');

        if (snowDcInput) snowDcInput.value = safeStorage.get('snow-dc') || '1';
        if (snowWorkerInput) snowWorkerInput.value = safeStorage.get('snow-worker') || '1';
        if (snowShortInput) snowShortInput.checked = safeStorage.get('snow-short') === 'true';
        if (snowJsSafeInput) snowJsSafeInput.checked = safeStorage.get('snow-js-safe') === 'true';
        
        // Auto-save Snowflake inputs
        if (snowDcInput) snowDcInput.oninput = () => safeStorage.set('snow-dc', snowDcInput.value);
        if (snowWorkerInput) snowWorkerInput.oninput = () => safeStorage.set('snow-worker', snowWorkerInput.value);
        if (snowShortInput) snowShortInput.onchange = () => {
             safeStorage.set('snow-short', snowShortInput.checked);
             renderSnowflakeOutput();
        };
        if (snowJsSafeInput) snowJsSafeInput.onchange = () => {
             safeStorage.set('snow-js-safe', snowJsSafeInput.checked);
             genSnowflake(); // Re-generate because the ID value itself changes
        };

        function renderSnowflakeOutput() {
            if (lastSnowRawID === null) return;
            const output = document.getElementById('snow-output');
            const isShort = snowShortInput && snowShortInput.checked;
            output.value = isShort ? encodeBase62(lastSnowRawID) : lastSnowRawID.toString();
        }

        function genSnowflake() {
            const dcId = BigInt(snowDcInput.value || 1);
            const workerId = BigInt(snowWorkerInput.value || 1);
            const isJsSafe = snowJsSafeInput && snowJsSafeInput.checked;
            const output = document.getElementById('snow-output');
            const info = document.getElementById('snow-info');

            // Save settings
            safeStorage.set('snow-dc', snowDcInput.value);
            safeStorage.set('snow-worker', snowWorkerInput.value);
            if (snowShortInput) safeStorage.set('snow-short', snowShortInput.checked);
            if (snowJsSafeInput) safeStorage.set('snow-js-safe', snowJsSafeInput.checked);

            let timestamp = BigInt(Date.now());

            if (timestamp < lastSnowTimestamp) {
                return showToast('时钟回退，生成失败');
            }

            let maxSequence;
            if (isJsSafe) {
                // 53-bit mode: 6 bits for sequence (0-63)
                maxSequence = 63n;
            } else {
                // 64-bit mode: 12 bits for sequence (0-4095)
                maxSequence = 4095n;
            }

            if (timestamp === lastSnowTimestamp) {
                snowSequence = (snowSequence + 1n) & maxSequence;
                if (snowSequence === 0n) {
                    while (timestamp <= lastSnowTimestamp) {
                        timestamp = BigInt(Date.now());
                    }
                }
            } else {
                snowSequence = 0n;
            }

            lastSnowTimestamp = timestamp;

            let id;
            if (isJsSafe) {
                // 53-bit Snowflake Structure:
                // 41 bits timestamp | 6 bits worker | 6 bits sequence
                // Note: We combine DC and Worker into 6 bits (mod 64) for simplicity in this mode
                const combinedWorker = (dcId + workerId) & 63n;
                id = ((timestamp - SNOW_EPOCH) << 12n) |
                     (combinedWorker << 6n) |
                     snowSequence;
            } else {
                // Standard 64-bit Snowflake Structure:
                // 1 bit sign | 41 bits timestamp | 5 bits DC | 5 bits Worker | 12 bits sequence
                id = ((timestamp - SNOW_EPOCH) << 22n) |
                     (dcId << 17n) |
                     (workerId << 12n) |
                     snowSequence;
            }

            lastSnowRawID = id;
            renderSnowflakeOutput();
            addToHistory('snowflake', output.value);
            
            const date = new Date(Number(timestamp));
            const bitInfo = isJsSafe ? '53位 (JS安全)' : '64位 (标准)';
            info.innerHTML = `<strong>模式:</strong> ${bitInfo} &nbsp; <strong>时间戳:</strong> ${timestamp}<br><strong>解析日期:</strong> ${date.toLocaleString()}.${date.getMilliseconds()}`;
        }

        document.getElementById('btn-gen-snow').onclick = genSnowflake;
        document.getElementById('btn-copy-snow').onclick = () => copyText(document.getElementById('snow-output').value);
        document.getElementById('btn-snow-reset').onclick = () => {
             document.getElementById('snow-datacenter').value = '1';
             document.getElementById('snow-worker').value = '1';
             document.getElementById('snow-output').value = '';
             document.getElementById('snow-info').innerHTML = '';
             if(snowShortInput) snowShortInput.checked = false;
             if(snowJsSafeInput) snowJsSafeInput.checked = false;
             lastSnowRawID = null;
             safeStorage.remove('snow-dc');
             safeStorage.remove('snow-worker');
             safeStorage.remove('snow-short');
             safeStorage.remove('snow-js-safe');
             showToast('已重置');
        };

        // --- UUID Generator ---
        // Load UUID settings
        const uuidCountInput = document.getElementById('uuid-count');
        const uuidNoHyphenInput = document.getElementById('uuid-no-hyphen');
        const uuidUpperInput = document.getElementById('uuid-upper');
        if (uuidCountInput) {
            uuidCountInput.value = safeStorage.get('uuid-count') || '10';
            uuidCountInput.oninput = () => safeStorage.set('uuid-count', uuidCountInput.value);
        }
        if (uuidNoHyphenInput) uuidNoHyphenInput.checked = safeStorage.get('uuid-no-hyphen') === 'true';
        if (uuidUpperInput) uuidUpperInput.checked = safeStorage.get('uuid-upper') === 'true';

        function genUUIDs() {
            const count = parseInt(uuidCountInput.value) || 10;
            const noHyphen = uuidNoHyphenInput.checked;
            const isUpper = uuidUpperInput.checked;
            const output = document.getElementById('uuid-output');
            let results = [];

            // Save settings
            safeStorage.set('uuid-count', uuidCountInput.value);
            safeStorage.set('uuid-no-hyphen', uuidNoHyphenInput.checked);
            safeStorage.set('uuid-upper', uuidUpperInput.checked);

            for (let i = 0; i < count; i++) {
                let uuid = '';
                if (typeof crypto.randomUUID === 'function') {
                    uuid = crypto.randomUUID();
                } else {
                    // Fallback for older browsers
                    uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                        const r = Math.random() * 16 | 0;
                        const v = c === 'x' ? r : (r & 0x3 | 0x8);
                        return v.toString(16);
                    });
                }
                if (noHyphen) uuid = uuid.replace(/-/g, '');
                if (isUpper) uuid = uuid.toUpperCase();
                results.push(uuid);
            }
            const resultStr = results.join('\n');
            output.value = resultStr;
            addToHistory('uuid', resultStr);
        }

        function updateUUIDs() {
            const output = document.getElementById('uuid-output');
            if (!output.value.trim()) return;

            const noHyphen = uuidNoHyphenInput.checked;
            const isUpper = uuidUpperInput.checked;

            safeStorage.set('uuid-no-hyphen', noHyphen);
            safeStorage.set('uuid-upper', isUpper);

            const lines = output.value.split('\n');
            const newLines = lines.map(line => {
                // Normalize: remove hyphens and non-hex chars
                let clean = line.replace(/[^a-fA-F0-9]/g, '');
                // UUID is 32 hex digits
                if (clean.length === 32) {
                    if (!noHyphen) {
                        clean = clean.slice(0, 8) + '-' + clean.slice(8, 12) + '-' + clean.slice(12, 16) + '-' + clean.slice(16, 20) + '-' + clean.slice(20);
                    }
                    return isUpper ? clean.toUpperCase() : clean.toLowerCase();
                }
                return line;
            });
            output.value = newLines.join('\n');
        }

        if (uuidNoHyphenInput) uuidNoHyphenInput.onchange = updateUUIDs;
        if (uuidUpperInput) uuidUpperInput.onchange = updateUUIDs;

        document.getElementById('btn-gen-uuid').onclick = genUUIDs;
        document.getElementById('btn-copy-uuid').onclick = () => copyText(document.getElementById('uuid-output').value);
        document.getElementById('btn-uuid-reset').onclick = () => {
             document.getElementById('uuid-count').value = '10';
             document.getElementById('uuid-no-hyphen').checked = false;
             document.getElementById('uuid-upper').checked = false;
             document.getElementById('uuid-output').value = '';
             safeStorage.remove('uuid-count');
             safeStorage.remove('uuid-no-hyphen');
             safeStorage.remove('uuid-upper');
             showToast('已重置');
        };

        // --- Password Generator ---
        const pwdLenInput = document.getElementById('pwd-length');
        const pwdLenVal = document.getElementById('pwd-len-val');
        const pwdUpperInput = document.getElementById('pwd-upper');
        const pwdLowerInput = document.getElementById('pwd-lower');
        const pwdNumInput = document.getElementById('pwd-number');
        const pwdSpecInput = document.getElementById('pwd-special');

        // Load Password settings
        if (pwdLenInput) {
            pwdLenInput.value = safeStorage.get('pwd-length') || '16';
            pwdLenVal.textContent = pwdLenInput.value;
            pwdLenInput.oninput = () => { 
                pwdLenVal.textContent = pwdLenInput.value; 
                safeStorage.set('pwd-length', pwdLenInput.value);
            };
        }
        if (pwdUpperInput) {
            pwdUpperInput.checked = safeStorage.get('pwd-upper') !== 'false';
            pwdUpperInput.onchange = () => safeStorage.set('pwd-upper', pwdUpperInput.checked);
        }
        if (pwdLowerInput) {
            pwdLowerInput.checked = safeStorage.get('pwd-lower') !== 'false';
            pwdLowerInput.onchange = () => safeStorage.set('pwd-lower', pwdLowerInput.checked);
        }
        if (pwdNumInput) {
            pwdNumInput.checked = safeStorage.get('pwd-number') !== 'false';
            pwdNumInput.onchange = () => safeStorage.set('pwd-number', pwdNumInput.checked);
        }
        if (pwdSpecInput) {
            pwdSpecInput.checked = safeStorage.get('pwd-special') !== 'false';
            pwdSpecInput.onchange = () => safeStorage.set('pwd-special', pwdSpecInput.checked);
        }

        function genPassword() {
            const length = parseInt(pwdLenInput.value);
            const hasUpper = pwdUpperInput.checked;
            const hasLower = pwdLowerInput.checked;
            const hasNumber = pwdNumInput.checked;
            const hasSpecial = pwdSpecInput.checked;
            const output = document.getElementById('pwd-output');

            // Save settings
            safeStorage.set('pwd-upper', hasUpper);
            safeStorage.set('pwd-lower', hasLower);
            safeStorage.set('pwd-number', hasNumber);
            safeStorage.set('pwd-special', hasSpecial);

            const lower = 'abcdefghijklmnopqrstuvwxyz';
            const upper = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
            const numbers = '0123456789';
            const special = '!@#$%^&*()_+~`|}{[]:;?><,./-=';

            let chars = '';
            if (hasLower) chars += lower;
            if (hasUpper) chars += upper;
            if (hasNumber) chars += numbers;
            if (hasSpecial) chars += special;

            if (!chars) {
                return showToast('请至少选择一种字符类型');
            }

            let password = '';
            const array = new Uint32Array(length);
            window.crypto.getRandomValues(array);

            for (let i = 0; i < length; i++) {
                password += chars.charAt(array[i] % chars.length);
            }
            output.value = password;
            addToHistory('password', password);
        }

        const btnGenPwd = document.getElementById('btn-gen-pwd');
        if (btnGenPwd) btnGenPwd.onclick = genPassword;
        const btnCopyPwd = document.getElementById('btn-copy-pwd');
        if(btnCopyPwd) {
             btnCopyPwd.onclick = () => {
                 const val = document.getElementById('pwd-output').value;
                 if(val) copyText(val);
                 else showToast('没有内容可复制');
             };
        }
        document.getElementById('btn-pwd-reset').onclick = () => {
             document.getElementById('pwd-length').value = '16';
             document.getElementById('pwd-len-val').textContent = '16';
             document.getElementById('pwd-upper').checked = true;
             document.getElementById('pwd-lower').checked = true;
             document.getElementById('pwd-number').checked = true;
             document.getElementById('pwd-special').checked = true;
             document.getElementById('pwd-output').value = '';
             safeStorage.remove('pwd-length');
             safeStorage.remove('pwd-upper');
             safeStorage.remove('pwd-lower');
             safeStorage.remove('pwd-number');
             safeStorage.remove('pwd-special');
             showToast('已重置');
        };

        window.setPwdPreset = function(type) {
            const len = document.getElementById('pwd-length');
            const upper = document.getElementById('pwd-upper');
            const lower = document.getElementById('pwd-lower');
            const num = document.getElementById('pwd-number');
            const spec = document.getElementById('pwd-special');
            
            if (type === 'strong') {
                len.value = 16;
                upper.checked = true;
                lower.checked = true;
                num.checked = true;
                spec.checked = true;
            } else if (type === 'simple') {
                len.value = 12;
                upper.checked = true;
                lower.checked = true;
                num.checked = true;
                spec.checked = false;
            } else if (type === 'pin') {
                len.value = 6;
                upper.checked = false;
                lower.checked = false;
                num.checked = true;
                spec.checked = false;
            }
            
            pwdLenVal.textContent = len.value;
            genPassword();
        };

        window.setSnowPreset = function(type) {
             const dc = document.getElementById('snow-datacenter');
             const worker = document.getElementById('snow-worker');
             if(type === 'default') {
                 dc.value = 1; worker.value = 1;
             } else if(type === 'max') {
                 dc.value = 31; worker.value = 31;
             } else if(type === 'random') {
                 dc.value = Math.floor(Math.random() * 32);
                 worker.value = Math.floor(Math.random() * 32);
             }
        };

        window.setMockPreset = function(type) {
             const age = document.getElementById('mock-age');
             const gender = document.getElementById('mock-gender');
             if(type === 'male_young') {
                 age.value = 18 + Math.floor(Math.random() * 12);
                 gender.value = 'M';
             } else if(type === 'female_young') {
                 age.value = 18 + Math.floor(Math.random() * 12);
                 gender.value = 'F';
             } else if(type === 'elder') {
                 age.value = 60 + Math.floor(Math.random() * 20);
                 gender.value = Math.random() > 0.5 ? 'M' : 'F';
             } else if(type === 'random') {
                 document.getElementById('mock-reset').click();
             }
        };
        
        window.setNetExample = function(type) {
             const method = document.getElementById('net-method');
             const url = document.getElementById('net-url');
             const body = document.getElementById('net-body');
             const headers = document.getElementById('net-headers');
             const typeSel = document.getElementById('net-type');
             
             if(type === 'get_json') {
                 typeSel.value = 'http';
                 method.value = 'GET';
                 url.value = 'https://jsonplaceholder.typicode.com/posts/1';
                 body.value = '';
                 headers.value = '{\n  "Accept": "application/json"\n}';
             } else if(type === 'post_json') {
                 typeSel.value = 'http';
                 method.value = 'POST';
                 url.value = 'https://jsonplaceholder.typicode.com/posts';
                 body.value = '{\n  "title": "foo",\n  "body": "bar",\n  "userId": 1\n}';
                 headers.value = '{\n  "Content-Type": "application/json"\n}';
             } else if(type === 'ws_echo') {
                 typeSel.value = 'ws';
                 url.value = 'wss://echo.websocket.events';
                 body.value = '';
                 headers.value = '';
             }
             // Trigger change to update UI visibility
             typeSel.dispatchEvent(new Event('change'));
        };

        const btnCopyUuid = document.getElementById('btn-copy-uuid');
        if(btnCopyUuid) {
            btnCopyUuid.onclick = () => {
                const val = document.getElementById('uuid-output').value;
                if(val) copyText(val);
                else showToast('没有内容可复制');
            };
        }
        
        // 暴露 copyText 为全局 copyToClipboard
        window.copyToClipboard = copyText;

        // --- Diff Tool Logic ---
    function diffText() {
        const text1 = document.getElementById('diff-left').value;
        const text2 = document.getElementById('diff-right').value;
        const output = document.getElementById('diff-output');
        
        if (!text1 && !text2) {
            output.innerHTML = '<div style="color:var(--muted); padding:1rem;">请输入需要对比的文本...</div>';
            return;
        }

        const lines1 = text1.split(/\r?\n/);
        const lines2 = text2.split(/\r?\n/);
        
        // Performance Warning
        if (lines1.length * lines2.length > 2500000) {
            if (!confirm(`文本行数较多 (${lines1.length} x ${lines2.length})，对比可能导致页面卡顿，是否继续？`)) {
                output.innerHTML = '<div style="color:var(--muted); padding:1rem;">已取消对比</div>';
                return;
            }
        }

        // Simple Line Diff Algorithm (LCS based)
        const matrix = Array(lines1.length + 1).fill(null).map(() => Array(lines2.length + 1).fill(0));
        
        for (let i = 1; i <= lines1.length; i++) {
            for (let j = 1; j <= lines2.length; j++) {
                if (lines1[i-1] === lines2[j-1]) {
                    matrix[i][j] = matrix[i-1][j-1] + 1;
                } else {
                    matrix[i][j] = Math.max(matrix[i-1][j], matrix[i][j-1]);
                }
            }
        }
        
        let i = lines1.length;
        let j = lines2.length;
        const result = [];
        
        while (i > 0 || j > 0) {
            if (i > 0 && j > 0 && lines1[i-1] === lines2[j-1]) {
                result.unshift({ type: 'equal', text: lines1[i-1] });
                i--;
                j--;
            } else if (j > 0 && (i === 0 || matrix[i][j-1] >= matrix[i-1][j])) {
                result.unshift({ type: 'add', text: lines2[j-1] });
                j--;
            } else {
                result.unshift({ type: 'remove', text: lines1[i-1] });
                i--;
            }
        }
        
        let html = '';
        result.forEach((line, idx) => {
            const num = (idx + 1).toString().padStart(3, ' ');
            if (line.type === 'equal') {
                html += `<div class="diff-line"><span class="diff-num">${num}</span>  ${escapeHtml(line.text)}</div>`;
            } else if (line.type === 'add') {
                html += `<div class="diff-line added"><span class="diff-num">${num}</span>+ ${escapeHtml(line.text)}</div>`;
            } else {
                html += `<div class="diff-line removed"><span class="diff-num">${num}</span>- ${escapeHtml(line.text)}</div>`;
            }
        });
        
        output.innerHTML = html;

        // 保存到历史记录
        if (text1 && text2) {
            const summary = `Left: ${text1.length} chars, Right: ${text2.length} chars\nChanges: ${result.filter(r => r.type !== 'equal').length} lines`;
            addToHistory('diff', summary, { leftLen: text1.length, rightLen: text2.length });
        }
    }

    const btnDiffRun = document.getElementById('btn-diff-run');
    if (btnDiffRun) btnDiffRun.onclick = diffText;

    // Auto-save Diff inputs with debounce
    let diffLeftSaveTimer = null, diffRightSaveTimer = null;
    document.getElementById('diff-left').oninput = (e) => {
        clearTimeout(diffLeftSaveTimer);
        diffLeftSaveTimer = setTimeout(() => safeStorage.set('diff-left', e.target.value), 500);
    };
    document.getElementById('diff-right').oninput = (e) => {
        clearTimeout(diffRightSaveTimer);
        diffRightSaveTimer = setTimeout(() => safeStorage.set('diff-right', e.target.value), 500);
    };
    
    const btnDiffClear = document.getElementById('btn-diff-clear');
    if (btnDiffClear) btnDiffClear.onclick = () => {
        document.getElementById('diff-left').value = '';
        safeStorage.set('diff-left', '');
        document.getElementById('diff-right').value = '';
        safeStorage.set('diff-right', '');
        document.getElementById('diff-output').innerHTML = '';
        showToast('已清空');
    };

    const diffExamplesData = {
        'code': {
            left: `function calculateTotal(price, tax) {
    return price + tax;
}

const appConfig = {
    version: "1.0.0",
    debug: false,
    theme: "light"
};`,
            right: `function calculateTotal(price, tax, discount = 0) {
    if (price < 0) return 0;
    return price + tax - discount;
}

const appConfig = {
    version: "1.0.1",
    debug: true,
    theme: "dark",
    features: ["auth", "dashboard"]
};`
        },
        'config': {
            left: `{
  "server": {
    "host": "localhost",
    "port": 8080
  },
  "database": {
    "url": "jdbc:mysql://localhost:3306/db",
    "username": "root",
    "password": "password"
  },
  "logging": "INFO"
}`,
            right: `{
  "server": {
    "host": "0.0.0.0",
    "port": 9090
  },
  "database": {
    "url": "jdbc:postgresql://db-server:5432/mydb",
    "username": "admin",
    "password": "secure_password",
    "poolSize": 20
  },
  "logging": "DEBUG",
  "metrics": true
}`
        },
        'text': {
            left: `春江花月夜
张若虚

春江潮水连海平，海上明月共潮生。
滟滟随波千万里，何处春江无月明！
江流宛转绕芳殿，月照花林皆似霰。
空里流霜不觉飞，汀上白沙看不见。`,
            right: `春江花月夜
【唐】张若虚

春江潮水连海平，海上明月共潮生。
滟滟随波千万里，何处春江无月明！
江流宛转绕芳殿，月照花林皆似霰。
空里流霜不觉飞，汀上白沙看不见。
江天一色无纤尘，皎皎空中孤月轮。`
        }
    };

    const diffExSelect = document.getElementById('diff-examples');
    if (diffExSelect) {
        diffExSelect.onchange = (e) => {
            const val = diffExamplesData[e.target.value];
            if (val) {
                document.getElementById('diff-left').value = val.left;
                document.getElementById('diff-right').value = val.right;
                diffText();
            }
            e.target.value = '';
        };
    }

    // --- JWT Tool Logic ---
    function decodeJwt() {
        const input = document.getElementById('jwt-input').value.trim();
        const headerEl = document.getElementById('jwt-header');
        const payloadEl = document.getElementById('jwt-payload');
        const signatureEl = document.getElementById('jwt-signature');

        if (!input) {
            headerEl.textContent = '';
            payloadEl.textContent = '';
            signatureEl.textContent = '';
            return;
        }

        const parts = input.split('.');
        if (parts.length !== 3) {
            headerEl.textContent = 'Invalid JWT format';
            payloadEl.textContent = '';
            signatureEl.textContent = '';
            return;
        }

        let result = '';

        try {
            const header = JSON.parse(atob(parts[0].replace(/-/g, '+').replace(/_/g, '/')));
            headerEl.textContent = JSON.stringify(header, null, 2);
            result += 'Header: ' + JSON.stringify(header, null, 2) + '\n\n';
            // Highlight
            if (window.hljs) hljs.highlightElement(headerEl);
        } catch (e) {
            headerEl.textContent = 'Error decoding header: ' + e.message;
        }

        try {
            const payload = JSON.parse(atob(parts[1].replace(/-/g, '+').replace(/_/g, '/')));
            payloadEl.textContent = JSON.stringify(payload, null, 2);
            result += 'Payload: ' + JSON.stringify(payload, null, 2) + '\n\n';
            if (window.hljs) hljs.highlightElement(payloadEl);
        } catch (e) {
            payloadEl.textContent = 'Error decoding payload: ' + e.message;
        }

        signatureEl.textContent = parts[2];
        result += 'Signature: ' + parts[2];

        // 保存到历史记录
        if (result && input.length <= HISTORY_ITEM_MAX_CHARS) {
            addToHistory('jwt', result);
        }
    }
    
    const jwtInput = document.getElementById('jwt-input');
    if (jwtInput) jwtInput.oninput = decodeJwt;

    const jwtExamplesData = {
        'hs256': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c',
        'rs256': 'eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWUsImlhdCI6MTUxNjIzOTAyMn0.POstT3y9rNkS8HW5_O97_1_7-1_8-1_9-1',
        'expired': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyLCJleHAiOjE1MTYyMzkwMjJ9.Xw',
        'complex': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJ1c2VyMTIzIiwiYXV0aG9yaXRpZXMiOlsiUk9MRV9BRE1JTiIsIlJPTEVfVVNFUiJdLCJkZXRhaWxzIjp7ImlwIjoiMTkyLjE2OC4xLjEiLCJ1c2VyQWdlbnQiOiJNb3ppbGxhLzUuMCJ9LCJpYXQiOjE2MTYyMzkwMjIsImV4cCI6MTYxNjI0MjYyMn0.Signature'
    };

    const jwtExSelect = document.getElementById('jwt-examples');
    if (jwtExSelect) {
        jwtExSelect.onchange = (e) => {
            const val = jwtExamplesData[e.target.value];
            if (val) {
                document.getElementById('jwt-input').value = val;
                decodeJwt();
            }
            e.target.value = '';
        };
    }


    // --- SQL Examples ---
    const sqlExamplesData = {
        // 1. CREATE (建表)
        'create_user': "CREATE TABLE `sys_user` (\n  `user_id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT '用户ID',\n  `dept_id` bigint(20) DEFAULT NULL COMMENT '部门ID',\n  `user_name` varchar(30) NOT NULL COMMENT '用户账号',\n  `nick_name` varchar(30) NOT NULL COMMENT '用户昵称',\n  `user_type` varchar(2) DEFAULT '00' COMMENT '用户类型（00系统用户）',\n  `email` varchar(50) DEFAULT '' COMMENT '用户邮箱',\n  `phonenumber` varchar(11) DEFAULT '' COMMENT '手机号码',\n  `sex` char(1) DEFAULT '0' COMMENT '用户性别（0男 1女 2未知）',\n  `avatar` varchar(100) DEFAULT '' COMMENT '头像地址',\n  `password` varchar(100) DEFAULT '' COMMENT '密码',\n  `status` char(1) DEFAULT '0' COMMENT '帐号状态（0正常 1停用）',\n  `del_flag` char(1) DEFAULT '0' COMMENT '删除标志（0代表存在 2代表删除）',\n  `login_ip` varchar(128) DEFAULT '' COMMENT '最后登录IP',\n  `login_date` datetime DEFAULT NULL COMMENT '最后登录时间',\n  `create_by` varchar(64) DEFAULT '' COMMENT '创建者',\n  `create_time` datetime DEFAULT NULL COMMENT '创建时间',\n  `update_by` varchar(64) DEFAULT '' COMMENT '更新者',\n  `update_time` datetime DEFAULT NULL COMMENT '更新时间',\n  `remark` varchar(500) DEFAULT NULL COMMENT '备注',\n  PRIMARY KEY (`user_id`),\n  UNIQUE KEY `idx_user_name` (`user_name`),\n  KEY `idx_dept_id` (`dept_id`)\n) ENGINE=InnoDB AUTO_INCREMENT=100 DEFAULT CHARSET=utf8mb4 COMMENT='用户信息表';",
        'create_order': "CREATE TABLE `shop_order` (\n  `order_id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT '订单ID',\n  `order_sn` varchar(64) NOT NULL COMMENT '订单编号',\n  `user_id` bigint(20) NOT NULL COMMENT '用户ID',\n  `total_amount` decimal(10,2) NOT NULL COMMENT '订单总金额',\n  `pay_amount` decimal(10,2) NOT NULL COMMENT '应付金额',\n  `freight_amount` decimal(10,2) NOT NULL COMMENT '运费金额',\n  `pay_type` tinyint(1) DEFAULT NULL COMMENT '支付方式：0->未支付；1->支付宝；2->微信',\n  `status` tinyint(1) NOT NULL DEFAULT '0' COMMENT '订单状态：0->待付款；1->待发货；2->已发货；3->已完成；4->已关闭；5->无效订单',\n  `delivery_company` varchar(64) DEFAULT NULL COMMENT '物流公司(配送方式)',\n  `delivery_sn` varchar(64) DEFAULT NULL COMMENT '物流单号',\n  `receiver_name` varchar(100) NOT NULL COMMENT '收货人姓名',\n  `receiver_phone` varchar(32) NOT NULL COMMENT '收货人电话',\n  `receiver_province` varchar(32) DEFAULT NULL COMMENT '省份/直辖市',\n  `receiver_city` varchar(32) DEFAULT NULL COMMENT '城市',\n  `receiver_region` varchar(32) DEFAULT NULL COMMENT '区',\n  `receiver_detail_address` varchar(200) DEFAULT NULL COMMENT '详细地址',\n  `payment_time` datetime DEFAULT NULL COMMENT '支付时间',\n  `delivery_time` datetime DEFAULT NULL COMMENT '发货时间',\n  `receive_time` datetime DEFAULT NULL COMMENT '确认收货时间',\n  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '提交时间',\n  `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '修改时间',\n  PRIMARY KEY (`order_id`),\n  UNIQUE KEY `idx_order_sn` (`order_sn`),\n  KEY `idx_user_status` (`user_id`,`status`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='订单表';",
        'create_article': "CREATE TABLE `cms_article` (\n  `id` bigint(20) NOT NULL AUTO_INCREMENT,\n  `category_id` bigint(20) DEFAULT NULL COMMENT '分类ID',\n  `title` varchar(200) NOT NULL COMMENT '文章标题',\n  `subtitle` varchar(200) DEFAULT NULL COMMENT '副标题',\n  `cover_image` varchar(500) DEFAULT NULL COMMENT '封面图片',\n  `content` longtext COMMENT '文章内容',\n  `keywords` varchar(200) DEFAULT NULL COMMENT '关键词',\n  `description` varchar(500) DEFAULT NULL COMMENT '摘要',\n  `author` varchar(50) DEFAULT NULL COMMENT '作者',\n  `view_count` int(11) DEFAULT '0' COMMENT '浏览量',\n  `sort` int(11) DEFAULT '0' COMMENT '排序',\n  `is_recommend` tinyint(1) DEFAULT '0' COMMENT '是否推荐',\n  `is_top` tinyint(1) DEFAULT '0' COMMENT '是否置顶',\n  `status` tinyint(1) DEFAULT '1' COMMENT '状态：0->草稿；1->发布；2->下架',\n  `publish_time` datetime DEFAULT NULL COMMENT '发布时间',\n  `create_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',\n  `update_time` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',\n  PRIMARY KEY (`id`),\n  KEY `idx_cat_sort` (`category_id`,`sort`),\n  FULLTEXT KEY `idx_title_content` (`title`,`content`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='CMS文章表';",

        // 2. INSERT (增)
        'insert_batch': "INSERT INTO `sys_dict_data` \n(`dict_sort`, `dict_label`, `dict_value`, `dict_type`, `css_class`, `list_class`, `is_default`, `status`, `create_by`, `create_time`, `remark`) VALUES \n(1, '男', '0', 'sys_user_sex', '', '', 'Y', '0', 'admin', SYSDATE(), '性别男'),\n(2, '女', '1', 'sys_user_sex', '', '', 'N', '0', 'admin', SYSDATE(), '性别女'),\n(3, '未知', '2', 'sys_user_sex', '', '', 'N', '0', 'admin', SYSDATE(), '性别未知');",
        'insert_select': "INSERT INTO `sys_oper_log_archive` \n(`title`, `business_type`, `method`, `request_method`, `oper_name`, `oper_url`, `oper_ip`, `oper_location`, `oper_param`, `json_result`, `status`, `error_msg`, `oper_time`)\nSELECT \n  `title`, `business_type`, `method`, `request_method`, `oper_name`, `oper_url`, `oper_ip`, `oper_location`, `oper_param`, `json_result`, `status`, `error_msg`, `oper_time`\nFROM `sys_oper_log`\nWHERE `oper_time` < DATE_SUB(NOW(), INTERVAL 1 YEAR);",
        'insert_upsert': "INSERT INTO `sys_user_online` (`sessionId`, `login_name`, `dept_name`, `ipaddr`, `login_location`, `browser`, `os`, `status`, `start_timestamp`, `last_access_time`, `expire_time`)\nVALUES \n('adv123...', 'admin', '研发部', '127.0.0.1', '内网IP', 'Chrome', 'Windows 10', 'on_line', NOW(), NOW(), DATE_ADD(NOW(), INTERVAL 30 MINUTE))\nON DUPLICATE KEY UPDATE \n  `last_access_time` = VALUES(`last_access_time`),\n  `expire_time` = VALUES(`expire_time`),\n  `status` = 'on_line';",

        // 3. DELETE (删)
        'delete_join': "DELETE t1 \nFROM `sys_logininfor` t1\nINNER JOIN `sys_logininfor` t2 \nWHERE t1.info_id < t2.info_id \n  AND t1.user_name = t2.user_name \n  AND t1.ipaddr = t2.ipaddr \n  AND t1.login_time = t2.login_time\n  AND t1.status = '0';\n-- 删除登录日志中完全重复的记录（保留最新的ID）",
        'delete_limit': "DELETE FROM `sys_notice` \nWHERE `status` = '1' \n  AND `create_time` < DATE_SUB(CURDATE(), INTERVAL 2 YEAR)\nORDER BY `create_time` ASC \nLIMIT 1000;\n-- 分批次清理2年前的已发布公告，防止大事务锁表",
        'delete_sub': "DELETE FROM `sys_role_menu`\nWHERE `role_id` IN (\n    SELECT `role_id` \n    FROM `sys_role` \n    WHERE `del_flag` = '2' OR `status` = '1'\n);\n-- 清理已删除或已停用角色的菜单权限关联数据",

        // 4. UPDATE (改)
        'update_case': "UPDATE `sys_job`\nSET \n  `misfire_policy` = CASE \n      WHEN `cron_expression` LIKE '%/1 * * * * ?' THEN '1' -- 每秒执行的任务，策略改为立即执行\n      WHEN `cron_expression` LIKE '0 0 1 * * ?' THEN '2' -- 每天凌晨的任务，策略改为执行一次\n      ELSE `misfire_policy` \n  END,\n  `update_time` = NOW(),\n  `update_by` = 'system_optimizer'\nWHERE `status` = '0';",
        'update_join': "UPDATE `shop_goods` g\nINNER JOIN `shop_category` c ON g.`category_id` = c.`cat_id`\nSET \n  g.`is_on_sale` = 0,\n  g.`update_time` = NOW(),\n  g.`remark` = CONCAT(IFNULL(g.`remark`,''), ' [Category Offline]')\nWHERE c.`is_show` = 0 AND g.`is_on_sale` = 1;\n-- 当分类下架时，批量下架该分类下的所有商品",
        'update_calc': "UPDATE `shop_member` m\nSET \n  m.`integration` = m.`integration` + 100,\n  m.`history_integration` = m.`history_integration` + 100,\n  m.`member_level_id` = IF(m.`history_integration` > 10000, 2, IF(m.`history_integration` > 5000, 1, m.`member_level_id`))\nWHERE m.`status` = 1 \n  AND m.`birthday` = CURDATE();\n-- 会员生日赠送积分，并根据历史积分自动升级会员等级",

        // 5. SELECT (查)
        'select_report': "SELECT \n    DATE_FORMAT(o.`create_time`, '%Y-%m-%d') AS date_str,\n    COUNT(o.`order_id`) AS total_count,\n    SUM(o.`total_amount`) AS total_amount,\n    SUM(CASE WHEN o.`status` IN (1,2,3) THEN o.`pay_amount` ELSE 0 END) AS valid_income,\n    ROUND(SUM(CASE WHEN o.`status` IN (1,2,3) THEN 1 ELSE 0 END) / COUNT(o.`order_id`) * 100, 2) AS pay_rate\nFROM `shop_order` o\nWHERE o.`create_time` >= DATE_SUB(CURDATE(), INTERVAL 30 DAY)\nGROUP BY date_str\nHAVING valid_income > 1000\nORDER BY date_str DESC;",
        'select_window': "SELECT *\nFROM (\n    SELECT \n        `dept_id`, \n        `user_name`, \n        `salary`,\n        RANK() OVER (PARTITION BY `dept_id` ORDER BY `salary` DESC) as salary_rank\n    FROM `sys_employee`\n) t\nWHERE t.salary_rank <= 3;\n-- 查询每个部门薪资排名前3的员工 (Window Function)",
        'select_join': "SELECT \n    u.`user_id`, u.`nick_name`, u.`email`,\n    d.`dept_name`, \n    r.`role_name`,\n    p.`post_name`\nFROM `sys_user` u\nLEFT JOIN `sys_dept` d ON u.`dept_id` = d.`dept_id`\nLEFT JOIN `sys_user_role` ur ON u.`user_id` = ur.`user_id`\nLEFT JOIN `sys_role` r ON ur.`role_id` = r.`role_id`\nLEFT JOIN `sys_user_post` up ON u.`user_id` = up.`user_id`\nLEFT JOIN `sys_post` p ON up.`post_id` = p.`post_id`\nWHERE u.`del_flag` = '0' \n  AND d.`status` = '0'\n  AND (u.`phonenumber` IS NOT NULL AND u.`phonenumber` != '')\nORDER BY u.`create_time` DESC\nLIMIT 10, 20;"
    };

    const sqlExSelect = document.getElementById('sql-examples');
    if (sqlExSelect) {
        sqlExSelect.onchange = (e) => {
            const val = sqlExamplesData[e.target.value];
            if (val) {
                document.getElementById('sql-input').value = val;
            }
            e.target.value = '';
        };
    }

    // --- Cron Tool Logic ---
    const cronExamples = {
        'every_min': { val: '* * * * *', desc: '每分钟' },
        'every_5min': { val: '*/5 * * * *', desc: '每5分钟' },
        'every_15min': { val: '*/15 * * * *', desc: '每15分钟' },
        'every_30min': { val: '*/30 * * * *', desc: '每30分钟' },
        'every_hour': { val: '0 * * * *', desc: '每小时整点' },
        'every_2hour': { val: '0 */2 * * *', desc: '每2小时' },
        'work_hour': { val: '0 9-18 * * *', desc: '工作时间 (早9到晚6整点)' },
        'daily_midnight': { val: '0 0 * * *', desc: '每天午夜 (00:00)' },
        'daily_noon': { val: '0 12 * * *', desc: '每天中午 (12:00)' },
        'weekly_mon': { val: '0 0 * * 1', desc: '每周一午夜' },
        'weekly_fri': { val: '0 0 * * 5', desc: '每周五午夜' },
        'weekend': { val: '0 0 * * 6,0', desc: '周末 (周六日午夜)' },
        'weekday': { val: '0 0 * * 1-5', desc: '工作日 (周一至周五午夜)' },
        'monthly_first': { val: '0 0 1 * *', desc: '每月1号午夜' },
        'monthly_last': { val: '0 0 L * *', desc: '每月最后一天 (部分系统支持 L)' },
        'quarterly': { val: '0 0 1 1,4,7,10 *', desc: '每季度首日' },
        'yearly': { val: '0 0 1 1 *', desc: '每年1月1号' }
    };
    
    function loadCronExample(key) {
        if (!key || !cronExamples[key]) return;
        const cronInput = document.getElementById('cron-input');
        cronInput.value = cronExamples[key].val;
        parseCron();
    }

    function parseCronField(field, min, max) {
        if (field === '*') return { type: 'all' };
        if (field.startsWith('*/')) {
            const step = parseInt(field.substring(2));
            if (isNaN(step) || step <= 0) throw new Error('Invalid step');
            return { type: 'step', step };
        }
        if (field.includes(',')) {
            const values = field.split(',').map(v => parseInt(v));
            if (values.some(v => isNaN(v) || v < min || v > max)) throw new Error('Value out of range');
            return { type: 'list', values };
        }
        if (field.includes('-')) {
            const parts = field.split('-');
            const start = parseInt(parts[0]);
            const end = parseInt(parts[1]);
            if (isNaN(start) || isNaN(end) || start < min || end > max || start > end) throw new Error('Invalid range');
            return { type: 'range', start, end };
        }
        const val = parseInt(field);
        if (isNaN(val) || val < min || val > max) throw new Error('Value out of range');
        return { type: 'value', val };
    }

    function matchCronField(parsed, val) {
        if (parsed.type === 'all') return true;
        if (parsed.type === 'step') return val % parsed.step === 0;
        if (parsed.type === 'list') return parsed.values.includes(val);
        if (parsed.type === 'range') return val >= parsed.start && val <= parsed.end;
        if (parsed.type === 'value') return val === parsed.val;
        return false;
    }
    
    function calculateNextRuns(cronStr, count = 5) {
        const parts = cronStr.trim().split(/\s+/);
        if (parts.length < 5) return [];
        
        try {
            const minP = parseCronField(parts[0], 0, 59);
            const hourP = parseCronField(parts[1], 0, 23);
            const dayP = parseCronField(parts[2], 1, 31);
            const monthP = parseCronField(parts[3], 1, 12);
            const weekP = parseCronField(parts[4], 0, 6); 
            
            const nextRuns = [];
            let date = new Date();
            date.setSeconds(0);
            date.setMilliseconds(0);
            date.setMinutes(date.getMinutes() + 1);
            
            let iterations = 0;
            const maxIterations = 20000; 
            
            while (nextRuns.length < count && iterations < maxIterations) {
                const min = date.getMinutes();
                const hour = date.getHours();
                const day = date.getDate();
                const month = date.getMonth() + 1;
                const week = date.getDay();
                
                if (matchCronField(monthP, month) &&
                    matchCronField(dayP, day) &&
                    matchCronField(weekP, week) &&
                    matchCronField(hourP, hour) &&
                    matchCronField(minP, min)) {
                    nextRuns.push(new Date(date));
                }
                
                date.setMinutes(date.getMinutes() + 1);
                iterations++;
            }
            return nextRuns;
        } catch (e) {
            return [];
        }
    }
    
    // Debounced save for Cron input
    let cronSaveTimer = null;
    function parseCron() {
        const val = document.getElementById('cron-input').value.trim();

        // Debounced save
        clearTimeout(cronSaveTimer);
        cronSaveTimer = setTimeout(() => {
            if (val) addToHistory('cron', val);
        }, 300);

        const resultEl = document.getElementById('cron-result');
        if (resultEl) resultEl.style.display = 'block';

        const descEl = document.getElementById('cron-desc');
        const nextEl = document.getElementById('cron-next');
        const v1 = document.getElementById('cron-v1');
        const v2 = document.getElementById('cron-v2');
        const v3 = document.getElementById('cron-v3');
        const v4 = document.getElementById('cron-v4');
        const v5 = document.getElementById('cron-v5');

        if (!val) {
            descEl.textContent = '输入 Cron 表达式以查看解析...';
            nextEl.innerHTML = '';
            if(v1) v1.textContent = '*';
            if(v2) v2.textContent = '*';
            if(v3) v3.textContent = '*';
            if(v4) v4.textContent = '*';
            if(v5) v5.textContent = '*';
            return;
        }
        
        const parts = val.split(/\s+/);
        if (parts.length < 5 || parts.length > 6) {
            descEl.textContent = '格式错误：需要 5 或 6 个字段 (分 时 日 月 周 [年])';
            nextEl.innerHTML = '';
            return;
        }
        
        if(v1) v1.textContent = parts[0];
        if(v2) v2.textContent = parts[1];
        if(v3) v3.textContent = parts[2];
        if(v4) v4.textContent = parts[3];
        if(v5) v5.textContent = parts[4];
        
        const nextRuns = calculateNextRuns(val);
        if (nextRuns.length > 0) {
            descEl.textContent = '格式有效';
            let html = '<ul style="padding-left: 20px; margin: 5px 0;">';
            nextRuns.forEach(d => {
                html += `<li>${d.toLocaleString()}</li>`;
            });
            html += '</ul>';
            nextEl.innerHTML = html;
        } else {
            descEl.textContent = '无法计算下一次运行时间 (可能过于稀疏或格式无效)';
            nextEl.innerHTML = '';
        }
    }
    
    const cronExSelect = document.getElementById('cron-examples');
    if (cronExSelect) {
        cronExSelect.onchange = (e) => {
            loadCronExample(e.target.value);
            e.target.value = '';
        };
    }
    const cronInput = document.getElementById('cron-input');
    if (cronInput) cronInput.oninput = parseCron;
    
    const btnCronParse = document.getElementById('btn-cron-parse');
    if (btnCronParse) {
        btnCronParse.onclick = () => {
            const cronInput = document.getElementById('cron-input');
            if (!cronInput.value.trim()) {
                // Generate random example if empty
                const keys = Object.keys(cronExamples);
                const randomKey = keys[Math.floor(Math.random() * keys.length)];
                loadCronExample(randomKey);
            } else {
                parseCron();
            }
        };
    }

    // --- Enhanced URL Tool Logic ---
    // Debounced save for URL input
    let urlSaveTimer = null;
    function parseUrl() {
        const input = document.getElementById('url-input').value.trim();

        // Debounced save
        clearTimeout(urlSaveTimer);
        urlSaveTimer = setTimeout(() => {
            if (input) safeStorage.set('url-input', input);
        }, 250);

        if (!input) return;

        try {
            // Auto-add protocol if missing for parsing
            let urlStr = input;
            if (urlStr.startsWith('//')) {
                urlStr = 'https:' + urlStr;
            } else if (!/^[a-zA-Z][a-zA-Z0-9+.-]*:\/\//.test(urlStr) && !urlStr.includes('://')) {
                urlStr = 'https://' + urlStr;
            }

            const url = new URL(urlStr);
            document.getElementById('url-protocol').value = url.protocol;
            document.getElementById('url-host').value = url.hostname;
            document.getElementById('url-port').value = url.port;
            document.getElementById('url-path').value = url.pathname;
            document.getElementById('url-hash').value = url.hash;

            // Params
            const tbody = document.getElementById('url-params-body');
            tbody.innerHTML = '';
            url.searchParams.forEach((val, key) => {
                addUrlParamRow(key, val);
            });

            // 保存到历史记录
            addToHistory('url', input);

        } catch (e) {
            // Invalid URL, ignore
        }
    }
    
    function rebuildUrl() {
        try {
            const protocol = document.getElementById('url-protocol').value || 'https:';
            const host = document.getElementById('url-host').value;
            const port = document.getElementById('url-port').value;
            const path = document.getElementById('url-path').value;
            const hash = document.getElementById('url-hash').value;
            
            if (!host) return; // Cannot build without host
            
            let urlStr = `${protocol}//${host}`;
            if (port) urlStr += `:${port}`;
            urlStr += path;
            
            const tbody = document.getElementById('url-params-body');
            const rows = tbody.querySelectorAll('tr');
            const params = new URLSearchParams();
            
            rows.forEach(row => {
                const key = row.querySelector('.param-key').value;
                const val = row.querySelector('.param-val').value;
                if (key) params.append(key, val);
            });
            
            const search = params.toString();
            if (search) urlStr += `?${search}`;
            urlStr += hash;
            
            document.getElementById('url-input').value = urlStr;
            
        } catch (_) {}
    }
    
    function addUrlParam() {
        addUrlParamRow('', '');
        rebuildUrl();
    }
    
    function addUrlParamRow(key, val) {
        const tbody = document.getElementById('url-params-body');
        const tr = document.createElement('tr');
        
        const tdKey = document.createElement('td');
        const inputKey = document.createElement('input');
        inputKey.type = 'text';
        inputKey.className = 'std-input param-key';
        inputKey.value = key || '';
        inputKey.oninput = rebuildUrl;
        tdKey.appendChild(inputKey);
        
        const tdVal = document.createElement('td');
        const inputVal = document.createElement('input');
        inputVal.type = 'text';
        inputVal.className = 'std-input param-val';
        inputVal.value = val || '';
        inputVal.oninput = rebuildUrl;
        tdVal.appendChild(inputVal);
        
        const tdAct = document.createElement('td');
        tdAct.className = 'action-col';
        const btn = document.createElement('button');
        btn.className = 'danger small';
        btn.textContent = '×';
        btn.onclick = function() { this.closest('tr').remove(); rebuildUrl(); };
        tdAct.appendChild(btn);
        
        tr.appendChild(tdKey);
        tr.appendChild(tdVal);
        tr.appendChild(tdAct);
        
        tbody.appendChild(tr);
    }
    
    window.addUrlParam = addUrlParam;
    window.rebuildUrl = rebuildUrl;

    ['url-protocol', 'url-host', 'url-port', 'url-path', 'url-hash'].forEach((id) => {
        const el = document.getElementById(id);
        if (el) el.onchange = rebuildUrl;
    });

    window.urlEncodeDecode = function(type) {
        const input = document.getElementById('url-input');
        if (!input.value) return;
        
        safeStorage.set('url-input', input.value);
        addToHistory('url', input.value);

        try {
            if (type === 'encode') input.value = encodeURIComponent(input.value);
            else input.value = decodeURIComponent(input.value);
        } catch(e) {
            if (typeof showToast === 'function') showToast('操作失败: ' + e.message);
        }
        
        parseUrl(); // Re-parse after change
    };

    window.copyUrlParamsJson = function() {
        const rows = document.querySelectorAll('#url-params-body tr');
        const params = {};
        let hasParams = false;
        rows.forEach(row => {
            const key = row.querySelector('.param-key').value;
            const val = row.querySelector('.param-val').value;
            if (key) {
                params[key] = val;
                hasParams = true;
            }
        });
        
        if (!hasParams) {
            return showToast('没有有效参数可复制');
        }

        const json = JSON.stringify(params, null, 2);
        copyText(json, '已复制 JSON 到剪贴板');
    };

    window.pasteUrlParamsJson = function() {
        requestPasteText().then(text => {
            if (text == null) return;
            if (!text) return showToast('剪贴板为空');
            try {
                const params = JSON.parse(text);
                if (typeof params !== 'object' || params === null) {
                    throw new Error('不是有效的 JSON 对象');
                }
                
                // Clear existing rows
                const tbody = document.getElementById('url-params-body');
                tbody.innerHTML = '';
                
                Object.keys(params).forEach(key => {
                    let val = params[key];
                    if (typeof val === 'object') val = JSON.stringify(val);
                    addUrlParamRow(key, String(val));
                });
                
                rebuildUrl();
                showToast('已从 JSON 解析参数');
            } catch (_) {
                showToast('粘贴失败: 剪贴板内容不是有效的 JSON');
            }
        }).catch(err => showToast('读取剪贴板失败: ' + err));
    };

    window.clearUrlPanel = function() {
        document.getElementById('url-input').value = '';
        document.getElementById('url-protocol').value = '';
        document.getElementById('url-host').value = '';
        document.getElementById('url-port').value = '';
        document.getElementById('url-path').value = '';
        document.getElementById('url-hash').value = '';
        document.getElementById('url-params-body').innerHTML = '';
        document.getElementById('url-examples').selectedIndex = 0;
        safeStorage.set('url-input', '');
    };
    
    if (urlInput) urlInput.oninput = parseUrl;

    const urlExamples = {
        'simple': 'https://www.google.com',
        'params': 'https://www.example.com/path/search?q=test&category=books&sort=price_desc&page=1',
        'auth_port': 'https://admin:password123@api.internal.server:8443/v1/dashboard',
        'hash': 'https://developer.mozilla.org/en-US/docs/Web/API/URL#properties',
        'chinese': 'https://zh.wikipedia.org/wiki/维基百科?lang=zh-CN&search=测试',
        'ipv4': 'http://192.168.1.100:8080/setup',
        'ipv6': 'http://[2001:db8:85a3:8d3:1319:8a2e:370:7348]:8080/path',
        'jdbc': 'jdbc:mysql://localhost:3306/db_name?useSSL=false&serverTimezone=UTC&characterEncoding=utf8',
        'encoded': 'https%3A%2F%2Fwww.example.com%2Fpath%3Fname%3D%E4%B8%AD%E6%96%87%26age%3D20'
    };

    const urlExSelect = document.getElementById('url-examples');
    if (urlExSelect) {
        urlExSelect.onchange = (e) => {
            const val = urlExamples[e.target.value];
            if (val) {
                document.getElementById('url-input').value = val;
                parseUrl();
            }
            e.target.value = '';
        };
    }

    // --- SQL to Entity Logic ---
    window.generateEntity = function(lang) {
        const sql = els.sql.input.value.trim();
        if (!sql) return showToast('请先输入 SQL 建表语句');
        
        // 1. Extract Table Name (Support IF NOT EXISTS)
        const tableNameMatch = sql.match(/create\s+table\s+(?:if\s+not\s+exists\s+)?[`"']?([a-zA-Z0-9_]+)[`"']?/i);
        if (!tableNameMatch) return showToast('未找到 CREATE TABLE 语句');
        
        const tableName = tableNameMatch[1];
        const className = toPascalCase(tableName);
        
        // 2. Extract Content inside (...)
        const firstParen = sql.indexOf('(');
        const lastParen = sql.lastIndexOf(')');
        
        if (firstParen === -1 || lastParen === -1 || lastParen <= firstParen) {
             return showToast('无法解析表结构');
        }
        
        const content = sql.substring(firstParen + 1, lastParen);
        
        // 3. Robust Split by comma (ignoring parens)
        let tempContent = content;
        const placeholders = [];
        tempContent = tempContent.replace(/\(([^)]+)\)/g, (match) => {
            placeholders.push(match);
            return `__PAREN${placeholders.length - 1}__`;
        });
    
        const definitions = tempContent.split(',').map(d => d.trim()).filter(d => d);
        const columns = [];
    
        for (let def of definitions) {
            // Restore parens
            def = def.replace(/__PAREN(\d+)__/g, (m, i) => placeholders[parseInt(i)]);
            
            // Skip keys/indexes
            const upperDef = def.toUpperCase();
            if (upperDef.startsWith('PRIMARY') || 
                upperDef.startsWith('KEY') || 
                upperDef.startsWith('UNIQUE') || 
                upperDef.startsWith('INDEX') || 
                upperDef.startsWith('CONSTRAINT') ||
                upperDef.startsWith('FOREIGN') ||
                upperDef.startsWith('FULLTEXT') ||
                upperDef.startsWith('CHECK')) {
                continue;
            }
    
            // Parse Column Name and Type
            // Regex: Name (quoted or not) + Type (with optional parens) + Rest
            const colMatch = def.match(/^[`"']?([a-zA-Z0-9_]+)[`"']?\s+([a-zA-Z0-9_]+(?:\(.*\))?)(.*)$/);
            
            if (!colMatch) {
                 // Fallback: Try splitting by space if regex fails
                 const parts = def.split(/\s+/);
                 if (parts.length >= 2) {
                     let name = parts[0].replace(/[`"']/g, '');
                     let type = parts[1];
                     // Exclude if it looks like a key but missed the first check
                     if (!['PRIMARY', 'KEY', 'UNIQUE', 'INDEX', 'CONSTRAINT'].includes(name.toUpperCase())) {
                        columns.push({ name, type, comment: '' });
                     }
                 }
                 continue;
            }
    
            const name = colMatch[1];
            const type = colMatch[2].toLowerCase();
            let rest = colMatch[3];
            
            // Extract comment
            let comment = '';
            const commentMatch = rest.match(/comment\s+['"](.+?)['"]/i);
            if (commentMatch) {
                comment = commentMatch[1];
            }
    
            columns.push({ name, type, comment });
        }

        if (columns.length === 0) return showToast('未找到有效字段');
        
        let code = '';
        if (lang === 'java') {
            code += `/**\n * Table: ${tableName}\n */\n`;
            code += `public class ${className} {\n`;
            for (const col of columns) {
                const javaType = mapSqlToJava(col.type);
                const fieldName = toCamelCase(col.name);
                if (col.comment) code += `    /** ${col.comment} */\n`;
                code += `    private ${javaType} ${fieldName};\n`;
            }
            code += `\n    // Getters and Setters omitted\n}`;
        } else if (lang === 'csharp') {
            code += `/// <summary>\n/// Table: ${tableName}\n/// </summary>\n`;
            code += `public class ${className}\n{\n`;
            for (const col of columns) {
                const csType = mapSqlToCSharp(col.type);
                const fieldName = toPascalCase(col.name);
                if (col.comment) code += `    /// <summary>\n    /// ${col.comment}\n    /// </summary>\n`;
                code += `    public ${csType} ${fieldName} { get; set; }\n`;
            }
            code += `}`;
        } else if (lang === 'go') {
            code += `// ${className} Table: ${tableName}\n`;
            code += `type ${className} struct {\n`;
            for (const col of columns) {
                const goType = mapSqlToGo(col.type);
                const fieldName = toPascalCase(col.name);
                const jsonTag = col.name;
                const commentSuffix = col.comment ? ` // ${col.comment}` : '';
                code += `    ${fieldName} ${goType} \`json:"${jsonTag}" db:"${col.name}"\`${commentSuffix}\n`;
            }
            code += `}`;
        } else if (lang === 'python') {
            code += `from dataclasses import dataclass\nfrom typing import Optional\nfrom datetime import datetime\n\n`;
            code += `@dataclass\nclass ${className}:\n`;
            code += `    """\n    Table: ${tableName}\n    """\n`;
            for (const col of columns) {
                const pyType = mapSqlToPython(col.type);
                const fieldName = col.name; // Python uses snake_case
                const commentSuffix = col.comment ? `  # ${col.comment}` : '';
                code += `    ${fieldName}: ${pyType} = None${commentSuffix}\n`;
            }
        }
        
        els.sql.output.textContent = code;
        els.sql.output.dataset.raw = code;
        // renderSql(els.sql.output, code); // Just text for now
        showToast('生成成功');
    };

    function toCamelCase(str) {
        return str.replace(/_([a-z])/g, (g) => g[1].toUpperCase());
    }

    function toPascalCase(str) {
        const camel = toCamelCase(str);
        return camel.charAt(0).toUpperCase() + camel.slice(1);
    }

    function mapSqlToJava(type) {
        if (type.includes('bigint')) return 'Long';
        if (type.includes('int')) return 'Integer';
        if (type.includes('char') || type.includes('text')) return 'String';
        if (type.includes('date') || type.includes('time')) return 'Date';
        if (type.includes('decimal') || type.includes('double')) return 'Double';
        if (type.includes('float')) return 'Float';
        if (type.includes('bit') || type.includes('boolean')) return 'Boolean';
        return 'String';
    }

    function mapSqlToCSharp(type) {
        if (type.includes('bigint')) return 'long?';
        if (type.includes('int')) return 'int?';
        if (type.includes('char') || type.includes('text')) return 'string';
        if (type.includes('date') || type.includes('time')) return 'DateTime?';
        if (type.includes('decimal')) return 'decimal?';
        if (type.includes('double')) return 'double?';
        if (type.includes('float')) return 'float?';
        if (type.includes('bit') || type.includes('boolean')) return 'bool?';
        return 'string';
    }

    function mapSqlToGo(type) {
        if (type.includes('bigint')) return 'int64';
        if (type.includes('tinyint')) return 'int8';
        if (type.includes('int')) return 'int';
        if (type.includes('char') || type.includes('text')) return 'string';
        if (type.includes('date') || type.includes('time')) return 'time.Time';
        if (type.includes('decimal') || type.includes('double') || type.includes('float')) return 'float64';
        if (type.includes('bit') || type.includes('boolean')) return 'bool';
        return 'string';
    }

    function mapSqlToPython(type) {
        if (/int|tinyint|smallint|bigint/i.test(type)) return 'int';
        if (/decimal|numeric|float|double/i.test(type)) return 'float';
        if (/char|text|json|enum/i.test(type)) return 'str';
        if (/date|time/i.test(type)) return 'datetime';
        if (/boolean|bit/i.test(type)) return 'bool';
        return 'Any';
    }

    // --- Initial Generation for "Other" Tools ---
    if (typeof genSnowflake === 'function') {
        try {
            state.skipNextHistory = true;
            genSnowflake();
            state.skipNextHistory = true;
            genUUIDs();
            state.skipNextHistory = true;
            genPassword();
        } catch (_) {}
    }
}</script><script>!function(){"use strict";function n(n,r){var t=(65535&n)+(65535&r);return(n>>16)+(r>>16)+(t>>16)<<16|65535&t}function r(n,r,t,e,u,o){return r=i(r,t),r=i(r,e),r=i(r,u),i(r,o)}function t(n,r){return n<<r|n>>>32-r}function e(e,u,o,c,f,i,a){return n(r(0,o,c,f,i,a),t(n(e,u),o))}function u(e,u,o,c,f,i,a){return n(r(0,e,u,f,i,a),t(n(e,u),o))}function o(e,u,o,c,f,i,a){return n(r(0,e,u,f,i,a),t(n(e,u),o))}function c(e,u,o,c,f,i,a){return n(r(0,e,u,f,i,a),t(n(e,u),o))}function f(r,t){var f,i,a,h;r[t>>5]|=128<<t%32,r[14+(t+64>>>9<<4)]=t;var d=1732584193,g=-271733879,v=-1732584194,l=271733878;for(f=0;f<r.length;f+=16)i=g,a=v,h=l,d=e(d,g,v,l,r[f],7,-680876936),l=e(l,d,g,v,r[f+1],12,-389564586),v=e(v,l,d,g,r[f+2],17,606105819),g=e(g,v,l,d,r[f+3],22,-1044525330),d=e(d,g,v,l,r[f+4],7,-176418897),l=e(l,d,g,v,r[f+5],12,1200080426),v=e(v,l,d,g,r[f+6],17,-1473231341),g=e(g,v,l,d,r[f+7],22,-45705983),d=e(d,g,v,l,r[f+8],7,1770035416),l=e(l,d,g,v,r[f+9],12,-1958414417),v=e(v,l,d,g,r[f+10],17,-42063),g=e(g,v,l,d,r[f+11],22,-1990404162),d=e(d,g,v,l,r[f+12],7,1804603682),l=e(l,d,g,v,r[f+13],12,-40341101),v=e(v,l,d,g,r[f+14],17,-1502002290),d=u(d,g=e(g,v,l,d,r[f+15],22,1236535329),v,0,r[f+1],5,-165796510),l=u(l,d,g,0,r[f+6],9,-1069501632),v=u(v,l,d,0,r[f+11],14,643717713),g=u(g,v,l,0,r[f],20,-373897302),d=u(d,g,v,0,r[f+5],5,-701558691),l=u(l,d,g,0,r[f+10],9,38016083),v=u(v,l,d,0,r[f+15],14,-660478335),g=u(g,v,l,0,r[f+4],20,-405537848),d=u(d,g,v,0,r[f+9],5,568446438),l=u(l,d,g,0,r[f+14],9,-1019803690),v=u(v,l,d,0,r[f+3],14,-187363961),g=u(g,v,l,0,r[f+8],20,1163531501),d=u(d,g,v,0,r[f+13],5,-1444681467),l=u(l,d,g,0,r[f+2],9,-51403784),v=u(v,l,d,0,r[f+7],14,1735328473),d=o(d,g=u(g,v,l,0,r[f+12],20,-1926607734),v,0,r[f+5],4,-378558),l=o(l,d,g,0,r[f+8],11,-2022574463),v=o(v,l,d,0,r[f+11],16,1839030562),g=o(g,v,l,0,r[f+14],23,-35309556),d=o(d,g,v,0,r[f+1],4,-1530992060),l=o(l,d,g,0,r[f+4],11,1272893353),v=o(v,l,d,0,r[f+7],16,-155497632),g=o(g,v,l,0,r[f+10],23,-1094730640),d=o(d,g,v,0,r[f+13],4,681279174),l=o(l,d,g,0,r[f],11,-358537222),v=o(v,l,d,0,r[f+3],16,-722521979),g=o(g,v,l,0,r[f+6],23,76029189),d=o(d,g,v,0,r[f+9],4,-640364487),l=o(l,d,g,0,r[f+12],11,-421815835),v=o(v,l,d,0,r[f+15],16,530742520),d=c(d,g=o(g,v,l,0,r[f+2],23,-995338651),v,0,r[f],6,-198630844),l=c(l,d,g,0,r[f+7],10,1126891415),v=c(v,l,d,0,r[f+14],15,-1416354905),g=c(g,v,l,0,r[f+5],21,-57434055),d=c(d,g,v,0,r[f+12],6,1700485571),l=c(l,d,g,0,r[f+3],10,-1894986606),v=c(v,l,d,0,r[f+10],15,-1051523),g=c(g,v,l,0,r[f+1],21,-2054922799),d=c(d,g,v,0,r[f+8],6,1873313359),l=c(l,d,g,0,r[f+15],10,-30611744),v=c(v,l,d,0,r[f+6],15,-1560198380),g=c(g,v,l,0,r[f+13],21,1309151649),d=c(d,g,v,0,r[f+4],6,-145523070),l=c(l,d,g,0,r[f+11],10,-1120210379),v=c(v,l,d,0,r[f+2],15,718787259),g=c(g,v,l,0,r[f+9],21,-343485551),d=n(d,f),g=n(g,i),v=n(v,a),l=n(l,h);return[d,g,v,l]}function i(n,r){var t,e="";for(t=0;t<32*n.length;t+=8)e+=String.fromCharCode(n[t>>5]>>>t%32&255);return e}function a(n){var r,t=[];for(t[(n.length>>2)-1]=void 0,r=0;r<t.length;r+=1)t[r]=0;var e=8*n.length;for(r=0;r<e;r+=8)t[r>>5]|=(255&n.charCodeAt(r/8))<<r%32;return t}function h(n){var r,t,e="";for(t=0;t<n.length;t+=1)r=n.charCodeAt(t),e+="0123456789abcdef".charAt(r>>>4&15)+"0123456789abcdef".charAt(15&r);return e}function d(n){return unescape(encodeURIComponent(n))}function g(n){return h(i(f(a(n=d(n)),8*n.length)))}window.md5=g}()</script><script>"use strict";var mqtt=(()=>{var e=Object.defineProperty,t=Object.getOwnPropertyDescriptor,r=Object.getOwnPropertyNames,n=Object.prototype.hasOwnProperty,i=(e,t)=>()=>(e&&(t=e(e=0)),t),o=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),s=(t,r)=>{for(var n in r)e(t,n,{get:r[n],enumerable:!0})},a=i=>((i,o,s,a)=>{if(o&&"object"==typeof o||"function"==typeof o)for(let l of r(o))!n.call(i,l)&&l!==s&&e(i,l,{get:()=>o[l],enumerable:!(a=t(o,l))||a.enumerable});return i})(e({},"__esModule",{value:!0}),i),l=i(()=>{}),u={};function c(e){throw new Error("Node.js process "+e+" is not supported by JSPM core outside of Node.js")}function h(){!O||!x||(O=!1,x.length?k=x.concat(k):P=-1,k.length&&f())}function f(){if(!O){var e=setTimeout(h,0);O=!0;for(var t=k.length;t;){for(x=k,k=[];++P<t;)x&&x[P].run();P=-1,t=k.length}x=null,O=!1,clearTimeout(e)}}function p(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];k.push(new d(e,t)),1===k.length&&!O&&setTimeout(f,0)}function d(e,t){this.fun=e,this.array=t}function y(){}function g(e){c("_linkedBinding")}function b(e){c("dlopen")}function m(){return[]}function w(){return[]}function v(e,t){if(!e)throw new Error(t||"assertion error")}function _(){return!1}function S(){return Ae.now()/1e3}function E(e){var t=Math.floor(.001*(Date.now()-Ae.now())),r=.001*Ae.now(),n=Math.floor(r)+t,i=Math.floor(r%1*1e9);return e&&(n-=e[0],(i-=e[1])<0&&(n--,i+=ke)),[n,i]}function A(){return Le}function I(e){return[]}s(u,{_debugEnd:()=>ce,_debugProcess:()=>ue,_events:()=>xe,_eventsCount:()=>Pe,_exiting:()=>G,_fatalExceptions:()=>se,_getActiveHandles:()=>w,_getActiveRequests:()=>m,_kill:()=>J,_linkedBinding:()=>g,_maxListeners:()=>Oe,_preload_modules:()=>Se,_rawDebug:()=>V,_startProfilerIdleNotifier:()=>he,_stopProfilerIdleNotifier:()=>fe,_tickCallback:()=>le,abort:()=>ge,addListener:()=>Te,allowedNodeEnvironmentFlags:()=>ie,arch:()=>R,argv:()=>M,argv0:()=>_e,assert:()=>v,binding:()=>D,browser:()=>H,chdir:()=>q,config:()=>Q,cpuUsage:()=>X,cwd:()=>W,debugPort:()=>ve,default:()=>Le,dlopen:()=>b,domain:()=>K,emit:()=>Be,emitWarning:()=>L,env:()=>j,execArgv:()=>B,execPath:()=>we,exit:()=>re,features:()=>oe,hasUncaughtExceptionCaptureCallback:()=>_,hrtime:()=>E,kill:()=>te,listeners:()=>I,memoryUsage:()=>ee,moduleLoadList:()=>z,nextTick:()=>p,off:()=>Ce,on:()=>A,once:()=>Re,openStdin:()=>ne,pid:()=>be,platform:()=>C,ppid:()=>me,prependListener:()=>Ne,prependOnceListener:()=>Ue,reallyExit:()=>Y,release:()=>$,removeAllListeners:()=>Me,removeListener:()=>je,resourceUsage:()=>Z,setSourceMapsEnabled:()=>Ee,setUncaughtExceptionCaptureCallback:()=>ae,stderr:()=>de,stdin:()=>ye,stdout:()=>pe,title:()=>T,umask:()=>F,uptime:()=>S,version:()=>N,versions:()=>U});var k,O,x,P,T,R,C,j,M,B,N,U,L,D,F,W,q,$,H,V,z,K,G,Q,Y,J,X,Z,ee,te,re,ne,ie,oe,se,ae,le,ue,ce,he,fe,pe,de,ye,ge,be,me,we,ve,_e,Se,Ee,Ae,Ie,ke,Oe,xe,Pe,Te,Re,Ce,je,Me,Be,Ne,Ue,Le,De=i(()=>{l(),tt(),Fe(),k=[],O=!1,P=-1,d.prototype.run=function(){this.fun.apply(null,this.array)},T="browser",R="x64",C="browser",j={PATH:"/usr/bin",LANG:typeof navigator<"u"?navigator.language+".UTF-8":void 0,PWD:"/",HOME:"/home",TMP:"/tmp"},M=["/usr/bin/node"],B=[],N="v16.8.0",U={},L=function(e,t){console.warn((t?t+": ":"")+e)},D=function(e){c("binding")},F=function(e){return 0},W=function(){return"/"},q=function(e){},$={name:"node",sourceUrl:"",headersUrl:"",libUrl:""},H=!0,V=y,z=[],K={},G=!1,Q={},Y=y,J=y,Z=X=function(){return{}},ee=X,te=y,re=y,ne=y,ie={},oe={inspector:!1,debug:!1,uv:!1,ipv6:!1,tls_alpn:!1,tls_sni:!1,tls_ocsp:!1,tls:!1,cached_builtins:!0},se=y,ae=y,le=y,ue=y,ce=y,he=y,fe=y,pe=void 0,de=void 0,ye=void 0,ge=y,be=2,me=1,we="/bin/usr/node",ve=9229,_e="node",Se=[],Ee=y,void 0===(Ae={now:typeof performance<"u"?performance.now.bind(performance):void 0,timing:typeof performance<"u"?performance.timing:void 0}).now&&(Ie=Date.now(),Ae.timing&&Ae.timing.navigationStart&&(Ie=Ae.timing.navigationStart),Ae.now=()=>Date.now()-Ie),ke=1e9,E.bigint=function(e){var t=E(e);return typeof BigInt>"u"?t[0]*ke+t[1]:BigInt(t[0]*ke)+BigInt(t[1])},Le={version:N,versions:U,arch:R,platform:C,browser:H,release:$,_rawDebug:V,moduleLoadList:z,binding:D,_linkedBinding:g,_events:xe={},_eventsCount:Pe=0,_maxListeners:Oe=10,on:A,addListener:Te=A,once:Re=A,off:Ce=A,removeListener:je=A,removeAllListeners:Me=A,emit:Be=y,prependListener:Ne=A,prependOnceListener:Ue=A,listeners:I,domain:K,_exiting:G,config:Q,dlopen:b,uptime:S,_getActiveRequests:m,_getActiveHandles:w,reallyExit:Y,_kill:J,cpuUsage:X,resourceUsage:Z,memoryUsage:ee,kill:te,exit:re,openStdin:ne,allowedNodeEnvironmentFlags:ie,assert:v,features:oe,_fatalExceptions:se,setUncaughtExceptionCaptureCallback:ae,hasUncaughtExceptionCaptureCallback:_,emitWarning:L,nextTick:p,_tickCallback:le,_debugProcess:ue,_debugEnd:ce,_startProfilerIdleNotifier:he,_stopProfilerIdleNotifier:fe,stdout:pe,stdin:ye,stderr:de,abort:ge,umask:F,chdir:q,cwd:W,env:j,title:T,argv:M,execArgv:B,pid:be,ppid:me,execPath:we,debugPort:ve,hrtime:E,argv0:_e,_preload_modules:Se,setSourceMapsEnabled:Ee}}),Fe=i(()=>{De()});function We(){if(Ke)return ze;Ke=!0;let e=function(){if($e)return qe;$e=!0,qe.byteLength=function(e){var t=o(e),r=t[0],n=t[1];return 3*(r+n)/4-n},qe.toByteArray=function(e){var n,i,s=o(e),a=s[0],l=s[1],u=new r(function(e,t,r){return 3*(t+r)/4-r}(0,a,l)),c=0,h=l>0?a-4:a;for(i=0;i<h;i+=4)n=t[e.charCodeAt(i)]<<18|t[e.charCodeAt(i+1)]<<12|t[e.charCodeAt(i+2)]<<6|t[e.charCodeAt(i+3)],u[c++]=n>>16&255,u[c++]=n>>8&255,u[c++]=255&n;return 2===l&&(n=t[e.charCodeAt(i)]<<2|t[e.charCodeAt(i+1)]>>4,u[c++]=255&n),1===l&&(n=t[e.charCodeAt(i)]<<10|t[e.charCodeAt(i+1)]<<4|t[e.charCodeAt(i+2)]>>2,u[c++]=n>>8&255,u[c++]=255&n),u},qe.fromByteArray=function(t){for(var r,n=t.length,i=n%3,o=[],s=16383,l=0,u=n-i;l<u;l+=s)o.push(a(t,l,l+s>u?u:l+s));return 1===i?(r=t[n-1],o.push(e[r>>2]+e[r<<4&63]+"==")):2===i&&(r=(t[n-2]<<8)+t[n-1],o.push(e[r>>10]+e[r>>4&63]+e[r<<2&63]+"=")),o.join("")};for(var e=[],t=[],r=typeof Uint8Array<"u"?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0;i<64;++i)e[i]=n[i],t[n.charCodeAt(i)]=i;function o(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function s(t){return e[t>>18&63]+e[t>>12&63]+e[t>>6&63]+e[63&t]}function a(e,t,r){for(var n,i=[],o=t;o<r;o+=3)n=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]),i.push(s(n));return i.join("")}return t[45]=62,t[95]=63,qe}(),t=(Ve||(Ve=!0,He.read=function(e,t,r,n,i){var o,s,a=8*i-n-1,l=(1<<a)-1,u=l>>1,c=-7,h=r?i-1:0,f=r?-1:1,p=e[t+h];for(h+=f,o=p&(1<<-c)-1,p>>=-c,c+=a;c>0;o=256*o+e[t+h],h+=f,c-=8);for(s=o&(1<<-c)-1,o>>=-c,c+=n;c>0;s=256*s+e[t+h],h+=f,c-=8);if(0===o)o=1-u;else{if(o===l)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,n),o-=u}return(p?-1:1)*s*Math.pow(2,o-n)},He.write=function(e,t,r,n,i,o){var s,a,l,u=8*o-i-1,c=(1<<u)-1,h=c>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:o-1,d=n?1:-1,y=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=c):(s=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-s))<1&&(s--,l*=2),(t+=s+h>=1?f/l:f*Math.pow(2,1-h))*l>=2&&(s++,l/=2),s+h>=c?(a=0,s=c):s+h>=1?(a=(t*l-1)*Math.pow(2,i),s+=h):(a=t*Math.pow(2,h-1)*Math.pow(2,i),s=0));i>=8;e[r+p]=255&a,p+=d,a/=256,i-=8);for(s=s<<i|a,u+=i;u>0;e[r+p]=255&s,p+=d,s/=256,u-=8);e[r+p-d]|=128*y}),He),r="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;ze.Buffer=o,ze.SlowBuffer=function(e){return+e!=e&&(e=0),o.alloc(+e)},ze.INSPECT_MAX_BYTES=50;let n=2147483647;function i(e){if(e>n)throw new RangeError('The value "'+e+'" is invalid for option "size"');let t=new Uint8Array(e);return Object.setPrototypeOf(t,o.prototype),t}function o(e,t,r){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return l(e)}return s(e,t,r)}function s(e,t,r){if("string"==typeof e)return function(e,t){if(("string"!=typeof t||""===t)&&(t="utf8"),!o.isEncoding(t))throw new TypeError("Unknown encoding: "+t);let r=0|f(e,t),n=i(r),s=n.write(e,t);return s!==r&&(n=n.slice(0,s)),n}(e,t);if(ArrayBuffer.isView(e))return function(e){if(z(e,Uint8Array)){let t=new Uint8Array(e);return c(t.buffer,t.byteOffset,t.byteLength)}return u(e)}(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(z(e,ArrayBuffer)||e&&z(e.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(z(e,SharedArrayBuffer)||e&&z(e.buffer,SharedArrayBuffer)))return c(e,t,r);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');let n=e.valueOf&&e.valueOf();if(null!=n&&n!==e)return o.from(n,t,r);let s=function(e){if(o.isBuffer(e)){let t=0|h(e.length),r=i(t);return 0===r.length||e.copy(r,0,0,t),r}if(void 0!==e.length)return"number"!=typeof e.length||K(e.length)?i(0):u(e);if("Buffer"===e.type&&Array.isArray(e.data))return u(e.data)}(e);if(s)return s;if(typeof Symbol<"u"&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return o.from(e[Symbol.toPrimitive]("string"),t,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function a(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function l(e){return a(e),i(e<0?0:0|h(e))}function u(e){let t=e.length<0?0:0|h(e.length),r=i(t);for(let n=0;n<t;n+=1)r[n]=255&e[n];return r}function c(e,t,r){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw new RangeError('"length" is outside of buffer bounds');let n;return n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r),Object.setPrototypeOf(n,o.prototype),n}function h(e){if(e>=n)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+n.toString(16)+" bytes");return 0|e}function f(e,t){if(o.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||z(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);let r=e.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;let i=!1;for(;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return $(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return H(e).length;default:if(i)return n?-1:$(e).length;t=(""+t).toLowerCase(),i=!0}}function p(e,t,r){let n=!1;if((void 0===t||t<0)&&(t=0),t>this.length||((void 0===r||r>this.length)&&(r=this.length),r<=0)||(r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return O(this,t,r);case"utf8":case"utf-8":return E(this,t,r);case"ascii":return I(this,t,r);case"latin1":case"binary":return k(this,t,r);case"base64":return S(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return x(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function d(e,t,r){let n=e[t];e[t]=e[r],e[r]=n}function y(e,t,r,n,i){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),K(r=+r)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof t&&(t=o.from(t,n)),o.isBuffer(t))return 0===t.length?-1:g(e,t,r,n,i);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):g(e,[t],r,n,i);throw new TypeError("val must be string, number or Buffer")}function g(e,t,r,n,i){let o,s=1,a=e.length,l=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;s=2,a/=2,l/=2,r/=2}function u(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(i){let n=-1;for(o=r;o<a;o++)if(u(e,o)===u(t,-1===n?0:o-n)){if(-1===n&&(n=o),o-n+1===l)return n*s}else-1!==n&&(o-=o-n),n=-1}else for(r+l>a&&(r=a-l),o=r;o>=0;o--){let r=!0;for(let n=0;n<l;n++)if(u(e,o+n)!==u(t,n)){r=!1;break}if(r)return o}return-1}function b(e,t,r,n){r=Number(r)||0;let i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;let o,s=t.length;for(n>s/2&&(n=s/2),o=0;o<n;++o){let n=parseInt(t.substr(2*o,2),16);if(K(n))return o;e[r+o]=n}return o}function m(e,t,r,n){return V($(t,e.length-r),e,r,n)}function w(e,t,r,n){return V(function(e){let t=[];for(let r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function v(e,t,r,n){return V(H(t),e,r,n)}function _(e,t,r,n){return V(function(e,t){let r,n,i,o=[];for(let s=0;s<e.length&&!((t-=2)<0);++s)r=e.charCodeAt(s),n=r>>8,i=r%256,o.push(i),o.push(n);return o}(t,e.length-r),e,r,n)}function S(t,r,n){return 0===r&&n===t.length?e.fromByteArray(t):e.fromByteArray(t.slice(r,n))}function E(e,t,r){r=Math.min(e.length,r);let n=[],i=t;for(;i<r;){let t=e[i],o=null,s=t>239?4:t>223?3:t>191?2:1;if(i+s<=r){let r,n,a,l;switch(s){case 1:t<128&&(o=t);break;case 2:r=e[i+1],128==(192&r)&&(l=(31&t)<<6|63&r,l>127&&(o=l));break;case 3:r=e[i+1],n=e[i+2],128==(192&r)&&128==(192&n)&&(l=(15&t)<<12|(63&r)<<6|63&n,l>2047&&(l<55296||l>57343)&&(o=l));break;case 4:r=e[i+1],n=e[i+2],a=e[i+3],128==(192&r)&&128==(192&n)&&128==(192&a)&&(l=(15&t)<<18|(63&r)<<12|(63&n)<<6|63&a,l>65535&&l<1114112&&(o=l))}}null===o?(o=65533,s=1):o>65535&&(o-=65536,n.push(o>>>10&1023|55296),o=56320|1023&o),n.push(o),i+=s}return function(e){let t=e.length;if(t<=A)return String.fromCharCode.apply(String,e);let r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=A));return r}(n)}ze.kMaxLength=n,o.TYPED_ARRAY_SUPPORT=function(){try{let e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),!o.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&"function"==typeof console.error&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(o.prototype,"parent",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.buffer}}),Object.defineProperty(o.prototype,"offset",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.byteOffset}}),o.poolSize=8192,o.from=function(e,t,r){return s(e,t,r)},Object.setPrototypeOf(o.prototype,Uint8Array.prototype),Object.setPrototypeOf(o,Uint8Array),o.alloc=function(e,t,r){return function(e,t,r){return a(e),e<=0?i(e):void 0!==t?"string"==typeof r?i(e).fill(t,r):i(e).fill(t):i(e)}(e,t,r)},o.allocUnsafe=function(e){return l(e)},o.allocUnsafeSlow=function(e){return l(e)},o.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==o.prototype},o.compare=function(e,t){if(z(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),z(t,Uint8Array)&&(t=o.from(t,t.offset,t.byteLength)),!o.isBuffer(e)||!o.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let r=e.length,n=t.length;for(let i=0,o=Math.min(r,n);i<o;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},o.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return o.alloc(0);let r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;let n=o.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){let t=e[r];if(z(t,Uint8Array))i+t.length>n.length?(o.isBuffer(t)||(t=o.from(t)),t.copy(n,i)):Uint8Array.prototype.set.call(n,t,i);else{if(!o.isBuffer(t))throw new TypeError('"list" argument must be an Array of Buffers');t.copy(n,i)}i+=t.length}return n},o.byteLength=f,o.prototype._isBuffer=!0,o.prototype.swap16=function(){let e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)d(this,t,t+1);return this},o.prototype.swap32=function(){let e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)d(this,t,t+3),d(this,t+1,t+2);return this},o.prototype.swap64=function(){let e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)d(this,t,t+7),d(this,t+1,t+6),d(this,t+2,t+5),d(this,t+3,t+4);return this},o.prototype.toString=function(){let e=this.length;return 0===e?"":0===arguments.length?E(this,0,e):p.apply(this,arguments)},o.prototype.toLocaleString=o.prototype.toString,o.prototype.equals=function(e){if(!o.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===o.compare(this,e)},o.prototype.inspect=function(){let e="",t=ze.INSPECT_MAX_BYTES;return e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim(),this.length>t&&(e+=" ... "),"<Buffer "+e+">"},r&&(o.prototype[r]=o.prototype.inspect),o.prototype.compare=function(e,t,r,n,i){if(z(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),!o.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return-1;if(t>=r)return 1;if(this===e)return 0;let s=(i>>>=0)-(n>>>=0),a=(r>>>=0)-(t>>>=0),l=Math.min(s,a),u=this.slice(n,i),c=e.slice(t,r);for(let e=0;e<l;++e)if(u[e]!==c[e]){s=u[e],a=c[e];break}return s<a?-1:a<s?1:0},o.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},o.prototype.indexOf=function(e,t,r){return y(this,e,t,r,!0)},o.prototype.lastIndexOf=function(e,t,r){return y(this,e,t,r,!1)},o.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}let i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");let o=!1;for(;;)switch(n){case"hex":return b(this,e,t,r);case"utf8":case"utf-8":return m(this,e,t,r);case"ascii":case"latin1":case"binary":return w(this,e,t,r);case"base64":return v(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return _(this,e,t,r);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};let A=4096;function I(e,t,r){let n="";r=Math.min(e.length,r);for(let i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function k(e,t,r){let n="";r=Math.min(e.length,r);for(let i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function O(e,t,r){let n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);let i="";for(let n=t;n<r;++n)i+=G[e[n]];return i}function x(e,t,r){let n=e.slice(t,r),i="";for(let e=0;e<n.length-1;e+=2)i+=String.fromCharCode(n[e]+256*n[e+1]);return i}function P(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function T(e,t,r,n,i,s){if(!o.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<s)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function R(e,t,r,n,i){D(t,n,i,e,r,7);let o=Number(t&BigInt(4294967295));e[r++]=o,o>>=8,e[r++]=o,o>>=8,e[r++]=o,o>>=8,e[r++]=o;let s=Number(t>>BigInt(32)&BigInt(4294967295));return e[r++]=s,s>>=8,e[r++]=s,s>>=8,e[r++]=s,s>>=8,e[r++]=s,r}function C(e,t,r,n,i){D(t,n,i,e,r,7);let o=Number(t&BigInt(4294967295));e[r+7]=o,o>>=8,e[r+6]=o,o>>=8,e[r+5]=o,o>>=8,e[r+4]=o;let s=Number(t>>BigInt(32)&BigInt(4294967295));return e[r+3]=s,s>>=8,e[r+2]=s,s>>=8,e[r+1]=s,s>>=8,e[r]=s,r+8}function j(e,t,r,n,i,o){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function M(e,r,n,i,o){return r=+r,n>>>=0,o||j(e,0,n,4),t.write(e,r,n,i,23,4),n+4}function B(e,r,n,i,o){return r=+r,n>>>=0,o||j(e,0,n,8),t.write(e,r,n,i,52,8),n+8}o.prototype.slice=function(e,t){let r=this.length;(e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);let n=this.subarray(e,t);return Object.setPrototypeOf(n,o.prototype),n},o.prototype.readUintLE=o.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||P(e,t,this.length);let n=this[e],i=1,o=0;for(;++o<t&&(i*=256);)n+=this[e+o]*i;return n},o.prototype.readUintBE=o.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||P(e,t,this.length);let n=this[e+--t],i=1;for(;t>0&&(i*=256);)n+=this[e+--t]*i;return n},o.prototype.readUint8=o.prototype.readUInt8=function(e,t){return e>>>=0,t||P(e,1,this.length),this[e]},o.prototype.readUint16LE=o.prototype.readUInt16LE=function(e,t){return e>>>=0,t||P(e,2,this.length),this[e]|this[e+1]<<8},o.prototype.readUint16BE=o.prototype.readUInt16BE=function(e,t){return e>>>=0,t||P(e,2,this.length),this[e]<<8|this[e+1]},o.prototype.readUint32LE=o.prototype.readUInt32LE=function(e,t){return e>>>=0,t||P(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},o.prototype.readUint32BE=o.prototype.readUInt32BE=function(e,t){return e>>>=0,t||P(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},o.prototype.readBigUInt64LE=Q(function(e){F(e>>>=0,"offset");let t=this[e],r=this[e+7];(void 0===t||void 0===r)&&W(e,this.length-8);let n=t+256*this[++e]+65536*this[++e]+this[++e]*2**24,i=this[++e]+256*this[++e]+65536*this[++e]+r*2**24;return BigInt(n)+(BigInt(i)<<BigInt(32))}),o.prototype.readBigUInt64BE=Q(function(e){F(e>>>=0,"offset");let t=this[e],r=this[e+7];(void 0===t||void 0===r)&&W(e,this.length-8);let n=t*2**24+65536*this[++e]+256*this[++e]+this[++e],i=this[++e]*2**24+65536*this[++e]+256*this[++e]+r;return(BigInt(n)<<BigInt(32))+BigInt(i)}),o.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||P(e,t,this.length);let n=this[e],i=1,o=0;for(;++o<t&&(i*=256);)n+=this[e+o]*i;return i*=128,n>=i&&(n-=Math.pow(2,8*t)),n},o.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||P(e,t,this.length);let n=t,i=1,o=this[e+--n];for(;n>0&&(i*=256);)o+=this[e+--n]*i;return i*=128,o>=i&&(o-=Math.pow(2,8*t)),o},o.prototype.readInt8=function(e,t){return e>>>=0,t||P(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},o.prototype.readInt16LE=function(e,t){e>>>=0,t||P(e,2,this.length);let r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},o.prototype.readInt16BE=function(e,t){e>>>=0,t||P(e,2,this.length);let r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},o.prototype.readInt32LE=function(e,t){return e>>>=0,t||P(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},o.prototype.readInt32BE=function(e,t){return e>>>=0,t||P(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},o.prototype.readBigInt64LE=Q(function(e){F(e>>>=0,"offset");let t=this[e],r=this[e+7];(void 0===t||void 0===r)&&W(e,this.length-8);let n=this[e+4]+256*this[e+5]+65536*this[e+6]+(r<<24);return(BigInt(n)<<BigInt(32))+BigInt(t+256*this[++e]+65536*this[++e]+this[++e]*2**24)}),o.prototype.readBigInt64BE=Q(function(e){F(e>>>=0,"offset");let t=this[e],r=this[e+7];(void 0===t||void 0===r)&&W(e,this.length-8);let n=(t<<24)+65536*this[++e]+256*this[++e]+this[++e];return(BigInt(n)<<BigInt(32))+BigInt(this[++e]*2**24+65536*this[++e]+256*this[++e]+r)}),o.prototype.readFloatLE=function(e,r){return e>>>=0,r||P(e,4,this.length),t.read(this,e,!0,23,4)},o.prototype.readFloatBE=function(e,r){return e>>>=0,r||P(e,4,this.length),t.read(this,e,!1,23,4)},o.prototype.readDoubleLE=function(e,r){return e>>>=0,r||P(e,8,this.length),t.read(this,e,!0,52,8)},o.prototype.readDoubleBE=function(e,r){return e>>>=0,r||P(e,8,this.length),t.read(this,e,!1,52,8)},o.prototype.writeUintLE=o.prototype.writeUIntLE=function(e,t,r,n){if(e=+e,t>>>=0,r>>>=0,!n){T(this,e,t,r,Math.pow(2,8*r)-1,0)}let i=1,o=0;for(this[t]=255&e;++o<r&&(i*=256);)this[t+o]=e/i&255;return t+r},o.prototype.writeUintBE=o.prototype.writeUIntBE=function(e,t,r,n){if(e=+e,t>>>=0,r>>>=0,!n){T(this,e,t,r,Math.pow(2,8*r)-1,0)}let i=r-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+r},o.prototype.writeUint8=o.prototype.writeUInt8=function(e,t,r){return e=+e,t>>>=0,r||T(this,e,t,1,255,0),this[t]=255&e,t+1},o.prototype.writeUint16LE=o.prototype.writeUInt16LE=function(e,t,r){return e=+e,t>>>=0,r||T(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeUint16BE=o.prototype.writeUInt16BE=function(e,t,r){return e=+e,t>>>=0,r||T(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeUint32LE=o.prototype.writeUInt32LE=function(e,t,r){return e=+e,t>>>=0,r||T(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},o.prototype.writeUint32BE=o.prototype.writeUInt32BE=function(e,t,r){return e=+e,t>>>=0,r||T(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeBigUInt64LE=Q(function(e,t=0){return R(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))}),o.prototype.writeBigUInt64BE=Q(function(e,t=0){return C(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))}),o.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t>>>=0,!n){let n=Math.pow(2,8*r-1);T(this,e,t,r,n-1,-n)}let i=0,o=1,s=0;for(this[t]=255&e;++i<r&&(o*=256);)e<0&&0===s&&0!==this[t+i-1]&&(s=1),this[t+i]=(e/o|0)-s&255;return t+r},o.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t>>>=0,!n){let n=Math.pow(2,8*r-1);T(this,e,t,r,n-1,-n)}let i=r-1,o=1,s=0;for(this[t+i]=255&e;--i>=0&&(o*=256);)e<0&&0===s&&0!==this[t+i+1]&&(s=1),this[t+i]=(e/o|0)-s&255;return t+r},o.prototype.writeInt8=function(e,t,r){return e=+e,t>>>=0,r||T(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},o.prototype.writeInt16LE=function(e,t,r){return e=+e,t>>>=0,r||T(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeInt16BE=function(e,t,r){return e=+e,t>>>=0,r||T(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeInt32LE=function(e,t,r){return e=+e,t>>>=0,r||T(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},o.prototype.writeInt32BE=function(e,t,r){return e=+e,t>>>=0,r||T(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeBigInt64LE=Q(function(e,t=0){return R(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),o.prototype.writeBigInt64BE=Q(function(e,t=0){return C(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),o.prototype.writeFloatLE=function(e,t,r){return M(this,e,t,!0,r)},o.prototype.writeFloatBE=function(e,t,r){return M(this,e,t,!1,r)},o.prototype.writeDoubleLE=function(e,t,r){return B(this,e,t,!0,r)},o.prototype.writeDoubleBE=function(e,t,r){return B(this,e,t,!1,r)},o.prototype.copy=function(e,t,r,n){if(!o.isBuffer(e))throw new TypeError("argument should be a Buffer");if(r||(r=0),!n&&0!==n&&(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r||0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);let i=n-r;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,r,n):Uint8Array.prototype.set.call(e,this.subarray(r,n),t),i},o.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!o.isEncoding(n))throw new TypeError("Unknown encoding: "+n);if(1===e.length){let t=e.charCodeAt(0);("utf8"===n&&t<128||"latin1"===n)&&(e=t)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;let i;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(i=t;i<r;++i)this[i]=e;else{let s=o.isBuffer(e)?e:o.from(e,n),a=s.length;if(0===a)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<r-t;++i)this[i+t]=s[i%a]}return this};let N={};function U(e,t,r){N[e]=class extends r{constructor(){super(),Object.defineProperty(this,"message",{value:t.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${e}]`,this.stack,delete this.name}get code(){return e}set code(e){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:e,writable:!0})}toString(){return`${this.name} [${e}]: ${this.message}`}}}function L(e){let t="",r=e.length,n="-"===e[0]?1:0;for(;r>=n+4;r-=3)t=`_${e.slice(r-3,r)}${t}`;return`${e.slice(0,r)}${t}`}function D(e,t,r,n,i,o){if(e>r||e<t){let r,n="bigint"==typeof t?"n":"";throw r=0===t||t===BigInt(0)?`>= 0${n} and < 2${n} ** ${8*(o+1)}${n}`:`>= -(2${n} ** ${8*(o+1)-1}${n}) and < 2 ** ${8*(o+1)-1}${n}`,new N.ERR_OUT_OF_RANGE("value",r,e)}!function(e,t,r){F(t,"offset"),(void 0===e[t]||void 0===e[t+r])&&W(t,e.length-(r+1))}(n,i,o)}function F(e,t){if("number"!=typeof e)throw new N.ERR_INVALID_ARG_TYPE(t,"number",e)}function W(e,t,r){throw Math.floor(e)!==e?(F(e,r),new N.ERR_OUT_OF_RANGE("offset","an integer",e)):t<0?new N.ERR_BUFFER_OUT_OF_BOUNDS:new N.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${t}`,e)}U("ERR_BUFFER_OUT_OF_BOUNDS",function(e){return e?`${e} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),U("ERR_INVALID_ARG_TYPE",function(e,t){return`The "${e}" argument must be of type number. Received type ${typeof t}`},TypeError),U("ERR_OUT_OF_RANGE",function(e,t,r){let n=`The value of "${e}" is out of range.`,i=r;return Number.isInteger(r)&&Math.abs(r)>2**32?i=L(String(r)):"bigint"==typeof r&&(i=String(r),(r>BigInt(2)**BigInt(32)||r<-(BigInt(2)**BigInt(32)))&&(i=L(i)),i+="n"),n+=` It must be ${t}. Received ${i}`,n},RangeError);let q=/[^+/0-9A-Za-z-_]/g;function $(e,t){t=t||1/0;let r,n=e.length,i=null,o=[];for(let s=0;s<n;++s){if(r=e.charCodeAt(s),r>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(s+1===n){(t-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&o.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;o.push(r)}else if(r<2048){if((t-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function H(t){return e.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(q,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(t))}function V(e,t,r,n){let i;for(i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}function z(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function K(e){return e!=e}let G=function(){let e="0123456789abcdef",t=new Array(256);for(let r=0;r<16;++r){let n=16*r;for(let i=0;i<16;++i)t[n+i]=e[r]+e[i]}return t}();function Q(e){return typeof BigInt>"u"?Y:e}function Y(){throw new Error("BigInt not supported")}return ze}var qe,$e,He,Ve,ze,Ke,Ge=i(()=>{l(),tt(),Fe(),qe={},$e=!1,He={},Ve=!1,ze={},Ke=!1}),Qe={};s(Qe,{Buffer:()=>Je,INSPECT_MAX_BYTES:()=>Xe,default:()=>Ye,kMaxLength:()=>Ze});var Ye,Je,Xe,Ze,et=i(()=>{l(),tt(),Fe(),Ge(),(Ye=We()).Buffer,Ye.SlowBuffer,Ye.INSPECT_MAX_BYTES,Ye.kMaxLength,Je=Ye.Buffer,Xe=Ye.INSPECT_MAX_BYTES,Ze=Ye.kMaxLength}),tt=i(()=>{et()}),rt=o((e,t)=>{l(),tt(),Fe();var r=class extends Error{constructor(e){if(!Array.isArray(e))throw new TypeError("Expected input to be an Array, got "+typeof e);let t="";for(let r=0;r<e.length;r++)t+=`    ${e[r].stack}\n`;super(t),this.name="AggregateError",this.errors=e}};t.exports={AggregateError:r,ArrayIsArray:e=>Array.isArray(e),ArrayPrototypeIncludes:(e,t)=>e.includes(t),ArrayPrototypeIndexOf:(e,t)=>e.indexOf(t),ArrayPrototypeJoin:(e,t)=>e.join(t),ArrayPrototypeMap:(e,t)=>e.map(t),ArrayPrototypePop:(e,t)=>e.pop(t),ArrayPrototypePush:(e,t)=>e.push(t),ArrayPrototypeSlice:(e,t,r)=>e.slice(t,r),Error:Error,FunctionPrototypeCall:(e,t,...r)=>e.call(t,...r),FunctionPrototypeSymbolHasInstance:(e,t)=>Function.prototype[Symbol.hasInstance].call(e,t),MathFloor:Math.floor,Number:Number,NumberIsInteger:Number.isInteger,NumberIsNaN:Number.isNaN,NumberMAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER,NumberMIN_SAFE_INTEGER:Number.MIN_SAFE_INTEGER,NumberParseInt:Number.parseInt,ObjectDefineProperties:(e,t)=>Object.defineProperties(e,t),ObjectDefineProperty:(e,t,r)=>Object.defineProperty(e,t,r),ObjectGetOwnPropertyDescriptor:(e,t)=>Object.getOwnPropertyDescriptor(e,t),ObjectKeys:e=>Object.keys(e),ObjectSetPrototypeOf:(e,t)=>Object.setPrototypeOf(e,t),Promise:Promise,PromisePrototypeCatch:(e,t)=>e.catch(t),PromisePrototypeThen:(e,t,r)=>e.then(t,r),PromiseReject:e=>Promise.reject(e),PromiseResolve:e=>Promise.resolve(e),ReflectApply:Reflect.apply,RegExpPrototypeTest:(e,t)=>e.test(t),SafeSet:Set,String:String,StringPrototypeSlice:(e,t,r)=>e.slice(t,r),StringPrototypeToLowerCase:e=>e.toLowerCase(),StringPrototypeToUpperCase:e=>e.toUpperCase(),StringPrototypeTrim:e=>e.trim(),Symbol:Symbol,SymbolFor:Symbol.for,SymbolAsyncIterator:Symbol.asyncIterator,SymbolHasInstance:Symbol.hasInstance,SymbolIterator:Symbol.iterator,SymbolDispose:Symbol.dispose||Symbol("Symbol.dispose"),SymbolAsyncDispose:Symbol.asyncDispose||Symbol("Symbol.asyncDispose"),TypedArrayPrototypeSet:(e,t,r)=>e.set(t,r),Boolean:Boolean,Uint8Array:Uint8Array}}),nt=o((e,t)=>{l(),tt(),Fe(),t.exports={format:(e,...t)=>e.replace(/%([sdifj])/g,function(...[e,r]){let n=t.shift();return"f"===r?n.toFixed(6):"j"===r?JSON.stringify(n):"s"===r&&"object"==typeof n?`${n.constructor!==Object?n.constructor.name:""} {}`.trim():n.toString()}),inspect(e){switch(typeof e){case"string":if(e.includes("'")){if(!e.includes('"'))return`"${e}"`;if(!e.includes("`")&&!e.includes("${"))return`\`${e}\``}return`'${e}'`;case"number":return isNaN(e)?"NaN":Object.is(e,-0)?String(e):e;case"bigint":return`${String(e)}n`;case"boolean":case"undefined":return String(e);case"object":return"{}"}}}}),it=o((e,t)=>{l(),tt(),Fe();var{format:r,inspect:n}=nt(),{AggregateError:i}=rt(),o=globalThis.AggregateError||i,s=Symbol("kIsNodeError"),a=["string","function","number","object","Function","Object","boolean","bigint","symbol"],u=/^([A-Z][a-z0-9]*)+$/,c={};function h(e,t){if(!e)throw new c.ERR_INTERNAL_ASSERTION(t)}function f(e){let t="",r=e.length,n="-"===e[0]?1:0;for(;r>=n+4;r-=3)t=`_${e.slice(r-3,r)}${t}`;return`${e.slice(0,r)}${t}`}function p(e,t,n){n||(n=Error);class i extends n{constructor(...n){super(function(e,t,n){if("function"==typeof t)return h(t.length<=n.length,`Code: ${e}; The provided arguments length (${n.length}) does not match the required ones (${t.length}).`),t(...n);let i=(t.match(/%[dfijoOs]/g)||[]).length;return h(i===n.length,`Code: ${e}; The provided arguments length (${n.length}) does not match the required ones (${i}).`),0===n.length?t:r(t,...n)}(e,t,n))}toString(){return`${this.name} [${e}]: ${this.message}`}}Object.defineProperties(i.prototype,{name:{value:n.name,writable:!0,enumerable:!1,configurable:!0},toString:{value(){return`${this.name} [${e}]: ${this.message}`},writable:!0,enumerable:!1,configurable:!0}}),i.prototype.code=e,i.prototype[s]=!0,c[e]=i}function d(e){let t="__node_internal_"+e.name;return Object.defineProperty(e,"name",{value:t}),e}var y=class extends Error{constructor(e="The operation was aborted",t=void 0){if(void 0!==t&&"object"!=typeof t)throw new c.ERR_INVALID_ARG_TYPE("options","Object",t);super(e,t),this.code="ABORT_ERR",this.name="AbortError"}};p("ERR_ASSERTION","%s",Error),p("ERR_INVALID_ARG_TYPE",(e,t,r)=>{h("string"==typeof e,"'name' must be a string"),Array.isArray(t)||(t=[t]);let i="The ";e.endsWith(" argument")?i+=`${e} `:i+=`"${e}" ${e.includes(".")?"property":"argument"} `,i+="must be ";let o=[],s=[],l=[];for(let e of t)h("string"==typeof e,"All expected entries have to be of type string"),a.includes(e)?o.push(e.toLowerCase()):u.test(e)?s.push(e):(h("object"!==e,'The value "object" should be written as "Object"'),l.push(e));if(s.length>0){let e=o.indexOf("object");-1!==e&&(o.splice(o,e,1),s.push("Object"))}if(o.length>0){switch(o.length){case 1:i+=`of type ${o[0]}`;break;case 2:i+=`one of type ${o[0]} or ${o[1]}`;break;default:{let e=o.pop();i+=`one of type ${o.join(", ")}, or ${e}`}}(s.length>0||l.length>0)&&(i+=" or ")}if(s.length>0){switch(s.length){case 1:i+=`an instance of ${s[0]}`;break;case 2:i+=`an instance of ${s[0]} or ${s[1]}`;break;default:{let e=s.pop();i+=`an instance of ${s.join(", ")}, or ${e}`}}l.length>0&&(i+=" or ")}switch(l.length){case 0:break;case 1:l[0].toLowerCase()!==l[0]&&(i+="an "),i+=`${l[0]}`;break;case 2:i+=`one of ${l[0]} or ${l[1]}`;break;default:{let e=l.pop();i+=`one of ${l.join(", ")}, or ${e}`}}if(null==r)i+=`. Received ${r}`;else if("function"==typeof r&&r.name)i+=`. Received function ${r.name}`;else if("object"==typeof r){var c;if(null!==(c=r.constructor)&&void 0!==c&&c.name)i+=`. Received an instance of ${r.constructor.name}`;else{i+=`. Received ${n(r,{depth:-1})}`}}else{let e=n(r,{colors:!1});e.length>25&&(e=`${e.slice(0,25)}...`),i+=`. Received type ${typeof r} (${e})`}return i},TypeError),p("ERR_INVALID_ARG_VALUE",(e,t,r="is invalid")=>{let i=n(t);return i.length>128&&(i=i.slice(0,128)+"..."),`The ${e.includes(".")?"property":"argument"} '${e}' ${r}. Received ${i}`},TypeError),p("ERR_INVALID_RETURN_VALUE",(e,t,r)=>{var n;return`Expected ${e} to be returned from the "${t}" function but got ${null!=r&&null!==(n=r.constructor)&&void 0!==n&&n.name?`instance of ${r.constructor.name}`:"type "+typeof r}.`},TypeError),p("ERR_MISSING_ARGS",(...e)=>{h(e.length>0,"At least one arg needs to be specified");let t,r=e.length;switch(e=(Array.isArray(e)?e:[e]).map(e=>`"${e}"`).join(" or "),r){case 1:t+=`The ${e[0]} argument`;break;case 2:t+=`The ${e[0]} and ${e[1]} arguments`;break;default:{let r=e.pop();t+=`The ${e.join(", ")}, and ${r} arguments`}}return`${t} must be specified`},TypeError),p("ERR_OUT_OF_RANGE",(e,t,r)=>{let i;if(h(t,'Missing "range" argument'),Number.isInteger(r)&&Math.abs(r)>2**32)i=f(String(r));else if("bigint"==typeof r){i=String(r);let e=BigInt(2)**BigInt(32);(r>e||r<-e)&&(i=f(i)),i+="n"}else i=n(r);return`The value of "${e}" is out of range. It must be ${t}. Received ${i}`},RangeError),p("ERR_MULTIPLE_CALLBACK","Callback called multiple times",Error),p("ERR_METHOD_NOT_IMPLEMENTED","The %s method is not implemented",Error),p("ERR_STREAM_ALREADY_FINISHED","Cannot call %s after a stream was finished",Error),p("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable",Error),p("ERR_STREAM_DESTROYED","Cannot call %s after a stream was destroyed",Error),p("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),p("ERR_STREAM_PREMATURE_CLOSE","Premature close",Error),p("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF",Error),p("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event",Error),p("ERR_STREAM_WRITE_AFTER_END","write after end",Error),p("ERR_UNKNOWN_ENCODING","Unknown encoding: %s",TypeError),t.exports={AbortError:y,aggregateTwoErrors:d(function(e,t){if(e&&t&&e!==t){if(Array.isArray(t.errors))return t.errors.push(e),t;let r=new o([t,e],t.message);return r.code=t.code,r}return e||t}),hideStackFrames:d,codes:c}}),ot=o((e,t)=>{l(),tt(),Fe();var{AbortController:r,AbortSignal:n}=typeof self<"u"?self:typeof window<"u"?window:void 0;t.exports=r,t.exports.AbortSignal=n,t.exports.default=r}),st={};function at(){if(ut)return lt;ut=!0;var e,t="object"==typeof Reflect?Reflect:null,r=t&&"function"==typeof t.apply?t.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};e=t&&"function"==typeof t.ownKeys?t.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var n=Number.isNaN||function(e){return e!=e};function i(){i.init.call(this)}(lt=i).once=function(e,t){return new Promise(function(r,n){function i(r){e.removeListener(t,o),n(r)}function o(){"function"==typeof e.removeListener&&e.removeListener("error",i),r([].slice.call(arguments))}d(e,t,o,{once:!0}),"error"!==t&&function(e,t,r){"function"==typeof e.on&&d(e,"error",t,r)}(e,i,{once:!0})})},i.EventEmitter=i,i.prototype._events=void 0,i.prototype._eventsCount=0,i.prototype._maxListeners=void 0;var o=10;function s(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function a(e){return void 0===e._maxListeners?i.defaultMaxListeners:e._maxListeners}function l(e,t,r,n){var i,o,l;if(s(r),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),o=e._events),l=o[t]),void 0===l)l=o[t]=r,++e._eventsCount;else if("function"==typeof l?l=o[t]=n?[r,l]:[l,r]:n?l.unshift(r):l.push(r),(i=a(e))>0&&l.length>i&&!l.warned){l.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+l.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=l.length,function(e){console&&console.warn&&console.warn(e)}(u)}return e}function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function c(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},i=u.bind(n);return i.listener=r,n.wrapFn=i,i}function h(e,t,r){var n=e._events;if(void 0===n)return[];var i=n[t];return void 0===i?[]:"function"==typeof i?r?[i.listener||i]:[i]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(i):p(i,i.length)}function f(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function p(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}function d(e,t,r,n){if("function"==typeof e.on)n.once?e.once(t,r):e.on(t,r);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,function i(o){n.once&&e.removeEventListener(t,i),r(o)})}}return Object.defineProperty(i,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(e){if("number"!=typeof e||e<0||n(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");o=e}}),i.init=function(){(void 0===this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},i.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||n(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},i.prototype.getMaxListeners=function(){return a(this)},i.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i="error"===e,o=this._events;if(void 0!==o)i=i&&void 0===o.error;else if(!i)return!1;if(i){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var l=o[e];if(void 0===l)return!1;if("function"==typeof l)r(l,this,t);else{var u=l.length,c=p(l,u);for(n=0;n<u;++n)r(c[n],this,t)}return!0},i.prototype.addListener=function(e,t){return l(this,e,t,!1)},i.prototype.on=i.prototype.addListener,i.prototype.prependListener=function(e,t){return l(this,e,t,!0)},i.prototype.once=function(e,t){return s(t),this.on(e,c(this,e,t)),this},i.prototype.prependOnceListener=function(e,t){return s(t),this.prependListener(e,c(this,e,t)),this},i.prototype.removeListener=function(e,t){var r,n,i,o,a;if(s(t),void 0===(n=this._events))return this;if(void 0===(r=n[e]))return this;if(r===t||r.listener===t)0===--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(i=-1,o=r.length-1;o>=0;o--)if(r[o]===t||r[o].listener===t){a=r[o].listener,i=o;break}if(i<0)return this;0===i?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,i),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,a||t)}return this},i.prototype.off=i.prototype.removeListener,i.prototype.removeAllListeners=function(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0===--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var i,o=Object.keys(r);for(n=0;n<o.length;++n)"removeListener"!==(i=o[n])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},i.prototype.listeners=function(e){return h(this,e,!0)},i.prototype.rawListeners=function(e){return h(this,e,!1)},i.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):f.call(e,t)},i.prototype.listenerCount=f,i.prototype.eventNames=function(){return this._eventsCount>0?e(this._events):[]},lt}s(st,{EventEmitter:()=>ht,default:()=>ct,defaultMaxListeners:()=>ft,init:()=>pt,listenerCount:()=>dt,on:()=>yt,once:()=>gt});var lt,ut,ct,ht,ft,pt,dt,yt,gt,bt=i(()=>{l(),tt(),Fe(),lt={},ut=!1,(ct=at()).once,ct.once=function(e,t){return new Promise((r,n)=>{function i(...t){void 0!==o&&e.removeListener("error",o),r(t)}let o;"error"!==t&&(o=t=>{e.removeListener(name,i),n(t)},e.once("error",o)),e.once(t,i)})},ct.on=function(e,t){let r=[],n=[],i=null,o=!1,s={async next(){let e=r.shift();if(e)return createIterResult(e,!1);if(i){let e=Promise.reject(i);return i=null,e}return o?createIterResult(void 0,!0):new Promise((e,t)=>n.push({resolve:e,reject:t}))},async return(){e.removeListener(t,a),e.removeListener("error",l),o=!0;for(let e of n)e.resolve(createIterResult(void 0,!0));return createIterResult(void 0,!0)},throw(r){i=r,e.removeListener(t,a),e.removeListener("error",l)},[Symbol.asyncIterator](){return this}};return e.on(t,a),e.on("error",l),s;function a(...e){let t=n.shift();t?t.resolve(createIterResult(e,!1)):r.push(e)}function l(e){o=!0;let t=n.shift();t?t.reject(e):i=e,s.return()}},({EventEmitter:ht,defaultMaxListeners:ft,init:pt,listenerCount:dt,on:yt,once:gt}=ct)}),mt=o((e,t)=>{l(),tt(),Fe();var r=(et(),a(Qe)),{format:n,inspect:i}=nt(),{codes:{ERR_INVALID_ARG_TYPE:o}}=it(),{kResistStopPropagation:s,AggregateError:u,SymbolDispose:c}=rt(),h=globalThis.AbortSignal||ot().AbortSignal,f=globalThis.AbortController||ot().AbortController,p=Object.getPrototypeOf(async function(){}).constructor,d=globalThis.Blob||r.Blob,y=typeof d<"u"?function(e){return e instanceof d}:function(e){return!1},g=(e,t)=>{if(void 0!==e&&(null===e||"object"!=typeof e||!("aborted"in e)))throw new o(t,"AbortSignal",e)};t.exports={AggregateError:u,kEmptyObject:Object.freeze({}),once(e){let t=!1;return function(...r){t||(t=!0,e.apply(this,r))}},createDeferredPromise:function(){let e,t;return{promise:new Promise((r,n)=>{e=r,t=n}),resolve:e,reject:t}},promisify:e=>new Promise((t,r)=>{e((e,...n)=>e?r(e):t(...n))}),debuglog:()=>function(){},format:n,inspect:i,types:{isAsyncFunction:e=>e instanceof p,isArrayBufferView:e=>ArrayBuffer.isView(e)},isBlob:y,deprecate:(e,t)=>e,addAbortListener:(bt(),a(st)).addAbortListener||function(e,t){if(void 0===e)throw new o("signal","AbortSignal",e);let r;return g(e,"signal"),((e,t)=>{if("function"!=typeof e)throw new o(t,"Function",e)})(t,"listener"),e.aborted?queueMicrotask(()=>t()):(e.addEventListener("abort",t,{__proto__:null,once:!0,[s]:!0}),r=()=>{e.removeEventListener("abort",t)}),{__proto__:null,[c](){var e;null===(e=r)||void 0===e||e()}}},AbortSignalAny:h.any||function(e){if(1===e.length)return e[0];let t=new f,r=()=>t.abort();return e.forEach(e=>{g(e,"signals"),e.addEventListener("abort",r,{once:!0})}),t.signal.addEventListener("abort",()=>{e.forEach(e=>e.removeEventListener("abort",r))},{once:!0}),t.signal}},t.exports.promisify.custom=Symbol.for("nodejs.util.promisify.custom")}),wt=o((e,t)=>{l(),tt(),Fe();var{ArrayIsArray:r,ArrayPrototypeIncludes:n,ArrayPrototypeJoin:i,ArrayPrototypeMap:o,NumberIsInteger:s,NumberIsNaN:a,NumberMAX_SAFE_INTEGER:u,NumberMIN_SAFE_INTEGER:c,NumberParseInt:h,ObjectPrototypeHasOwnProperty:f,RegExpPrototypeExec:p,String:d,StringPrototypeToUpperCase:y,StringPrototypeTrim:g}=rt(),{hideStackFrames:b,codes:{ERR_SOCKET_BAD_PORT:m,ERR_INVALID_ARG_TYPE:w,ERR_INVALID_ARG_VALUE:v,ERR_OUT_OF_RANGE:_,ERR_UNKNOWN_SIGNAL:S}}=it(),{normalizeEncoding:E}=mt(),{isAsyncFunction:A,isArrayBufferView:I}=mt().types,k={};var O=/^[0-7]+$/;var x=b((e,t,r=c,n=u)=>{if("number"!=typeof e)throw new w(t,"number",e);if(!s(e))throw new _(t,"an integer",e);if(e<r||e>n)throw new _(t,`>= ${r} && <= ${n}`,e)}),P=b((e,t,r=-2147483648,n=2147483647)=>{if("number"!=typeof e)throw new w(t,"number",e);if(!s(e))throw new _(t,"an integer",e);if(e<r||e>n)throw new _(t,`>= ${r} && <= ${n}`,e)}),T=b((e,t,r=!1)=>{if("number"!=typeof e)throw new w(t,"number",e);if(!s(e))throw new _(t,"an integer",e);let n=r?1:0,i=4294967295;if(e<n||e>i)throw new _(t,`>= ${n} && <= ${i}`,e)});function R(e,t){if("string"!=typeof e)throw new w(t,"string",e)}var C=b((e,t,r)=>{if(!n(r,e)){let n="must be one of: "+i(o(r,e=>"string"==typeof e?`'${e}'`:d(e)),", ");throw new v(t,e,n)}});function j(e,t){if("boolean"!=typeof e)throw new w(t,"boolean",e)}function M(e,t,r){return null!=e&&f(e,t)?e[t]:r}var B=b((e,t,n=null)=>{let i=M(n,"allowArray",!1),o=M(n,"allowFunction",!1);if(!M(n,"nullable",!1)&&null===e||!i&&r(e)||"object"!=typeof e&&(!o||"function"!=typeof e))throw new w(t,"Object",e)}),N=b((e,t)=>{if(null!=e&&"object"!=typeof e&&"function"!=typeof e)throw new w(t,"a dictionary",e)}),U=b((e,t,n=0)=>{if(!r(e))throw new w(t,"Array",e);if(e.length<n){throw new v(t,e,`must be longer than ${n}`)}});var L=b((e,t="buffer")=>{if(!I(e))throw new w(t,["Buffer","TypedArray","DataView"],e)});var D=b((e,t)=>{if(void 0!==e&&(null===e||"object"!=typeof e||!("aborted"in e)))throw new w(t,"AbortSignal",e)}),F=b((e,t)=>{if("function"!=typeof e)throw new w(t,"Function",e)}),W=b((e,t)=>{if("function"!=typeof e||A(e))throw new w(t,"Function",e)}),q=b((e,t)=>{if(void 0!==e)throw new w(t,"undefined",e)});var $=/^(?:<[^>]*>)(?:\s*;\s*[^;"\s]+(?:=(")?[^;"\s]*\1)?)*$/;function H(e,t){if(typeof e>"u"||!p($,e))throw new v(t,e,'must be an array or string of format "</styles.css>; rel=preload; as=style"')}t.exports={isInt32:function(e){return e===(0|e)},isUint32:function(e){return e===e>>>0},parseFileMode:function(e,t,r){if(typeof e>"u"&&(e=r),"string"==typeof e){if(null===p(O,e))throw new v(t,e,"must be a 32-bit unsigned integer or an octal string");e=h(e,8)}return T(e,t),e},validateArray:U,validateStringArray:function(e,t){U(e,t);for(let r=0;r<e.length;r++)R(e[r],`${t}[${r}]`)},validateBooleanArray:function(e,t){U(e,t);for(let r=0;r<e.length;r++)j(e[r],`${t}[${r}]`)},validateAbortSignalArray:function(e,t){U(e,t);for(let r=0;r<e.length;r++){let n=e[r],i=`${t}[${r}]`;if(null==n)throw new w(i,"AbortSignal",n);D(n,i)}},validateBoolean:j,validateBuffer:L,validateDictionary:N,validateEncoding:function(e,t){let r=E(t),n=e.length;if("hex"===r&&n%2!=0)throw new v("encoding",t,`is invalid for data of length ${n}`)},validateFunction:F,validateInt32:P,validateInteger:x,validateNumber:function(e,t,r=void 0,n){if("number"!=typeof e)throw new w(t,"number",e);if(null!=r&&e<r||null!=n&&e>n||(null!=r||null!=n)&&a(e))throw new _(t,`${null!=r?`>= ${r}`:""}${null!=r&&null!=n?" && ":""}${null!=n?`<= ${n}`:""}`,e)},validateObject:B,validateOneOf:C,validatePlainFunction:W,validatePort:function(e,t="Port",r=!0){if("number"!=typeof e&&"string"!=typeof e||"string"==typeof e&&0===g(e).length||+e!==+e>>>0||e>65535||0===e&&!r)throw new m(t,e,r);return 0|e},validateSignalName:function(e,t="signal"){if(R(e,t),void 0===k[e])throw void 0!==k[y(e)]?new S(e+" (signals must use all capital letters)"):new S(e)},validateString:R,validateUint32:T,validateUndefined:q,validateUnion:function(e,t,r){if(!n(r,e))throw new w(t,`('${i(r,"|")}')`,e)},validateAbortSignal:D,validateLinkHeaderValue:function(e){if("string"==typeof e)return H(e,"hints"),e;if(r(e)){let t=e.length,r="";if(0===t)return r;for(let n=0;n<t;n++){let i=e[n];H(i,"hints"),r+=i,n!==t-1&&(r+=", ")}return r}throw new v("hints",e,'must be an array or string of format "</styles.css>; rel=preload; as=style"')}}}),vt=o((e,t)=>{l(),tt(),Fe();var r,n,i=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(e){if(r===setTimeout)return setTimeout(e,0);if((r===o||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:o}catch(e){r=o}try{n="function"==typeof clearTimeout?clearTimeout:s}catch(e){n=s}}();var u,c=[],h=!1,f=-1;function p(){!h||!u||(h=!1,u.length?c=u.concat(c):f=-1,c.length&&d())}function d(){if(!h){var e=a(p);h=!0;for(var t=c.length;t;){for(u=c,c=[];++f<t;)u&&u[f].run();f=-1,t=c.length}u=null,h=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{return n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function y(e,t){this.fun=e,this.array=t}function g(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];c.push(new y(e,t)),1===c.length&&!h&&a(d)},y.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.prependListener=g,i.prependOnceListener=g,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}}),_t=o((e,t)=>{l(),tt(),Fe();var{SymbolAsyncIterator:r,SymbolIterator:n,SymbolFor:i}=rt(),o=i("nodejs.stream.destroyed"),s=i("nodejs.stream.errored"),a=i("nodejs.stream.readable"),u=i("nodejs.stream.writable"),c=i("nodejs.stream.disturbed"),h=i("nodejs.webstream.isClosedPromise"),f=i("nodejs.webstream.controllerErrorFunction");function p(e,t=!1){var r;return!(!e||"function"!=typeof e.pipe||"function"!=typeof e.on||t&&("function"!=typeof e.pause||"function"!=typeof e.resume)||e._writableState&&!1===(null===(r=e._readableState)||void 0===r?void 0:r.readable)||e._writableState&&!e._readableState)}function d(e){var t;return!(!e||"function"!=typeof e.write||"function"!=typeof e.on||e._readableState&&!1===(null===(t=e._writableState)||void 0===t?void 0:t.writable))}function y(e){return e&&(e._readableState||e._writableState||"function"==typeof e.write&&"function"==typeof e.on||"function"==typeof e.pipe&&"function"==typeof e.on)}function g(e){return!(!e||y(e)||"function"!=typeof e.pipeThrough||"function"!=typeof e.getReader||"function"!=typeof e.cancel)}function b(e){return!(!e||y(e)||"function"!=typeof e.getWriter||"function"!=typeof e.abort)}function m(e){return!(!e||y(e)||"object"!=typeof e.readable||"object"!=typeof e.writable)}function w(e){if(!y(e))return null;let t=e._writableState,r=e._readableState,n=t||r;return!!(e.destroyed||e[o]||null!=n&&n.destroyed)}function v(e){if(!d(e))return null;if(!0===e.writableEnded)return!0;let t=e._writableState;return(null==t||!t.errored)&&("boolean"!=typeof t?.ended?null:t.ended)}function _(e,t){if(!p(e))return null;let r=e._readableState;return(null==r||!r.errored)&&("boolean"!=typeof r?.endEmitted?null:!!(r.endEmitted||!1===t&&!0===r.ended&&0===r.length))}function S(e){return e&&null!=e[a]?e[a]:"boolean"!=typeof e?.readable?null:!w(e)&&(p(e)&&e.readable&&!_(e))}function E(e){return e&&null!=e[u]?e[u]:"boolean"!=typeof e?.writable?null:!w(e)&&(d(e)&&e.writable&&!v(e))}function A(e){return"boolean"==typeof e._closed&&"boolean"==typeof e._defaultKeepAlive&&"boolean"==typeof e._removedConnection&&"boolean"==typeof e._removedContLen}function I(e){return"boolean"==typeof e._sent100&&A(e)}t.exports={isDestroyed:w,kIsDestroyed:o,isDisturbed:function(e){var t;return!(!e||!(null!==(t=e[c])&&void 0!==t?t:e.readableDidRead||e.readableAborted))},kIsDisturbed:c,isErrored:function(e){var t,r,n,i,o,a,l,u,c,h;return!(!e||!(null!==(t=null!==(r=null!==(n=null!==(i=null!==(o=null!==(a=e[s])&&void 0!==a?a:e.readableErrored)&&void 0!==o?o:e.writableErrored)&&void 0!==i?i:null===(l=e._readableState)||void 0===l?void 0:l.errorEmitted)&&void 0!==n?n:null===(u=e._writableState)||void 0===u?void 0:u.errorEmitted)&&void 0!==r?r:null===(c=e._readableState)||void 0===c?void 0:c.errored)&&void 0!==t?t:null!==(h=e._writableState)&&void 0!==h&&h.errored))},kIsErrored:s,isReadable:S,kIsReadable:a,kIsClosedPromise:h,kControllerErrorFunction:f,kIsWritable:u,isClosed:function(e){if(!y(e))return null;if("boolean"==typeof e.closed)return e.closed;let t=e._writableState,r=e._readableState;return"boolean"==typeof t?.closed||"boolean"==typeof r?.closed?t?.closed||r?.closed:"boolean"==typeof e._closed&&A(e)?e._closed:null},isDuplexNodeStream:function(e){return!(!e||"function"!=typeof e.pipe||!e._readableState||"function"!=typeof e.on||"function"!=typeof e.write)},isFinished:function(e,t){return y(e)?!!w(e)||!(!1!==t?.readable&&S(e)||!1!==t?.writable&&E(e)):null},isIterable:function(e,t){return null!=e&&(!0===t?"function"==typeof e[r]:!1===t?"function"==typeof e[n]:"function"==typeof e[r]||"function"==typeof e[n])},isReadableNodeStream:p,isReadableStream:g,isReadableEnded:function(e){if(!p(e))return null;if(!0===e.readableEnded)return!0;let t=e._readableState;return!(!t||t.errored)&&("boolean"!=typeof t?.ended?null:t.ended)},isReadableFinished:_,isReadableErrored:function(e){var t,r;return y(e)?e.readableErrored?e.readableErrored:null!==(t=null===(r=e._readableState)||void 0===r?void 0:r.errored)&&void 0!==t?t:null:null},isNodeStream:y,isWebStream:function(e){return g(e)||b(e)||m(e)},isWritable:E,isWritableNodeStream:d,isWritableStream:b,isWritableEnded:v,isWritableFinished:function(e,t){if(!d(e))return null;if(!0===e.writableFinished)return!0;let r=e._writableState;return(null==r||!r.errored)&&("boolean"!=typeof r?.finished?null:!!(r.finished||!1===t&&!0===r.ended&&0===r.length))},isWritableErrored:function(e){var t,r;return y(e)?e.writableErrored?e.writableErrored:null!==(t=null===(r=e._writableState)||void 0===r?void 0:r.errored)&&void 0!==t?t:null:null},isServerRequest:function(e){var t;return"boolean"==typeof e._consuming&&"boolean"==typeof e._dumped&&void 0===(null===(t=e.req)||void 0===t?void 0:t.upgradeOrConnect)},isServerResponse:I,willEmitClose:function(e){if(!y(e))return null;let t=e._writableState,r=e._readableState,n=t||r;return!n&&I(e)||!!(n&&n.autoDestroy&&n.emitClose&&!1===n.closed)},isTransformStream:m}}),St=o((e,t)=>{l(),tt(),Fe();var r,n=vt(),{AbortError:i,codes:o}=it(),{ERR_INVALID_ARG_TYPE:s,ERR_STREAM_PREMATURE_CLOSE:a}=o,{kEmptyObject:u,once:c}=mt(),{validateAbortSignal:h,validateFunction:f,validateObject:p,validateBoolean:d}=wt(),{Promise:y,PromisePrototypeThen:g,SymbolDispose:b}=rt(),{isClosed:m,isReadable:w,isReadableNodeStream:v,isReadableStream:_,isReadableFinished:S,isReadableErrored:E,isWritable:A,isWritableNodeStream:I,isWritableStream:k,isWritableFinished:O,isWritableErrored:x,isNodeStream:P,willEmitClose:T,kIsClosedPromise:R}=_t();var C=()=>{};function j(e,t,o){var l,d;if(2===arguments.length?(o=t,t=u):null==t?t=u:p(t,"options"),f(o,"callback"),h(t.signal,"options.signal"),o=c(o),_(e)||k(e))return function(e,t,o){let s=!1,a=C;if(t.signal)if(a=()=>{s=!0,o.call(e,new i(void 0,{cause:t.signal.reason}))},t.signal.aborted)n.nextTick(a);else{let n=(r=r||mt().addAbortListener)(t.signal,a),i=o;o=c((...t)=>{n[b](),i.apply(e,t)})}let l=(...t)=>{s||n.nextTick(()=>o.apply(e,t))};return g(e[R].promise,l,l),C}(e,t,o);if(!P(e))throw new s("stream",["ReadableStream","WritableStream","Stream"],e);let y=null!==(l=t.readable)&&void 0!==l?l:v(e),j=null!==(d=t.writable)&&void 0!==d?d:I(e),M=e._writableState,B=e._readableState,N=()=>{e.writable||D()},U=T(e)&&v(e)===y&&I(e)===j,L=O(e,!1),D=()=>{L=!0,e.destroyed&&(U=!1),(!U||e.readable&&!y)&&(!y||F)&&o.call(e)},F=S(e,!1),W=()=>{F=!0,e.destroyed&&(U=!1),(!U||e.writable&&!j)&&(!j||L)&&o.call(e)},q=t=>{o.call(e,t)},$=m(e),H=()=>{$=!0;let t=x(e)||E(e);return t&&"boolean"!=typeof t?o.call(e,t):y&&!F&&v(e,!0)&&!S(e,!1)?o.call(e,new a):!j||L||O(e,!1)?void o.call(e):o.call(e,new a)},V=()=>{$=!0;let t=x(e)||E(e);if(t&&"boolean"!=typeof t)return o.call(e,t);o.call(e)},z=()=>{e.req.on("finish",D)};!function(e){return e.setHeader&&"function"==typeof e.abort}(e)?j&&!M&&(e.on("end",N),e.on("close",N)):(e.on("complete",D),U||e.on("abort",H),e.req?z():e.on("request",z)),!U&&"boolean"==typeof e.aborted&&e.on("aborted",H),e.on("end",W),e.on("finish",D),!1!==t.error&&e.on("error",q),e.on("close",H),$?n.nextTick(H):null!=M&&M.errorEmitted||null!=B&&B.errorEmitted?U||n.nextTick(V):(!y&&(!U||w(e))&&(L||!1===A(e))||!j&&(!U||A(e))&&(F||!1===w(e))||B&&e.req&&e.aborted)&&n.nextTick(V);let K=()=>{o=C,e.removeListener("aborted",H),e.removeListener("complete",D),e.removeListener("abort",H),e.removeListener("request",z),e.req&&e.req.removeListener("finish",D),e.removeListener("end",N),e.removeListener("close",N),e.removeListener("finish",D),e.removeListener("end",W),e.removeListener("error",q),e.removeListener("close",H)};if(t.signal&&!$){let s=()=>{let r=o;K(),r.call(e,new i(void 0,{cause:t.signal.reason}))};if(t.signal.aborted)n.nextTick(s);else{let n=(r=r||mt().addAbortListener)(t.signal,s),i=o;o=c((...t)=>{n[b](),i.apply(e,t)})}}return K}t.exports=j,t.exports.finished=function(e,t){var r;let n=!1;return null===t&&(t=u),null!==(r=t)&&void 0!==r&&r.cleanup&&(d(t.cleanup,"cleanup"),n=t.cleanup),new y((r,i)=>{let o=j(e,t,e=>{n&&o(),e?i(e):r()})})}}),Et=o((e,t)=>{l(),tt(),Fe();var r=vt(),{aggregateTwoErrors:n,codes:{ERR_MULTIPLE_CALLBACK:i},AbortError:o}=it(),{Symbol:s}=rt(),{kIsDestroyed:a,isDestroyed:u,isFinished:c,isServerRequest:h}=_t(),f=s("kDestroy"),p=s("kConstruct");function d(e,t,r){e&&(e.stack,t&&!t.errored&&(t.errored=e),r&&!r.errored&&(r.errored=e))}function y(e,t,n){let i=!1;function o(t){if(i)return;i=!0;let o=e._readableState,s=e._writableState;d(t,s,o),s&&(s.closed=!0),o&&(o.closed=!0),"function"==typeof n&&n(t),t?r.nextTick(g,e,t):r.nextTick(b,e)}try{e._destroy(t||null,o)}catch(e){o(e)}}function g(e,t){m(e,t),b(e)}function b(e){let t=e._readableState,r=e._writableState;r&&(r.closeEmitted=!0),t&&(t.closeEmitted=!0),(null!=r&&r.emitClose||null!=t&&t.emitClose)&&e.emit("close")}function m(e,t){let r=e._readableState,n=e._writableState;null!=n&&n.errorEmitted||null!=r&&r.errorEmitted||(n&&(n.errorEmitted=!0),r&&(r.errorEmitted=!0),e.emit("error",t))}function w(e,t,n){let i=e._readableState,o=e._writableState;if(null!=o&&o.destroyed||null!=i&&i.destroyed)return this;null!=i&&i.autoDestroy||null!=o&&o.autoDestroy?e.destroy(t):t&&(t.stack,o&&!o.errored&&(o.errored=t),i&&!i.errored&&(i.errored=t),n?r.nextTick(m,e,t):m(e,t))}function v(e){let t=!1;function n(n){if(t)return void w(e,n??new i);t=!0;let o=e._readableState,s=e._writableState,a=s||o;o&&(o.constructed=!0),s&&(s.constructed=!0),a.destroyed?e.emit(f,n):n?w(e,n,!0):r.nextTick(_,e)}try{e._construct(e=>{r.nextTick(n,e)})}catch(e){r.nextTick(n,e)}}function _(e){e.emit(p)}function S(e){return e?.setHeader&&"function"==typeof e.abort}function E(e){e.emit("close")}function A(e,t){e.emit("error",t),r.nextTick(E,e)}t.exports={construct:function(e,t){if("function"!=typeof e._construct)return;let n=e._readableState,i=e._writableState;n&&(n.constructed=!1),i&&(i.constructed=!1),e.once(p,t),!(e.listenerCount(p)>1)&&r.nextTick(v,e)},destroyer:function(e,t){!e||u(e)||(!t&&!c(e)&&(t=new o),h(e)?(e.socket=null,e.destroy(t)):S(e)?e.abort():S(e.req)?e.req.abort():"function"==typeof e.destroy?e.destroy(t):"function"==typeof e.close?e.close():t?r.nextTick(A,e,t):r.nextTick(E,e),e.destroyed||(e[a]=!0))},destroy:function(e,t){let r=this._readableState,i=this._writableState,o=i||r;return null!=i&&i.destroyed||null!=r&&r.destroyed?("function"==typeof t&&t(),this):(d(e,i,r),i&&(i.destroyed=!0),r&&(r.destroyed=!0),o.constructed?y(this,e,t):this.once(f,function(r){y(this,n(r,e),t)}),this)},undestroy:function(){let e=this._readableState,t=this._writableState;e&&(e.constructed=!0,e.closed=!1,e.closeEmitted=!1,e.destroyed=!1,e.errored=null,e.errorEmitted=!1,e.reading=!1,e.ended=!1===e.readable,e.endEmitted=!1===e.readable),t&&(t.constructed=!0,t.destroyed=!1,t.closed=!1,t.closeEmitted=!1,t.errored=null,t.errorEmitted=!1,t.finalCalled=!1,t.prefinished=!1,t.ended=!1===t.writable,t.ending=!1===t.writable,t.finished=!1===t.writable)},errorOrDestroy:w}}),At=o((e,t)=>{l(),tt(),Fe();var{ArrayIsArray:r,ObjectSetPrototypeOf:n}=rt(),{EventEmitter:i}=(bt(),a(st));function o(e){i.call(this,e)}function s(e,t,n){if("function"==typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?r(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}n(o.prototype,i.prototype),n(o,i),o.prototype.pipe=function(e,t){let r=this;function n(t){e.writable&&!1===e.write(t)&&r.pause&&r.pause()}function o(){r.readable&&r.resume&&r.resume()}r.on("data",n),e.on("drain",o),!e._isStdio&&(!t||!1!==t.end)&&(r.on("end",l),r.on("close",u));let a=!1;function l(){a||(a=!0,e.end())}function u(){a||(a=!0,"function"==typeof e.destroy&&e.destroy())}function c(e){h(),0===i.listenerCount(this,"error")&&this.emit("error",e)}function h(){r.removeListener("data",n),e.removeListener("drain",o),r.removeListener("end",l),r.removeListener("close",u),r.removeListener("error",c),e.removeListener("error",c),r.removeListener("end",h),r.removeListener("close",h),e.removeListener("close",h)}return s(r,"error",c),s(e,"error",c),r.on("end",h),r.on("close",h),e.on("close",h),e.emit("pipe",r),e},t.exports={Stream:o,prependListener:s}}),It=o((e,t)=>{l(),tt(),Fe();var r,{SymbolDispose:n}=rt(),{AbortError:i,codes:o}=it(),{isNodeStream:s,isWebStream:a,kControllerErrorFunction:u}=_t(),c=St(),{ERR_INVALID_ARG_TYPE:h}=o;t.exports.addAbortSignal=function(e,r){if(((e,t)=>{if("object"!=typeof e||!("aborted"in e))throw new h(t,"AbortSignal",e)})(e,"signal"),!s(r)&&!a(r))throw new h("stream",["ReadableStream","WritableStream","Stream"],r);return t.exports.addAbortSignalNoValidate(e,r)},t.exports.addAbortSignalNoValidate=function(e,t){if("object"!=typeof e||!("aborted"in e))return t;let o=s(t)?()=>{t.destroy(new i(void 0,{cause:e.reason}))}:()=>{t[u](new i(void 0,{cause:e.reason}))};if(e.aborted)o();else{let i=(r=r||mt().addAbortListener)(e,o);c(t,i[n])}return t}}),kt=o((e,t)=>{l(),tt(),Fe();var{StringPrototypeSlice:r,SymbolIterator:n,TypedArrayPrototypeSet:i,Uint8Array:o}=rt(),{Buffer:s}=(et(),a(Qe)),{inspect:u}=mt();t.exports=class{constructor(){this.head=null,this.tail=null,this.length=0}push(e){let t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length}unshift(e){let t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length}shift(){if(0===this.length)return;let e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}clear(){this.head=this.tail=null,this.length=0}join(e){if(0===this.length)return"";let t=this.head,r=""+t.data;for(;null!==(t=t.next);)r+=e+t.data;return r}concat(e){if(0===this.length)return s.alloc(0);let t=s.allocUnsafe(e>>>0),r=this.head,n=0;for(;r;)i(t,r.data,n),n+=r.data.length,r=r.next;return t}consume(e,t){let r=this.head.data;if(e<r.length){let t=r.slice(0,e);return this.head.data=r.slice(e),t}return e===r.length?this.shift():t?this._getString(e):this._getBuffer(e)}first(){return this.head.data}*[n](){for(let e=this.head;e;e=e.next)yield e.data}_getString(e){let t="",n=this.head,i=0;do{let o=n.data;if(!(e>o.length)){e===o.length?(t+=o,++i,n.next?this.head=n.next:this.head=this.tail=null):(t+=r(o,0,e),this.head=n,n.data=r(o,e));break}t+=o,e-=o.length,++i}while(null!==(n=n.next));return this.length-=i,t}_getBuffer(e){let t=s.allocUnsafe(e),r=e,n=this.head,a=0;do{let s=n.data;if(!(e>s.length)){e===s.length?(i(t,s,r-e),++a,n.next?this.head=n.next:this.head=this.tail=null):(i(t,new o(s.buffer,s.byteOffset,e),r-e),this.head=n,n.data=s.slice(e));break}i(t,s,r-e),e-=s.length,++a}while(null!==(n=n.next));return this.length-=a,t}[Symbol.for("nodejs.util.inspect.custom")](e,t){return u(this,{...t,depth:0,customInspect:!1})}}}),Ot=o((e,t)=>{l(),tt(),Fe();var{MathFloor:r,NumberIsInteger:n}=rt(),{validateInteger:i}=wt(),{ERR_INVALID_ARG_VALUE:o}=it().codes,s=16384,a=16;function u(e){return e?a:s}t.exports={getHighWaterMark:function(e,t,i,s){let a=function(e,t,r){return null!=e.highWaterMark?e.highWaterMark:t?e[r]:null}(t,s,i);if(null!=a){if(!n(a)||a<0){throw new o(s?`options.${i}`:"options.highWaterMark",a)}return r(a)}return u(e.objectMode)},getDefaultHighWaterMark:u,setDefaultHighWaterMark:function(e,t){i(t,"value",0),e?a=t:s=t}}}),xt=o((e,t)=>{l(),tt(),Fe();var r=(et(),a(Qe)),n=r.Buffer;function i(e,t){for(var r in e)t[r]=e[r]}function o(e,t,r){return n(e,t,r)}n.from&&n.alloc&&n.allocUnsafe&&n.allocUnsafeSlow?t.exports=r:(i(r,e),e.Buffer=o),o.prototype=Object.create(n.prototype),i(n,o),o.from=function(e,t,r){if("number"==typeof e)throw new TypeError("Argument must not be a number");return n(e,t,r)},o.alloc=function(e,t,r){if("number"!=typeof e)throw new TypeError("Argument must be a number");var i=n(e);return void 0!==t?"string"==typeof r?i.fill(t,r):i.fill(t):i.fill(0),i},o.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return n(e)},o.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r.SlowBuffer(e)}}),Pt=o(e=>{l(),tt(),Fe();var t=xt().Buffer,r=t.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function n(e){var n;switch(this.encoding=function(e){var n=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof n&&(t.isEncoding===r||!r(e)))throw new Error("Unknown encoding: "+e);return n||e}(e),this.encoding){case"utf16le":this.text=s,this.end=a,n=4;break;case"utf8":this.fillLast=o,n=4;break;case"base64":this.text=u,this.end=c,n=3;break;default:return this.write=h,void(this.end=f)}this.lastNeed=0,this.lastTotal=0,this.lastChar=t.allocUnsafe(n)}function i(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function o(e){var t=this.lastTotal-this.lastNeed,r=function(e,t){if(128!=(192&t[0]))return e.lastNeed=0,"�";if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"�";if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,"�"}}(this,e);return void 0!==r?r:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function s(e,t){if((e.length-t)%2==0){var r=e.toString("utf16le",t);if(r){var n=r.charCodeAt(r.length-1);if(n>=55296&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function a(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,r)}return t}function u(e,t){var r=(e.length-t)%3;return 0===r?e.toString("base64",t):(this.lastNeed=3-r,this.lastTotal=3,1===r?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-r))}function c(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function h(e){return e.toString(this.encoding)}function f(e){return e&&e.length?this.write(e):""}e.StringDecoder=n,n.prototype.write=function(e){if(0===e.length)return"";var t,r;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<e.length?t?t+this.text(e,r):this.text(e,r):t||""},n.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"�":t},n.prototype.text=function(e,t){var r=function(e,t,r){var n=t.length-1;if(n<r)return 0;var o=i(t[n]);return o>=0?(o>0&&(e.lastNeed=o-1),o):--n<r||-2===o?0:(o=i(t[n]),o>=0?(o>0&&(e.lastNeed=o-2),o):--n<r||-2===o?0:(o=i(t[n]),o>=0?(o>0&&(2===o?o=0:e.lastNeed=o-3),o):0))}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=r;var n=e.length-(r-this.lastNeed);return e.copy(this.lastChar,0,n),e.toString("utf8",t,n)},n.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}}),Tt=o((e,t)=>{l(),tt(),Fe();var r=vt(),{PromisePrototypeThen:n,SymbolAsyncIterator:i,SymbolIterator:o}=rt(),{Buffer:s}=(et(),a(Qe)),{ERR_INVALID_ARG_TYPE:u,ERR_STREAM_NULL_VALUES:c}=it().codes;t.exports=function(e,t,a){let l,h;if("string"==typeof t||t instanceof s)return new e({objectMode:!0,...a,read(){this.push(t),this.push(null)}});if(t&&t[i])h=!0,l=t[i]();else{if(!t||!t[o])throw new u("iterable",["Iterable"],t);h=!1,l=t[o]()}let f=new e({objectMode:!0,highWaterMark:1,...a}),p=!1;return f._read=function(){p||(p=!0,async function(){for(;;){try{let{value:e,done:t}=h?await l.next():l.next();if(t)f.push(null);else{let t=e&&"function"==typeof e.then?await e:e;if(null===t)throw p=!1,new c;if(f.push(t))continue;p=!1}}catch(e){f.destroy(e)}break}}())},f._destroy=function(e,t){n(async function(e){let t=null!=e,r="function"==typeof l.throw;if(t&&r){let{value:t,done:r}=await l.throw(e);if(await t,r)return}if("function"==typeof l.return){let{value:e}=await l.return();await e}}(e),()=>r.nextTick(t,e),n=>r.nextTick(t,n||e))},f}}),Rt=o((e,t)=>{l(),tt(),Fe();var r=vt(),{ArrayPrototypeIndexOf:n,NumberIsInteger:i,NumberIsNaN:o,NumberParseInt:s,ObjectDefineProperties:u,ObjectKeys:c,ObjectSetPrototypeOf:h,Promise:f,SafeSet:p,SymbolAsyncDispose:d,SymbolAsyncIterator:y,Symbol:g}=rt();t.exports=G,G.ReadableState=K;var{EventEmitter:b}=(bt(),a(st)),{Stream:m,prependListener:w}=At(),{Buffer:v}=(et(),a(Qe)),{addAbortSignal:_}=It(),S=St(),E=mt().debuglog("stream",e=>{E=e}),A=kt(),I=Et(),{getHighWaterMark:k,getDefaultHighWaterMark:O}=Ot(),{aggregateTwoErrors:x,codes:{ERR_INVALID_ARG_TYPE:P,ERR_METHOD_NOT_IMPLEMENTED:T,ERR_OUT_OF_RANGE:R,ERR_STREAM_PUSH_AFTER_EOF:C,ERR_STREAM_UNSHIFT_AFTER_END_EVENT:j},AbortError:M}=it(),{validateObject:B}=wt(),N=g("kPaused"),{StringDecoder:U}=Pt(),L=Tt();h(G.prototype,m.prototype),h(G,m);var D=()=>{},{errorOrDestroy:F}=I,W=1,q=16,$=32,H=2048,V=4096;function z(e){return{enumerable:!1,get(){return 0!==(this.state&e)},set(t){t?this.state|=e:this.state&=~e}}}function K(e,t,r){"boolean"!=typeof r&&(r=t instanceof Mt()),this.state=H|V|q|$,e&&e.objectMode&&(this.state|=W),r&&e&&e.readableObjectMode&&(this.state|=W),this.highWaterMark=e?k(this,e,"readableHighWaterMark",r):O(!1),this.buffer=new A,this.length=0,this.pipes=[],this.flowing=null,this[N]=null,e&&!1===e.emitClose&&(this.state&=~H),e&&!1===e.autoDestroy&&(this.state&=~V),this.errored=null,this.defaultEncoding=e&&e.defaultEncoding||"utf8",this.awaitDrainWriters=null,this.decoder=null,this.encoding=null,e&&e.encoding&&(this.decoder=new U(e.encoding),this.encoding=e.encoding)}function G(e){if(!(this instanceof G))return new G(e);let t=this instanceof Mt();this._readableState=new K(e,this,t),e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.construct&&(this._construct=e.construct),e.signal&&!t&&_(e.signal,this)),m.call(this,e),I.construct(this,()=>{this._readableState.needReadable&&te(this,this._readableState)})}function Q(e,t,r,n){E("readableAddChunk",t);let i,o=e._readableState;if(0===(o.state&W)&&("string"==typeof t?(r=r||o.defaultEncoding,o.encoding!==r&&(n&&o.encoding?t=v.from(t,r).toString(o.encoding):(t=v.from(t,r),r=""))):t instanceof v?r="":m._isUint8Array(t)?(t=m._uint8ArrayToBuffer(t),r=""):null!=t&&(i=new P("chunk",["string","Buffer","Uint8Array"],t))),i)F(e,i);else if(null===t)o.state&=-9,function(e,t){if(E("onEofChunk"),!t.ended){if(t.decoder){let e=t.decoder.end();e&&e.length&&(t.buffer.push(e),t.length+=t.objectMode?1:e.length)}t.ended=!0,t.sync?Z(e):(t.needReadable=!1,t.emittedReadable=!0,ee(e))}}(e,o);else if(0!==(o.state&W)||t&&t.length>0)if(n)if(4&o.state)F(e,new j);else{if(o.destroyed||o.errored)return!1;Y(e,o,t,!0)}else if(o.ended)F(e,new C);else{if(o.destroyed||o.errored)return!1;o.state&=-9,o.decoder&&!r?(t=o.decoder.write(t),o.objectMode||0!==t.length?Y(e,o,t,!1):te(e,o)):Y(e,o,t,!1)}else n||(o.state&=-9,te(e,o));return!o.ended&&(o.length<o.highWaterMark||0===o.length)}function Y(e,t,r,n){t.flowing&&0===t.length&&!t.sync&&e.listenerCount("data")>0?(65536&t.state?t.awaitDrainWriters.clear():t.awaitDrainWriters=null,t.dataEmitted=!0,e.emit("data",r)):(t.length+=t.objectMode?1:r.length,n?t.buffer.unshift(r):t.buffer.push(r),!!(64&t.state)&&Z(e)),te(e,t)}u(K.prototype,{objectMode:z(W),ended:z(2),endEmitted:z(4),reading:z(8),constructed:z(q),sync:z($),needReadable:z(64),emittedReadable:z(128),readableListening:z(256),resumeScheduled:z(512),errorEmitted:z(1024),emitClose:z(H),autoDestroy:z(V),destroyed:z(8192),closed:z(16384),closeEmitted:z(32768),multiAwaitDrain:z(65536),readingMore:z(1<<17),dataEmitted:z(1<<18)}),G.prototype.destroy=I.destroy,G.prototype._undestroy=I.undestroy,G.prototype._destroy=function(e,t){t(e)},G.prototype[b.captureRejectionSymbol]=function(e){this.destroy(e)},G.prototype[d]=function(){let e;return this.destroyed||(e=this.readableEnded?null:new M,this.destroy(e)),new f((t,r)=>S(this,n=>n&&n!==e?r(n):t(null)))},G.prototype.push=function(e,t){return Q(this,e,t,!1)},G.prototype.unshift=function(e,t){return Q(this,e,t,!0)},G.prototype.isPaused=function(){let e=this._readableState;return!0===e[N]||!1===e.flowing},G.prototype.setEncoding=function(e){let t=new U(e);this._readableState.decoder=t,this._readableState.encoding=this._readableState.decoder.encoding;let r=this._readableState.buffer,n="";for(let e of r)n+=t.write(e);return r.clear(),""!==n&&r.push(n),this._readableState.length=n.length,this};var J;function X(e,t){return e<=0||0===t.length&&t.ended?0:0!==(t.state&W)?1:o(e)?t.flowing&&t.length?t.buffer.first().length:t.length:e<=t.length?e:t.ended?t.length:0}function Z(e){let t=e._readableState;E("emitReadable",t.needReadable,t.emittedReadable),t.needReadable=!1,t.emittedReadable||(E("emitReadable",t.flowing),t.emittedReadable=!0,r.nextTick(ee,e))}function ee(e){let t=e._readableState;E("emitReadable_",t.destroyed,t.length,t.ended),!t.destroyed&&!t.errored&&(t.length||t.ended)&&(e.emit("readable"),t.emittedReadable=!1),t.needReadable=!t.flowing&&!t.ended&&t.length<=t.highWaterMark,se(e)}function te(e,t){!t.readingMore&&t.constructed&&(t.readingMore=!0,r.nextTick(re,e,t))}function re(e,t){for(;!t.reading&&!t.ended&&(t.length<t.highWaterMark||t.flowing&&0===t.length);){let r=t.length;if(E("maybeReadMore read 0"),e.read(0),r===t.length)break}t.readingMore=!1}function ne(e){let t=e._readableState;t.readableListening=e.listenerCount("readable")>0,t.resumeScheduled&&!1===t[N]?t.flowing=!0:e.listenerCount("data")>0?e.resume():t.readableListening||(t.flowing=null)}function ie(e){E("readable nexttick read 0"),e.read(0)}function oe(e,t){E("resume",t.reading),t.reading||e.read(0),t.resumeScheduled=!1,e.emit("resume"),se(e),t.flowing&&!t.reading&&e.read(0)}function se(e){let t=e._readableState;for(E("flow",t.flowing);t.flowing&&null!==e.read(););}function ae(e,t){"function"!=typeof e.read&&(e=G.wrap(e,{objectMode:!0}));let r=async function*(e,t){let r=D;function n(t){this===e?(r(),r=D):r=t}e.on("readable",n);let i,o=S(e,{writable:!1},e=>{i=e?x(i,e):null,r(),r=D});try{for(;;){let t=e.destroyed?null:e.read();if(null!==t)yield t;else{if(i)throw i;if(null===i)return;await new f(n)}}}catch(e){throw i=x(i,e),i}finally{!i&&!1===t?.destroyOnReturn||void 0!==i&&!e._readableState.autoDestroy?(e.off("readable",n),o()):I.destroyer(e,null)}}(e,t);return r.stream=e,r}function le(e,t){if(0===t.length)return null;let r;return t.objectMode?r=t.buffer.shift():!e||e>=t.length?(r=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.first():t.buffer.concat(t.length),t.buffer.clear()):r=t.buffer.consume(e,t.decoder),r}function ue(e){let t=e._readableState;E("endReadable",t.endEmitted),t.endEmitted||(t.ended=!0,r.nextTick(ce,t,e))}function ce(e,t){if(E("endReadableNT",e.endEmitted,e.length),!e.errored&&!e.closeEmitted&&!e.endEmitted&&0===e.length)if(e.endEmitted=!0,t.emit("end"),t.writable&&!1===t.allowHalfOpen)r.nextTick(he,t);else if(e.autoDestroy){let e=t._writableState;(!e||e.autoDestroy&&(e.finished||!1===e.writable))&&t.destroy()}}function he(e){e.writable&&!e.writableEnded&&!e.destroyed&&e.end()}function fe(){return void 0===J&&(J={}),J}G.prototype.read=function(e){E("read",e),void 0===e?e=NaN:i(e)||(e=s(e,10));let t=this._readableState,r=e;if(e>t.highWaterMark&&(t.highWaterMark=function(e){if(e>1073741824)throw new R("size","<= 1GiB",e);return e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,++e}(e)),0!==e&&(t.state&=-129),0===e&&t.needReadable&&((0!==t.highWaterMark?t.length>=t.highWaterMark:t.length>0)||t.ended))return E("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?ue(this):Z(this),null;if(0===(e=X(e,t))&&t.ended)return 0===t.length&&ue(this),null;let n,o=!!(64&t.state);if(E("need readable",o),(0===t.length||t.length-e<t.highWaterMark)&&(o=!0,E("length less than watermark",o)),t.ended||t.reading||t.destroyed||t.errored||!t.constructed)o=!1,E("reading, ended or constructing",o);else if(o){E("do read"),t.state|=8|$,0===t.length&&(t.state|=64);try{this._read(t.highWaterMark)}catch(e){F(this,e)}t.state&=~$,t.reading||(e=X(r,t))}return n=e>0?le(e,t):null,null===n?(t.needReadable=t.length<=t.highWaterMark,e=0):(t.length-=e,t.multiAwaitDrain?t.awaitDrainWriters.clear():t.awaitDrainWriters=null),0===t.length&&(t.ended||(t.needReadable=!0),r!==e&&t.ended&&ue(this)),null!==n&&!t.errorEmitted&&!t.closeEmitted&&(t.dataEmitted=!0,this.emit("data",n)),n},G.prototype._read=function(e){throw new T("_read()")},G.prototype.pipe=function(e,t){let n=this,i=this._readableState;1===i.pipes.length&&(i.multiAwaitDrain||(i.multiAwaitDrain=!0,i.awaitDrainWriters=new p(i.awaitDrainWriters?[i.awaitDrainWriters]:[]))),i.pipes.push(e),E("pipe count=%d opts=%j",i.pipes.length,t);let o=t&&!1===t.end||e===r.stdout||e===r.stderr?g:a;function s(t,r){E("onunpipe"),t===n&&r&&!1===r.hasUnpiped&&(r.hasUnpiped=!0,E("cleanup"),e.removeListener("close",d),e.removeListener("finish",y),l&&e.removeListener("drain",l),e.removeListener("error",f),e.removeListener("unpipe",s),n.removeListener("end",a),n.removeListener("end",g),n.removeListener("data",h),u=!0,l&&i.awaitDrainWriters&&(!e._writableState||e._writableState.needDrain)&&l())}function a(){E("onend"),e.end()}i.endEmitted?r.nextTick(o):n.once("end",o),e.on("unpipe",s);let l,u=!1;function c(){u||(1===i.pipes.length&&i.pipes[0]===e?(E("false write response, pause",0),i.awaitDrainWriters=e,i.multiAwaitDrain=!1):i.pipes.length>1&&i.pipes.includes(e)&&(E("false write response, pause",i.awaitDrainWriters.size),i.awaitDrainWriters.add(e)),n.pause()),l||(l=function(e,t){return function(){let r=e._readableState;r.awaitDrainWriters===t?(E("pipeOnDrain",1),r.awaitDrainWriters=null):r.multiAwaitDrain&&(E("pipeOnDrain",r.awaitDrainWriters.size),r.awaitDrainWriters.delete(t)),(!r.awaitDrainWriters||0===r.awaitDrainWriters.size)&&e.listenerCount("data")&&e.resume()}}(n,e),e.on("drain",l))}function h(t){E("ondata");let r=e.write(t);E("dest.write",r),!1===r&&c()}function f(t){if(E("onerror",t),g(),e.removeListener("error",f),0===e.listenerCount("error")){let r=e._writableState||e._readableState;r&&!r.errorEmitted?F(e,t):e.emit("error",t)}}function d(){e.removeListener("finish",y),g()}function y(){E("onfinish"),e.removeListener("close",d),g()}function g(){E("unpipe"),n.unpipe(e)}return n.on("data",h),w(e,"error",f),e.once("close",d),e.once("finish",y),e.emit("pipe",n),!0===e.writableNeedDrain?c():i.flowing||(E("pipe resume"),n.resume()),e},G.prototype.unpipe=function(e){let t=this._readableState;if(0===t.pipes.length)return this;if(!e){let e=t.pipes;t.pipes=[],this.pause();for(let t=0;t<e.length;t++)e[t].emit("unpipe",this,{hasUnpiped:!1});return this}let r=n(t.pipes,e);return-1===r||(t.pipes.splice(r,1),0===t.pipes.length&&this.pause(),e.emit("unpipe",this,{hasUnpiped:!1})),this},G.prototype.on=function(e,t){let n=m.prototype.on.call(this,e,t),i=this._readableState;return"data"===e?(i.readableListening=this.listenerCount("readable")>0,!1!==i.flowing&&this.resume()):"readable"===e&&!i.endEmitted&&!i.readableListening&&(i.readableListening=i.needReadable=!0,i.flowing=!1,i.emittedReadable=!1,E("on readable",i.length,i.reading),i.length?Z(this):i.reading||r.nextTick(ie,this)),n},G.prototype.addListener=G.prototype.on,G.prototype.removeListener=function(e,t){let n=m.prototype.removeListener.call(this,e,t);return"readable"===e&&r.nextTick(ne,this),n},G.prototype.off=G.prototype.removeListener,G.prototype.removeAllListeners=function(e){let t=m.prototype.removeAllListeners.apply(this,arguments);return("readable"===e||void 0===e)&&r.nextTick(ne,this),t},G.prototype.resume=function(){let e=this._readableState;return e.flowing||(E("resume"),e.flowing=!e.readableListening,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,r.nextTick(oe,e,t))}(this,e)),e[N]=!1,this},G.prototype.pause=function(){return E("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(E("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState[N]=!0,this},G.prototype.wrap=function(e){let t=!1;e.on("data",r=>{!this.push(r)&&e.pause&&(t=!0,e.pause())}),e.on("end",()=>{this.push(null)}),e.on("error",e=>{F(this,e)}),e.on("close",()=>{this.destroy()}),e.on("destroy",()=>{this.destroy()}),this._read=()=>{t&&e.resume&&(t=!1,e.resume())};let r=c(e);for(let t=1;t<r.length;t++){let n=r[t];void 0===this[n]&&"function"==typeof e[n]&&(this[n]=e[n].bind(e))}return this},G.prototype[y]=function(){return ae(this)},G.prototype.iterator=function(e){return void 0!==e&&B(e,"options"),ae(this,e)},u(G.prototype,{readable:{__proto__:null,get(){let e=this._readableState;return!(!e||!1===e.readable||e.destroyed||e.errorEmitted||e.endEmitted)},set(e){this._readableState&&(this._readableState.readable=!!e)}},readableDidRead:{__proto__:null,enumerable:!1,get:function(){return this._readableState.dataEmitted}},readableAborted:{__proto__:null,enumerable:!1,get:function(){return!(!1===this._readableState.readable||!this._readableState.destroyed&&!this._readableState.errored||this._readableState.endEmitted)}},readableHighWaterMark:{__proto__:null,enumerable:!1,get:function(){return this._readableState.highWaterMark}},readableBuffer:{__proto__:null,enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}},readableFlowing:{__proto__:null,enumerable:!1,get:function(){return this._readableState.flowing},set:function(e){this._readableState&&(this._readableState.flowing=e)}},readableLength:{__proto__:null,enumerable:!1,get(){return this._readableState.length}},readableObjectMode:{__proto__:null,enumerable:!1,get(){return!!this._readableState&&this._readableState.objectMode}},readableEncoding:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.encoding:null}},errored:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.errored:null}},closed:{__proto__:null,get(){return!!this._readableState&&this._readableState.closed}},destroyed:{__proto__:null,enumerable:!1,get(){return!!this._readableState&&this._readableState.destroyed},set(e){this._readableState&&(this._readableState.destroyed=e)}},readableEnded:{__proto__:null,enumerable:!1,get(){return!!this._readableState&&this._readableState.endEmitted}}}),u(K.prototype,{pipesCount:{__proto__:null,get(){return this.pipes.length}},paused:{__proto__:null,get(){return!1!==this[N]},set(e){this[N]=!!e}}}),G._fromList=le,G.from=function(e,t){return L(G,e,t)},G.fromWeb=function(e,t){return fe().newStreamReadableFromReadableStream(e,t)},G.toWeb=function(e,t){return fe().newReadableStreamFromStreamReadable(e,t)},G.wrap=function(e,t){var r,n;return new G({objectMode:null===(r=null!==(n=e.readableObjectMode)&&void 0!==n?n:e.objectMode)||void 0===r||r,...t,destroy(t,r){I.destroyer(e,t),r(t)}}).wrap(e)}}),Ct=o((e,t)=>{l(),tt(),Fe();var r=vt(),{ArrayPrototypeSlice:n,Error:i,FunctionPrototypeSymbolHasInstance:o,ObjectDefineProperty:s,ObjectDefineProperties:u,ObjectSetPrototypeOf:c,StringPrototypeToLowerCase:h,Symbol:f,SymbolHasInstance:p}=rt();t.exports=B,B.WritableState=j;var{EventEmitter:d}=(bt(),a(st)),y=At().Stream,{Buffer:g}=(et(),a(Qe)),b=Et(),{addAbortSignal:m}=It(),{getHighWaterMark:w,getDefaultHighWaterMark:v}=Ot(),{ERR_INVALID_ARG_TYPE:_,ERR_METHOD_NOT_IMPLEMENTED:S,ERR_MULTIPLE_CALLBACK:E,ERR_STREAM_CANNOT_PIPE:A,ERR_STREAM_DESTROYED:I,ERR_STREAM_ALREADY_FINISHED:k,ERR_STREAM_NULL_VALUES:O,ERR_STREAM_WRITE_AFTER_END:x,ERR_UNKNOWN_ENCODING:P}=it().codes,{errorOrDestroy:T}=b;function R(){}c(B.prototype,y.prototype),c(B,y);var C=f("kOnFinished");function j(e,t,r){"boolean"!=typeof r&&(r=t instanceof Mt()),this.objectMode=!(!e||!e.objectMode),r&&(this.objectMode=this.objectMode||!(!e||!e.writableObjectMode)),this.highWaterMark=e?w(this,e,"writableHighWaterMark",r):v(!1),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;let n=!(!e||!1!==e.decodeStrings);this.decodeStrings=!n,this.defaultEncoding=e&&e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=D.bind(void 0,t),this.writecb=null,this.writelen=0,this.afterWriteTickInfo=null,M(this),this.pendingcb=0,this.constructed=!0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!e||!1!==e.emitClose,this.autoDestroy=!e||!1!==e.autoDestroy,this.errored=null,this.closed=!1,this.closeEmitted=!1,this[C]=[]}function M(e){e.buffered=[],e.bufferedIndex=0,e.allBuffers=!0,e.allNoop=!0}function B(e){let t=this instanceof Mt();if(!t&&!o(B,this))return new B(e);this._writableState=new j(e,this,t),e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final),"function"==typeof e.construct&&(this._construct=e.construct),e.signal&&m(e.signal,this)),y.call(this,e),b.construct(this,()=>{let e=this._writableState;e.writing||$(this,e),z(this,e)})}function N(e,t,n,i){let o,s=e._writableState;if("function"==typeof n)i=n,n=s.defaultEncoding;else{if(n){if("buffer"!==n&&!g.isEncoding(n))throw new P(n)}else n=s.defaultEncoding;"function"!=typeof i&&(i=R)}if(null===t)throw new O;if(!s.objectMode)if("string"==typeof t)!1!==s.decodeStrings&&(t=g.from(t,n),n="buffer");else if(t instanceof g)n="buffer";else{if(!y._isUint8Array(t))throw new _("chunk",["string","Buffer","Uint8Array"],t);t=y._uint8ArrayToBuffer(t),n="buffer"}return s.ending?o=new x:s.destroyed&&(o=new I("write")),o?(r.nextTick(i,o),T(e,o,!0),o):(s.pendingcb++,function(e,t,r,n,i){let o=t.objectMode?1:r.length;t.length+=o;let s=t.length<t.highWaterMark;return s||(t.needDrain=!0),t.writing||t.corked||t.errored||!t.constructed?(t.buffered.push({chunk:r,encoding:n,callback:i}),t.allBuffers&&"buffer"!==n&&(t.allBuffers=!1),t.allNoop&&i!==R&&(t.allNoop=!1)):(t.writelen=o,t.writecb=i,t.writing=!0,t.sync=!0,e._write(r,n,t.onwrite),t.sync=!1),s&&!t.errored&&!t.destroyed}(e,s,t,n,i))}function U(e,t,r,n,i,o,s){t.writelen=n,t.writecb=s,t.writing=!0,t.sync=!0,t.destroyed?t.onwrite(new I("write")):r?e._writev(i,t.onwrite):e._write(i,o,t.onwrite),t.sync=!1}function L(e,t,r,n){--t.pendingcb,n(r),q(t),T(e,r)}function D(e,t){let n=e._writableState,i=n.sync,o=n.writecb;"function"==typeof o?(n.writing=!1,n.writecb=null,n.length-=n.writelen,n.writelen=0,t?(t.stack,n.errored||(n.errored=t),e._readableState&&!e._readableState.errored&&(e._readableState.errored=t),i?r.nextTick(L,e,n,t,o):L(e,n,t,o)):(n.buffered.length>n.bufferedIndex&&$(e,n),i?null!==n.afterWriteTickInfo&&n.afterWriteTickInfo.cb===o?n.afterWriteTickInfo.count++:(n.afterWriteTickInfo={count:1,cb:o,stream:e,state:n},r.nextTick(F,n.afterWriteTickInfo)):W(e,n,1,o))):T(e,new E)}function F({stream:e,state:t,count:r,cb:n}){return t.afterWriteTickInfo=null,W(e,t,r,n)}function W(e,t,r,n){for(!t.ending&&!e.destroyed&&0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"));r-- >0;)t.pendingcb--,n();t.destroyed&&q(t),z(e,t)}function q(e){if(e.writing)return;for(let r=e.bufferedIndex;r<e.buffered.length;++r){var t;let{chunk:n,callback:i}=e.buffered[r],o=e.objectMode?1:n.length;e.length-=o,i(null!==(t=e.errored)&&void 0!==t?t:new I("write"))}let r=e[C].splice(0);for(let t=0;t<r.length;t++){var n;r[t](null!==(n=e.errored)&&void 0!==n?n:new I("end"))}M(e)}function $(e,t){if(t.corked||t.bufferProcessing||t.destroyed||!t.constructed)return;let{buffered:r,bufferedIndex:i,objectMode:o}=t,s=r.length-i;if(!s)return;let a=i;if(t.bufferProcessing=!0,s>1&&e._writev){t.pendingcb-=s-1;let i=t.allNoop?R:e=>{for(let t=a;t<r.length;++t)r[t].callback(e)},o=t.allNoop&&0===a?r:n(r,a);o.allBuffers=t.allBuffers,U(e,t,!0,t.length,o,"",i),M(t)}else{do{let{chunk:n,encoding:i,callback:s}=r[a];r[a++]=null,U(e,t,!1,o?1:n.length,n,i,s)}while(a<r.length&&!t.writing);a===r.length?M(t):a>256?(r.splice(0,a),t.bufferedIndex=0):t.bufferedIndex=a}t.bufferProcessing=!1}function H(e){return e.ending&&!e.destroyed&&e.constructed&&0===e.length&&!e.errored&&0===e.buffered.length&&!e.finished&&!e.writing&&!e.errorEmitted&&!e.closeEmitted}function V(e,t){!t.prefinished&&!t.finalCalled&&("function"!=typeof e._final||t.destroyed?(t.prefinished=!0,e.emit("prefinish")):(t.finalCalled=!0,function(e,t){let n=!1;function i(i){if(n)T(e,i??E());else if(n=!0,t.pendingcb--,i){let r=t[C].splice(0);for(let e=0;e<r.length;e++)r[e](i);T(e,i,t.sync)}else H(t)&&(t.prefinished=!0,e.emit("prefinish"),t.pendingcb++,r.nextTick(K,e,t))}t.sync=!0,t.pendingcb++;try{e._final(i)}catch(e){i(e)}t.sync=!1}(e,t)))}function z(e,t,n){H(t)&&(V(e,t),0===t.pendingcb&&(n?(t.pendingcb++,r.nextTick((e,t)=>{H(t)?K(e,t):t.pendingcb--},e,t)):H(t)&&(t.pendingcb++,K(e,t))))}function K(e,t){t.pendingcb--,t.finished=!0;let r=t[C].splice(0);for(let e=0;e<r.length;e++)r[e]();if(e.emit("finish"),t.autoDestroy){let t=e._readableState;(!t||t.autoDestroy&&(t.endEmitted||!1===t.readable))&&e.destroy()}}j.prototype.getBuffer=function(){return n(this.buffered,this.bufferedIndex)},s(j.prototype,"bufferedRequestCount",{__proto__:null,get(){return this.buffered.length-this.bufferedIndex}}),s(B,p,{__proto__:null,value:function(e){return!!o(this,e)||this===B&&(e&&e._writableState instanceof j)}}),B.prototype.pipe=function(){T(this,new A)},B.prototype.write=function(e,t,r){return!0===N(this,e,t,r)},B.prototype.cork=function(){this._writableState.corked++},B.prototype.uncork=function(){let e=this._writableState;e.corked&&(e.corked--,e.writing||$(this,e))},B.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=h(e)),!g.isEncoding(e))throw new P(e);return this._writableState.defaultEncoding=e,this},B.prototype._write=function(e,t,r){if(!this._writev)throw new S("_write()");this._writev([{chunk:e,encoding:t}],r)},B.prototype._writev=null,B.prototype.end=function(e,t,n){let o,s=this._writableState;if("function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),null!=e){let r=N(this,e,t);r instanceof i&&(o=r)}return s.corked&&(s.corked=1,this.uncork()),o||(s.errored||s.ending?s.finished?o=new k("end"):s.destroyed&&(o=new I("end")):(s.ending=!0,z(this,s,!0),s.ended=!0)),"function"==typeof n&&(o||s.finished?r.nextTick(n,o):s[C].push(n)),this},u(B.prototype,{closed:{__proto__:null,get(){return!!this._writableState&&this._writableState.closed}},destroyed:{__proto__:null,get(){return!!this._writableState&&this._writableState.destroyed},set(e){this._writableState&&(this._writableState.destroyed=e)}},writable:{__proto__:null,get(){let e=this._writableState;return!(!e||!1===e.writable||e.destroyed||e.errored||e.ending||e.ended)},set(e){this._writableState&&(this._writableState.writable=!!e)}},writableFinished:{__proto__:null,get(){return!!this._writableState&&this._writableState.finished}},writableObjectMode:{__proto__:null,get(){return!!this._writableState&&this._writableState.objectMode}},writableBuffer:{__proto__:null,get(){return this._writableState&&this._writableState.getBuffer()}},writableEnded:{__proto__:null,get(){return!!this._writableState&&this._writableState.ending}},writableNeedDrain:{__proto__:null,get(){let e=this._writableState;return!!e&&(!e.destroyed&&!e.ending&&e.needDrain)}},writableHighWaterMark:{__proto__:null,get(){return this._writableState&&this._writableState.highWaterMark}},writableCorked:{__proto__:null,get(){return this._writableState?this._writableState.corked:0}},writableLength:{__proto__:null,get(){return this._writableState&&this._writableState.length}},errored:{__proto__:null,enumerable:!1,get(){return this._writableState?this._writableState.errored:null}},writableAborted:{__proto__:null,enumerable:!1,get:function(){return!(!1===this._writableState.writable||!this._writableState.destroyed&&!this._writableState.errored||this._writableState.finished)}}});var G,Q=b.destroy;function Y(){return void 0===G&&(G={}),G}B.prototype.destroy=function(e,t){let n=this._writableState;return!n.destroyed&&(n.bufferedIndex<n.buffered.length||n[C].length)&&r.nextTick(q,n),Q.call(this,e,t),this},B.prototype._undestroy=b.undestroy,B.prototype._destroy=function(e,t){t(e)},B.prototype[d.captureRejectionSymbol]=function(e){this.destroy(e)},B.fromWeb=function(e,t){return Y().newStreamWritableFromWritableStream(e,t)},B.toWeb=function(e){return Y().newWritableStreamFromStreamWritable(e)}}),jt=o((e,t)=>{l(),tt(),Fe();var r=vt(),n=(et(),a(Qe)),{isReadable:i,isWritable:o,isIterable:s,isNodeStream:u,isReadableNodeStream:c,isWritableNodeStream:h,isDuplexNodeStream:f,isReadableStream:p,isWritableStream:d}=_t(),y=St(),{AbortError:g,codes:{ERR_INVALID_ARG_TYPE:b,ERR_INVALID_RETURN_VALUE:m}}=it(),{destroyer:w}=Et(),v=Mt(),_=Rt(),S=Ct(),{createDeferredPromise:E}=mt(),A=Tt(),I=globalThis.Blob||n.Blob,k=typeof I<"u"?function(e){return e instanceof I}:function(e){return!1},O=globalThis.AbortController||ot().AbortController,{FunctionPrototypeCall:x}=rt(),P=class extends v{constructor(e){super(e),!1===e?.readable&&(this._readableState.readable=!1,this._readableState.ended=!0,this._readableState.endEmitted=!0),!1===e?.writable&&(this._writableState.writable=!1,this._writableState.ending=!0,this._writableState.ended=!0,this._writableState.finished=!0)}};function T(e){let t,r,n,s,a,l=e.readable&&"function"!=typeof e.readable.read?_.wrap(e.readable):e.readable,u=e.writable,c=!!i(l),h=!!o(u);function f(e){let t=s;s=null,t?t(e):e&&a.destroy(e)}return a=new P({readableObjectMode:!(null==l||!l.readableObjectMode),writableObjectMode:!(null==u||!u.writableObjectMode),readable:c,writable:h}),h&&(y(u,e=>{h=!1,e&&w(l,e),f(e)}),a._write=function(e,r,n){u.write(e,r)?n():t=n},a._final=function(e){u.end(),r=e},u.on("drain",function(){if(t){let e=t;t=null,e()}}),u.on("finish",function(){if(r){let e=r;r=null,e()}})),c&&(y(l,e=>{c=!1,e&&w(l,e),f(e)}),l.on("readable",function(){if(n){let e=n;n=null,e()}}),l.on("end",function(){a.push(null)}),a._read=function(){for(;;){let e=l.read();if(null===e)return void(n=a._read);if(!a.push(e))return}}),a._destroy=function(e,i){!e&&null!==s&&(e=new g),n=null,t=null,r=null,null===s?i(e):(s=i,w(u,e),w(l,e))},a}t.exports=function e(t,n){if(f(t))return t;if(c(t))return T({readable:t});if(h(t))return T({writable:t});if(u(t))return T({writable:!1,readable:!1});if(p(t))return T({readable:_.fromWeb(t)});if(d(t))return T({writable:S.fromWeb(t)});if("function"==typeof t){let{value:e,write:i,final:o,destroy:a}=function(e){let{promise:t,resolve:n}=E(),i=new O,o=i.signal;return{value:e(async function*(){for(;;){let e=t;t=null;let{chunk:i,done:s,cb:a}=await e;if(r.nextTick(a),s)return;if(o.aborted)throw new g(void 0,{cause:o.reason});({promise:t,resolve:n}=E()),yield i}}(),{signal:o}),write(e,t,r){let i=n;n=null,i({chunk:e,done:!1,cb:r})},final(e){let t=n;n=null,t({done:!0,cb:e})},destroy(e,t){i.abort(),t(e)}}}(t);if(s(e))return A(P,e,{objectMode:!0,write:i,final:o,destroy:a});let l=e?.then;if("function"==typeof l){let t,n=x(l,e,e=>{if(null!=e)throw new m("nully","body",e)},e=>{w(t,e)});return t=new P({objectMode:!0,readable:!1,write:i,final(e){o(async()=>{try{await n,r.nextTick(e,null)}catch(t){r.nextTick(e,t)}})},destroy:a})}throw new m("Iterable, AsyncIterable or AsyncFunction",n,e)}if(k(t))return e(t.arrayBuffer());if(s(t))return A(P,t,{objectMode:!0,writable:!1});if(p(t?.readable)&&d(t?.writable))return P.fromWeb(t);if("object"==typeof t?.writable||"object"==typeof t?.readable){return T({readable:null!=t&&t.readable?c(t?.readable)?t?.readable:e(t.readable):void 0,writable:null!=t&&t.writable?h(t?.writable)?t?.writable:e(t.writable):void 0})}let i=t?.then;if("function"==typeof i){let e;return x(i,t,t=>{null!=t&&e.push(t),e.push(null)},t=>{w(e,t)}),e=new P({objectMode:!0,writable:!1,read(){}})}throw new b(n,["Blob","ReadableStream","WritableStream","Stream","Iterable","AsyncIterable","Function","{ readable, writable } pair","Promise"],t)}}),Mt=o((e,t)=>{l(),tt(),Fe();var{ObjectDefineProperties:r,ObjectGetOwnPropertyDescriptor:n,ObjectKeys:i,ObjectSetPrototypeOf:o}=rt();t.exports=h;var s,a,u=Rt(),c=Ct();o(h.prototype,u.prototype),o(h,u);{let e=i(c.prototype);for(let t=0;t<e.length;t++){let r=e[t];h.prototype[r]||(h.prototype[r]=c.prototype[r])}}function h(e){if(!(this instanceof h))return new h(e);u.call(this,e),c.call(this,e),e?(this.allowHalfOpen=!1!==e.allowHalfOpen,!1===e.readable&&(this._readableState.readable=!1,this._readableState.ended=!0,this._readableState.endEmitted=!0),!1===e.writable&&(this._writableState.writable=!1,this._writableState.ending=!0,this._writableState.ended=!0,this._writableState.finished=!0)):this.allowHalfOpen=!0}function f(){return void 0===s&&(s={}),s}r(h.prototype,{writable:{__proto__:null,...n(c.prototype,"writable")},writableHighWaterMark:{__proto__:null,...n(c.prototype,"writableHighWaterMark")},writableObjectMode:{__proto__:null,...n(c.prototype,"writableObjectMode")},writableBuffer:{__proto__:null,...n(c.prototype,"writableBuffer")},writableLength:{__proto__:null,...n(c.prototype,"writableLength")},writableFinished:{__proto__:null,...n(c.prototype,"writableFinished")},writableCorked:{__proto__:null,...n(c.prototype,"writableCorked")},writableEnded:{__proto__:null,...n(c.prototype,"writableEnded")},writableNeedDrain:{__proto__:null,...n(c.prototype,"writableNeedDrain")},destroyed:{__proto__:null,get(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set(e){this._readableState&&this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}}}),h.fromWeb=function(e,t){return f().newStreamDuplexFromReadableWritablePair(e,t)},h.toWeb=function(e){return f().newReadableWritablePairFromDuplex(e)},h.from=function(e){return a||(a=jt()),a(e,"body")}}),Bt=o((e,t)=>{l(),tt(),Fe();var{ObjectSetPrototypeOf:r,Symbol:n}=rt();t.exports=u;var{ERR_METHOD_NOT_IMPLEMENTED:i}=it().codes,o=Mt(),{getHighWaterMark:s}=Ot();r(u.prototype,o.prototype),r(u,o);var a=n("kCallback");function u(e){if(!(this instanceof u))return new u(e);let t=e?s(this,e,"readableHighWaterMark",!0):null;0===t&&(e={...e,highWaterMark:null,readableHighWaterMark:t,writableHighWaterMark:e.writableHighWaterMark||0}),o.call(this,e),this._readableState.sync=!1,this[a]=null,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",h)}function c(e){"function"!=typeof this._flush||this.destroyed?(this.push(null),e&&e()):this._flush((t,r)=>{t?e?e(t):this.destroy(t):(null!=r&&this.push(r),this.push(null),e&&e())})}function h(){this._final!==c&&c.call(this)}u.prototype._final=c,u.prototype._transform=function(e,t,r){throw new i("_transform()")},u.prototype._write=function(e,t,r){let n=this._readableState,i=this._writableState,o=n.length;this._transform(e,t,(e,t)=>{e?r(e):(null!=t&&this.push(t),i.ended||o===n.length||n.length<n.highWaterMark?r():this[a]=r)})},u.prototype._read=function(){if(this[a]){let e=this[a];this[a]=null,e()}}}),Nt=o((e,t)=>{l(),tt(),Fe();var{ObjectSetPrototypeOf:r}=rt();t.exports=i;var n=Bt();function i(e){if(!(this instanceof i))return new i(e);n.call(this,e)}r(i.prototype,n.prototype),r(i,n),i.prototype._transform=function(e,t,r){r(null,e)}}),Ut=o((e,t)=>{l(),tt(),Fe();var r,n,i,o=vt(),{ArrayIsArray:s,Promise:a,SymbolAsyncIterator:u,SymbolDispose:c}=rt(),h=St(),{once:f}=mt(),p=Et(),d=Mt(),{aggregateTwoErrors:y,codes:{ERR_INVALID_ARG_TYPE:g,ERR_INVALID_RETURN_VALUE:b,ERR_MISSING_ARGS:m,ERR_STREAM_DESTROYED:w,ERR_STREAM_PREMATURE_CLOSE:v},AbortError:_}=it(),{validateFunction:S,validateAbortSignal:E}=wt(),{isIterable:A,isReadable:I,isReadableNodeStream:k,isNodeStream:O,isTransformStream:x,isWebStream:P,isReadableStream:T,isReadableFinished:R}=_t(),C=globalThis.AbortController||ot().AbortController;function j(e,t,r){let n=!1;return e.on("close",()=>{n=!0}),{destroy:t=>{n||(n=!0,p.destroyer(e,t||new w("pipe")))},cleanup:h(e,{readable:t,writable:r},e=>{n=!e})}}function M(e){if(A(e))return e;if(k(e))return async function*(e){n||(n=Rt()),yield*n.prototype[u].call(e)}(e);throw new g("val",["Readable","Iterable","AsyncIterable"],e)}async function B(e,t,r,{end:n}){let i,o=null,s=e=>{if(e&&(i=e),o){let e=o;o=null,e()}},l=()=>new a((e,t)=>{i?t(i):o=()=>{i?t(i):e()}});t.on("drain",s);let u=h(t,{readable:!1},s);try{t.writableNeedDrain&&await l();for await(let r of e)t.write(r)||await l();n&&(t.end(),await l()),r()}catch(e){r(i!==e?y(i,e):e)}finally{u(),t.off("drain",s)}}async function N(e,t,r,{end:n}){x(t)&&(t=t.writable);let i=t.getWriter();try{for await(let t of e)await i.ready,i.write(t).catch(()=>{});await i.ready,n&&await i.close(),r()}catch(e){try{await i.abort(e),r(e)}catch(e){r(e)}}}function U(e,t,n){if(1===e.length&&s(e[0])&&(e=e[0]),e.length<2)throw new m("streams");let a,l=new C,u=l.signal,h=n?.signal,f=[];function p(){D(new _)}E(h,"options.signal"),i=i||mt().addAbortListener,h&&(a=i(h,p));let y,w,v,S=[],R=0;function U(e){D(e,0===--R)}function D(e,r){var n;if(e&&(!y||"ERR_STREAM_PREMATURE_CLOSE"===y.code)&&(y=e),y||r){for(;S.length;)S.shift()(y);null===(n=a)||void 0===n||n[c](),l.abort(),r&&(y||f.forEach(e=>e()),o.nextTick(t,y,w))}}for(let t=0;t<e.length;t++){let i=e[t],s=t<e.length-1,a=t>0,l=s||!1!==n?.end,c=t===e.length-1;if(O(i)){let e=function(e){e&&"AbortError"!==e.name&&"ERR_STREAM_PREMATURE_CLOSE"!==e.code&&U(e)};if(l){let{destroy:e,cleanup:t}=j(i,s,a);S.push(e),I(i)&&c&&f.push(t)}i.on("error",e),I(i)&&c&&f.push(()=>{i.removeListener("error",e)})}if(0===t)if("function"==typeof i){if(v=i({signal:u}),!A(v))throw new b("Iterable, AsyncIterable or Stream","source",v)}else v=A(i)||k(i)||x(i)?i:d.from(i);else if("function"==typeof i){var F;if(x(v))v=M(null===(F=v)||void 0===F?void 0:F.readable);else v=M(v);if(v=i(v,{signal:u}),s){if(!A(v,!0))throw new b("AsyncIterable",`transform[${t-1}]`,v)}else{var W;r||(r=Nt());let e=new r({objectMode:!0}),t=null===(W=v)||void 0===W?void 0:W.then;if("function"==typeof t)R++,t.call(v,t=>{w=t,null!=t&&e.write(t),l&&e.end(),o.nextTick(U)},t=>{e.destroy(t),o.nextTick(U,t)});else if(A(v,!0))R++,B(v,e,U,{end:l});else{if(!T(v)&&!x(v))throw new b("AsyncIterable or Promise","destination",v);{let t=v.readable||v;R++,B(t,e,U,{end:l})}}v=e;let{destroy:n,cleanup:i}=j(v,!1,!0);S.push(n),c&&f.push(i)}}else if(O(i)){if(k(v)){R+=2;let e=L(v,i,U,{end:l});I(i)&&c&&f.push(e)}else if(x(v)||T(v)){let e=v.readable||v;R++,B(e,i,U,{end:l})}else{if(!A(v))throw new g("val",["Readable","Iterable","AsyncIterable","ReadableStream","TransformStream"],v);R++,B(v,i,U,{end:l})}v=i}else if(P(i)){if(k(v))R++,N(M(v),i,U,{end:l});else if(T(v)||A(v))R++,N(v,i,U,{end:l});else{if(!x(v))throw new g("val",["Readable","Iterable","AsyncIterable","ReadableStream","TransformStream"],v);R++,N(v.readable,i,U,{end:l})}v=i}else v=d.from(i)}return(null!=u&&u.aborted||null!=h&&h.aborted)&&o.nextTick(p),v}function L(e,t,r,{end:n}){let i=!1;if(t.on("close",()=>{i||r(new v)}),e.pipe(t,{end:!1}),n){let r=function(){i=!0,t.end()};R(e)?o.nextTick(r):e.once("end",r)}else r();return h(e,{readable:!0,writable:!1},t=>{let n=e._readableState;t&&"ERR_STREAM_PREMATURE_CLOSE"===t.code&&n&&n.ended&&!n.errored&&!n.errorEmitted?e.once("end",r).once("error",r):r(t)}),h(t,{readable:!1,writable:!0},r)}t.exports={pipelineImpl:U,pipeline:function(...e){return U(e,f(function(e){return S(e[e.length-1],"streams[stream.length - 1]"),e.pop()}(e)))}}}),Lt=o((e,t)=>{l(),tt(),Fe();var{pipeline:r}=Ut(),n=Mt(),{destroyer:i}=Et(),{isNodeStream:o,isReadable:s,isWritable:a,isWebStream:u,isTransformStream:c,isWritableStream:h,isReadableStream:f}=_t(),{AbortError:p,codes:{ERR_INVALID_ARG_VALUE:d,ERR_MISSING_ARGS:y}}=it(),g=St();t.exports=function(...e){if(0===e.length)throw new y("streams");if(1===e.length)return n.from(e[0]);let t,l,b,m,w,v=[...e];if("function"==typeof e[0]&&(e[0]=n.from(e[0])),"function"==typeof e[e.length-1]){let t=e.length-1;e[t]=n.from(e[t])}for(let t=0;t<e.length;++t)if(o(e[t])||u(e[t])){if(t<e.length-1&&!(s(e[t])||f(e[t])||c(e[t])))throw new d(`streams[${t}]`,v[t],"must be readable");if(t>0&&!(a(e[t])||h(e[t])||c(e[t])))throw new d(`streams[${t}]`,v[t],"must be writable")}let _=e[0],S=r(e,function(e){let t=m;m=null,t?t(e):e?w.destroy(e):!A&&!E&&w.destroy()}),E=!!(a(_)||h(_)||c(_)),A=!!(s(S)||f(S)||c(S));if(w=new n({writableObjectMode:!(null==_||!_.writableObjectMode),readableObjectMode:!(null==S||!S.readableObjectMode),writable:E,readable:A}),E){if(o(_))w._write=function(e,r,n){_.write(e,r)?n():t=n},w._final=function(e){_.end(),l=e},_.on("drain",function(){if(t){let e=t;t=null,e()}});else if(u(_)){let e=(c(_)?_.writable:_).getWriter();w._write=async function(t,r,n){try{await e.ready,e.write(t).catch(()=>{}),n()}catch(e){n(e)}},w._final=async function(t){try{await e.ready,e.close().catch(()=>{}),l=t}catch(e){t(e)}}}let e=c(S)?S.readable:S;g(e,()=>{if(l){let e=l;l=null,e()}})}if(A)if(o(S))S.on("readable",function(){if(b){let e=b;b=null,e()}}),S.on("end",function(){w.push(null)}),w._read=function(){for(;;){let e=S.read();if(null===e)return void(b=w._read);if(!w.push(e))return}};else if(u(S)){let e=(c(S)?S.readable:S).getReader();w._read=async function(){for(;;)try{let{value:t,done:r}=await e.read();if(!w.push(t))return;if(r)return void w.push(null)}catch(e){return}}}return w._destroy=function(e,r){!e&&null!==m&&(e=new p),b=null,t=null,l=null,null===m?r(e):(m=r,o(S)&&i(S,e))},w}}),Dt=o((e,t)=>{l(),tt(),Fe();var r=globalThis.AbortController||ot().AbortController,{codes:{ERR_INVALID_ARG_VALUE:n,ERR_INVALID_ARG_TYPE:i,ERR_MISSING_ARGS:o,ERR_OUT_OF_RANGE:s},AbortError:a}=it(),{validateAbortSignal:u,validateInteger:c,validateObject:h}=wt(),f=rt().Symbol("kWeak"),p=rt().Symbol("kResistStopPropagation"),{finished:d}=St(),y=Lt(),{addAbortSignalNoValidate:g}=It(),{isWritable:b,isNodeStream:m}=_t(),{deprecate:w}=mt(),{ArrayPrototypePush:v,Boolean:_,MathFloor:S,Number:E,NumberIsNaN:A,Promise:I,PromiseReject:k,PromiseResolve:O,PromisePrototypeThen:x,Symbol:P}=rt(),T=P("kEmpty"),R=P("kEof");function C(e,t){if("function"!=typeof e)throw new i("fn",["Function","AsyncFunction"],e);null!=t&&h(t,"options"),null!=t?.signal&&u(t.signal,"options.signal");let r=1;null!=t?.concurrency&&(r=S(t.concurrency));let n=r-1;return null!=t?.highWaterMark&&(n=S(t.highWaterMark)),c(r,"options.concurrency",1),c(n,"options.highWaterMark",0),n+=r,async function*(){let i,o,s=mt().AbortSignalAny([t?.signal].filter(_)),l=this,u=[],c={signal:s},h=!1,f=0;function p(){h=!0,d()}function d(){f-=1,y()}function y(){o&&!h&&f<r&&u.length<n&&(o(),o=null)}!async function(){try{for await(let t of l){if(h)return;if(s.aborted)throw new a;try{if(t=e(t,c),t===T)continue;t=O(t)}catch(e){t=k(e)}f+=1,x(t,d,p),u.push(t),i&&(i(),i=null),!h&&(u.length>=n||f>=r)&&await new I(e=>{o=e})}u.push(R)}catch(e){let t=k(e);x(t,d,p),u.push(t)}finally{h=!0,i&&(i(),i=null)}}();try{for(;;){for(;u.length>0;){let e=await u[0];if(e===R)return;if(s.aborted)throw new a;e!==T&&(yield e),u.shift(),y()}await new I(e=>{i=e})}}finally{h=!0,o&&(o(),o=null)}}.call(this)}async function j(e,t=void 0){for await(let r of M.call(this,e,t))return!0;return!1}function M(e,t){if("function"!=typeof e)throw new i("fn",["Function","AsyncFunction"],e);return C.call(this,async function(t,r){return await e(t,r)?t:T},t)}var B=class extends o{constructor(){super("reduce"),this.message="Reduce of an empty stream requires an initial value"}};function N(e){if(e=E(e),A(e))return 0;if(e<0)throw new s("number",">= 0",e);return e}t.exports.streamReturningOperators={asIndexedPairs:w(function(e=void 0){return null!=e&&h(e,"options"),null!=e?.signal&&u(e.signal,"options.signal"),async function*(){let t=0;for await(let n of this){var r;if(null!=e&&null!==(r=e.signal)&&void 0!==r&&r.aborted)throw new a({cause:e.signal.reason});yield[t++,n]}}.call(this)},"readable.asIndexedPairs will be removed in a future version."),drop:function(e,t=void 0){return null!=t&&h(t,"options"),null!=t?.signal&&u(t.signal,"options.signal"),e=N(e),async function*(){var r;if(null!=t&&null!==(r=t.signal)&&void 0!==r&&r.aborted)throw new a;for await(let r of this){var n;if(null!=t&&null!==(n=t.signal)&&void 0!==n&&n.aborted)throw new a;e--<=0&&(yield r)}}.call(this)},filter:M,flatMap:function(e,t){let r=C.call(this,e,t);return async function*(){for await(let e of r)yield*e}.call(this)},map:C,take:function(e,t=void 0){return null!=t&&h(t,"options"),null!=t?.signal&&u(t.signal,"options.signal"),e=N(e),async function*(){var r;if(null!=t&&null!==(r=t.signal)&&void 0!==r&&r.aborted)throw new a;for await(let r of this){var n;if(null!=t&&null!==(n=t.signal)&&void 0!==n&&n.aborted)throw new a;if(e-- >0&&(yield r),e<=0)return}}.call(this)},compose:function(e,t){if(null!=t&&h(t,"options"),null!=t?.signal&&u(t.signal,"options.signal"),m(e)&&!b(e))throw new n("stream",e,"must be writable");let r=y(this,e);return null!=t&&t.signal&&g(t.signal,r),r}},t.exports.promiseReturningOperators={every:async function(e,t=void 0){if("function"!=typeof e)throw new i("fn",["Function","AsyncFunction"],e);return!await j.call(this,async(...t)=>!await e(...t),t)},forEach:async function(e,t){if("function"!=typeof e)throw new i("fn",["Function","AsyncFunction"],e);for await(let r of C.call(this,async function(t,r){return await e(t,r),T},t));},reduce:async function(e,t,n){var o;if("function"!=typeof e)throw new i("reducer",["Function","AsyncFunction"],e);null!=n&&h(n,"options"),null!=n?.signal&&u(n.signal,"options.signal");let s=arguments.length>1;if(null!=n&&null!==(o=n.signal)&&void 0!==o&&o.aborted){let e=new a(void 0,{cause:n.signal.reason});throw this.once("error",()=>{}),await d(this.destroy(e)),e}let l=new r,c=l.signal;if(null!=n&&n.signal){let e={once:!0,[f]:this,[p]:!0};n.signal.addEventListener("abort",()=>l.abort(),e)}let y=!1;try{for await(let r of this){var g;if(y=!0,null!=n&&null!==(g=n.signal)&&void 0!==g&&g.aborted)throw new a;s?t=await e(t,r,{signal:c}):(t=r,s=!0)}if(!y&&!s)throw new B}finally{l.abort()}return t},toArray:async function(e){null!=e&&h(e,"options"),null!=e?.signal&&u(e.signal,"options.signal");let t=[];for await(let n of this){var r;if(null!=e&&null!==(r=e.signal)&&void 0!==r&&r.aborted)throw new a(void 0,{cause:e.signal.reason});v(t,n)}return t},some:j,find:async function(e,t){for await(let r of M.call(this,e,t))return r}}}),Ft=o((e,t)=>{l(),tt(),Fe();var{ArrayPrototypePop:r,Promise:n}=rt(),{isIterable:i,isNodeStream:o,isWebStream:s}=_t(),{pipelineImpl:a}=Ut(),{finished:u}=St();Wt(),t.exports={finished:u,pipeline:function(...e){return new n((t,n)=>{let l,u,c=e[e.length-1];if(c&&"object"==typeof c&&!o(c)&&!i(c)&&!s(c)){let t=r(e);l=t.signal,u=t.end}a(e,(e,r)=>{e?n(e):t(r)},{signal:l,end:u})})}}}),Wt=o((e,t)=>{l(),tt(),Fe();var{Buffer:r}=(et(),a(Qe)),{ObjectDefineProperty:n,ObjectKeys:i,ReflectApply:o}=rt(),{promisify:{custom:s}}=mt(),{streamReturningOperators:u,promiseReturningOperators:c}=Dt(),{codes:{ERR_ILLEGAL_CONSTRUCTOR:h}}=it(),f=Lt(),{setDefaultHighWaterMark:p,getDefaultHighWaterMark:d}=Ot(),{pipeline:y}=Ut(),{destroyer:g}=Et(),b=St(),m=Ft(),w=_t(),v=t.exports=At().Stream;v.isDestroyed=w.isDestroyed,v.isDisturbed=w.isDisturbed,v.isErrored=w.isErrored,v.isReadable=w.isReadable,v.isWritable=w.isWritable,v.Readable=Rt();for(let e of i(u)){let t=function(...e){if(new.target)throw h();return v.Readable.from(o(r,this,e))},r=u[e];n(t,"name",{__proto__:null,value:r.name}),n(t,"length",{__proto__:null,value:r.length}),n(v.Readable.prototype,e,{__proto__:null,value:t,enumerable:!1,configurable:!0,writable:!0})}for(let e of i(c)){let t=function(...e){if(new.target)throw h();return o(r,this,e)},r=c[e];n(t,"name",{__proto__:null,value:r.name}),n(t,"length",{__proto__:null,value:r.length}),n(v.Readable.prototype,e,{__proto__:null,value:t,enumerable:!1,configurable:!0,writable:!0})}v.Writable=Ct(),v.Duplex=Mt(),v.Transform=Bt(),v.PassThrough=Nt(),v.pipeline=y;var{addAbortSignal:_}=It();v.addAbortSignal=_,v.finished=b,v.destroy=g,v.compose=f,v.setDefaultHighWaterMark=p,v.getDefaultHighWaterMark=d,n(v,"promises",{__proto__:null,configurable:!0,enumerable:!0,get:()=>m}),n(y,s,{__proto__:null,enumerable:!0,get:()=>m.pipeline}),n(b,s,{__proto__:null,enumerable:!0,get:()=>m.finished}),v.Stream=v,v._isUint8Array=function(e){return e instanceof Uint8Array},v._uint8ArrayToBuffer=function(e){return r.from(e.buffer,e.byteOffset,e.byteLength)}}),qt=o((e,t)=>{l(),tt(),Fe();var r=Wt(),n=Ft(),i=r.Readable.destroy;t.exports=r.Readable,t.exports._uint8ArrayToBuffer=r._uint8ArrayToBuffer,t.exports._isUint8Array=r._isUint8Array,t.exports.isDisturbed=r.isDisturbed,t.exports.isErrored=r.isErrored,t.exports.isReadable=r.isReadable,t.exports.Readable=r.Readable,t.exports.Writable=r.Writable,t.exports.Duplex=r.Duplex,t.exports.Transform=r.Transform,t.exports.PassThrough=r.PassThrough,t.exports.addAbortSignal=r.addAbortSignal,t.exports.finished=r.finished,t.exports.destroy=r.destroy,t.exports.destroy=i,t.exports.pipeline=r.pipeline,t.exports.compose=r.compose,Object.defineProperty(r,"promises",{configurable:!0,enumerable:!0,get:()=>n}),t.exports.Stream=r.Stream,t.exports.default=t.exports}),$t=o((e,t)=>{l(),tt(),Fe(),"function"==typeof Object.create?t.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:t.exports=function(e,t){if(t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}}}),Ht=o((e,t)=>{l(),tt(),Fe();var{Buffer:r}=(et(),a(Qe)),n=Symbol.for("BufferList");function i(e){if(!(this instanceof i))return new i(e);i._init.call(this,e)}i._init=function(e){Object.defineProperty(this,n,{value:!0}),this._bufs=[],this.length=0,e&&this.append(e)},i.prototype._new=function(e){return new i(e)},i.prototype._offset=function(e){if(0===e)return[0,0];let t=0;for(let r=0;r<this._bufs.length;r++){let n=t+this._bufs[r].length;if(e<n||r===this._bufs.length-1)return[r,e-t];t=n}},i.prototype._reverseOffset=function(e){let t=e[0],r=e[1];for(let e=0;e<t;e++)r+=this._bufs[e].length;return r},i.prototype.getBuffers=function(){return this._bufs},i.prototype.get=function(e){if(e>this.length||e<0)return;let t=this._offset(e);return this._bufs[t[0]][t[1]]},i.prototype.slice=function(e,t){return"number"==typeof e&&e<0&&(e+=this.length),"number"==typeof t&&t<0&&(t+=this.length),this.copy(null,0,e,t)},i.prototype.copy=function(e,t,n,i){if(("number"!=typeof n||n<0)&&(n=0),("number"!=typeof i||i>this.length)&&(i=this.length),n>=this.length||i<=0)return e||r.alloc(0);let o=!!e,s=this._offset(n),a=i-n,l=a,u=o&&t||0,c=s[1];if(0===n&&i===this.length){if(!o)return 1===this._bufs.length?this._bufs[0]:r.concat(this._bufs,this.length);for(let t=0;t<this._bufs.length;t++)this._bufs[t].copy(e,u),u+=this._bufs[t].length;return e}if(l<=this._bufs[s[0]].length-c)return o?this._bufs[s[0]].copy(e,t,c,c+l):this._bufs[s[0]].slice(c,c+l);o||(e=r.allocUnsafe(a));for(let t=s[0];t<this._bufs.length;t++){let r=this._bufs[t].length-c;if(!(l>r)){this._bufs[t].copy(e,u,c,c+l),u+=r;break}this._bufs[t].copy(e,u,c),u+=r,l-=r,c&&(c=0)}return e.length>u?e.slice(0,u):e},i.prototype.shallowSlice=function(e,t){if(e=e||0,t="number"!=typeof t?this.length:t,e<0&&(e+=this.length),t<0&&(t+=this.length),e===t)return this._new();let r=this._offset(e),n=this._offset(t),i=this._bufs.slice(r[0],n[0]+1);return 0===n[1]?i.pop():i[i.length-1]=i[i.length-1].slice(0,n[1]),0!==r[1]&&(i[0]=i[0].slice(r[1])),this._new(i)},i.prototype.toString=function(e,t,r){return this.slice(t,r).toString(e)},i.prototype.consume=function(e){if(e=Math.trunc(e),Number.isNaN(e)||e<=0)return this;for(;this._bufs.length;){if(!(e>=this._bufs[0].length)){this._bufs[0]=this._bufs[0].slice(e),this.length-=e;break}e-=this._bufs[0].length,this.length-=this._bufs[0].length,this._bufs.shift()}return this},i.prototype.duplicate=function(){let e=this._new();for(let t=0;t<this._bufs.length;t++)e.append(this._bufs[t]);return e},i.prototype.append=function(e){return this._attach(e,i.prototype._appendBuffer)},i.prototype.prepend=function(e){return this._attach(e,i.prototype._prependBuffer,!0)},i.prototype._attach=function(e,t,n){if(null==e)return this;if(e.buffer)t.call(this,r.from(e.buffer,e.byteOffset,e.byteLength));else if(Array.isArray(e)){let[r,i]=n?[e.length-1,-1]:[0,1];for(let o=r;o>=0&&o<e.length;o+=i)this._attach(e[o],t,n)}else if(this._isBufferList(e)){let[r,i]=n?[e._bufs.length-1,-1]:[0,1];for(let o=r;o>=0&&o<e._bufs.length;o+=i)this._attach(e._bufs[o],t,n)}else"number"==typeof e&&(e=e.toString()),t.call(this,r.from(e));return this},i.prototype._appendBuffer=function(e){this._bufs.push(e),this.length+=e.length},i.prototype._prependBuffer=function(e){this._bufs.unshift(e),this.length+=e.length},i.prototype.indexOf=function(e,t,n){if(void 0===n&&"string"==typeof t&&(n=t,t=void 0),"function"==typeof e||Array.isArray(e))throw new TypeError('The "value" argument must be one of type string, Buffer, BufferList, or Uint8Array.');if("number"==typeof e?e=r.from([e]):"string"==typeof e?e=r.from(e,n):this._isBufferList(e)?e=e.slice():Array.isArray(e.buffer)?e=r.from(e.buffer,e.byteOffset,e.byteLength):r.isBuffer(e)||(e=r.from(e)),t=Number(t||0),isNaN(t)&&(t=0),t<0&&(t=this.length+t),t<0&&(t=0),0===e.length)return t>this.length?this.length:t;let i=this._offset(t),o=i[0],s=i[1];for(;o<this._bufs.length;o++){let t=this._bufs[o];for(;s<t.length;)if(t.length-s>=e.length){let r=t.indexOf(e,s);if(-1!==r)return this._reverseOffset([o,r]);s=t.length-e.length+1}else{let t=this._reverseOffset([o,s]);if(this._match(t,e))return t;s++}s=0}return-1},i.prototype._match=function(e,t){if(this.length-e<t.length)return!1;for(let r=0;r<t.length;r++)if(this.get(e+r)!==t[r])return!1;return!0},function(){let e={readDoubleBE:8,readDoubleLE:8,readFloatBE:4,readFloatLE:4,readBigInt64BE:8,readBigInt64LE:8,readBigUInt64BE:8,readBigUInt64LE:8,readInt32BE:4,readInt32LE:4,readUInt32BE:4,readUInt32LE:4,readInt16BE:2,readInt16LE:2,readUInt16BE:2,readUInt16LE:2,readInt8:1,readUInt8:1,readIntBE:null,readIntLE:null,readUIntBE:null,readUIntLE:null};for(let t in e)(function(t){i.prototype[t]=null===e[t]?function(e,r){return this.slice(e,e+r)[t](0,r)}:function(r=0){return this.slice(r,r+e[t])[t](0)}})(t)}(),i.prototype._isBufferList=function(e){return e instanceof i||i.isBufferList(e)},i.isBufferList=function(e){return null!=e&&e[n]},t.exports=i}),Vt=o((e,t)=>{l(),tt(),Fe();var r=qt().Duplex,n=$t(),i=Ht();function o(e){if(!(this instanceof o))return new o(e);if("function"==typeof e){this._callback=e;let t=function(e){this._callback&&(this._callback(e),this._callback=null)}.bind(this);this.on("pipe",function(e){e.on("error",t)}),this.on("unpipe",function(e){e.removeListener("error",t)}),e=null}i._init.call(this,e),r.call(this)}n(o,r),Object.assign(o.prototype,i.prototype),o.prototype._new=function(e){return new o(e)},o.prototype._write=function(e,t,r){this._appendBuffer(e),"function"==typeof r&&r()},o.prototype._read=function(e){if(!this.length)return this.push(null);e=Math.min(e,this.length),this.push(this.slice(0,e)),this.consume(e)},o.prototype.end=function(e){r.prototype.end.call(this,e),this._callback&&(this._callback(null,this.slice()),this._callback=null)},o.prototype._destroy=function(e,t){this._bufs.length=0,this.length=0,t(e)},o.prototype._isBufferList=function(e){return e instanceof o||e instanceof i||o.isBufferList(e)},o.isBufferList=i.isBufferList,t.exports=o,t.exports.BufferListStream=o,t.exports.BufferList=i}),zt=o((e,t)=>{l(),tt(),Fe();t.exports=class{constructor(){this.cmd=null,this.retain=!1,this.qos=0,this.dup=!1,this.length=-1,this.topic=null,this.payload=null}}}),Kt=o((e,t)=>{l(),tt(),Fe();var r=t.exports,{Buffer:n}=(et(),a(Qe));r.types={0:"reserved",1:"connect",2:"connack",3:"publish",4:"puback",5:"pubrec",6:"pubrel",7:"pubcomp",8:"subscribe",9:"suback",10:"unsubscribe",11:"unsuback",12:"pingreq",13:"pingresp",14:"disconnect",15:"auth"},r.requiredHeaderFlags={1:0,2:0,4:0,5:0,6:2,7:0,8:2,9:0,10:2,11:0,12:0,13:0,14:0,15:0},r.requiredHeaderFlagsErrors={};for(let e in r.requiredHeaderFlags){let t=r.requiredHeaderFlags[e];r.requiredHeaderFlagsErrors[e]="Invalid header flag bits, must be 0x"+t.toString(16)+" for "+r.types[e]+" packet"}r.codes={};for(let e in r.types){let t=r.types[e];r.codes[t]=e}r.CMD_SHIFT=4,r.CMD_MASK=240,r.DUP_MASK=8,r.QOS_MASK=3,r.QOS_SHIFT=1,r.RETAIN_MASK=1,r.VARBYTEINT_MASK=127,r.VARBYTEINT_FIN_MASK=128,r.VARBYTEINT_MAX=268435455,r.SESSIONPRESENT_MASK=1,r.SESSIONPRESENT_HEADER=n.from([r.SESSIONPRESENT_MASK]),r.CONNACK_HEADER=n.from([r.codes.connack<<r.CMD_SHIFT]),r.USERNAME_MASK=128,r.PASSWORD_MASK=64,r.WILL_RETAIN_MASK=32,r.WILL_QOS_MASK=24,r.WILL_QOS_SHIFT=3,r.WILL_FLAG_MASK=4,r.CLEAN_SESSION_MASK=2,r.CONNECT_HEADER=n.from([r.codes.connect<<r.CMD_SHIFT]),r.properties={sessionExpiryInterval:17,willDelayInterval:24,receiveMaximum:33,maximumPacketSize:39,topicAliasMaximum:34,requestResponseInformation:25,requestProblemInformation:23,userProperties:38,authenticationMethod:21,authenticationData:22,payloadFormatIndicator:1,messageExpiryInterval:2,contentType:3,responseTopic:8,correlationData:9,maximumQoS:36,retainAvailable:37,assignedClientIdentifier:18,reasonString:31,wildcardSubscriptionAvailable:40,subscriptionIdentifiersAvailable:41,sharedSubscriptionAvailable:42,serverKeepAlive:19,responseInformation:26,serverReference:28,topicAlias:35,subscriptionIdentifier:11},r.propertiesCodes={};for(let e in r.properties){let t=r.properties[e];r.propertiesCodes[t]=e}function i(e){return[0,1,2].map(t=>[0,1].map(i=>[0,1].map(o=>{let s=n.alloc(1);return s.writeUInt8(r.codes[e]<<r.CMD_SHIFT|(i?r.DUP_MASK:0)|t<<r.QOS_SHIFT|o,0,!0),s})))}r.propertiesTypes={sessionExpiryInterval:"int32",willDelayInterval:"int32",receiveMaximum:"int16",maximumPacketSize:"int32",topicAliasMaximum:"int16",requestResponseInformation:"byte",requestProblemInformation:"byte",userProperties:"pair",authenticationMethod:"string",authenticationData:"binary",payloadFormatIndicator:"byte",messageExpiryInterval:"int32",contentType:"string",responseTopic:"string",correlationData:"binary",maximumQoS:"int8",retainAvailable:"byte",assignedClientIdentifier:"string",reasonString:"string",wildcardSubscriptionAvailable:"byte",subscriptionIdentifiersAvailable:"byte",sharedSubscriptionAvailable:"byte",serverKeepAlive:"int16",responseInformation:"string",serverReference:"string",topicAlias:"int16",subscriptionIdentifier:"var"},r.PUBLISH_HEADER=i("publish"),r.SUBSCRIBE_HEADER=i("subscribe"),r.SUBSCRIBE_OPTIONS_QOS_MASK=3,r.SUBSCRIBE_OPTIONS_NL_MASK=1,r.SUBSCRIBE_OPTIONS_NL_SHIFT=2,r.SUBSCRIBE_OPTIONS_RAP_MASK=1,r.SUBSCRIBE_OPTIONS_RAP_SHIFT=3,r.SUBSCRIBE_OPTIONS_RH_MASK=3,r.SUBSCRIBE_OPTIONS_RH_SHIFT=4,r.SUBSCRIBE_OPTIONS_RH=[0,16,32],r.SUBSCRIBE_OPTIONS_NL=4,r.SUBSCRIBE_OPTIONS_RAP=8,r.SUBSCRIBE_OPTIONS_QOS=[0,1,2],r.UNSUBSCRIBE_HEADER=i("unsubscribe"),r.ACKS={unsuback:i("unsuback"),puback:i("puback"),pubcomp:i("pubcomp"),pubrel:i("pubrel"),pubrec:i("pubrec")},r.SUBACK_HEADER=n.from([r.codes.suback<<r.CMD_SHIFT]),r.VERSION3=n.from([3]),r.VERSION4=n.from([4]),r.VERSION5=n.from([5]),r.VERSION131=n.from([131]),r.VERSION132=n.from([132]),r.QOS=[0,1,2].map(e=>n.from([e])),r.EMPTY={pingreq:n.from([r.codes.pingreq<<4,0]),pingresp:n.from([r.codes.pingresp<<4,0]),disconnect:n.from([r.codes.disconnect<<4,0])},r.MQTT5_PUBACK_PUBREC_CODES={0:"Success",16:"No matching subscribers",128:"Unspecified error",131:"Implementation specific error",135:"Not authorized",144:"Topic Name invalid",145:"Packet identifier in use",151:"Quota exceeded",153:"Payload format invalid"},r.MQTT5_PUBREL_PUBCOMP_CODES={0:"Success",146:"Packet Identifier not found"},r.MQTT5_SUBACK_CODES={0:"Granted QoS 0",1:"Granted QoS 1",2:"Granted QoS 2",128:"Unspecified error",131:"Implementation specific error",135:"Not authorized",143:"Topic Filter invalid",145:"Packet Identifier in use",151:"Quota exceeded",158:"Shared Subscriptions not supported",161:"Subscription Identifiers not supported",162:"Wildcard Subscriptions not supported"},r.MQTT5_UNSUBACK_CODES={0:"Success",17:"No subscription existed",128:"Unspecified error",131:"Implementation specific error",135:"Not authorized",143:"Topic Filter invalid",145:"Packet Identifier in use"},r.MQTT5_DISCONNECT_CODES={0:"Normal disconnection",4:"Disconnect with Will Message",128:"Unspecified error",129:"Malformed Packet",130:"Protocol Error",131:"Implementation specific error",135:"Not authorized",137:"Server busy",139:"Server shutting down",141:"Keep Alive timeout",142:"Session taken over",143:"Topic Filter invalid",144:"Topic Name invalid",147:"Receive Maximum exceeded",148:"Topic Alias invalid",149:"Packet too large",150:"Message rate too high",151:"Quota exceeded",152:"Administrative action",153:"Payload format invalid",154:"Retain not supported",155:"QoS not supported",156:"Use another server",157:"Server moved",158:"Shared Subscriptions not supported",159:"Connection rate exceeded",160:"Maximum connect time",161:"Subscription Identifiers not supported",162:"Wildcard Subscriptions not supported"},r.MQTT5_AUTH_CODES={0:"Success",24:"Continue authentication",25:"Re-authenticate"}}),Gt=o((e,t)=>{l(),tt(),Fe();var r=1e3,n=6e4,i=60*n,o=24*i,s=7*o,a=365.25*o;function u(e,t,r,n){var i=t>=1.5*r;return Math.round(e/r)+" "+n+(i?"s":"")}t.exports=function(e,t){t=t||{};var l=typeof e;if("string"===l&&e.length>0)return function(e){if(e=String(e),!(e.length>100)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(t){var l=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return l*a;case"weeks":case"week":case"w":return l*s;case"days":case"day":case"d":return l*o;case"hours":case"hour":case"hrs":case"hr":case"h":return l*i;case"minutes":case"minute":case"mins":case"min":case"m":return l*n;case"seconds":case"second":case"secs":case"sec":case"s":return l*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return l;default:return}}}}(e);if("number"===l&&isFinite(e))return t.long?function(e){var t=Math.abs(e);return t>=o?u(e,t,o,"day"):t>=i?u(e,t,i,"hour"):t>=n?u(e,t,n,"minute"):t>=r?u(e,t,r,"second"):e+" ms"}(e):function(e){var t=Math.abs(e);return t>=o?Math.round(e/o)+"d":t>=i?Math.round(e/i)+"h":t>=n?Math.round(e/n)+"m":t>=r?Math.round(e/r)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}}),Qt=o((e,t)=>{l(),tt(),Fe(),t.exports=function(e){function t(e){let n,i,o,s=null;function a(...e){if(!a.enabled)return;let r=a,i=Number(new Date),o=i-(n||i);r.diff=o,r.prev=n,r.curr=i,n=i,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let s=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(n,i)=>{if("%%"===n)return"%";s++;let o=t.formatters[i];if("function"==typeof o){let t=e[s];n=o.call(r,t),e.splice(s,1),s--}return n}),t.formatArgs.call(r,e),(r.log||t.log).apply(r,e)}return a.namespace=e,a.useColors=t.useColors(),a.color=t.selectColor(e),a.extend=r,a.destroy=t.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==s?s:(i!==t.namespaces&&(i=t.namespaces,o=t.enabled(e)),o),set:e=>{s=e}}),"function"==typeof t.init&&t.init(a),a}function r(e,r){let n=t(this.namespace+(typeof r>"u"?":":r)+e);return n.log=this.log,n}function n(e,t){let r=0,n=0,i=-1,o=0;for(;r<e.length;)if(n<t.length&&(t[n]===e[r]||"*"===t[n]))"*"===t[n]?(i=n,o=r,n++):(r++,n++);else{if(-1===i)return!1;n=i+1,o++,r=o}for(;n<t.length&&"*"===t[n];)n++;return n===t.length}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){let e=[...t.names,...t.skips.map(e=>"-"+e)].join(",");return t.enable(""),e},t.enable=function(e){t.save(e),t.namespaces=e,t.names=[],t.skips=[];let r=("string"==typeof e?e:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(let e of r)"-"===e[0]?t.skips.push(e.slice(1)):t.names.push(e)},t.enabled=function(e){for(let r of t.skips)if(n(e,r))return!1;for(let r of t.names)if(n(e,r))return!0;return!1},t.humanize=Gt(),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach(r=>{t[r]=e[r]}),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let r=0;for(let t=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;return t.colors[Math.abs(r)%t.colors.length]},t.enable(t.load()),t}}),Yt=o((e,t)=>{l(),tt(),Fe(),e.formatArgs=function(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;let r="color: "+this.color;e.splice(1,0,r,"color: inherit");let n=0,i=0;e[0].replace(/%[a-zA-Z%]/g,e=>{"%%"!==e&&(n++,"%c"===e&&(i=n))}),e.splice(i,0,r)},e.save=function(t){try{t?e.storage.setItem("debug",t):e.storage.removeItem("debug")}catch(e){}},e.load=function(){let t;try{t=e.storage.getItem("debug")||e.storage.getItem("DEBUG")}catch(e){}return!t&&typeof u<"u"&&"env"in u&&(t=u.env.DEBUG),t},e.useColors=function(){if(typeof window<"u"&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let e;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(e=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(e[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},e.storage=function(){try{return localStorage}catch(e){}}(),e.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.log=console.debug||console.log||(()=>{}),t.exports=Qt()(e);var{formatters:r}=t.exports;r.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}),Jt=o((e,t)=>{l(),tt(),Fe();var r=Vt(),{EventEmitter:n}=(bt(),a(st)),i=zt(),o=Kt(),s=Yt()("mqtt-packet:parser");t.exports=class e extends n{constructor(){super(),this.parser=this.constructor.parser}static parser(t){return this instanceof e?(this.settings=t||{},this._states=["_parseHeader","_parseLength","_parsePayload","_newPacket"],this._resetState(),this):(new e).parser(t)}_resetState(){s("_resetState: resetting packet, error, _list, and _stateCounter"),this.packet=new i,this.error=null,this._list=r(),this._stateCounter=0}parse(e){for(this.error&&this._resetState(),this._list.append(e),s("parse: current state: %s",this._states[this._stateCounter]);(-1!==this.packet.length||this._list.length>0)&&this[this._states[this._stateCounter]]()&&!this.error;)this._stateCounter++,s("parse: state complete. _stateCounter is now: %d",this._stateCounter),s("parse: packet.length: %d, buffer list length: %d",this.packet.length,this._list.length),this._stateCounter>=this._states.length&&(this._stateCounter=0);return s("parse: exited while loop. packet: %d, buffer list length: %d",this.packet.length,this._list.length),this._list.length}_parseHeader(){let e=this._list.readUInt8(0),t=e>>o.CMD_SHIFT;this.packet.cmd=o.types[t];let r=15&e,n=o.requiredHeaderFlags[t];return null!=n&&r!==n?this._emitError(new Error(o.requiredHeaderFlagsErrors[t])):(this.packet.retain=0!==(e&o.RETAIN_MASK),this.packet.qos=e>>o.QOS_SHIFT&o.QOS_MASK,this.packet.qos>2?this._emitError(new Error("Packet must not have both QoS bits set to 1")):(this.packet.dup=0!==(e&o.DUP_MASK),s("_parseHeader: packet: %o",this.packet),this._list.consume(1),!0))}_parseLength(){let e=this._parseVarByteNum(!0);return e&&(this.packet.length=e.value,this._list.consume(e.bytes)),s("_parseLength %d",e.value),!!e}_parsePayload(){s("_parsePayload: payload %O",this._list);let e=!1;if(0===this.packet.length||this._list.length>=this.packet.length){switch(this._pos=0,this.packet.cmd){case"connect":this._parseConnect();break;case"connack":this._parseConnack();break;case"publish":this._parsePublish();break;case"puback":case"pubrec":case"pubrel":case"pubcomp":this._parseConfirmation();break;case"subscribe":this._parseSubscribe();break;case"suback":this._parseSuback();break;case"unsubscribe":this._parseUnsubscribe();break;case"unsuback":this._parseUnsuback();break;case"pingreq":case"pingresp":break;case"disconnect":this._parseDisconnect();break;case"auth":this._parseAuth();break;default:this._emitError(new Error("Not supported"))}e=!0}return s("_parsePayload complete result: %s",e),e}_parseConnect(){s("_parseConnect");let e,t,r,n,i={},a=this.packet,l=this._parseString();if(null===l)return this._emitError(new Error("Cannot parse protocolId"));if("MQTT"!==l&&"MQIsdp"!==l)return this._emitError(new Error("Invalid protocolId"));if(a.protocolId=l,this._pos>=this._list.length)return this._emitError(new Error("Packet too short"));if(a.protocolVersion=this._list.readUInt8(this._pos),a.protocolVersion>=128&&(a.bridgeMode=!0,a.protocolVersion=a.protocolVersion-128),3!==a.protocolVersion&&4!==a.protocolVersion&&5!==a.protocolVersion)return this._emitError(new Error("Invalid protocol version"));if(this._pos++,this._pos>=this._list.length)return this._emitError(new Error("Packet too short"));if(1&this._list.readUInt8(this._pos))return this._emitError(new Error("Connect flag bit 0 must be 0, but got 1"));i.username=this._list.readUInt8(this._pos)&o.USERNAME_MASK,i.password=this._list.readUInt8(this._pos)&o.PASSWORD_MASK,i.will=this._list.readUInt8(this._pos)&o.WILL_FLAG_MASK;let u=!!(this._list.readUInt8(this._pos)&o.WILL_RETAIN_MASK),c=(this._list.readUInt8(this._pos)&o.WILL_QOS_MASK)>>o.WILL_QOS_SHIFT;if(i.will)a.will={},a.will.retain=u,a.will.qos=c;else{if(u)return this._emitError(new Error("Will Retain Flag must be set to zero when Will Flag is set to 0"));if(c)return this._emitError(new Error("Will QoS must be set to zero when Will Flag is set to 0"))}if(a.clean=0!==(this._list.readUInt8(this._pos)&o.CLEAN_SESSION_MASK),this._pos++,a.keepalive=this._parseNum(),-1===a.keepalive)return this._emitError(new Error("Packet too short"));if(5===a.protocolVersion){let e=this._parseProperties();Object.getOwnPropertyNames(e).length&&(a.properties=e)}let h=this._parseString();if(null===h)return this._emitError(new Error("Packet too short"));if(a.clientId=h,s("_parseConnect: packet.clientId: %s",a.clientId),i.will){if(5===a.protocolVersion){let e=this._parseProperties();Object.getOwnPropertyNames(e).length&&(a.will.properties=e)}if(e=this._parseString(),null===e)return this._emitError(new Error("Cannot parse will topic"));if(a.will.topic=e,s("_parseConnect: packet.will.topic: %s",a.will.topic),t=this._parseBuffer(),null===t)return this._emitError(new Error("Cannot parse will payload"));a.will.payload=t,s("_parseConnect: packet.will.paylaod: %s",a.will.payload)}if(i.username){if(n=this._parseString(),null===n)return this._emitError(new Error("Cannot parse username"));a.username=n,s("_parseConnect: packet.username: %s",a.username)}if(i.password){if(r=this._parseBuffer(),null===r)return this._emitError(new Error("Cannot parse password"));a.password=r}return this.settings=a,s("_parseConnect: complete"),a}_parseConnack(){s("_parseConnack");let e=this.packet;if(this._list.length<1)return null;let t=this._list.readUInt8(this._pos++);if(t>1)return this._emitError(new Error("Invalid connack flags, bits 7-1 must be set to 0"));if(e.sessionPresent=!!(t&o.SESSIONPRESENT_MASK),5===this.settings.protocolVersion)this._list.length>=2?e.reasonCode=this._list.readUInt8(this._pos++):e.reasonCode=0;else{if(this._list.length<2)return null;e.returnCode=this._list.readUInt8(this._pos++)}if(-1===e.returnCode||-1===e.reasonCode)return this._emitError(new Error("Cannot parse return code"));if(5===this.settings.protocolVersion){let t=this._parseProperties();Object.getOwnPropertyNames(t).length&&(e.properties=t)}s("_parseConnack: complete")}_parsePublish(){s("_parsePublish");let e=this.packet;if(e.topic=this._parseString(),null===e.topic)return this._emitError(new Error("Cannot parse topic"));if(!(e.qos>0)||this._parseMessageId()){if(5===this.settings.protocolVersion){let t=this._parseProperties();Object.getOwnPropertyNames(t).length&&(e.properties=t)}e.payload=this._list.slice(this._pos,e.length),s("_parsePublish: payload from buffer list: %o",e.payload)}}_parseSubscribe(){s("_parseSubscribe");let e,t,r,n,i,a,l,u=this.packet;if(u.subscriptions=[],this._parseMessageId()){if(5===this.settings.protocolVersion){let e=this._parseProperties();Object.getOwnPropertyNames(e).length&&(u.properties=e)}if(u.length<=0)return this._emitError(new Error("Malformed subscribe, no payload specified"));for(;this._pos<u.length;){if(e=this._parseString(),null===e)return this._emitError(new Error("Cannot parse topic"));if(this._pos>=u.length)return this._emitError(new Error("Malformed Subscribe Payload"));if(t=this._parseByte(),5===this.settings.protocolVersion){if(192&t)return this._emitError(new Error("Invalid subscribe topic flag bits, bits 7-6 must be 0"))}else if(252&t)return this._emitError(new Error("Invalid subscribe topic flag bits, bits 7-2 must be 0"));if(r=t&o.SUBSCRIBE_OPTIONS_QOS_MASK,r>2)return this._emitError(new Error("Invalid subscribe QoS, must be <= 2"));if(a=0!==(t>>o.SUBSCRIBE_OPTIONS_NL_SHIFT&o.SUBSCRIBE_OPTIONS_NL_MASK),i=0!==(t>>o.SUBSCRIBE_OPTIONS_RAP_SHIFT&o.SUBSCRIBE_OPTIONS_RAP_MASK),n=t>>o.SUBSCRIBE_OPTIONS_RH_SHIFT&o.SUBSCRIBE_OPTIONS_RH_MASK,n>2)return this._emitError(new Error("Invalid retain handling, must be <= 2"));l={topic:e,qos:r},5===this.settings.protocolVersion?(l.nl=a,l.rap=i,l.rh=n):this.settings.bridgeMode&&(l.rh=0,l.rap=!0,l.nl=!0),s("_parseSubscribe: push subscription `%s` to subscription",l),u.subscriptions.push(l)}}}_parseSuback(){s("_parseSuback");let e=this.packet;if(this.packet.granted=[],this._parseMessageId()){if(5===this.settings.protocolVersion){let t=this._parseProperties();Object.getOwnPropertyNames(t).length&&(e.properties=t)}if(e.length<=0)return this._emitError(new Error("Malformed suback, no payload specified"));for(;this._pos<this.packet.length;){let e=this._list.readUInt8(this._pos++);if(5===this.settings.protocolVersion){if(!o.MQTT5_SUBACK_CODES[e])return this._emitError(new Error("Invalid suback code"))}else if(e>2&&128!==e)return this._emitError(new Error("Invalid suback QoS, must be 0, 1, 2 or 128"));this.packet.granted.push(e)}}}_parseUnsubscribe(){s("_parseUnsubscribe");let e=this.packet;if(e.unsubscriptions=[],this._parseMessageId()){if(5===this.settings.protocolVersion){let t=this._parseProperties();Object.getOwnPropertyNames(t).length&&(e.properties=t)}if(e.length<=0)return this._emitError(new Error("Malformed unsubscribe, no payload specified"));for(;this._pos<e.length;){let t=this._parseString();if(null===t)return this._emitError(new Error("Cannot parse topic"));s("_parseUnsubscribe: push topic `%s` to unsubscriptions",t),e.unsubscriptions.push(t)}}}_parseUnsuback(){s("_parseUnsuback");let e=this.packet;if(!this._parseMessageId())return this._emitError(new Error("Cannot parse messageId"));if((3===this.settings.protocolVersion||4===this.settings.protocolVersion)&&2!==e.length)return this._emitError(new Error("Malformed unsuback, payload length must be 2"));if(e.length<=0)return this._emitError(new Error("Malformed unsuback, no payload specified"));if(5===this.settings.protocolVersion){let t=this._parseProperties();for(Object.getOwnPropertyNames(t).length&&(e.properties=t),e.granted=[];this._pos<this.packet.length;){let e=this._list.readUInt8(this._pos++);if(!o.MQTT5_UNSUBACK_CODES[e])return this._emitError(new Error("Invalid unsuback code"));this.packet.granted.push(e)}}}_parseConfirmation(){s("_parseConfirmation: packet.cmd: `%s`",this.packet.cmd);let e=this.packet;if(this._parseMessageId(),5===this.settings.protocolVersion){if(e.length>2){switch(e.reasonCode=this._parseByte(),this.packet.cmd){case"puback":case"pubrec":if(!o.MQTT5_PUBACK_PUBREC_CODES[e.reasonCode])return this._emitError(new Error("Invalid "+this.packet.cmd+" reason code"));break;case"pubrel":case"pubcomp":if(!o.MQTT5_PUBREL_PUBCOMP_CODES[e.reasonCode])return this._emitError(new Error("Invalid "+this.packet.cmd+" reason code"))}s("_parseConfirmation: packet.reasonCode `%d`",e.reasonCode)}else e.reasonCode=0;if(e.length>3){let t=this._parseProperties();Object.getOwnPropertyNames(t).length&&(e.properties=t)}}return!0}_parseDisconnect(){let e=this.packet;if(s("_parseDisconnect"),5===this.settings.protocolVersion){this._list.length>0?(e.reasonCode=this._parseByte(),o.MQTT5_DISCONNECT_CODES[e.reasonCode]||this._emitError(new Error("Invalid disconnect reason code"))):e.reasonCode=0;let t=this._parseProperties();Object.getOwnPropertyNames(t).length&&(e.properties=t)}return s("_parseDisconnect result: true"),!0}_parseAuth(){s("_parseAuth");let e=this.packet;if(5!==this.settings.protocolVersion)return this._emitError(new Error("Not supported auth packet for this version MQTT"));if(e.reasonCode=this._parseByte(),!o.MQTT5_AUTH_CODES[e.reasonCode])return this._emitError(new Error("Invalid auth reason code"));let t=this._parseProperties();return Object.getOwnPropertyNames(t).length&&(e.properties=t),s("_parseAuth: result: true"),!0}_parseMessageId(){let e=this.packet;return e.messageId=this._parseNum(),null===e.messageId?(this._emitError(new Error("Cannot parse messageId")),!1):(s("_parseMessageId: packet.messageId %d",e.messageId),!0)}_parseString(e){let t=this._parseNum(),r=t+this._pos;if(-1===t||r>this._list.length||r>this.packet.length)return null;let n=this._list.toString("utf8",this._pos,r);return this._pos+=t,s("_parseString: result: %s",n),n}_parseStringPair(){return s("_parseStringPair"),{name:this._parseString(),value:this._parseString()}}_parseBuffer(){let e=this._parseNum(),t=e+this._pos;if(-1===e||t>this._list.length||t>this.packet.length)return null;let r=this._list.slice(this._pos,t);return this._pos+=e,s("_parseBuffer: result: %o",r),r}_parseNum(){if(this._list.length-this._pos<2)return-1;let e=this._list.readUInt16BE(this._pos);return this._pos+=2,s("_parseNum: result: %s",e),e}_parse4ByteNum(){if(this._list.length-this._pos<4)return-1;let e=this._list.readUInt32BE(this._pos);return this._pos+=4,s("_parse4ByteNum: result: %s",e),e}_parseVarByteNum(e){s("_parseVarByteNum");let t,r=0,n=1,i=0,a=!1,l=this._pos?this._pos:0;for(;r<4&&l+r<this._list.length;){if(t=this._list.readUInt8(l+r++),i+=n*(t&o.VARBYTEINT_MASK),n*=128,0===(t&o.VARBYTEINT_FIN_MASK)){a=!0;break}if(this._list.length<=r)break}return!a&&4===r&&this._list.length>=r&&this._emitError(new Error("Invalid variable byte integer")),l&&(this._pos+=r),a=!!a&&(e?{bytes:r,value:i}:i),s("_parseVarByteNum: result: %o",a),a}_parseByte(){let e;return this._pos<this._list.length&&(e=this._list.readUInt8(this._pos),this._pos++),s("_parseByte: result: %o",e),e}_parseByType(e){switch(s("_parseByType: type: %s",e),e){case"byte":return 0!==this._parseByte();case"int8":return this._parseByte();case"int16":return this._parseNum();case"int32":return this._parse4ByteNum();case"var":return this._parseVarByteNum();case"string":return this._parseString();case"pair":return this._parseStringPair();case"binary":return this._parseBuffer()}}_parseProperties(){s("_parseProperties");let e=this._parseVarByteNum(),t=this._pos+e,r={};for(;this._pos<t;){let e=this._parseByte();if(!e)return this._emitError(new Error("Cannot parse property code type")),!1;let t=o.propertiesCodes[e];if(!t)return this._emitError(new Error("Unknown property")),!1;if("userProperties"===t){r[t]||(r[t]=Object.create(null));let e=this._parseByType(o.propertiesTypes[t]);if(r[t][e.name])if(Array.isArray(r[t][e.name]))r[t][e.name].push(e.value);else{let n=r[t][e.name];r[t][e.name]=[n],r[t][e.name].push(e.value)}else r[t][e.name]=e.value;continue}r[t]?(Array.isArray(r[t])||(r[t]=[r[t]]),r[t].push(this._parseByType(o.propertiesTypes[t]))):r[t]=this._parseByType(o.propertiesTypes[t])}return r}_newPacket(){return s("_newPacket"),this.packet&&(this._list.consume(this.packet.length),s("_newPacket: parser emit packet: packet.cmd: %s, packet.payload: %s, packet.length: %d",this.packet.cmd,this.packet.payload,this.packet.length),this.emit("packet",this.packet)),s("_newPacket: new packet"),this.packet=new i,this._pos=0,!0}_emitError(e){s("_emitError",e),this.error=e,this.emit("error",e)}}}),Xt=o((e,t)=>{l(),tt(),Fe();var{Buffer:r}=(et(),a(Qe)),n={},i=r.isBuffer(r.from([1,2]).subarray(0,1));function o(e){let t=r.allocUnsafe(2);return t.writeUInt8(e>>8,0),t.writeUInt8(255&e,1),t}t.exports={cache:n,generateCache:function(){for(let e=0;e<65536;e++)n[e]=o(e)},generateNumber:o,genBufVariableByteInt:function(e){let t=0,n=0,o=r.allocUnsafe(4);do{t=e%128|0,(e=e/128|0)>0&&(t|=128),o.writeUInt8(t,n++)}while(e>0&&n<4);return e>0&&(n=0),i?o.subarray(0,n):o.slice(0,n)},generate4ByteBuffer:function(e){let t=r.allocUnsafe(4);return t.writeUInt32BE(e,0),t}}}),Zt=o((e,t)=>{l(),tt(),Fe(),typeof u>"u"||!u.version||0===u.version.indexOf("v0.")||0===u.version.indexOf("v1.")&&0!==u.version.indexOf("v1.8.")?t.exports={nextTick:function(e,t,r,n){if("function"!=typeof e)throw new TypeError('"callback" argument must be a function');var i,o,s=arguments.length;switch(s){case 0:case 1:return u.nextTick(e);case 2:return u.nextTick(function(){e.call(null,t)});case 3:return u.nextTick(function(){e.call(null,t,r)});case 4:return u.nextTick(function(){e.call(null,t,r,n)});default:for(i=new Array(s-1),o=0;o<i.length;)i[o++]=arguments[o];return u.nextTick(function(){e.apply(null,i)})}}}:t.exports=u}),er=o((e,t)=>{l(),tt(),Fe();var r=Kt(),{Buffer:n}=(et(),a(Qe)),i=n.allocUnsafe(0),o=n.from([0]),s=Xt(),u=Zt().nextTick,c=Yt()("mqtt-packet:writeToStream"),h=s.cache,f=s.generateNumber,p=s.generateCache,d=s.genBufVariableByteInt,y=s.generate4ByteBuffer,g=A,b=!0;function m(e,t,s){switch(c("generate called"),t.cork&&(t.cork(),u(w,t)),b&&(b=!1,p()),c("generate: packet.cmd: %s",e.cmd),e.cmd){case"connect":return function(e,t){let i=e||{},o=i.protocolId||"MQTT",s=i.protocolVersion||4,a=i.will,l=i.clean,u=i.keepalive||0,c=i.clientId||"",h=i.username,f=i.password,p=i.properties;void 0===l&&(l=!0);let d,y,b=0;if(!o||"string"!=typeof o&&!n.isBuffer(o))return t.destroy(new Error("Invalid protocolId")),!1;if(b+=o.length+2,3!==s&&4!==s&&5!==s)return t.destroy(new Error("Invalid protocol version")),!1;if(b+=1,("string"==typeof c||n.isBuffer(c))&&(c||s>=4)&&(c||l))b+=n.byteLength(c)+2;else{if(s<4)return t.destroy(new Error("clientId must be supplied before 3.1.1")),!1;if(1*l==0)return t.destroy(new Error("clientId must be given if cleanSession set to 0")),!1}if("number"!=typeof u||u<0||u>65535||u%1!=0)return t.destroy(new Error("Invalid keepalive")),!1;if(b+=2,b+=1,5===s){if(d=O(t,p),!d)return!1;b+=d.length}if(a){if("object"!=typeof a)return t.destroy(new Error("Invalid will")),!1;if(!a.topic||"string"!=typeof a.topic)return t.destroy(new Error("Invalid will topic")),!1;if(b+=n.byteLength(a.topic)+2,b+=2,a.payload){if(!(a.payload.length>=0))return t.destroy(new Error("Invalid will payload")),!1;"string"==typeof a.payload?b+=n.byteLength(a.payload):b+=a.payload.length}if(y={},5===s){if(y=O(t,a.properties),!y)return!1;b+=y.length}}let m=!1;if(null!=h){if(!C(h))return t.destroy(new Error("Invalid username")),!1;m=!0,b+=n.byteLength(h)+2}if(null!=f){if(!m)return t.destroy(new Error("Username is required to use password")),!1;if(!C(f))return t.destroy(new Error("Invalid password")),!1;b+=R(f)+2}t.write(r.CONNECT_HEADER),_(t,b),k(t,o),i.bridgeMode&&(s+=128),t.write(131===s?r.VERSION131:132===s?r.VERSION132:4===s?r.VERSION4:5===s?r.VERSION5:r.VERSION3);let w=0;return w|=null!=h?r.USERNAME_MASK:0,w|=null!=f?r.PASSWORD_MASK:0,w|=a&&a.retain?r.WILL_RETAIN_MASK:0,w|=a&&a.qos?a.qos<<r.WILL_QOS_SHIFT:0,w|=a?r.WILL_FLAG_MASK:0,w|=l?r.CLEAN_SESSION_MASK:0,t.write(n.from([w])),g(t,u),5===s&&d.write(),k(t,c),a&&(5===s&&y.write(),S(t,a.topic),k(t,a.payload)),null!=h&&k(t,h),null!=f&&k(t,f),!0}(e,t);case"connack":return function(e,t,i){let s=i?i.protocolVersion:4,a=e||{},l=5===s?a.reasonCode:a.returnCode,u=a.properties,c=2;if("number"!=typeof l)return t.destroy(new Error("Invalid return code")),!1;let h=null;if(5===s){if(h=O(t,u),!h)return!1;c+=h.length}return t.write(r.CONNACK_HEADER),_(t,c),t.write(a.sessionPresent?r.SESSIONPRESENT_HEADER:o),t.write(n.from([l])),h?.write(),!0}(e,t,s);case"publish":return function(e,t,o){c("publish: packet: %o",e);let s=o?o.protocolVersion:4,a=e||{},l=a.qos||0,u=a.retain?r.RETAIN_MASK:0,h=a.topic,f=a.payload||i,p=a.messageId,d=a.properties,y=0;if("string"==typeof h)y+=n.byteLength(h)+2;else{if(!n.isBuffer(h))return t.destroy(new Error("Invalid topic")),!1;y+=h.length+2}if(n.isBuffer(f)?y+=f.length:y+=n.byteLength(f),l&&"number"!=typeof p)return t.destroy(new Error("Invalid messageId")),!1;l&&(y+=2);let b=null;if(5===s){if(b=O(t,d),!b)return!1;y+=b.length}return t.write(r.PUBLISH_HEADER[l][a.dup?1:0][u?1:0]),_(t,y),g(t,R(h)),t.write(h),l>0&&g(t,p),b?.write(),c("publish: payload: %o",f),t.write(f)}(e,t,s);case"puback":case"pubrec":case"pubrel":case"pubcomp":return function(e,t,i){let o=i?i.protocolVersion:4,s=e||{},a=s.cmd||"puback",l=s.messageId,u=s.dup&&"pubrel"===a?r.DUP_MASK:0,c=0,h=s.reasonCode,f=s.properties,p=5===o?3:2;if("pubrel"===a&&(c=1),"number"!=typeof l)return t.destroy(new Error("Invalid messageId")),!1;let d=null;if(5===o&&"object"==typeof f){if(d=x(t,f,i,p),!d)return!1;p+=d.length}return t.write(r.ACKS[a][c][u][0]),3===p&&(p+=0!==h?1:-1),_(t,p),g(t,l),5===o&&2!==p&&t.write(n.from([h])),null!==d?d.write():4===p&&t.write(n.from([0])),!0}(e,t,s);case"subscribe":return function(e,t,i){c("subscribe: packet: ");let o=i?i.protocolVersion:4,s=e||{},a=s.dup?r.DUP_MASK:0,l=s.messageId,u=s.subscriptions,h=s.properties,f=0;if("number"!=typeof l)return t.destroy(new Error("Invalid messageId")),!1;f+=2;let p=null;if(5===o){if(p=O(t,h),!p)return!1;f+=p.length}if("object"!=typeof u||!u.length)return t.destroy(new Error("Invalid subscriptions")),!1;for(let e=0;e<u.length;e+=1){let r=u[e].topic,i=u[e].qos;if("string"!=typeof r)return t.destroy(new Error("Invalid subscriptions - invalid topic")),!1;if("number"!=typeof i)return t.destroy(new Error("Invalid subscriptions - invalid qos")),!1;if(5===o){if("boolean"!=typeof(u[e].nl||!1))return t.destroy(new Error("Invalid subscriptions - invalid No Local")),!1;if("boolean"!=typeof(u[e].rap||!1))return t.destroy(new Error("Invalid subscriptions - invalid Retain as Published")),!1;let r=u[e].rh||0;if("number"!=typeof r||r>2)return t.destroy(new Error("Invalid subscriptions - invalid Retain Handling")),!1}f+=n.byteLength(r)+2+1}c("subscribe: writing to stream: %o",r.SUBSCRIBE_HEADER),t.write(r.SUBSCRIBE_HEADER[1][a?1:0][0]),_(t,f),g(t,l),null!==p&&p.write();let d=!0;for(let e of u){let i,s=e.topic,a=e.qos,l=+e.nl,u=+e.rap,c=e.rh;S(t,s),i=r.SUBSCRIBE_OPTIONS_QOS[a],5===o&&(i|=l?r.SUBSCRIBE_OPTIONS_NL:0,i|=u?r.SUBSCRIBE_OPTIONS_RAP:0,i|=c?r.SUBSCRIBE_OPTIONS_RH[c]:0),d=t.write(n.from([i]))}return d}(e,t,s);case"suback":return function(e,t,i){let o=i?i.protocolVersion:4,s=e||{},a=s.messageId,l=s.granted,u=s.properties,c=0;if("number"!=typeof a)return t.destroy(new Error("Invalid messageId")),!1;if(c+=2,"object"!=typeof l||!l.length)return t.destroy(new Error("Invalid qos vector")),!1;for(let e=0;e<l.length;e+=1){if("number"!=typeof l[e])return t.destroy(new Error("Invalid qos vector")),!1;c+=1}let h=null;if(5===o){if(h=x(t,u,i,c),!h)return!1;c+=h.length}return t.write(r.SUBACK_HEADER),_(t,c),g(t,a),null!==h&&h.write(),t.write(n.from(l))}(e,t,s);case"unsubscribe":return function(e,t,i){let o=i?i.protocolVersion:4,s=e||{},a=s.messageId,l=s.dup?r.DUP_MASK:0,u=s.unsubscriptions,c=s.properties,h=0;if("number"!=typeof a)return t.destroy(new Error("Invalid messageId")),!1;if(h+=2,"object"!=typeof u||!u.length)return t.destroy(new Error("Invalid unsubscriptions")),!1;for(let e=0;e<u.length;e+=1){if("string"!=typeof u[e])return t.destroy(new Error("Invalid unsubscriptions")),!1;h+=n.byteLength(u[e])+2}let f=null;if(5===o){if(f=O(t,c),!f)return!1;h+=f.length}t.write(r.UNSUBSCRIBE_HEADER[1][l?1:0][0]),_(t,h),g(t,a),null!==f&&f.write();let p=!0;for(let e=0;e<u.length;e++)p=S(t,u[e]);return p}(e,t,s);case"unsuback":return function(e,t,i){let o=i?i.protocolVersion:4,s=e||{},a=s.messageId,l=s.dup?r.DUP_MASK:0,u=s.granted,c=s.properties,h=s.cmd,f=0,p=2;if("number"!=typeof a)return t.destroy(new Error("Invalid messageId")),!1;if(5===o){if("object"!=typeof u||!u.length)return t.destroy(new Error("Invalid qos vector")),!1;for(let e=0;e<u.length;e+=1){if("number"!=typeof u[e])return t.destroy(new Error("Invalid qos vector")),!1;p+=1}}let d=null;if(5===o){if(d=x(t,c,i,p),!d)return!1;p+=d.length}return t.write(r.ACKS[h][f][l][0]),_(t,p),g(t,a),null!==d&&d.write(),5===o&&t.write(n.from(u)),!0}(e,t,s);case"pingreq":case"pingresp":return function(e,t){return t.write(r.EMPTY[e.cmd])}(e,t);case"disconnect":return function(e,t,i){let o=i?i.protocolVersion:4,s=e||{},a=s.reasonCode,l=s.properties,u=5===o?1:0,c=null;if(5===o){if(c=x(t,l,i,u),!c)return!1;u+=c.length}return t.write(n.from([r.codes.disconnect<<4])),_(t,u),5===o&&t.write(n.from([a])),null!==c&&c.write(),!0}(e,t,s);case"auth":return function(e,t,i){let o=i?i.protocolVersion:4,s=e||{},a=s.reasonCode,l=s.properties,u=5===o?1:0;5!==o&&t.destroy(new Error("Invalid mqtt version for auth packet"));let c=x(t,l,i,u);return!!c&&(u+=c.length,t.write(n.from([r.codes.auth<<4])),_(t,u),t.write(n.from([a])),null!==c&&c.write(),!0)}(e,t,s);default:return t.destroy(new Error("Unknown command")),!1}}function w(e){e.uncork()}Object.defineProperty(m,"cacheNumbers",{get:()=>g===A,set(e){e?((!h||0===Object.keys(h).length)&&(b=!0),g=A):(b=!1,g=I)}});var v={};function _(e,t){if(t>r.VARBYTEINT_MAX)return e.destroy(new Error(`Invalid variable byte integer: ${t}`)),!1;let n=v[t];return n||(n=d(t),t<16384&&(v[t]=n)),c("writeVarByteInt: writing to stream: %o",n),e.write(n)}function S(e,t){let r=n.byteLength(t);return g(e,r),c("writeString: %s",t),e.write(t,"utf8")}function E(e,t,r){S(e,t),S(e,r)}function A(e,t){return c("writeNumberCached: number: %d",t),c("writeNumberCached: %o",h[t]),e.write(h[t])}function I(e,t){let r=f(t);return c("writeNumberGenerated: %o",r),e.write(r)}function k(e,t){"string"==typeof t?S(e,t):t?(g(e,t.length),e.write(t)):g(e,0)}function O(e,t){if("object"!=typeof t||null!=t.length)return{length:1,write(){T(e,{},0)}};let i=0;function o(t,i){let o=0;switch(r.propertiesTypes[t]){case"byte":if("boolean"!=typeof i)return e.destroy(new Error(`Invalid ${t}: ${i}`)),!1;o+=2;break;case"int8":if("number"!=typeof i||i<0||i>255)return e.destroy(new Error(`Invalid ${t}: ${i}`)),!1;o+=2;break;case"binary":if(i&&null===i)return e.destroy(new Error(`Invalid ${t}: ${i}`)),!1;o+=1+n.byteLength(i)+2;break;case"int16":if("number"!=typeof i||i<0||i>65535)return e.destroy(new Error(`Invalid ${t}: ${i}`)),!1;o+=3;break;case"int32":if("number"!=typeof i||i<0||i>4294967295)return e.destroy(new Error(`Invalid ${t}: ${i}`)),!1;o+=5;break;case"var":if("number"!=typeof i||i<0||i>268435455)return e.destroy(new Error(`Invalid ${t}: ${i}`)),!1;o+=1+n.byteLength(d(i));break;case"string":if("string"!=typeof i)return e.destroy(new Error(`Invalid ${t}: ${i}`)),!1;o+=3+n.byteLength(i.toString());break;case"pair":if("object"!=typeof i)return e.destroy(new Error(`Invalid ${t}: ${i}`)),!1;o+=Object.getOwnPropertyNames(i).reduce((e,t)=>{let r=i[t];return Array.isArray(r)?e+=r.reduce((e,r)=>e+=3+n.byteLength(t.toString())+2+n.byteLength(r.toString()),0):e+=3+n.byteLength(t.toString())+2+n.byteLength(i[t].toString()),e},0);break;default:return e.destroy(new Error(`Invalid property ${t}: ${i}`)),!1}return o}if(t)for(let e in t){let r=0,n=0,s=t[e];if(void 0!==s){if(Array.isArray(s))for(let t=0;t<s.length;t++){if(n=o(e,s[t]),!n)return!1;r+=n}else{if(n=o(e,s),!n)return!1;r=n}if(!r)return!1;i+=r}}return{length:n.byteLength(d(i))+i,write(){T(e,t,i)}}}function x(e,t,r,n){let i=["reasonString","userProperties"],o=r&&r.properties&&r.properties.maximumPacketSize?r.properties.maximumPacketSize:0,s=O(e,t);if(o)for(;n+s.length>o;){let r=i.shift();if(!r||!t[r])return!1;delete t[r],s=O(e,t)}return s}function P(e,t,i){switch(r.propertiesTypes[t]){case"byte":e.write(n.from([r.properties[t]])),e.write(n.from([+i]));break;case"int8":e.write(n.from([r.properties[t]])),e.write(n.from([i]));break;case"binary":e.write(n.from([r.properties[t]])),k(e,i);break;case"int16":e.write(n.from([r.properties[t]])),g(e,i);break;case"int32":e.write(n.from([r.properties[t]])),function(e,t){let r=y(t);c("write4ByteNumber: %o",r),e.write(r)}(e,i);break;case"var":e.write(n.from([r.properties[t]])),_(e,i);break;case"string":e.write(n.from([r.properties[t]])),S(e,i);break;case"pair":Object.getOwnPropertyNames(i).forEach(o=>{let s=i[o];Array.isArray(s)?s.forEach(i=>{e.write(n.from([r.properties[t]])),E(e,o.toString(),i.toString())}):(e.write(n.from([r.properties[t]])),E(e,o.toString(),s.toString()))});break;default:return e.destroy(new Error(`Invalid property ${t} value: ${i}`)),!1}}function T(e,t,r){_(e,r);for(let r in t)if(Object.prototype.hasOwnProperty.call(t,r)&&null!=t[r]){let n=t[r];if(Array.isArray(n))for(let t=0;t<n.length;t++)P(e,r,n[t]);else P(e,r,n)}}function R(e){return e?e instanceof n?e.length:n.byteLength(e):0}function C(e){return"string"==typeof e||e instanceof n}t.exports=m}),tr=o((e,t)=>{l(),tt(),Fe();var r=er(),{EventEmitter:n}=(bt(),a(st)),{Buffer:i}=(et(),a(Qe));var o=class extends n{constructor(){super(),this._array=new Array(20),this._i=0}write(e){return this._array[this._i++]=e,!0}concat(){let e,t=0,r=new Array(this._array.length),n=this._array,o=0;for(e=0;e<n.length&&void 0!==n[e];e++)"string"!=typeof n[e]?r[e]=n[e].length:r[e]=i.byteLength(n[e]),t+=r[e];let s=i.allocUnsafe(t);for(e=0;e<n.length&&void 0!==n[e];e++)"string"!=typeof n[e]?(n[e].copy(s,o),o+=r[e]):(s.write(n[e],o),o+=r[e]);return s}destroy(e){e&&this.emit("error",e)}};t.exports=function(e,t){let n=new o;return r(e,n,t),n.concat()}}),rr=o(e=>{l(),tt(),Fe(),e.parser=Jt().parser,e.generate=tr(),e.writeToStream=er()}),nr=o((e,t)=>{function r(e){return e instanceof Je?Je.from(e):new e.constructor(e.buffer.slice(),e.byteOffset,e.length)}l(),tt(),Fe(),t.exports=function(e){if((e=e||{}).circles)return function(e){let t=[],n=[],i=new Map;if(i.set(Date,e=>new Date(e)),i.set(Map,(e,t)=>new Map(s(Array.from(e),t))),i.set(Set,(e,t)=>new Set(s(Array.from(e),t))),e.constructorHandlers)for(let t of e.constructorHandlers)i.set(t[0],t[1]);let o=null;return e.proto?l:a;function s(e,s){let a=Object.keys(e),l=new Array(a.length);for(let u=0;u<a.length;u++){let c=a[u],h=e[c];if("object"!=typeof h||null===h)l[c]=h;else if(h.constructor!==Object&&(o=i.get(h.constructor)))l[c]=o(h,s);else if(ArrayBuffer.isView(h))l[c]=r(h);else{let e=t.indexOf(h);l[c]=-1!==e?n[e]:s(h)}}return l}function a(e){if("object"!=typeof e||null===e)return e;if(Array.isArray(e))return s(e,a);if(e.constructor!==Object&&(o=i.get(e.constructor)))return o(e,a);let l={};t.push(e),n.push(l);for(let s in e){if(!1===Object.hasOwnProperty.call(e,s))continue;let u=e[s];if("object"!=typeof u||null===u)l[s]=u;else if(u.constructor!==Object&&(o=i.get(u.constructor)))l[s]=o(u,a);else if(ArrayBuffer.isView(u))l[s]=r(u);else{let e=t.indexOf(u);l[s]=-1!==e?n[e]:a(u)}}return t.pop(),n.pop(),l}function l(e){if("object"!=typeof e||null===e)return e;if(Array.isArray(e))return s(e,l);if(e.constructor!==Object&&(o=i.get(e.constructor)))return o(e,l);let a={};t.push(e),n.push(a);for(let s in e){let u=e[s];if("object"!=typeof u||null===u)a[s]=u;else if(u.constructor!==Object&&(o=i.get(u.constructor)))a[s]=o(u,l);else if(ArrayBuffer.isView(u))a[s]=r(u);else{let e=t.indexOf(u);a[s]=-1!==e?n[e]:l(u)}}return t.pop(),n.pop(),a}}(e);let t=new Map;if(t.set(Date,e=>new Date(e)),t.set(Map,(e,t)=>new Map(i(Array.from(e),t))),t.set(Set,(e,t)=>new Set(i(Array.from(e),t))),e.constructorHandlers)for(let r of e.constructorHandlers)t.set(r[0],r[1]);let n=null;return e.proto?function e(o){if("object"!=typeof o||null===o)return o;if(Array.isArray(o))return i(o,e);if(o.constructor!==Object&&(n=t.get(o.constructor)))return n(o,e);let s={};for(let i in o){let a=o[i];"object"!=typeof a||null===a?s[i]=a:a.constructor!==Object&&(n=t.get(a.constructor))?s[i]=n(a,e):ArrayBuffer.isView(a)?s[i]=r(a):s[i]=e(a)}return s}:function e(o){if("object"!=typeof o||null===o)return o;if(Array.isArray(o))return i(o,e);if(o.constructor!==Object&&(n=t.get(o.constructor)))return n(o,e);let s={};for(let i in o){if(!1===Object.hasOwnProperty.call(o,i))continue;let a=o[i];"object"!=typeof a||null===a?s[i]=a:a.constructor!==Object&&(n=t.get(a.constructor))?s[i]=n(a,e):ArrayBuffer.isView(a)?s[i]=r(a):s[i]=e(a)}return s};function i(e,i){let o=Object.keys(e),s=new Array(o.length);for(let a=0;a<o.length;a++){let l=o[a],u=e[l];"object"!=typeof u||null===u?s[l]=u:u.constructor!==Object&&(n=t.get(u.constructor))?s[l]=n(u,i):ArrayBuffer.isView(u)?s[l]=r(u):s[l]=i(u)}return s}}}),ir=o((e,t)=>{l(),tt(),Fe(),t.exports=nr()()}),or=o(e=>{function t(e){let t=e.split("/");for(let e=0;e<t.length;e++)if("+"!==t[e]){if("#"===t[e])return e===t.length-1;if(-1!==t[e].indexOf("+")||-1!==t[e].indexOf("#"))return!1}return!0}l(),tt(),Fe(),Object.defineProperty(e,"__esModule",{value:!0}),e.validateTopic=t,e.validateTopics=function(e){if(0===e.length)return"empty_topic_list";for(let r=0;r<e.length;r++)if(!t(e[r]))return e[r];return null}}),sr=o(e=>{l(),tt(),Fe(),Object.defineProperty(e,"__esModule",{value:!0});var t=qt(),r={objectMode:!0},n={clean:!0};e.default=class{options;_inflights;constructor(e){this.options=e||{},this.options={...n,...e},this._inflights=new Map}put(e,t){return this._inflights.set(e.messageId,e),t&&t(),this}createStream(){let e=new t.Readable(r),n=[],i=!1,o=0;return this._inflights.forEach((e,t)=>{n.push(e)}),e._read=()=>{!i&&o<n.length?e.push(n[o++]):e.push(null)},e.destroy=t=>{if(!i)return i=!0,setTimeout(()=>{e.emit("close")},0),e},e}del(e,t){let r=this._inflights.get(e.messageId);return r?(this._inflights.delete(e.messageId),t(null,r)):t&&t(new Error("missing packet")),this}get(e,t){let r=this._inflights.get(e.messageId);return r?t(null,r):t&&t(new Error("missing packet")),this}close(e){this.options.clean&&(this._inflights=null),e&&e()}}}),ar=o(e=>{l(),tt(),Fe(),Object.defineProperty(e,"__esModule",{value:!0});var t=[0,16,128,131,135,144,145,151,153];e.default=(e,r,n)=>{e.log("handlePublish: packet %o",r),n=typeof n<"u"?n:e.noop;let i=r.topic.toString(),o=r.payload,{qos:s}=r,{messageId:a}=r,{options:l}=e;if(5===e.options.protocolVersion){let t;if(r.properties&&(t=r.properties.topicAlias),typeof t<"u")if(0===i.length){if(!(t>0&&t<=65535))return e.log("handlePublish :: topic alias out of range. alias: %d",t),void e.emit("error",new Error("Received Topic Alias is out of range"));{let r=e.topicAliasRecv.getTopicByAlias(t);if(!r)return e.log("handlePublish :: unregistered topic alias. alias: %d",t),void e.emit("error",new Error("Received unregistered Topic Alias"));i=r,e.log("handlePublish :: topic complemented by alias. topic: %s - alias: %d",i,t)}}else{if(!e.topicAliasRecv.put(i,t))return e.log("handlePublish :: topic alias out of range. alias: %d",t),void e.emit("error",new Error("Received Topic Alias is out of range"));e.log("handlePublish :: registered topic: %s - alias: %d",i,t)}}switch(e.log("handlePublish: qos %d",s),s){case 2:l.customHandleAcks(i,o,r,(i,o)=>("number"==typeof i&&(o=i,i=null),i?e.emit("error",i):-1===t.indexOf(o)?e.emit("error",new Error("Wrong reason code for pubrec")):void(o?e._sendPacket({cmd:"pubrec",messageId:a,reasonCode:o},n):e.incomingStore.put(r,()=>{e._sendPacket({cmd:"pubrec",messageId:a},n)}))));break;case 1:l.customHandleAcks(i,o,r,(s,l)=>("number"==typeof s&&(l=s,s=null),s?e.emit("error",s):-1===t.indexOf(l)?e.emit("error",new Error("Wrong reason code for puback")):(l||e.emit("message",i,o,r),void e.handleMessage(r,t=>{if(t)return n&&n(t);e._sendPacket({cmd:"puback",messageId:a,reasonCode:l},n)}))));break;case 0:e.emit("message",i,o,r),e.handleMessage(r,n);break;default:e.log("handlePublish: unknown QoS. Doing nothing.")}}}),lr=o((e,t)=>{t.exports={version:"5.14.1"}}),ur=o(e=>{l(),tt(),Fe(),Object.defineProperty(e,"__esModule",{value:!0}),e.MQTTJS_VERSION=e.nextTick=e.ErrorWithSubackPacket=e.ErrorWithReasonCode=void 0,e.applyMixin=function(e,t,r=!1){let n=[t];for(;;){let e=n[0],t=Object.getPrototypeOf(e);if(!t?.prototype)break;n.unshift(t)}for(let t of n)for(let n of Object.getOwnPropertyNames(t.prototype))(r||"constructor"!==n)&&Object.defineProperty(e.prototype,n,Object.getOwnPropertyDescriptor(t.prototype,n)??Object.create(null))};var t=class e extends Error{code;constructor(t,r){super(t),this.code=r,Object.setPrototypeOf(this,e.prototype),Object.getPrototypeOf(this).name="ErrorWithReasonCode"}};e.ErrorWithReasonCode=t;var r=class e extends Error{packet;constructor(t,r){super(t),this.packet=r,Object.setPrototypeOf(this,e.prototype),Object.getPrototypeOf(this).name="ErrorWithSubackPacket"}};e.ErrorWithSubackPacket=r,e.nextTick="function"==typeof u?.nextTick?u.nextTick:e=>{setTimeout(e,0)},e.MQTTJS_VERSION=lr().version}),cr=o(e=>{l(),tt(),Fe(),Object.defineProperty(e,"__esModule",{value:!0}),e.ReasonCodes=void 0;var t=ur();e.ReasonCodes={0:"",1:"Unacceptable protocol version",2:"Identifier rejected",3:"Server unavailable",4:"Bad username or password",5:"Not authorized",16:"No matching subscribers",17:"No subscription existed",128:"Unspecified error",129:"Malformed Packet",130:"Protocol Error",131:"Implementation specific error",132:"Unsupported Protocol Version",133:"Client Identifier not valid",134:"Bad User Name or Password",135:"Not authorized",136:"Server unavailable",137:"Server busy",138:"Banned",139:"Server shutting down",140:"Bad authentication method",141:"Keep Alive timeout",142:"Session taken over",143:"Topic Filter invalid",144:"Topic Name invalid",145:"Packet identifier in use",146:"Packet Identifier not found",147:"Receive Maximum exceeded",148:"Topic Alias invalid",149:"Packet too large",150:"Message rate too high",151:"Quota exceeded",152:"Administrative action",153:"Payload format invalid",154:"Retain not supported",155:"QoS not supported",156:"Use another server",157:"Server moved",158:"Shared Subscriptions not supported",159:"Connection rate exceeded",160:"Maximum connect time",161:"Subscription Identifiers not supported",162:"Wildcard Subscriptions not supported"};e.default=(r,n)=>{let{messageId:i}=n,o=n.cmd,s=null,a=r.outgoing[i]?r.outgoing[i].cb:null,l=null;if(a){switch(r.log("_handleAck :: packet type",o),o){case"pubcomp":case"puback":{let o=n.reasonCode;o&&o>0&&16!==o?(l=new t.ErrorWithReasonCode(`Publish error: ${e.ReasonCodes[o]}`,o),r._removeOutgoingAndStoreMessage(i,()=>{a(l,n)})):r._removeOutgoingAndStoreMessage(i,a);break}case"pubrec":{s={cmd:"pubrel",qos:2,messageId:i};let o=n.reasonCode;o&&o>0&&16!==o?(l=new t.ErrorWithReasonCode(`Publish error: ${e.ReasonCodes[o]}`,o),r._removeOutgoingAndStoreMessage(i,()=>{a(l,n)})):r._sendPacket(s);break}case"suback":{delete r.outgoing[i],r.messageIdProvider.deallocate(i);let t=n.granted;for(let n=0;n<t.length;n++){let o=t[n];if(128&o){l=new Error(`Subscribe error: ${e.ReasonCodes[o]}`),l.code=o;let t=r.messageIdToTopic[i];t&&t.forEach(e=>{delete r._resubscribeTopics[e]})}}delete r.messageIdToTopic[i],r._invokeStoreProcessingQueue(),a(l,n);break}case"unsuback":delete r.outgoing[i],r.messageIdProvider.deallocate(i),r._invokeStoreProcessingQueue(),a(null,n);break;default:r.emit("error",new Error("unrecognized packet type"))}r.disconnecting&&0===Object.keys(r.outgoing).length&&r.emit("outgoingEmpty")}else r.log("_handleAck :: Server sent an ack in error. Ignoring.")}}),hr=o(e=>{l(),tt(),Fe(),Object.defineProperty(e,"__esModule",{value:!0});var t=ur(),r=cr();e.default=(e,n)=>{let{options:i}=e,o=i.protocolVersion,s=5===o?n.reasonCode:n.returnCode;if(5!==o){let r=new t.ErrorWithReasonCode(`Protocol error: Auth packets are only supported in MQTT 5. Your version:${o}`,s);return void e.emit("error",r)}e.handleAuth(n,(n,i)=>{if(n)e.emit("error",n);else if(24===s)e.reconnecting=!1,e._sendPacket(i);else{let n=new t.ErrorWithReasonCode(`Connection refused: ${r.ReasonCodes[s]}`,s);e.emit("error",n)}})}}),fr=o(e=>{l(),tt(),Fe(),Object.defineProperty(e,"__esModule",{value:!0}),e.LRUCache=void 0;var t="object"==typeof performance&&performance&&"function"==typeof performance.now?performance:Date,r=new Set,n="object"==typeof u&&u?u:{},i=(e,t,r,i)=>{"function"==typeof n.emitWarning?n.emitWarning(e,t,r,i):console.error(`[${r}] ${t}: ${e}`)},o=globalThis.AbortController,s=globalThis.AbortSignal;if(typeof o>"u"){s=class{onabort;_onabort=[];reason;aborted=!1;addEventListener(e,t){this._onabort.push(t)}},o=class{constructor(){t()}signal=new s;abort(e){if(!this.signal.aborted){this.signal.reason=e,this.signal.aborted=!0;for(let t of this.signal._onabort)t(e);this.signal.onabort?.(e)}}};let e="1"!==n.env?.LRU_CACHE_IGNORE_AC_WARNING,t=()=>{e&&(e=!1,i("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",t))}}Symbol("type");var a=e=>e&&e===Math.floor(e)&&e>0&&isFinite(e),c=e=>a(e)?e<=Math.pow(2,8)?Uint8Array:e<=Math.pow(2,16)?Uint16Array:e<=Math.pow(2,32)?Uint32Array:e<=Number.MAX_SAFE_INTEGER?h:null:null,h=class extends Array{constructor(e){super(e),this.fill(0)}},f=class e{heap;length;static#e=!1;static create(t){let r=c(t);if(!r)return[];e.#e=!0;let n=new e(t,r);return e.#e=!1,n}constructor(t,r){if(!e.#e)throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new r(t),this.length=0}push(e){this.heap[this.length++]=e}pop(){return this.heap[--this.length]}},p=class e{#e;#t;#r;#n;#i;#o;ttl;ttlResolution;ttlAutopurge;updateAgeOnGet;updateAgeOnHas;allowStale;noDisposeOnSet;noUpdateTTL;maxEntrySize;sizeCalculation;noDeleteOnFetchRejection;noDeleteOnStaleGet;allowStaleOnFetchAbort;allowStaleOnFetchRejection;ignoreFetchAbort;#s;#a;#l;#u;#c;#h;#f;#p;#d;#y;#g;#b;#m;#w;#v;#_;#S;static unsafeExposeInternals(e){return{starts:e.#m,ttls:e.#w,sizes:e.#b,keyMap:e.#l,keyList:e.#u,valList:e.#c,next:e.#h,prev:e.#f,get head(){return e.#p},get tail(){return e.#d},free:e.#y,isBackgroundFetch:t=>e.#E(t),backgroundFetch:(t,r,n,i)=>e.#A(t,r,n,i),moveToTail:t=>e.#I(t),indexes:t=>e.#k(t),rindexes:t=>e.#O(t),isStale:t=>e.#x(t)}}get max(){return this.#e}get maxSize(){return this.#t}get calculatedSize(){return this.#a}get size(){return this.#s}get fetchMethod(){return this.#i}get memoMethod(){return this.#o}get dispose(){return this.#r}get disposeAfter(){return this.#n}constructor(t){let{max:n=0,ttl:o,ttlResolution:s=1,ttlAutopurge:l,updateAgeOnGet:u,updateAgeOnHas:h,allowStale:p,dispose:d,disposeAfter:y,noDisposeOnSet:g,noUpdateTTL:b,maxSize:m=0,maxEntrySize:w=0,sizeCalculation:v,fetchMethod:_,memoMethod:S,noDeleteOnFetchRejection:E,noDeleteOnStaleGet:A,allowStaleOnFetchRejection:I,allowStaleOnFetchAbort:k,ignoreFetchAbort:O}=t;if(0!==n&&!a(n))throw new TypeError("max option must be a nonnegative integer");let x=n?c(n):Array;if(!x)throw new Error("invalid max value: "+n);if(this.#e=n,this.#t=m,this.maxEntrySize=w||this.#t,this.sizeCalculation=v,this.sizeCalculation){if(!this.#t&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if("function"!=typeof this.sizeCalculation)throw new TypeError("sizeCalculation set to non-function")}if(void 0!==S&&"function"!=typeof S)throw new TypeError("memoMethod must be a function if defined");if(this.#o=S,void 0!==_&&"function"!=typeof _)throw new TypeError("fetchMethod must be a function if specified");if(this.#i=_,this.#_=!!_,this.#l=new Map,this.#u=new Array(n).fill(void 0),this.#c=new Array(n).fill(void 0),this.#h=new x(n),this.#f=new x(n),this.#p=0,this.#d=0,this.#y=f.create(n),this.#s=0,this.#a=0,"function"==typeof d&&(this.#r=d),"function"==typeof y?(this.#n=y,this.#g=[]):(this.#n=void 0,this.#g=void 0),this.#v=!!this.#r,this.#S=!!this.#n,this.noDisposeOnSet=!!g,this.noUpdateTTL=!!b,this.noDeleteOnFetchRejection=!!E,this.allowStaleOnFetchRejection=!!I,this.allowStaleOnFetchAbort=!!k,this.ignoreFetchAbort=!!O,0!==this.maxEntrySize){if(0!==this.#t&&!a(this.#t))throw new TypeError("maxSize must be a positive integer if specified");if(!a(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");this.#P()}if(this.allowStale=!!p,this.noDeleteOnStaleGet=!!A,this.updateAgeOnGet=!!u,this.updateAgeOnHas=!!h,this.ttlResolution=a(s)||0===s?s:1,this.ttlAutopurge=!!l,this.ttl=o||0,this.ttl){if(!a(this.ttl))throw new TypeError("ttl must be a positive integer if specified");this.#T()}if(0===this.#e&&0===this.ttl&&0===this.#t)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!this.#e&&!this.#t){let t="LRU_CACHE_UNBOUNDED";(e=>!r.has(e))(t)&&(r.add(t),i("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",t,e))}}getRemainingTTL(e){return this.#l.has(e)?1/0:0}#T(){let e=new h(this.#e),r=new h(this.#e);this.#w=e,this.#m=r,this.#R=(n,i,o=t.now())=>{if(r[n]=0!==i?o:0,e[n]=i,0!==i&&this.ttlAutopurge){let e=setTimeout(()=>{this.#x(n)&&this.#C(this.#u[n],"expire")},i+1);e.unref&&e.unref()}},this.#j=n=>{r[n]=0!==e[n]?t.now():0},this.#M=(t,o)=>{if(e[o]){let s=e[o],a=r[o];if(!s||!a)return;t.ttl=s,t.start=a,t.now=n||i();let l=t.now-a;t.remainingTTL=s-l}};let n=0,i=()=>{let e=t.now();if(this.ttlResolution>0){n=e;let t=setTimeout(()=>n=0,this.ttlResolution);t.unref&&t.unref()}return e};this.getRemainingTTL=t=>{let o=this.#l.get(t);if(void 0===o)return 0;let s=e[o],a=r[o];return s&&a?s-((n||i())-a):1/0},this.#x=t=>{let o=r[t],s=e[t];return!!s&&!!o&&(n||i())-o>s}}#j=()=>{};#M=()=>{};#R=()=>{};#x=()=>!1;#P(){let e=new h(this.#e);this.#a=0,this.#b=e,this.#B=t=>{this.#a-=e[t],e[t]=0},this.#N=(e,t,r,n)=>{if(this.#E(t))return 0;if(!a(r)){if(!n)throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");if("function"!=typeof n)throw new TypeError("sizeCalculation must be a function");if(r=n(t,e),!a(r))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}return r},this.#U=(t,r,n)=>{if(e[t]=r,this.#t){let r=this.#t-e[t];for(;this.#a>r;)this.#L(!0)}this.#a+=e[t],n&&(n.entrySize=r,n.totalCalculatedSize=this.#a)}}#B=e=>{};#U=(e,t,r)=>{};#N=(e,t,r,n)=>{if(r||n)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0};*#k({allowStale:e=this.allowStale}={}){if(this.#s)for(let t=this.#d;this.#D(t)&&((e||!this.#x(t))&&(yield t),t!==this.#p);)t=this.#f[t]}*#O({allowStale:e=this.allowStale}={}){if(this.#s)for(let t=this.#p;this.#D(t)&&((e||!this.#x(t))&&(yield t),t!==this.#d);)t=this.#h[t]}#D(e){return void 0!==e&&this.#l.get(this.#u[e])===e}*entries(){for(let e of this.#k())void 0!==this.#c[e]&&void 0!==this.#u[e]&&!this.#E(this.#c[e])&&(yield[this.#u[e],this.#c[e]])}*rentries(){for(let e of this.#O())void 0!==this.#c[e]&&void 0!==this.#u[e]&&!this.#E(this.#c[e])&&(yield[this.#u[e],this.#c[e]])}*keys(){for(let e of this.#k()){let t=this.#u[e];void 0!==t&&!this.#E(this.#c[e])&&(yield t)}}*rkeys(){for(let e of this.#O()){let t=this.#u[e];void 0!==t&&!this.#E(this.#c[e])&&(yield t)}}*values(){for(let e of this.#k())void 0!==this.#c[e]&&!this.#E(this.#c[e])&&(yield this.#c[e])}*rvalues(){for(let e of this.#O())void 0!==this.#c[e]&&!this.#E(this.#c[e])&&(yield this.#c[e])}[Symbol.iterator](){return this.entries()}[Symbol.toStringTag]="LRUCache";find(e,t={}){for(let r of this.#k()){let n=this.#c[r],i=this.#E(n)?n.__staleWhileFetching:n;if(void 0!==i&&e(i,this.#u[r],this))return this.get(this.#u[r],t)}}forEach(e,t=this){for(let r of this.#k()){let n=this.#c[r],i=this.#E(n)?n.__staleWhileFetching:n;void 0!==i&&e.call(t,i,this.#u[r],this)}}rforEach(e,t=this){for(let r of this.#O()){let n=this.#c[r],i=this.#E(n)?n.__staleWhileFetching:n;void 0!==i&&e.call(t,i,this.#u[r],this)}}purgeStale(){let e=!1;for(let t of this.#O({allowStale:!0}))this.#x(t)&&(this.#C(this.#u[t],"expire"),e=!0);return e}info(e){let r=this.#l.get(e);if(void 0===r)return;let n=this.#c[r],i=this.#E(n)?n.__staleWhileFetching:n;if(void 0===i)return;let o={value:i};if(this.#w&&this.#m){let e=this.#w[r],n=this.#m[r];if(e&&n){let r=e-(t.now()-n);o.ttl=r,o.start=Date.now()}}return this.#b&&(o.size=this.#b[r]),o}dump(){let e=[];for(let r of this.#k({allowStale:!0})){let n=this.#u[r],i=this.#c[r],o=this.#E(i)?i.__staleWhileFetching:i;if(void 0===o||void 0===n)continue;let s={value:o};if(this.#w&&this.#m){s.ttl=this.#w[r];let e=t.now()-this.#m[r];s.start=Math.floor(Date.now()-e)}this.#b&&(s.size=this.#b[r]),e.unshift([n,s])}return e}load(e){this.clear();for(let[r,n]of e){if(n.start){let e=Date.now()-n.start;n.start=t.now()-e}this.set(r,n.value,n)}}set(e,t,r={}){if(void 0===t)return this.delete(e),this;let{ttl:n=this.ttl,start:i,noDisposeOnSet:o=this.noDisposeOnSet,sizeCalculation:s=this.sizeCalculation,status:a}=r,{noUpdateTTL:l=this.noUpdateTTL}=r,u=this.#N(e,t,r.size||0,s);if(this.maxEntrySize&&u>this.maxEntrySize)return a&&(a.set="miss",a.maxEntrySizeExceeded=!0),this.#C(e,"set"),this;let c=0===this.#s?void 0:this.#l.get(e);if(void 0===c)c=0===this.#s?this.#d:0!==this.#y.length?this.#y.pop():this.#s===this.#e?this.#L(!1):this.#s,this.#u[c]=e,this.#c[c]=t,this.#l.set(e,c),this.#h[this.#d]=c,this.#f[c]=this.#d,this.#d=c,this.#s++,this.#U(c,u,a),a&&(a.set="add"),l=!1;else{this.#I(c);let r=this.#c[c];if(t!==r){if(this.#_&&this.#E(r)){r.__abortController.abort(new Error("replaced"));let{__staleWhileFetching:t}=r;void 0!==t&&!o&&(this.#v&&this.#r?.(t,e,"set"),this.#S&&this.#g?.push([t,e,"set"]))}else o||(this.#v&&this.#r?.(r,e,"set"),this.#S&&this.#g?.push([r,e,"set"]));if(this.#B(c),this.#U(c,u,a),this.#c[c]=t,a){a.set="replace";let e=r&&this.#E(r)?r.__staleWhileFetching:r;void 0!==e&&(a.oldValue=e)}}else a&&(a.set="update")}if(0!==n&&!this.#w&&this.#T(),this.#w&&(l||this.#R(c,n,i),a&&this.#M(a,c)),!o&&this.#S&&this.#g){let e,t=this.#g;for(;e=t?.shift();)this.#n?.(...e)}return this}pop(){try{for(;this.#s;){let e=this.#c[this.#p];if(this.#L(!0),this.#E(e)){if(e.__staleWhileFetching)return e.__staleWhileFetching}else if(void 0!==e)return e}}finally{if(this.#S&&this.#g){let e,t=this.#g;for(;e=t?.shift();)this.#n?.(...e)}}}#L(e){let t=this.#p,r=this.#u[t],n=this.#c[t];return this.#_&&this.#E(n)?n.__abortController.abort(new Error("evicted")):(this.#v||this.#S)&&(this.#v&&this.#r?.(n,r,"evict"),this.#S&&this.#g?.push([n,r,"evict"])),this.#B(t),e&&(this.#u[t]=void 0,this.#c[t]=void 0,this.#y.push(t)),1===this.#s?(this.#p=this.#d=0,this.#y.length=0):this.#p=this.#h[t],this.#l.delete(r),this.#s--,t}has(e,t={}){let{updateAgeOnHas:r=this.updateAgeOnHas,status:n}=t,i=this.#l.get(e);if(void 0!==i){let e=this.#c[i];if(this.#E(e)&&void 0===e.__staleWhileFetching)return!1;if(!this.#x(i))return r&&this.#j(i),n&&(n.has="hit",this.#M(n,i)),!0;n&&(n.has="stale",this.#M(n,i))}else n&&(n.has="miss");return!1}peek(e,t={}){let{allowStale:r=this.allowStale}=t,n=this.#l.get(e);if(void 0===n||!r&&this.#x(n))return;let i=this.#c[n];return this.#E(i)?i.__staleWhileFetching:i}#A(e,t,r,n){let i=void 0===t?void 0:this.#c[t];if(this.#E(i))return i;let s=new o,{signal:a}=r;a?.addEventListener("abort",()=>s.abort(a.reason),{signal:s.signal});let l={signal:s.signal,options:r,context:n},u=(n,i=!1)=>{let{aborted:o}=s.signal,a=r.ignoreFetchAbort&&void 0!==n;if(r.status&&(o&&!i?(r.status.fetchAborted=!0,r.status.fetchError=s.signal.reason,a&&(r.status.fetchAbortIgnored=!0)):r.status.fetchResolved=!0),o&&!a&&!i)return c(s.signal.reason);let u=h;return this.#c[t]===h&&(void 0===n?u.__staleWhileFetching?this.#c[t]=u.__staleWhileFetching:this.#C(e,"fetch"):(r.status&&(r.status.fetchUpdated=!0),this.set(e,n,l.options))),n},c=n=>{let{aborted:i}=s.signal,o=i&&r.allowStaleOnFetchAbort,a=o||r.allowStaleOnFetchRejection,l=a||r.noDeleteOnFetchRejection,u=h;if(this.#c[t]===h&&(l&&void 0!==u.__staleWhileFetching?o||(this.#c[t]=u.__staleWhileFetching):this.#C(e,"fetch")),a)return r.status&&void 0!==u.__staleWhileFetching&&(r.status.returnedStale=!0),u.__staleWhileFetching;if(u.__returned===u)throw n};r.status&&(r.status.fetchDispatched=!0);let h=new Promise((t,n)=>{let o=this.#i?.(e,i,l);o&&o instanceof Promise&&o.then(e=>t(void 0===e?void 0:e),n),s.signal.addEventListener("abort",()=>{(!r.ignoreFetchAbort||r.allowStaleOnFetchAbort)&&(t(void 0),r.allowStaleOnFetchAbort&&(t=e=>u(e,!0)))})}).then(u,e=>(r.status&&(r.status.fetchRejected=!0,r.status.fetchError=e),c(e))),f=Object.assign(h,{__abortController:s,__staleWhileFetching:i,__returned:void 0});return void 0===t?(this.set(e,f,{...l.options,status:void 0}),t=this.#l.get(e)):this.#c[t]=f,f}#E(e){if(!this.#_)return!1;let t=e;return!!t&&t instanceof Promise&&t.hasOwnProperty("__staleWhileFetching")&&t.__abortController instanceof o}async fetch(e,t={}){let{allowStale:r=this.allowStale,updateAgeOnGet:n=this.updateAgeOnGet,noDeleteOnStaleGet:i=this.noDeleteOnStaleGet,ttl:o=this.ttl,noDisposeOnSet:s=this.noDisposeOnSet,size:a=0,sizeCalculation:l=this.sizeCalculation,noUpdateTTL:u=this.noUpdateTTL,noDeleteOnFetchRejection:c=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:h=this.allowStaleOnFetchRejection,ignoreFetchAbort:f=this.ignoreFetchAbort,allowStaleOnFetchAbort:p=this.allowStaleOnFetchAbort,context:d,forceRefresh:y=!1,status:g,signal:b}=t;if(!this.#_)return g&&(g.fetch="get"),this.get(e,{allowStale:r,updateAgeOnGet:n,noDeleteOnStaleGet:i,status:g});let m={allowStale:r,updateAgeOnGet:n,noDeleteOnStaleGet:i,ttl:o,noDisposeOnSet:s,size:a,sizeCalculation:l,noUpdateTTL:u,noDeleteOnFetchRejection:c,allowStaleOnFetchRejection:h,allowStaleOnFetchAbort:p,ignoreFetchAbort:f,status:g,signal:b},w=this.#l.get(e);if(void 0===w){g&&(g.fetch="miss");let t=this.#A(e,w,m,d);return t.__returned=t}{let t=this.#c[w];if(this.#E(t)){let e=r&&void 0!==t.__staleWhileFetching;return g&&(g.fetch="inflight",e&&(g.returnedStale=!0)),e?t.__staleWhileFetching:t.__returned=t}let i=this.#x(w);if(!y&&!i)return g&&(g.fetch="hit"),this.#I(w),n&&this.#j(w),g&&this.#M(g,w),t;let o=this.#A(e,w,m,d),s=void 0!==o.__staleWhileFetching&&r;return g&&(g.fetch=i?"stale":"refresh",s&&i&&(g.returnedStale=!0)),s?o.__staleWhileFetching:o.__returned=o}}async forceFetch(e,t={}){let r=await this.fetch(e,t);if(void 0===r)throw new Error("fetch() returned undefined");return r}memo(e,t={}){let r=this.#o;if(!r)throw new Error("no memoMethod provided to constructor");let{context:n,forceRefresh:i,...o}=t,s=this.get(e,o);if(!i&&void 0!==s)return s;let a=r(e,s,{options:o,context:n});return this.set(e,a,o),a}get(e,t={}){let{allowStale:r=this.allowStale,updateAgeOnGet:n=this.updateAgeOnGet,noDeleteOnStaleGet:i=this.noDeleteOnStaleGet,status:o}=t,s=this.#l.get(e);if(void 0!==s){let t=this.#c[s],a=this.#E(t);return o&&this.#M(o,s),this.#x(s)?(o&&(o.get="stale"),a?(o&&r&&void 0!==t.__staleWhileFetching&&(o.returnedStale=!0),r?t.__staleWhileFetching:void 0):(i||this.#C(e,"expire"),o&&r&&(o.returnedStale=!0),r?t:void 0)):(o&&(o.get="hit"),a?t.__staleWhileFetching:(this.#I(s),n&&this.#j(s),t))}o&&(o.get="miss")}#F(e,t){this.#f[t]=e,this.#h[e]=t}#I(e){e!==this.#d&&(e===this.#p?this.#p=this.#h[e]:this.#F(this.#f[e],this.#h[e]),this.#F(this.#d,e),this.#d=e)}delete(e){return this.#C(e,"delete")}#C(e,t){let r=!1;if(0!==this.#s){let n=this.#l.get(e);if(void 0!==n)if(r=!0,1===this.#s)this.#W(t);else{this.#B(n);let r=this.#c[n];if(this.#E(r)?r.__abortController.abort(new Error("deleted")):(this.#v||this.#S)&&(this.#v&&this.#r?.(r,e,t),this.#S&&this.#g?.push([r,e,t])),this.#l.delete(e),this.#u[n]=void 0,this.#c[n]=void 0,n===this.#d)this.#d=this.#f[n];else if(n===this.#p)this.#p=this.#h[n];else{let e=this.#f[n];this.#h[e]=this.#h[n];let t=this.#h[n];this.#f[t]=this.#f[n]}this.#s--,this.#y.push(n)}}if(this.#S&&this.#g?.length){let e,t=this.#g;for(;e=t?.shift();)this.#n?.(...e)}return r}clear(){return this.#W("delete")}#W(e){for(let t of this.#O({allowStale:!0})){let r=this.#c[t];if(this.#E(r))r.__abortController.abort(new Error("deleted"));else{let n=this.#u[t];this.#v&&this.#r?.(r,n,e),this.#S&&this.#g?.push([r,n,e])}}if(this.#l.clear(),this.#c.fill(void 0),this.#u.fill(void 0),this.#w&&this.#m&&(this.#w.fill(0),this.#m.fill(0)),this.#b&&this.#b.fill(0),this.#p=0,this.#d=0,this.#y.length=0,this.#a=0,this.#s=0,this.#S&&this.#g){let e,t=this.#g;for(;e=t?.shift();)this.#n?.(...e)}}};e.LRUCache=p}),pr=o(e=>{l(),tt(),Fe(),Object.defineProperty(e,"t",{value:!0}),e.ContainerIterator=e.Container=e.Base=void 0;e.ContainerIterator=class{constructor(e=0){this.iteratorType=e}equals(e){return this.o===e.o}};var t=class{constructor(){this.i=0}get length(){return this.i}size(){return this.i}empty(){return 0===this.i}};e.Base=t;e.Container=class extends t{}}),dr=o(e=>{l(),tt(),Fe(),Object.defineProperty(e,"t",{value:!0}),e.default=void 0;var t=pr(),r=class extends t.Base{constructor(e=[]){super(),this.S=[];let t=this;e.forEach(function(e){t.push(e)})}clear(){this.i=0,this.S=[]}push(e){return this.S.push(e),this.i+=1,this.i}pop(){if(0!==this.i)return this.i-=1,this.S.pop()}top(){return this.S[this.i-1]}};e.default=r}),yr=o(e=>{l(),tt(),Fe(),Object.defineProperty(e,"t",{value:!0}),e.default=void 0;var t=pr(),r=class extends t.Base{constructor(e=[]){super(),this.j=0,this.q=[];let t=this;e.forEach(function(e){t.push(e)})}clear(){this.q=[],this.i=this.j=0}push(e){let t=this.q.length;if(this.j/t>.5&&this.j+this.i>=t&&t>4096){let t=this.i;for(let e=0;e<t;++e)this.q[e]=this.q[this.j+e];this.j=0,this.q[this.i]=e}else this.q[this.j+this.i]=e;return++this.i}pop(){if(0===this.i)return;let e=this.q[this.j++];return this.i-=1,e}front(){if(0!==this.i)return this.q[this.j]}};e.default=r}),gr=o(e=>{l(),tt(),Fe(),Object.defineProperty(e,"t",{value:!0}),e.default=void 0;var t=pr(),r=class extends t.Base{constructor(e=[],t=function(e,t){return e>t?-1:e<t?1:0},r=!0){if(super(),this.v=t,Array.isArray(e))this.C=r?[...e]:e;else{this.C=[];let t=this;e.forEach(function(e){t.C.push(e)})}this.i=this.C.length;let n=this.i>>1;for(let e=this.i-1>>1;e>=0;--e)this.k(e,n)}m(e){let t=this.C[e];for(;e>0;){let r=e-1>>1,n=this.C[r];if(this.v(n,t)<=0)break;this.C[e]=n,e=r}this.C[e]=t}k(e,t){let r=this.C[e];for(;e<t;){let t=e<<1|1,n=t+1,i=this.C[t];if(n<this.i&&this.v(i,this.C[n])>0&&(t=n,i=this.C[n]),this.v(i,r)>=0)break;this.C[e]=i,e=t}this.C[e]=r}clear(){this.i=0,this.C.length=0}push(e){this.C.push(e),this.m(this.i),this.i+=1}pop(){if(0===this.i)return;let e=this.C[0],t=this.C.pop();return this.i-=1,this.i&&(this.C[0]=t,this.k(0,this.i>>1)),e}top(){return this.C[0]}find(e){return this.C.indexOf(e)>=0}remove(e){let t=this.C.indexOf(e);return!(t<0)&&(0===t?this.pop():t===this.i-1?(this.C.pop(),this.i-=1):(this.C.splice(t,1,this.C.pop()),this.i-=1,this.m(t),this.k(t,this.i>>1)),!0)}updateItem(e){let t=this.C.indexOf(e);return!(t<0)&&(this.m(t),this.k(t,this.i>>1),!0)}toArray(){return[...this.C]}};e.default=r}),br=o(e=>{l(),tt(),Fe(),Object.defineProperty(e,"t",{value:!0}),e.default=void 0;var t=pr(),r=class extends t.Container{};e.default=r}),mr=o(e=>{l(),tt(),Fe(),Object.defineProperty(e,"t",{value:!0}),e.throwIteratorAccessError=function(){throw new RangeError("Iterator access denied!")}}),wr=o(e=>{l(),tt(),Fe(),Object.defineProperty(e,"t",{value:!0}),e.RandomIterator=void 0;var t=pr(),r=mr(),n=class extends t.ContainerIterator{constructor(e,t){super(t),this.o=e,0===this.iteratorType?(this.pre=function(){return 0===this.o&&(0,r.throwIteratorAccessError)(),this.o-=1,this},this.next=function(){return this.o===this.container.size()&&(0,r.throwIteratorAccessError)(),this.o+=1,this}):(this.pre=function(){return this.o===this.container.size()-1&&(0,r.throwIteratorAccessError)(),this.o+=1,this},this.next=function(){return-1===this.o&&(0,r.throwIteratorAccessError)(),this.o-=1,this})}get pointer(){return this.container.getElementByPos(this.o)}set pointer(e){this.container.setElementByPos(this.o,e)}};e.RandomIterator=n}),vr=o(e=>{l(),tt(),Fe(),Object.defineProperty(e,"t",{value:!0}),e.default=void 0;var t,r=(t=br())&&t.t?t:{default:t},n=wr();var i=class e extends n.RandomIterator{constructor(e,t,r){super(e,r),this.container=t}copy(){return new e(this.o,this.container,this.iteratorType)}},o=class extends r.default{constructor(e=[],t=!0){if(super(),Array.isArray(e))this.J=t?[...e]:e,this.i=e.length;else{this.J=[];let t=this;e.forEach(function(e){t.pushBack(e)})}}clear(){this.i=0,this.J.length=0}begin(){return new i(0,this)}end(){return new i(this.i,this)}rBegin(){return new i(this.i-1,this,1)}rEnd(){return new i(-1,this,1)}front(){return this.J[0]}back(){return this.J[this.i-1]}getElementByPos(e){if(e<0||e>this.i-1)throw new RangeError;return this.J[e]}eraseElementByPos(e){if(e<0||e>this.i-1)throw new RangeError;return this.J.splice(e,1),this.i-=1,this.i}eraseElementByValue(e){let t=0;for(let r=0;r<this.i;++r)this.J[r]!==e&&(this.J[t++]=this.J[r]);return this.i=this.J.length=t,this.i}eraseElementByIterator(e){let t=e.o;return e=e.next(),this.eraseElementByPos(t),e}pushBack(e){return this.J.push(e),this.i+=1,this.i}popBack(){if(0!==this.i)return this.i-=1,this.J.pop()}setElementByPos(e,t){if(e<0||e>this.i-1)throw new RangeError;this.J[e]=t}insert(e,t,r=1){if(e<0||e>this.i)throw new RangeError;return this.J.splice(e,0,...new Array(r).fill(t)),this.i+=r,this.i}find(e){for(let t=0;t<this.i;++t)if(this.J[t]===e)return new i(t,this);return this.end()}reverse(){this.J.reverse()}unique(){let e=1;for(let t=1;t<this.i;++t)this.J[t]!==this.J[t-1]&&(this.J[e++]=this.J[t]);return this.i=this.J.length=e,this.i}sort(e){this.J.sort(e)}forEach(e){for(let t=0;t<this.i;++t)e(this.J[t],t,this)}[Symbol.iterator](){return function*(){yield*this.J}.bind(this)()}};e.default=o}),_r=o(e=>{l(),tt(),Fe(),Object.defineProperty(e,"t",{value:!0}),e.default=void 0;var t,r=(t=br())&&t.t?t:{default:t},n=pr(),i=mr();var o=class e extends n.ContainerIterator{constructor(e,t,r,n){super(n),this.o=e,this.h=t,this.container=r,0===this.iteratorType?(this.pre=function(){return this.o.L===this.h&&(0,i.throwIteratorAccessError)(),this.o=this.o.L,this},this.next=function(){return this.o===this.h&&(0,i.throwIteratorAccessError)(),this.o=this.o.B,this}):(this.pre=function(){return this.o.B===this.h&&(0,i.throwIteratorAccessError)(),this.o=this.o.B,this},this.next=function(){return this.o===this.h&&(0,i.throwIteratorAccessError)(),this.o=this.o.L,this})}get pointer(){return this.o===this.h&&(0,i.throwIteratorAccessError)(),this.o.l}set pointer(e){this.o===this.h&&(0,i.throwIteratorAccessError)(),this.o.l=e}copy(){return new e(this.o,this.h,this.container,this.iteratorType)}},s=class extends r.default{constructor(e=[]){super(),this.h={},this.p=this._=this.h.L=this.h.B=this.h;let t=this;e.forEach(function(e){t.pushBack(e)})}V(e){let{L:t,B:r}=e;t.B=r,r.L=t,e===this.p&&(this.p=r),e===this._&&(this._=t),this.i-=1}G(e,t){let r=t.B,n={l:e,L:t,B:r};t.B=n,r.L=n,t===this.h&&(this.p=n),r===this.h&&(this._=n),this.i+=1}clear(){this.i=0,this.p=this._=this.h.L=this.h.B=this.h}begin(){return new o(this.p,this.h,this)}end(){return new o(this.h,this.h,this)}rBegin(){return new o(this._,this.h,this,1)}rEnd(){return new o(this.h,this.h,this,1)}front(){return this.p.l}back(){return this._.l}getElementByPos(e){if(e<0||e>this.i-1)throw new RangeError;let t=this.p;for(;e--;)t=t.B;return t.l}eraseElementByPos(e){if(e<0||e>this.i-1)throw new RangeError;let t=this.p;for(;e--;)t=t.B;return this.V(t),this.i}eraseElementByValue(e){let t=this.p;for(;t!==this.h;)t.l===e&&this.V(t),t=t.B;return this.i}eraseElementByIterator(e){let t=e.o;return t===this.h&&(0,i.throwIteratorAccessError)(),e=e.next(),this.V(t),e}pushBack(e){return this.G(e,this._),this.i}popBack(){if(0===this.i)return;let e=this._.l;return this.V(this._),e}pushFront(e){return this.G(e,this.h),this.i}popFront(){if(0===this.i)return;let e=this.p.l;return this.V(this.p),e}setElementByPos(e,t){if(e<0||e>this.i-1)throw new RangeError;let r=this.p;for(;e--;)r=r.B;r.l=t}insert(e,t,r=1){if(e<0||e>this.i)throw new RangeError;if(r<=0)return this.i;if(0===e)for(;r--;)this.pushFront(t);else if(e===this.i)for(;r--;)this.pushBack(t);else{let n=this.p;for(let t=1;t<e;++t)n=n.B;let i=n.B;for(this.i+=r;r--;)n.B={l:t,L:n},n.B.L=n,n=n.B;n.B=i,i.L=n}return this.i}find(e){let t=this.p;for(;t!==this.h;){if(t.l===e)return new o(t,this.h,this);t=t.B}return this.end()}reverse(){if(this.i<=1)return;let e=this.p,t=this._,r=0;for(;r<<1<this.i;){let n=e.l;e.l=t.l,t.l=n,e=e.B,t=t.L,r+=1}}unique(){if(this.i<=1)return this.i;let e=this.p;for(;e!==this.h;){let t=e;for(;t.B!==this.h&&t.l===t.B.l;)t=t.B,this.i-=1;e.B=t.B,e.B.L=e,e=e.B}return this.i}sort(e){if(this.i<=1)return;let t=[];this.forEach(function(e){t.push(e)}),t.sort(e);let r=this.p;t.forEach(function(e){r.l=e,r=r.B})}merge(e){let t=this;if(0===this.i)e.forEach(function(e){t.pushBack(e)});else{let r=this.p;e.forEach(function(e){for(;r!==t.h&&r.l<=e;)r=r.B;t.G(e,r.L)})}return this.i}forEach(e){let t=this.p,r=0;for(;t!==this.h;)e(t.l,r++,this),t=t.B}[Symbol.iterator](){return function*(){if(0===this.i)return;let e=this.p;for(;e!==this.h;)yield e.l,e=e.B}.bind(this)()}};e.default=s}),Sr=o(e=>{l(),tt(),Fe(),Object.defineProperty(e,"t",{value:!0}),e.default=void 0;var t,r=(t=br())&&t.t?t:{default:t},n=wr();var i=class e extends n.RandomIterator{constructor(e,t,r){super(e,r),this.container=t}copy(){return new e(this.o,this.container,this.iteratorType)}},o=class extends r.default{constructor(e=[],t=4096){super(),this.j=0,this.D=0,this.R=0,this.N=0,this.P=0,this.A=[];let r=(()=>{if("number"==typeof e.length)return e.length;if("number"==typeof e.size)return e.size;if("function"==typeof e.size)return e.size();throw new TypeError("Cannot get the length or size of the container")})();this.F=t,this.P=Math.max(Math.ceil(r/this.F),1);for(let e=0;e<this.P;++e)this.A.push(new Array(this.F));let n=Math.ceil(r/this.F);this.j=this.R=(this.P>>1)-(n>>1),this.D=this.N=this.F-r%this.F>>1;let i=this;e.forEach(function(e){i.pushBack(e)})}T(){let e=[],t=Math.max(this.P>>1,1);for(let r=0;r<t;++r)e[r]=new Array(this.F);for(let t=this.j;t<this.P;++t)e[e.length]=this.A[t];for(let t=0;t<this.R;++t)e[e.length]=this.A[t];e[e.length]=[...this.A[this.R]],this.j=t,this.R=e.length-1;for(let r=0;r<t;++r)e[e.length]=new Array(this.F);this.A=e,this.P=e.length}O(e){let t=this.D+e+1,r=t%this.F,n=r-1,i=this.j+(t-r)/this.F;return 0===r&&(i-=1),i%=this.P,n<0&&(n+=this.F),{curNodeBucketIndex:i,curNodePointerIndex:n}}clear(){this.A=[new Array(this.F)],this.P=1,this.j=this.R=this.i=0,this.D=this.N=this.F>>1}begin(){return new i(0,this)}end(){return new i(this.i,this)}rBegin(){return new i(this.i-1,this,1)}rEnd(){return new i(-1,this,1)}front(){if(0!==this.i)return this.A[this.j][this.D]}back(){if(0!==this.i)return this.A[this.R][this.N]}pushBack(e){return this.i&&(this.N<this.F-1?this.N+=1:this.R<this.P-1?(this.R+=1,this.N=0):(this.R=0,this.N=0),this.R===this.j&&this.N===this.D&&this.T()),this.i+=1,this.A[this.R][this.N]=e,this.i}popBack(){if(0===this.i)return;let e=this.A[this.R][this.N];return 1!==this.i&&(this.N>0?this.N-=1:this.R>0?(this.R-=1,this.N=this.F-1):(this.R=this.P-1,this.N=this.F-1)),this.i-=1,e}pushFront(e){return this.i&&(this.D>0?this.D-=1:this.j>0?(this.j-=1,this.D=this.F-1):(this.j=this.P-1,this.D=this.F-1),this.j===this.R&&this.D===this.N&&this.T()),this.i+=1,this.A[this.j][this.D]=e,this.i}popFront(){if(0===this.i)return;let e=this.A[this.j][this.D];return 1!==this.i&&(this.D<this.F-1?this.D+=1:this.j<this.P-1?(this.j+=1,this.D=0):(this.j=0,this.D=0)),this.i-=1,e}getElementByPos(e){if(e<0||e>this.i-1)throw new RangeError;let{curNodeBucketIndex:t,curNodePointerIndex:r}=this.O(e);return this.A[t][r]}setElementByPos(e,t){if(e<0||e>this.i-1)throw new RangeError;let{curNodeBucketIndex:r,curNodePointerIndex:n}=this.O(e);this.A[r][n]=t}insert(e,t,r=1){if(e<0||e>this.i)throw new RangeError;if(0===e)for(;r--;)this.pushFront(t);else if(e===this.i)for(;r--;)this.pushBack(t);else{let n=[];for(let t=e;t<this.i;++t)n.push(this.getElementByPos(t));this.cut(e-1);for(let e=0;e<r;++e)this.pushBack(t);for(let e=0;e<n.length;++e)this.pushBack(n[e])}return this.i}cut(e){if(e<0)return this.clear(),0;let{curNodeBucketIndex:t,curNodePointerIndex:r}=this.O(e);return this.R=t,this.N=r,this.i=e+1,this.i}eraseElementByPos(e){if(e<0||e>this.i-1)throw new RangeError;if(0===e)this.popFront();else if(e===this.i-1)this.popBack();else{let t=[];for(let r=e+1;r<this.i;++r)t.push(this.getElementByPos(r));this.cut(e),this.popBack();let r=this;t.forEach(function(e){r.pushBack(e)})}return this.i}eraseElementByValue(e){if(0===this.i)return 0;let t=[];for(let r=0;r<this.i;++r){let n=this.getElementByPos(r);n!==e&&t.push(n)}let r=t.length;for(let e=0;e<r;++e)this.setElementByPos(e,t[e]);return this.cut(r-1)}eraseElementByIterator(e){let t=e.o;return this.eraseElementByPos(t),e=e.next()}find(e){for(let t=0;t<this.i;++t)if(this.getElementByPos(t)===e)return new i(t,this);return this.end()}reverse(){let e=0,t=this.i-1;for(;e<t;){let r=this.getElementByPos(e);this.setElementByPos(e,this.getElementByPos(t)),this.setElementByPos(t,r),e+=1,t-=1}}unique(){if(this.i<=1)return this.i;let e=1,t=this.getElementByPos(0);for(let r=1;r<this.i;++r){let n=this.getElementByPos(r);n!==t&&(t=n,this.setElementByPos(e++,n))}for(;this.i>e;)this.popBack();return this.i}sort(e){let t=[];for(let e=0;e<this.i;++e)t.push(this.getElementByPos(e));t.sort(e);for(let e=0;e<this.i;++e)this.setElementByPos(e,t[e])}shrinkToFit(){if(0===this.i)return;let e=[];this.forEach(function(t){e.push(t)}),this.P=Math.max(Math.ceil(this.i/this.F),1),this.i=this.j=this.R=this.D=this.N=0,this.A=[];for(let e=0;e<this.P;++e)this.A.push(new Array(this.F));for(let t=0;t<e.length;++t)this.pushBack(e[t])}forEach(e){for(let t=0;t<this.i;++t)e(this.getElementByPos(t),t,this)}[Symbol.iterator](){return function*(){for(let e=0;e<this.i;++e)yield this.getElementByPos(e)}.bind(this)()}};e.default=o}),Er=o(e=>{l(),tt(),Fe(),Object.defineProperty(e,"t",{value:!0}),e.TreeNodeEnableIndex=e.TreeNode=void 0;var t=class{constructor(e,t){this.ee=1,this.u=void 0,this.l=void 0,this.U=void 0,this.W=void 0,this.tt=void 0,this.u=e,this.l=t}L(){let e=this;if(1===e.ee&&e.tt.tt===e)e=e.W;else if(e.U)for(e=e.U;e.W;)e=e.W;else{let t=e.tt;for(;t.U===e;)e=t,t=e.tt;e=t}return e}B(){let e=this;if(e.W){for(e=e.W;e.U;)e=e.U;return e}{let t=e.tt;for(;t.W===e;)e=t,t=e.tt;return e.W!==t?t:e}}te(){let e=this.tt,t=this.W,r=t.U;return e.tt===this?e.tt=t:e.U===this?e.U=t:e.W=t,t.tt=e,t.U=this,this.tt=t,this.W=r,r&&(r.tt=this),t}se(){let e=this.tt,t=this.U,r=t.W;return e.tt===this?e.tt=t:e.U===this?e.U=t:e.W=t,t.tt=e,t.W=this,this.tt=t,this.U=r,r&&(r.tt=this),t}};e.TreeNode=t;e.TreeNodeEnableIndex=class extends t{constructor(){super(...arguments),this.rt=1}te(){let e=super.te();return this.ie(),e.ie(),e}se(){let e=super.se();return this.ie(),e.ie(),e}ie(){this.rt=1,this.U&&(this.rt+=this.U.rt),this.W&&(this.rt+=this.W.rt)}}}),Ar=o(e=>{l(),tt(),Fe(),Object.defineProperty(e,"t",{value:!0}),e.default=void 0;var t=Er(),r=pr(),n=mr(),i=class extends r.Container{constructor(e=function(e,t){return e<t?-1:e>t?1:0},r=!1){super(),this.Y=void 0,this.v=e,r?(this.re=t.TreeNodeEnableIndex,this.M=function(e,t,r){let n=this.ne(e,t,r);if(n){let e=n.tt;for(;e!==this.h;)e.rt+=1,e=e.tt;let t=this.he(n);if(t){let{parentNode:e,grandParent:r,curNode:n}=t;e.ie(),r.ie(),n.ie()}}return this.i},this.V=function(e){let t=this.fe(e);for(;t!==this.h;)t.rt-=1,t=t.tt}):(this.re=t.TreeNode,this.M=function(e,t,r){let n=this.ne(e,t,r);return n&&this.he(n),this.i},this.V=this.fe),this.h=new this.re}X(e,t){let r=this.h;for(;e;){let n=this.v(e.u,t);if(n<0)e=e.W;else{if(!(n>0))return e;r=e,e=e.U}}return r}Z(e,t){let r=this.h;for(;e;)this.v(e.u,t)<=0?e=e.W:(r=e,e=e.U);return r}$(e,t){let r=this.h;for(;e;){let n=this.v(e.u,t);if(n<0)r=e,e=e.W;else{if(!(n>0))return e;e=e.U}}return r}rr(e,t){let r=this.h;for(;e;)this.v(e.u,t)<0?(r=e,e=e.W):e=e.U;return r}ue(e){for(;;){let t=e.tt;if(t===this.h)return;if(1===e.ee)return void(e.ee=0);if(e===t.U){let r=t.W;if(1===r.ee)r.ee=0,t.ee=1,t===this.Y?this.Y=t.te():t.te();else{if(r.W&&1===r.W.ee)return r.ee=t.ee,t.ee=0,r.W.ee=0,void(t===this.Y?this.Y=t.te():t.te());r.U&&1===r.U.ee?(r.ee=1,r.U.ee=0,r.se()):(r.ee=1,e=t)}}else{let r=t.U;if(1===r.ee)r.ee=0,t.ee=1,t===this.Y?this.Y=t.se():t.se();else{if(r.U&&1===r.U.ee)return r.ee=t.ee,t.ee=0,r.U.ee=0,void(t===this.Y?this.Y=t.se():t.se());r.W&&1===r.W.ee?(r.ee=1,r.W.ee=0,r.te()):(r.ee=1,e=t)}}}}fe(e){if(1===this.i)return this.clear(),this.h;let t=e;for(;t.U||t.W;){if(t.W)for(t=t.W;t.U;)t=t.U;else t=t.U;[e.u,t.u]=[t.u,e.u],[e.l,t.l]=[t.l,e.l],e=t}this.h.U===t?this.h.U=t.tt:this.h.W===t&&(this.h.W=t.tt),this.ue(t);let r=t.tt;return t===r.U?r.U=void 0:r.W=void 0,this.i-=1,this.Y.ee=0,r}oe(e,t){return void 0!==e&&(!(!this.oe(e.U,t)&&!t(e))||this.oe(e.W,t))}he(e){for(;;){let t=e.tt;if(0===t.ee)return;let r=t.tt;if(t===r.U){let n=r.W;if(n&&1===n.ee){if(n.ee=t.ee=0,r===this.Y)return;r.ee=1,e=r;continue}if(e===t.W){if(e.ee=0,e.U&&(e.U.tt=t),e.W&&(e.W.tt=r),t.W=e.U,r.U=e.W,e.U=t,e.W=r,r===this.Y)this.Y=e,this.h.tt=e;else{let t=r.tt;t.U===r?t.U=e:t.W=e}return e.tt=r.tt,t.tt=e,r.tt=e,r.ee=1,{parentNode:t,grandParent:r,curNode:e}}t.ee=0,r===this.Y?this.Y=r.se():r.se(),r.ee=1}else{let n=r.U;if(n&&1===n.ee){if(n.ee=t.ee=0,r===this.Y)return;r.ee=1,e=r;continue}if(e===t.U){if(e.ee=0,e.U&&(e.U.tt=r),e.W&&(e.W.tt=t),r.W=e.U,t.U=e.W,e.U=r,e.W=t,r===this.Y)this.Y=e,this.h.tt=e;else{let t=r.tt;t.U===r?t.U=e:t.W=e}return e.tt=r.tt,t.tt=e,r.tt=e,r.ee=1,{parentNode:t,grandParent:r,curNode:e}}t.ee=0,r===this.Y?this.Y=r.te():r.te(),r.ee=1}return}}ne(e,t,r){if(void 0===this.Y)return this.i+=1,this.Y=new this.re(e,t),this.Y.ee=0,this.Y.tt=this.h,this.h.tt=this.Y,this.h.U=this.Y,void(this.h.W=this.Y);let n,i=this.h.U,o=this.v(i.u,e);if(0!==o){if(o>0)i.U=new this.re(e,t),i.U.tt=i,n=i.U,this.h.U=n;else{let i=this.h.W,o=this.v(i.u,e);if(0===o)return void(i.l=t);if(o<0)i.W=new this.re(e,t),i.W.tt=i,n=i.W,this.h.W=n;else{if(void 0!==r){let i=r.o;if(i!==this.h){let r=this.v(i.u,e);if(0===r)return void(i.l=t);if(r>0){let r=i.L(),o=this.v(r.u,e);if(0===o)return void(r.l=t);o<0&&(n=new this.re(e,t),void 0===r.W?(r.W=n,n.tt=r):(i.U=n,n.tt=i))}}}if(void 0===n)for(n=this.Y;;){let r=this.v(n.u,e);if(r>0){if(void 0===n.U){n.U=new this.re(e,t),n.U.tt=n,n=n.U;break}n=n.U}else{if(!(r<0))return void(n.l=t);if(void 0===n.W){n.W=new this.re(e,t),n.W.tt=n,n=n.W;break}n=n.W}}}}return this.i+=1,n}i.l=t}I(e,t){for(;e;){let r=this.v(e.u,t);if(r<0)e=e.W;else{if(!(r>0))return e;e=e.U}}return e||this.h}clear(){this.i=0,this.Y=void 0,this.h.tt=void 0,this.h.U=this.h.W=void 0}updateKeyByIterator(e,t){let r=e.o;if(r===this.h&&(0,n.throwIteratorAccessError)(),1===this.i)return r.u=t,!0;if(r===this.h.U)return this.v(r.B().u,t)>0&&(r.u=t,!0);if(r===this.h.W)return this.v(r.L().u,t)<0&&(r.u=t,!0);let i=r.L().u;if(this.v(i,t)>=0)return!1;let o=r.B().u;return!(this.v(o,t)<=0)&&(r.u=t,!0)}eraseElementByPos(e){if(e<0||e>this.i-1)throw new RangeError;let t=0,r=this;return this.oe(this.Y,function(n){return e===t?(r.V(n),!0):(t+=1,!1)}),this.i}eraseElementByKey(e){if(0===this.i)return!1;let t=this.I(this.Y,e);return t!==this.h&&(this.V(t),!0)}eraseElementByIterator(e){let t=e.o;t===this.h&&(0,n.throwIteratorAccessError)();let r=void 0===t.W;return 0===e.iteratorType?r&&e.next():(!r||void 0===t.U)&&e.next(),this.V(t),e}forEach(e){let t=0;for(let r of this)e(r,t++,this)}getElementByPos(e){if(e<0||e>this.i-1)throw new RangeError;let t,r=0;for(let n of this){if(r===e){t=n;break}r+=1}return t}getHeight(){if(0===this.i)return 0;let e=function(t){return t?Math.max(e(t.U),e(t.W))+1:0};return e(this.Y)}};e.default=i}),Ir=o(e=>{l(),tt(),Fe(),Object.defineProperty(e,"t",{value:!0}),e.default=void 0;var t=pr(),r=mr(),n=class extends t.ContainerIterator{constructor(e,t,n){super(n),this.o=e,this.h=t,0===this.iteratorType?(this.pre=function(){return this.o===this.h.U&&(0,r.throwIteratorAccessError)(),this.o=this.o.L(),this},this.next=function(){return this.o===this.h&&(0,r.throwIteratorAccessError)(),this.o=this.o.B(),this}):(this.pre=function(){return this.o===this.h.W&&(0,r.throwIteratorAccessError)(),this.o=this.o.B(),this},this.next=function(){return this.o===this.h&&(0,r.throwIteratorAccessError)(),this.o=this.o.L(),this})}get index(){let e=this.o,t=this.h.tt;if(e===this.h)return t?t.rt-1:0;let r=0;for(e.U&&(r+=e.U.rt);e!==t;){let t=e.tt;e===t.W&&(r+=1,t.U&&(r+=t.U.rt)),e=t}return r}};e.default=n}),kr=o(e=>{l(),tt(),Fe(),Object.defineProperty(e,"t",{value:!0}),e.default=void 0;var t=i(Ar()),r=i(Ir()),n=mr();function i(e){return e&&e.t?e:{default:e}}var o=class e extends r.default{constructor(e,t,r,n){super(e,t,n),this.container=r}get pointer(){return this.o===this.h&&(0,n.throwIteratorAccessError)(),this.o.u}copy(){return new e(this.o,this.h,this.container,this.iteratorType)}},s=class extends t.default{constructor(e=[],t,r){super(t,r);let n=this;e.forEach(function(e){n.insert(e)})}*K(e){void 0!==e&&(yield*this.K(e.U),yield e.u,yield*this.K(e.W))}begin(){return new o(this.h.U||this.h,this.h,this)}end(){return new o(this.h,this.h,this)}rBegin(){return new o(this.h.W||this.h,this.h,this,1)}rEnd(){return new o(this.h,this.h,this,1)}front(){return this.h.U?this.h.U.u:void 0}back(){return this.h.W?this.h.W.u:void 0}insert(e,t){return this.M(e,void 0,t)}find(e){let t=this.I(this.Y,e);return new o(t,this.h,this)}lowerBound(e){let t=this.X(this.Y,e);return new o(t,this.h,this)}upperBound(e){let t=this.Z(this.Y,e);return new o(t,this.h,this)}reverseLowerBound(e){let t=this.$(this.Y,e);return new o(t,this.h,this)}reverseUpperBound(e){let t=this.rr(this.Y,e);return new o(t,this.h,this)}union(e){let t=this;return e.forEach(function(e){t.insert(e)}),this.i}[Symbol.iterator](){return this.K(this.Y)}};e.default=s}),Or=o(e=>{l(),tt(),Fe(),Object.defineProperty(e,"t",{value:!0}),e.default=void 0;var t=i(Ar()),r=i(Ir()),n=mr();function i(e){return e&&e.t?e:{default:e}}var o=class e extends r.default{constructor(e,t,r,n){super(e,t,n),this.container=r}get pointer(){this.o===this.h&&(0,n.throwIteratorAccessError)();let e=this;return new Proxy([],{get:(t,r)=>"0"===r?e.o.u:"1"===r?e.o.l:void 0,set(t,r,n){if("1"!==r)throw new TypeError("props must be 1");return e.o.l=n,!0}})}copy(){return new e(this.o,this.h,this.container,this.iteratorType)}},s=class extends t.default{constructor(e=[],t,r){super(t,r);let n=this;e.forEach(function(e){n.setElement(e[0],e[1])})}*K(e){void 0!==e&&(yield*this.K(e.U),yield[e.u,e.l],yield*this.K(e.W))}begin(){return new o(this.h.U||this.h,this.h,this)}end(){return new o(this.h,this.h,this)}rBegin(){return new o(this.h.W||this.h,this.h,this,1)}rEnd(){return new o(this.h,this.h,this,1)}front(){if(0===this.i)return;let e=this.h.U;return[e.u,e.l]}back(){if(0===this.i)return;let e=this.h.W;return[e.u,e.l]}lowerBound(e){let t=this.X(this.Y,e);return new o(t,this.h,this)}upperBound(e){let t=this.Z(this.Y,e);return new o(t,this.h,this)}reverseLowerBound(e){let t=this.$(this.Y,e);return new o(t,this.h,this)}reverseUpperBound(e){let t=this.rr(this.Y,e);return new o(t,this.h,this)}setElement(e,t,r){return this.M(e,t,r)}find(e){let t=this.I(this.Y,e);return new o(t,this.h,this)}getElementByKey(e){return this.I(this.Y,e).l}union(e){let t=this;return e.forEach(function(e){t.setElement(e[0],e[1])}),this.i}[Symbol.iterator](){return this.K(this.Y)}};e.default=s}),xr=o(e=>{l(),tt(),Fe(),Object.defineProperty(e,"t",{value:!0}),e.default=function(e){let t=typeof e;return"object"===t&&null!==e||"function"===t}}),Pr=o(e=>{l(),tt(),Fe(),Object.defineProperty(e,"t",{value:!0}),e.HashContainerIterator=e.HashContainer=void 0;var t,r=pr(),n=(t=xr())&&t.t?t:{default:t},i=mr();var o=class extends r.ContainerIterator{constructor(e,t,r){super(r),this.o=e,this.h=t,0===this.iteratorType?(this.pre=function(){return this.o.L===this.h&&(0,i.throwIteratorAccessError)(),this.o=this.o.L,this},this.next=function(){return this.o===this.h&&(0,i.throwIteratorAccessError)(),this.o=this.o.B,this}):(this.pre=function(){return this.o.B===this.h&&(0,i.throwIteratorAccessError)(),this.o=this.o.B,this},this.next=function(){return this.o===this.h&&(0,i.throwIteratorAccessError)(),this.o=this.o.L,this})}};e.HashContainerIterator=o;var s=class extends r.Container{constructor(){super(),this.H=[],this.g={},this.HASH_TAG=Symbol("@@HASH_TAG"),Object.setPrototypeOf(this.g,null),this.h={},this.h.L=this.h.B=this.p=this._=this.h}V(e){let{L:t,B:r}=e;t.B=r,r.L=t,e===this.p&&(this.p=r),e===this._&&(this._=t),this.i-=1}M(e,t,r){let i;if(void 0===r&&(r=(0,n.default)(e)),r){let r=e[this.HASH_TAG];if(void 0!==r)return this.H[r].l=t,this.i;Object.defineProperty(e,this.HASH_TAG,{value:this.H.length,configurable:!0}),i={u:e,l:t,L:this._,B:this.h},this.H.push(i)}else{let r=this.g[e];if(r)return r.l=t,this.i;i={u:e,l:t,L:this._,B:this.h},this.g[e]=i}return 0===this.i?(this.p=i,this.h.B=i):this._.B=i,this._=i,this.h.L=i,++this.i}I(e,t){if(void 0===t&&(t=(0,n.default)(e)),t){let t=e[this.HASH_TAG];return void 0===t?this.h:this.H[t]}return this.g[e]||this.h}clear(){let e=this.HASH_TAG;this.H.forEach(function(t){delete t.u[e]}),this.H=[],this.g={},Object.setPrototypeOf(this.g,null),this.i=0,this.p=this._=this.h.L=this.h.B=this.h}eraseElementByKey(e,t){let r;if(void 0===t&&(t=(0,n.default)(e)),t){let t=e[this.HASH_TAG];if(void 0===t)return!1;delete e[this.HASH_TAG],r=this.H[t],delete this.H[t]}else{if(r=this.g[e],void 0===r)return!1;delete this.g[e]}return this.V(r),!0}eraseElementByIterator(e){let t=e.o;return t===this.h&&(0,i.throwIteratorAccessError)(),this.V(t),e.next()}eraseElementByPos(e){if(e<0||e>this.i-1)throw new RangeError;let t=this.p;for(;e--;)t=t.B;return this.V(t),this.i}};e.HashContainer=s}),Tr=o(e=>{l(),tt(),Fe(),Object.defineProperty(e,"t",{value:!0}),e.default=void 0;var t=Pr(),r=mr(),n=class e extends t.HashContainerIterator{constructor(e,t,r,n){super(e,t,n),this.container=r}get pointer(){return this.o===this.h&&(0,r.throwIteratorAccessError)(),this.o.u}copy(){return new e(this.o,this.h,this.container,this.iteratorType)}},i=class extends t.HashContainer{constructor(e=[]){super();let t=this;e.forEach(function(e){t.insert(e)})}begin(){return new n(this.p,this.h,this)}end(){return new n(this.h,this.h,this)}rBegin(){return new n(this._,this.h,this,1)}rEnd(){return new n(this.h,this.h,this,1)}front(){return this.p.u}back(){return this._.u}insert(e,t){return this.M(e,void 0,t)}getElementByPos(e){if(e<0||e>this.i-1)throw new RangeError;let t=this.p;for(;e--;)t=t.B;return t.u}find(e,t){let r=this.I(e,t);return new n(r,this.h,this)}forEach(e){let t=0,r=this.p;for(;r!==this.h;)e(r.u,t++,this),r=r.B}[Symbol.iterator](){return function*(){let e=this.p;for(;e!==this.h;)yield e.u,e=e.B}.bind(this)()}};e.default=i}),Rr=o(e=>{l(),tt(),Fe(),Object.defineProperty(e,"t",{value:!0}),e.default=void 0;var t,r=Pr(),n=(t=xr())&&t.t?t:{default:t},i=mr();var o=class e extends r.HashContainerIterator{constructor(e,t,r,n){super(e,t,n),this.container=r}get pointer(){this.o===this.h&&(0,i.throwIteratorAccessError)();let e=this;return new Proxy([],{get:(t,r)=>"0"===r?e.o.u:"1"===r?e.o.l:void 0,set(t,r,n){if("1"!==r)throw new TypeError("props must be 1");return e.o.l=n,!0}})}copy(){return new e(this.o,this.h,this.container,this.iteratorType)}},s=class extends r.HashContainer{constructor(e=[]){super();let t=this;e.forEach(function(e){t.setElement(e[0],e[1])})}begin(){return new o(this.p,this.h,this)}end(){return new o(this.h,this.h,this)}rBegin(){return new o(this._,this.h,this,1)}rEnd(){return new o(this.h,this.h,this,1)}front(){if(0!==this.i)return[this.p.u,this.p.l]}back(){if(0!==this.i)return[this._.u,this._.l]}setElement(e,t,r){return this.M(e,t,r)}getElementByKey(e,t){if(void 0===t&&(t=(0,n.default)(e)),t){let t=e[this.HASH_TAG];return void 0!==t?this.H[t].l:void 0}let r=this.g[e];return r?r.l:void 0}getElementByPos(e){if(e<0||e>this.i-1)throw new RangeError;let t=this.p;for(;e--;)t=t.B;return[t.u,t.l]}find(e,t){let r=this.I(e,t);return new o(r,this.h,this)}forEach(e){let t=0,r=this.p;for(;r!==this.h;)e([r.u,r.l],t++,this),r=r.B}[Symbol.iterator](){return function*(){let e=this.p;for(;e!==this.h;)yield[e.u,e.l],e=e.B}.bind(this)()}};e.default=s}),Cr=o(e=>{l(),tt(),Fe(),Object.defineProperty(e,"t",{value:!0}),Object.defineProperty(e,"Deque",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(e,"HashMap",{enumerable:!0,get:function(){return h.default}}),Object.defineProperty(e,"HashSet",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(e,"LinkList",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(e,"OrderedMap",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(e,"OrderedSet",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(e,"PriorityQueue",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(e,"Queue",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(e,"Stack",{enumerable:!0,get:function(){return t.default}}),Object.defineProperty(e,"Vector",{enumerable:!0,get:function(){return i.default}});var t=f(dr()),r=f(yr()),n=f(gr()),i=f(vr()),o=f(_r()),s=f(Sr()),a=f(kr()),u=f(Or()),c=f(Tr()),h=f(Rr());function f(e){return e&&e.t?e:{default:e}}}),jr=o((e,t)=>{l(),tt(),Fe();var r=Cr().OrderedSet,n=Yt()("number-allocator:trace"),i=Yt()("number-allocator:error");function o(e,t){this.low=e,this.high=t}function s(e,t){if(!(this instanceof s))return new s(e,t);this.min=e,this.max=t,this.ss=new r([],(e,t)=>e.compare(t)),n("Create"),this.clear()}o.prototype.equals=function(e){return this.low===e.low&&this.high===e.high},o.prototype.compare=function(e){return this.low<e.low&&this.high<e.low?-1:e.low<this.low&&e.high<this.low?1:0},s.prototype.firstVacant=function(){return 0===this.ss.size()?null:this.ss.front().low},s.prototype.alloc=function(){if(0===this.ss.size())return n("alloc():empty"),null;let e=this.ss.begin(),t=e.pointer.low,r=e.pointer.high,i=t;return i+1<=r?this.ss.updateKeyByIterator(e,new o(t+1,r)):this.ss.eraseElementByPos(0),n("alloc():"+i),i},s.prototype.use=function(e){let t=new o(e,e),r=this.ss.lowerBound(t);if(!r.equals(this.ss.end())){let i=r.pointer.low,s=r.pointer.high;return r.pointer.equals(t)?(this.ss.eraseElementByIterator(r),n("use():"+e),!0):!(i>e)&&(i===e?(this.ss.updateKeyByIterator(r,new o(i+1,s)),n("use():"+e),!0):s===e?(this.ss.updateKeyByIterator(r,new o(i,s-1)),n("use():"+e),!0):(this.ss.updateKeyByIterator(r,new o(e+1,s)),this.ss.insert(new o(i,e-1)),n("use():"+e),!0))}return n("use():failed"),!1},s.prototype.free=function(e){if(e<this.min||e>this.max)return void i("free():"+e+" is out of range");let t=new o(e,e),r=this.ss.upperBound(t);if(r.equals(this.ss.end())){if(r.equals(this.ss.begin()))return void this.ss.insert(t);r.pre();let n=r.pointer.high;r.pointer.high+1===e?this.ss.updateKeyByIterator(r,new o(n,e)):this.ss.insert(t)}else if(r.equals(this.ss.begin()))if(e+1===r.pointer.low){let t=r.pointer.high;this.ss.updateKeyByIterator(r,new o(e,t))}else this.ss.insert(t);else{let n=r.pointer.low,i=r.pointer.high;r.pre();let s=r.pointer.low;r.pointer.high+1===e?e+1===n?(this.ss.eraseElementByIterator(r),this.ss.updateKeyByIterator(r,new o(s,i))):this.ss.updateKeyByIterator(r,new o(s,e)):e+1===n?(this.ss.eraseElementByIterator(r.next()),this.ss.insert(new o(e,i))):this.ss.insert(t)}n("free():"+e)},s.prototype.clear=function(){n("clear()"),this.ss.clear(),this.ss.insert(new o(this.min,this.max))},s.prototype.intervalCount=function(){return this.ss.size()},s.prototype.dump=function(){console.log("length:"+this.ss.size());for(let e of this.ss)console.log(e)},t.exports=s}),Mr=o((e,t)=>{l(),tt(),Fe();var r=jr();t.exports.NumberAllocator=r}),Br=o(e=>{l(),tt(),Fe(),Object.defineProperty(e,"__esModule",{value:!0});var t=fr(),r=Mr();e.default=class{aliasToTopic;topicToAlias;max;numberAllocator;length;constructor(e){e>0&&(this.aliasToTopic=new t.LRUCache({max:e}),this.topicToAlias={},this.numberAllocator=new r.NumberAllocator(1,e),this.max=e,this.length=0)}put(e,t){if(0===t||t>this.max)return!1;let r=this.aliasToTopic.get(t);return r&&delete this.topicToAlias[r],this.aliasToTopic.set(t,e),this.topicToAlias[e]=t,this.numberAllocator.use(t),this.length=this.aliasToTopic.size,!0}getTopicByAlias(e){return this.aliasToTopic.get(e)}getAliasByTopic(e){let t=this.topicToAlias[e];return typeof t<"u"&&this.aliasToTopic.get(t),t}clear(){this.aliasToTopic.clear(),this.topicToAlias={},this.numberAllocator.clear(),this.length=0}getLruAlias(){return this.numberAllocator.firstVacant()||[...this.aliasToTopic.keys()][this.aliasToTopic.size-1]}}}),Nr=o(e=>{l(),tt(),Fe();var t=e&&e.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(e,"__esModule",{value:!0});var r=cr(),n=t(Br()),i=ur();e.default=(e,t)=>{e.log("_handleConnack");let{options:o}=e,s=5===o.protocolVersion?t.reasonCode:t.returnCode;if(clearTimeout(e.connackTimer),delete e.topicAliasSend,t.properties){if(t.properties.topicAliasMaximum){if(t.properties.topicAliasMaximum>65535)return void e.emit("error",new Error("topicAliasMaximum from broker is out of range"));t.properties.topicAliasMaximum>0&&(e.topicAliasSend=new n.default(t.properties.topicAliasMaximum))}t.properties.serverKeepAlive&&o.keepalive&&(o.keepalive=t.properties.serverKeepAlive),t.properties.maximumPacketSize&&(o.properties||(o.properties={}),o.properties.maximumPacketSize=t.properties.maximumPacketSize)}if(0===s)e.reconnecting=!1,e._onConnect(t);else if(s>0){let t=new i.ErrorWithReasonCode(`Connection refused: ${r.ReasonCodes[s]}`,s);e.emit("error",t),e.options.reconnectOnConnackError&&e._cleanUp(!0)}}}),Ur=o(e=>{l(),tt(),Fe(),Object.defineProperty(e,"__esModule",{value:!0});e.default=(e,t,r)=>{e.log("handling pubrel packet");let n=typeof r<"u"?r:e.noop,{messageId:i}=t,o={cmd:"pubcomp",messageId:i};e.incomingStore.get(t,(t,r)=>{t?e._sendPacket(o,n):(e.emit("message",r.topic,r.payload,r),e.handleMessage(r,t=>{if(t)return n(t);e.incomingStore.del(r,e.noop),e._sendPacket(o,n)}))})}}),Lr=o(e=>{l(),tt(),Fe();var t=e&&e.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(e,"__esModule",{value:!0});var r=t(ar()),n=t(hr()),i=t(Nr()),o=t(cr()),s=t(Ur());e.default=(e,t,a)=>{let{options:l}=e;if(5===l.protocolVersion&&l.properties&&l.properties.maximumPacketSize&&l.properties.maximumPacketSize<t.length)return e.emit("error",new Error(`exceeding packets size ${t.cmd}`)),e.end({reasonCode:149,properties:{reasonString:"Maximum packet size was exceeded"}}),e;switch(e.log("_handlePacket :: emitting packetreceive"),e.emit("packetreceive",t),t.cmd){case"publish":(0,r.default)(e,t,a);break;case"puback":case"pubrec":case"pubcomp":case"suback":case"unsuback":e.reschedulePing(),(0,o.default)(e,t),a();break;case"pubrel":e.reschedulePing(),(0,s.default)(e,t,a);break;case"connack":(0,i.default)(e,t),a();break;case"auth":e.reschedulePing(),(0,n.default)(e,t),a();break;case"pingresp":e.log("_handlePacket :: received pingresp"),e.reschedulePing(!0),a();break;case"disconnect":e.emit("disconnect",t),a();break;default:e.log("_handlePacket :: unknown command"),a()}}}),Dr=o(e=>{l(),tt(),Fe(),Object.defineProperty(e,"__esModule",{value:!0});e.default=class{nextId;constructor(){this.nextId=Math.max(1,Math.floor(65535*Math.random()))}allocate(){let e=this.nextId++;return 65536===this.nextId&&(this.nextId=1),e}getLastAllocated(){return 1===this.nextId?65535:this.nextId-1}register(e){return!0}deallocate(e){}clear(){}}}),Fr=o(e=>{l(),tt(),Fe(),Object.defineProperty(e,"__esModule",{value:!0});e.default=class{aliasToTopic;max;length;constructor(e){this.aliasToTopic={},this.max=e}put(e,t){return!(0===t||t>this.max)&&(this.aliasToTopic[t]=e,this.length=Object.keys(this.aliasToTopic).length,!0)}getTopicByAlias(e){return this.aliasToTopic[e]}clear(){this.aliasToTopic={}}}}),Wr=o(e=>{l(),tt(),Fe();var t=e&&e.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(e,"__esModule",{value:!0}),e.TypedEventEmitter=void 0;var r=t((bt(),a(st))),n=ur(),i=class{};e.TypedEventEmitter=i,(0,n.applyMixin)(i,r.default)}),qr=o((e,t)=>{function r(e){return t.exports=r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t.exports.__esModule=!0,t.exports.default=t.exports,r(e)}l(),tt(),Fe(),t.exports=r,t.exports.__esModule=!0,t.exports.default=t.exports}),$r=o((e,t)=>{l(),tt(),Fe();var r=qr().default;t.exports=function(e,t){if("object"!=r(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=r(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)},t.exports.__esModule=!0,t.exports.default=t.exports}),Hr=o((e,t)=>{l(),tt(),Fe();var r=qr().default,n=$r();t.exports=function(e){var t=n(e,"string");return"symbol"==r(t)?t:t+""},t.exports.__esModule=!0,t.exports.default=t.exports}),Vr=o((e,t)=>{l(),tt(),Fe();var r=Hr();t.exports=function(e,t,n){return(t=r(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},t.exports.__esModule=!0,t.exports.default=t.exports}),zr=o((e,t)=>{l(),tt(),Fe(),t.exports=function(e){if(Array.isArray(e))return e},t.exports.__esModule=!0,t.exports.default=t.exports}),Kr=o((e,t)=>{l(),tt(),Fe(),t.exports=function(e,t){var r=null==e?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,s,a=[],l=!0,u=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=o.call(r)).done)&&(a.push(n.value),a.length!==t);l=!0);}catch(e){u=!0,i=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(u)throw i}}return a}},t.exports.__esModule=!0,t.exports.default=t.exports}),Gr=o((e,t)=>{l(),tt(),Fe(),t.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n},t.exports.__esModule=!0,t.exports.default=t.exports}),Qr=o((e,t)=>{l(),tt(),Fe();var r=Gr();t.exports=function(e,t){if(e){if("string"==typeof e)return r(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}},t.exports.__esModule=!0,t.exports.default=t.exports}),Yr=o((e,t)=>{l(),tt(),Fe(),t.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},t.exports.__esModule=!0,t.exports.default=t.exports}),Jr=o((e,t)=>{l(),tt(),Fe();var r=zr(),n=Kr(),i=Qr(),o=Yr();t.exports=function(e,t){return r(e)||n(e,t)||i(e,t)||o()},t.exports.__esModule=!0,t.exports.default=t.exports}),Xr=o((e,t)=>{var r,n;l(),tt(),Fe(),r=e,n=function(e){var t,r=void 0===Number.MAX_SAFE_INTEGER?9007199254740991:Number.MAX_SAFE_INTEGER,n=536870912,i=2*n,o=new WeakMap,s=function(e,t){return function(o){var s=t.get(o),a=void 0===s?o.size:s<i?s+1:0;if(!o.has(a))return e(o,a);if(o.size<n){for(;o.has(a);)a=Math.floor(Math.random()*i);return e(o,a)}if(o.size>r)throw new Error("Congratulations, you created a collection of unique numbers which uses all available integers!");for(;o.has(a);)a=Math.floor(Math.random()*r);return e(o,a)}}((t=o,function(e,r){return t.set(e,r),r}),o),a=function(e){return function(t){var r=e(t);return t.add(r),r}}(s);e.addUniqueNumber=a,e.generateUniqueNumber=s},"object"==typeof e&&typeof t<"u"?n(e):"function"==typeof define&&define.amd?define(["exports"],n):n((r=typeof globalThis<"u"?globalThis:r||self).fastUniqueNumbers={})}),Zr=o((e,t)=>{function r(e,t,r,n,i,o,s){try{var a=e[o](s),l=a.value}catch(e){return void r(e)}a.done?t(l):Promise.resolve(l).then(n,i)}l(),tt(),Fe(),t.exports=function(e){return function(){var t=this,n=arguments;return new Promise(function(i,o){var s=e.apply(t,n);function a(e){r(s,i,o,a,l,"next",e)}function l(e){r(s,i,o,a,l,"throw",e)}a(void 0)})}},t.exports.__esModule=!0,t.exports.default=t.exports}),en=o((e,t)=>{l(),tt(),Fe(),t.exports=function(e,t){this.v=e,this.k=t},t.exports.__esModule=!0,t.exports.default=t.exports}),tn=o((e,t)=>{function r(e,n,i,o){var s=Object.defineProperty;try{s({},"",{})}catch(n){s=0}t.exports=r=function(e,t,n,i){function o(t,n){r(e,t,function(e){return this._invoke(t,n,e)})}t?s?s(e,t,{value:n,enumerable:!i,configurable:!i,writable:!i}):e[t]=n:(o("next",0),o("throw",1),o("return",2))},t.exports.__esModule=!0,t.exports.default=t.exports,r(e,n,i,o)}l(),tt(),Fe(),t.exports=r,t.exports.__esModule=!0,t.exports.default=t.exports}),rn=o((e,t)=>{l(),tt(),Fe();var r=tn();function n(){var e,i,o="function"==typeof Symbol?Symbol:{},s=o.iterator||"@@iterator",a=o.toStringTag||"@@toStringTag";function l(t,n,o,s){var a=n&&n.prototype instanceof c?n:c,l=Object.create(a.prototype);return r(l,"_invoke",function(t,r,n){var o,s,a,l=0,c=n||[],h=!1,f={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,r){return o=t,s=0,a=e,f.n=r,u}};function p(t,r){for(s=t,a=r,i=0;!h&&l&&!n&&i<c.length;i++){var n,o=c[i],p=f.p,d=o[2];t>3?(n=d===r)&&(a=o[(s=o[4])?5:(s=3,3)],o[4]=o[5]=e):o[0]<=p&&((n=t<2&&p<o[1])?(s=0,f.v=r,f.n=o[1]):p<d&&(n=t<3||o[0]>r||r>d)&&(o[4]=t,o[5]=r,f.n=d,s=0))}if(n||t>1)return u;throw h=!0,r}return function(n,c,d){if(l>1)throw TypeError("Generator is already running");for(h&&1===c&&p(c,d),s=c,a=d;(i=s<2?e:a)||!h;){o||(s?s<3?(s>1&&(f.n=-1),p(s,a)):f.n=a:f.v=a);try{if(l=2,o){if(s||(n="next"),i=o[n]){if(!(i=i.call(o,a)))throw TypeError("iterator result is not an object");if(!i.done)return i;a=i.value,s<2&&(s=0)}else 1===s&&(i=o.return)&&i.call(o),s<2&&(a=TypeError("The iterator does not provide a '"+n+"' method"),s=1);o=e}else if((i=(h=f.n<0)?a:t.call(r,f))!==u)break}catch(t){o=e,s=1,a=t}finally{l=1}}return{value:i,done:h}}}(t,o,s),!0),l}var u={};function c(){}function h(){}function f(){}i=Object.getPrototypeOf;var p=[][s]?i(i([][s]())):(r(i={},s,function(){return this}),i),d=f.prototype=c.prototype=Object.create(p);function y(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,r(e,a,"GeneratorFunction")),e.prototype=Object.create(d),e}return h.prototype=f,r(d,"constructor",f),r(f,"constructor",h),h.displayName="GeneratorFunction",r(f,a,"GeneratorFunction"),r(d),r(d,a,"Generator"),r(d,s,function(){return this}),r(d,"toString",function(){return"[object Generator]"}),(t.exports=n=function(){return{w:l,m:y}},t.exports.__esModule=!0,t.exports.default=t.exports)()}t.exports=n,t.exports.__esModule=!0,t.exports.default=t.exports}),nn=o((e,t)=>{l(),tt(),Fe();var r=en(),n=tn();t.exports=function e(t,i){function o(e,n,s,a){try{var l=t[e](n),u=l.value;return u instanceof r?i.resolve(u.v).then(function(e){o("next",e,s,a)},function(e){o("throw",e,s,a)}):i.resolve(u).then(function(e){l.value=e,s(l)},function(e){return o("throw",e,s,a)})}catch(e){a(e)}}var s;this.next||(n(e.prototype),n(e.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",function(){return this})),n(this,"_invoke",function(e,t,r){function n(){return new i(function(t,n){o(e,r,t,n)})}return s=s?s.then(n,n):n()},!0)},t.exports.__esModule=!0,t.exports.default=t.exports}),on=o((e,t)=>{l(),tt(),Fe();var r=rn(),n=nn();t.exports=function(e,t,i,o,s){return new n(r().w(e,t,i,o),s||Promise)},t.exports.__esModule=!0,t.exports.default=t.exports}),sn=o((e,t)=>{l(),tt(),Fe();var r=on();t.exports=function(e,t,n,i,o){var s=r(e,t,n,i,o);return s.next().then(function(e){return e.done?e.value:s.next()})},t.exports.__esModule=!0,t.exports.default=t.exports}),an=o((e,t)=>{l(),tt(),Fe(),t.exports=function(e){var t=Object(e),r=[];for(var n in t)r.unshift(n);return function e(){for(;r.length;)if((n=r.pop())in t)return e.value=n,e.done=!1,e;return e.done=!0,e}},t.exports.__esModule=!0,t.exports.default=t.exports}),ln=o((e,t)=>{l(),tt(),Fe();var r=qr().default;t.exports=function(e){if(null!=e){var t=e["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],n=0;if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}throw new TypeError(r(e)+" is not iterable")},t.exports.__esModule=!0,t.exports.default=t.exports}),un=o((e,t)=>{l(),tt(),Fe();var r=en(),n=rn(),i=sn(),o=on(),s=nn(),a=an(),u=ln();function c(){var e=n(),l=e.m(c),h=(Object.getPrototypeOf?Object.getPrototypeOf(l):l.__proto__).constructor;function f(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))}var p={throw:1,return:2,break:3,continue:3};function d(e){var t,r;return function(n){t||(t={stop:function(){return r(n.a,2)},catch:function(){return n.v},abrupt:function(e,t){return r(n.a,p[e],t)},delegateYield:function(e,i,o){return t.resultName=i,r(n.d,u(e),o)},finish:function(e){return r(n.f,e)}},r=function(e,r,i){n.p=t.prev,n.n=t.next;try{return e(r,i)}finally{t.next=n.n}}),t.resultName&&(t[t.resultName]=n.v,t.resultName=void 0),t.sent=n.v,t.next=n.n;try{return e.call(this,t)}finally{n.p=t.prev,n.n=t.next}}}return(t.exports=c=function(){return{wrap:function(t,r,n,i){return e.w(d(t),r,n,i&&i.reverse())},isGeneratorFunction:f,mark:e.m,awrap:function(e,t){return new r(e,t)},AsyncIterator:s,async:function(e,t,r,n,s){return(f(t)?o:i)(d(e),t,r,n,s)},keys:a,values:u}},t.exports.__esModule=!0,t.exports.default=t.exports)()}t.exports=c,t.exports.__esModule=!0,t.exports.default=t.exports}),cn=o((e,t)=>{l(),tt(),Fe();var r=un()();t.exports=r;try{regeneratorRuntime=r}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=r:Function("r","regeneratorRuntime = r")(r)}}),hn=o((e,t)=>{var r,n;l(),tt(),Fe(),r=e,n=function(e,t,r,n,i,o){var s=new WeakMap;function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function l(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?a(Object(n),!0).forEach(function(r){t(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function c(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?u(Object(n),!0).forEach(function(r){t(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var h=new WeakMap;e.createBroker=function(e){var a=function(e){return l(l({},e),{},{connect:function(e){var t=e.call;return i(o.mark(function e(){var r,n,i,a;return o.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new MessageChannel,n=r.port1,i=r.port2,e.next=1,t("connect",{port:n},[n]);case 1:return a=e.sent,s.set(i,a),e.abrupt("return",i);case 2:case"end":return e.stop()}},e)}))},disconnect:function(e){var t,r=e.call;return t=i(o.mark(function e(t){var n;return o.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==(n=s.get(t))){e.next=1;break}throw new Error("The given port is not connected.");case 1:return e.next=2,r("disconnect",{portId:n});case 2:case"end":return e.stop()}},e)})),function(e){return t.apply(this,arguments)}},isSupported:function(e){var t=e.call;return function(){return t("isSupported")}}})}(e);return function(e){var i=function(e){if(h.has(e))return h.get(e);var t=new Map;return h.set(e,t),t}(e);e.addEventListener("message",function(e){var t=e.data,r=t.id;if(null!==r&&i.has(r)){var n=i.get(r),o=n.reject,s=n.resolve;i.delete(r),void 0===t.error?s(t.result):o(new Error(t.error.message))}}),function(e){return"function"==typeof e.start}(e)&&e.start();for(var o=function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return new Promise(function(s,a){var l=n.generateUniqueNumber(i);i.set(l,{reject:a,resolve:s}),null===r?e.postMessage({id:l,method:t},o):e.postMessage({id:l,method:t,params:r},o)})},s=function(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];e.postMessage({id:null,method:t,params:r},n)},l={},u=0,f=Object.entries(a);u<f.length;u++){var p=r(f[u],2),d=p[0],y=p[1];l=c(c({},l),{},t({},d,y({call:o,notify:s})))}return c({},l)}}},"object"==typeof e&&typeof t<"u"?n(e,Vr(),Jr(),Xr(),Zr(),cn()):"function"==typeof define&&define.amd?define(["exports","@babel/runtime/helpers/defineProperty","@babel/runtime/helpers/slicedToArray","fast-unique-numbers","@babel/runtime/helpers/asyncToGenerator","@babel/runtime/regenerator"],n):n((r=typeof globalThis<"u"?globalThis:r||self).brokerFactory={},r._defineProperty,r._slicedToArray,r.fastUniqueNumbers,r._asyncToGenerator,r._regeneratorRuntime)}),fn=o((e,t)=>{var r,n;l(),tt(),Fe(),r=e,n=function(e,t,r,n){var i=new Map([[0,null]]),o=new Map([[0,null]]),s=r.createBroker({clearInterval:function(e){var r=e.call;return function(e){"symbol"===t(i.get(e))&&(i.set(e,null),r("clear",{timerId:e,timerType:"interval"}).then(function(){i.delete(e)}))}},clearTimeout:function(e){var r=e.call;return function(e){"symbol"===t(o.get(e))&&(o.set(e,null),r("clear",{timerId:e,timerType:"timeout"}).then(function(){o.delete(e)}))}},setInterval:function(e){var t=e.call;return function(e){for(var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length,s=new Array(o>2?o-2:0),a=2;a<o;a++)s[a-2]=arguments[a];var l=Symbol(),u=n.generateUniqueNumber(i);i.set(u,l);var c=function(){return t("set",{delay:r,now:performance.timeOrigin+performance.now(),timerId:u,timerType:"interval"}).then(function(){var t=i.get(u);if(void 0===t)throw new Error("The timer is in an undefined state.");t===l&&(e.apply(void 0,s),i.get(u)===l&&c())})};return c(),u}},setTimeout:function(e){var t=e.call;return function(e){for(var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length,s=new Array(i>2?i-2:0),a=2;a<i;a++)s[a-2]=arguments[a];var l=Symbol(),u=n.generateUniqueNumber(o);return o.set(u,l),t("set",{delay:r,now:performance.timeOrigin+performance.now(),timerId:u,timerType:"timeout"}).then(function(){var t=o.get(u);if(void 0===t)throw new Error("The timer is in an undefined state.");t===l&&(o.delete(u),e.apply(void 0,s))}),u}}});e.load=function(e){var t=new Worker(e);return s(t)},e.wrap=s},"object"==typeof e&&typeof t<"u"?n(e,qr(),hn(),Xr()):"function"==typeof define&&define.amd?define(["exports","@babel/runtime/helpers/typeof","broker-factory","fast-unique-numbers"],n):n((r=typeof globalThis<"u"?globalThis:r||self).workerTimersBroker={},r._typeof,r.brokerFactory,r.fastUniqueNumbers)}),pn=o((e,t)=>{var r,n;l(),tt(),Fe(),r=e,n=function(e,t){var r,n,i,o=(r=t.load,n='(()=>{var e={45:(e,t,r)=>{var n=r(738).default;e.exports=function(e,t){if("object"!=n(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,t||"default");if("object"!=n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)},e.exports.__esModule=!0,e.exports.default=e.exports},79:e=>{e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n},e.exports.__esModule=!0,e.exports.default=e.exports},122:(e,t,r)=>{var n=r(79);e.exports=function(e,t){if(e){if("string"==typeof e)return n(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}},e.exports.__esModule=!0,e.exports.default=e.exports},156:e=>{e.exports=function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,u,a,i=[],s=!0,c=!1;try{if(u=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;s=!1}else for(;!(s=(n=u.call(r)).done)&&(i.push(n.value),i.length!==t);s=!0);}catch(e){c=!0,o=e}finally{try{if(!s&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw o}}return i}},e.exports.__esModule=!0,e.exports.default=e.exports},172:e=>{e.exports=function(e,t){this.v=e,this.k=t},e.exports.__esModule=!0,e.exports.default=e.exports},293:e=>{function t(e,t,r,n,o,u,a){try{var i=e[u](a),s=i.value}catch(e){return void r(e)}i.done?t(s):Promise.resolve(s).then(n,o)}e.exports=function(e){return function(){var r=this,n=arguments;return new Promise((function(o,u){var a=e.apply(r,n);function i(e){t(a,o,u,i,s,"next",e)}function s(e){t(a,o,u,i,s,"throw",e)}i(void 0)}))}},e.exports.__esModule=!0,e.exports.default=e.exports},373:e=>{e.exports=function(e){var t=Object(e),r=[];for(var n in t)r.unshift(n);return function e(){for(;r.length;)if((n=r.pop())in t)return e.value=n,e.done=!1,e;return e.done=!0,e}},e.exports.__esModule=!0,e.exports.default=e.exports},389:function(e,t){!function(e){"use strict";var t=function(e){return function(t){var r=e(t);return t.add(r),r}},r=function(e){return function(t,r){return e.set(t,r),r}},n=void 0===Number.MAX_SAFE_INTEGER?9007199254740991:Number.MAX_SAFE_INTEGER,o=536870912,u=2*o,a=function(e,t){return function(r){var a=t.get(r),i=void 0===a?r.size:a<u?a+1:0;if(!r.has(i))return e(r,i);if(r.size<o){for(;r.has(i);)i=Math.floor(Math.random()*u);return e(r,i)}if(r.size>n)throw new Error("Congratulations, you created a collection of unique numbers which uses all available integers!");for(;r.has(i);)i=Math.floor(Math.random()*n);return e(r,i)}},i=new WeakMap,s=r(i),c=a(s,i),f=t(c);e.addUniqueNumber=f,e.generateUniqueNumber=c}(t)},472:function(e,t,r){!function(e,t,r,n){"use strict";var o=function(e,t){return function(r){var o=t.get(r);if(void 0===o)return Promise.resolve(!1);var u=n(o,2),a=u[0],i=u[1];return e(a),t.delete(r),i(!1),Promise.resolve(!0)}},u=function(e,t){var r=function(n,o,u,a){var i=n-e.now();i>0?o.set(a,[t(r,i,n,o,u,a),u]):(o.delete(a),u(!0))};return r},a=function(e,t,r,n){return function(o,u,a){var i=o+u-t.timeOrigin,s=i-t.now();return new Promise((function(t){e.set(a,[r(n,s,i,e,t,a),t])}))}},i=new Map,s=o(globalThis.clearTimeout,i),c=new Map,f=o(globalThis.clearTimeout,c),l=u(performance,globalThis.setTimeout),p=a(i,performance,globalThis.setTimeout,l),d=a(c,performance,globalThis.setTimeout,l);r.createWorker(self,{clear:function(){var r=e(t.mark((function e(r){var n,o,u;return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.timerId,o=r.timerType,e.next=1,"interval"===o?s(n):f(n);case 1:return u=e.sent,e.abrupt("return",{result:u});case 2:case"end":return e.stop()}}),e)})));function n(e){return r.apply(this,arguments)}return n}(),set:function(){var r=e(t.mark((function e(r){var n,o,u,a,i;return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.delay,o=r.now,u=r.timerId,a=r.timerType,e.next=1,("interval"===a?p:d)(n,o,u);case 1:return i=e.sent,e.abrupt("return",{result:i});case 2:case"end":return e.stop()}}),e)})));function n(e){return r.apply(this,arguments)}return n}()})}(r(293),r(756),r(623),r(715))},546:e=>{function t(r,n,o,u){var a=Object.defineProperty;try{a({},"",{})}catch(r){a=0}e.exports=t=function(e,r,n,o){if(r)a?a(e,r,{value:n,enumerable:!o,configurable:!o,writable:!o}):e[r]=n;else{var u=function(r,n){t(e,r,(function(e){return this._invoke(r,n,e)}))};u("next",0),u("throw",1),u("return",2)}},e.exports.__esModule=!0,e.exports.default=e.exports,t(r,n,o,u)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},579:(e,t,r)=>{var n=r(738).default;e.exports=function(e){if(null!=e){var t=e["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],r=0;if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}}throw new TypeError(n(e)+" is not iterable")},e.exports.__esModule=!0,e.exports.default=e.exports},623:function(e,t,r){!function(e,t,r,n,o){"use strict";var u={INTERNAL_ERROR:-32603,INVALID_PARAMS:-32602,METHOD_NOT_FOUND:-32601},a=function(e,t){return Object.assign(new Error(e),{status:t})},i=function(e){return a(\'The requested method called "\'.concat(e,\'" is not supported.\'),u.METHOD_NOT_FOUND)},s=function(e){return a(\'The handler of the method called "\'.concat(e,\'" returned no required result.\'),u.INTERNAL_ERROR)},c=function(e){return a(\'The handler of the method called "\'.concat(e,\'" returned an unexpected result.\'),u.INTERNAL_ERROR)},f=function(e){return a(\'The specified parameter called "portId" with the given value "\'.concat(e,\'" does not identify a port connected to this worker.\'),u.INVALID_PARAMS)},l=function(e,n){return function(){var o=t(r.mark((function t(o){var u,a,f,l,p,d,v,x,y,b,h,m,_,g,w;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(u=o.data,a=u.id,f=u.method,l=u.params,p=n[f],t.prev=1,void 0!==p){t.next=2;break}throw i(f);case 2:if(void 0!==(d=void 0===l?p():p(l))){t.next=3;break}throw s(f);case 3:if(!(d instanceof Promise)){t.next=5;break}return t.next=4,d;case 4:g=t.sent,t.next=6;break;case 5:g=d;case 6:if(v=g,null!==a){t.next=8;break}if(void 0===v.result){t.next=7;break}throw c(f);case 7:t.next=10;break;case 8:if(void 0!==v.result){t.next=9;break}throw c(f);case 9:x=v.result,y=v.transferables,b=void 0===y?[]:y,e.postMessage({id:a,result:x},b);case 10:t.next=12;break;case 11:t.prev=11,w=t.catch(1),h=w.message,m=w.status,_=void 0===m?-32603:m,e.postMessage({error:{code:_,message:h},id:a});case 12:case"end":return t.stop()}}),t,null,[[1,11]])})));return function(e){return o.apply(this,arguments)}}()},p=function(){return new Promise((function(e){var t=new ArrayBuffer(0),r=new MessageChannel,n=r.port1,o=r.port2;n.onmessage=function(t){var r=t.data;return e(null!==r)},o.postMessage(t,[t])}))};function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function v(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var x=new Map,y=function(e,n,u){return v(v({},n),{},{connect:function(t){var r=t.port;r.start();var u=e(r,n),a=o.generateUniqueNumber(x);return x.set(a,(function(){u(),r.close(),x.delete(a)})),{result:a}},disconnect:function(e){var t=e.portId,r=x.get(t);if(void 0===r)throw f(t);return r(),{result:null}},isSupported:function(){var e=t(r.mark((function e(){var t,n,o;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,p();case 1:if(!e.sent){e.next=5;break}if(!((t=u())instanceof Promise)){e.next=3;break}return e.next=2,t;case 2:o=e.sent,e.next=4;break;case 3:o=t;case 4:return n=o,e.abrupt("return",{result:n});case 5:return e.abrupt("return",{result:!1});case 6:case"end":return e.stop()}}),e)})));function n(){return e.apply(this,arguments)}return n}()})},b=function(e,t){var r=y(b,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){return!0}),n=l(e,r);return e.addEventListener("message",n),function(){return e.removeEventListener("message",n)}};e.createWorker=b,e.isSupported=p}(t,r(293),r(756),r(693),r(389))},633:(e,t,r)=>{var n=r(172),o=r(993),u=r(869),a=r(887),i=r(791),s=r(373),c=r(579);function f(){"use strict";var t=o(),r=t.m(f),l=(Object.getPrototypeOf?Object.getPrototypeOf(r):r.__proto__).constructor;function p(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===l||"GeneratorFunction"===(t.displayName||t.name))}var d={throw:1,return:2,break:3,continue:3};function v(e){var t,r;return function(n){t||(t={stop:function(){return r(n.a,2)},catch:function(){return n.v},abrupt:function(e,t){return r(n.a,d[e],t)},delegateYield:function(e,o,u){return t.resultName=o,r(n.d,c(e),u)},finish:function(e){return r(n.f,e)}},r=function(e,r,o){n.p=t.prev,n.n=t.next;try{return e(r,o)}finally{t.next=n.n}}),t.resultName&&(t[t.resultName]=n.v,t.resultName=void 0),t.sent=n.v,t.next=n.n;try{return e.call(this,t)}finally{n.p=t.prev,n.n=t.next}}}return(e.exports=f=function(){return{wrap:function(e,r,n,o){return t.w(v(e),r,n,o&&o.reverse())},isGeneratorFunction:p,mark:t.m,awrap:function(e,t){return new n(e,t)},AsyncIterator:i,async:function(e,t,r,n,o){return(p(t)?a:u)(v(e),t,r,n,o)},keys:s,values:c}},e.exports.__esModule=!0,e.exports.default=e.exports)()}e.exports=f,e.exports.__esModule=!0,e.exports.default=e.exports},693:(e,t,r)=>{var n=r(736);e.exports=function(e,t,r){return(t=n(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},e.exports.__esModule=!0,e.exports.default=e.exports},715:(e,t,r)=>{var n=r(987),o=r(156),u=r(122),a=r(752);e.exports=function(e,t){return n(e)||o(e,t)||u(e,t)||a()},e.exports.__esModule=!0,e.exports.default=e.exports},736:(e,t,r)=>{var n=r(738).default,o=r(45);e.exports=function(e){var t=o(e,"string");return"symbol"==n(t)?t:t+""},e.exports.__esModule=!0,e.exports.default=e.exports},738:e=>{function t(r){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},752:e=>{e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports},756:(e,t,r)=>{var n=r(633)();e.exports=n;try{regeneratorRuntime=n}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=n:Function("r","regeneratorRuntime = r")(n)}},791:(e,t,r)=>{var n=r(172),o=r(546);e.exports=function e(t,r){function u(e,o,a,i){try{var s=t[e](o),c=s.value;return c instanceof n?r.resolve(c.v).then((function(e){u("next",e,a,i)}),(function(e){u("throw",e,a,i)})):r.resolve(c).then((function(e){s.value=e,a(s)}),(function(e){return u("throw",e,a,i)}))}catch(e){i(e)}}var a;this.next||(o(e.prototype),o(e.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",(function(){return this}))),o(this,"_invoke",(function(e,t,n){function o(){return new r((function(t,r){u(e,n,t,r)}))}return a=a?a.then(o,o):o()}),!0)},e.exports.__esModule=!0,e.exports.default=e.exports},869:(e,t,r)=>{var n=r(887);e.exports=function(e,t,r,o,u){var a=n(e,t,r,o,u);return a.next().then((function(e){return e.done?e.value:a.next()}))},e.exports.__esModule=!0,e.exports.default=e.exports},887:(e,t,r)=>{var n=r(993),o=r(791);e.exports=function(e,t,r,u,a){return new o(n().w(e,t,r,u),a||Promise)},e.exports.__esModule=!0,e.exports.default=e.exports},987:e=>{e.exports=function(e){if(Array.isArray(e))return e},e.exports.__esModule=!0,e.exports.default=e.exports},993:(e,t,r)=>{var n=r(546);function o(){var t,r,u="function"==typeof Symbol?Symbol:{},a=u.iterator||"@@iterator",i=u.toStringTag||"@@toStringTag";function s(e,o,u,a){var i=o&&o.prototype instanceof f?o:f,s=Object.create(i.prototype);return n(s,"_invoke",function(e,n,o){var u,a,i,s=0,f=o||[],l=!1,p={p:0,n:0,v:t,a:d,f:d.bind(t,4),d:function(e,r){return u=e,a=0,i=t,p.n=r,c}};function d(e,n){for(a=e,i=n,r=0;!l&&s&&!o&&r<f.length;r++){var o,u=f[r],d=p.p,v=u[2];e>3?(o=v===n)&&(i=u[(a=u[4])?5:(a=3,3)],u[4]=u[5]=t):u[0]<=d&&((o=e<2&&d<u[1])?(a=0,p.v=n,p.n=u[1]):d<v&&(o=e<3||u[0]>n||n>v)&&(u[4]=e,u[5]=n,p.n=v,a=0))}if(o||e>1)return c;throw l=!0,n}return function(o,f,v){if(s>1)throw TypeError("Generator is already running");for(l&&1===f&&d(f,v),a=f,i=v;(r=a<2?t:i)||!l;){u||(a?a<3?(a>1&&(p.n=-1),d(a,i)):p.n=i:p.v=i);try{if(s=2,u){if(a||(o="next"),r=u[o]){if(!(r=r.call(u,i)))throw TypeError("iterator result is not an object");if(!r.done)return r;i=r.value,a<2&&(a=0)}else 1===a&&(r=u.return)&&r.call(u),a<2&&(i=TypeError("The iterator does not provide a \'"+o+"\' method"),a=1);u=t}else if((r=(l=p.n<0)?i:e.call(n,p))!==c)break}catch(e){u=t,a=1,i=e}finally{s=1}}return{value:r,done:l}}}(e,u,a),!0),s}var c={};function f(){}function l(){}function p(){}r=Object.getPrototypeOf;var d=[][a]?r(r([][a]())):(n(r={},a,(function(){return this})),r),v=p.prototype=f.prototype=Object.create(d);function x(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,n(e,i,"GeneratorFunction")),e.prototype=Object.create(v),e}return l.prototype=p,n(v,"constructor",p),n(p,"constructor",l),l.displayName="GeneratorFunction",n(p,i,"GeneratorFunction"),n(v),n(v,i,"Generator"),n(v,a,(function(){return this})),n(v,"toString",(function(){return"[object Generator]"})),(e.exports=o=function(){return{w:s,m:x}},e.exports.__esModule=!0,e.exports.default=e.exports)()}e.exports=o,e.exports.__esModule=!0,e.exports.default=e.exports}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var u=t[n]={exports:{}};return e[n].call(u.exports,u,u.exports,r),u.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";r(472)})()})();',i=null,function(){if(null!==i)return i;var e=new Blob([n],{type:"application/javascript; charset=utf-8"}),t=URL.createObjectURL(e);return i=r(t),setTimeout(function(){return URL.revokeObjectURL(t)}),i});e.clearInterval=function(e){return o().clearInterval(e)},e.clearTimeout=function(e){return o().clearTimeout(e)},e.setInterval=function(){var e;return(e=o()).setInterval.apply(e,arguments)},e.setTimeout=function(){var e;return(e=o()).setTimeout.apply(e,arguments)}},"object"==typeof e&&typeof t<"u"?n(e,fn()):"function"==typeof define&&define.amd?define(["exports","worker-timers-broker"],n):n((r=typeof globalThis<"u"?globalThis:r||self).workerTimers={},r.workerTimersBroker)}),dn=o(e=>{l(),tt(),Fe(),Object.defineProperty(e,"__esModule",{value:!0}),e.isReactNativeBrowser=e.isWebWorker=void 0;var t=()=>!!("object"==typeof self&&self?.constructor?.name?.includes("WorkerGlobalScope")&&typeof Deno>"u"),r=()=>typeof navigator<"u"&&"ReactNative"===navigator.product,n=typeof window<"u"&&(typeof navigator<"u"&&navigator.userAgent?.toLowerCase().indexOf(" electron/")>-1&&u?.versions?!Object.prototype.hasOwnProperty.call(u.versions,"electron"):typeof window.document<"u")||t()||r();e.isWebWorker=t(),e.isReactNativeBrowser=r(),e.default=n}),yn=o(e=>{l(),tt(),Fe();var t,r=e&&e.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),n=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=e&&e.__importStar||(t=function(e){return(t=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t})(e)},function(e){if(e&&e.__esModule)return e;var i={};if(null!=e)for(var o=t(e),s=0;s<o.length;s++)"default"!==o[s]&&r(i,e,o[s]);return n(i,e),i});Object.defineProperty(e,"__esModule",{value:!0});var o=pn(),s=i(dn()),a={set:o.setInterval,clear:o.clearInterval},u={set:(e,t)=>setInterval(e,t),clear:e=>clearInterval(e)};e.default=e=>{switch(e){case"native":return u;case"worker":return a;default:return!s.default||s.isWebWorker||s.isReactNativeBrowser?u:a}}}),gn=o(e=>{l(),tt(),Fe();var t=e&&e.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(e,"__esModule",{value:!0});var r=t(yn());e.default=class{_keepalive;timerId;timer;destroyed=!1;counter;client;_keepaliveTimeoutTimestamp;_intervalEvery;get keepaliveTimeoutTimestamp(){return this._keepaliveTimeoutTimestamp}get intervalEvery(){return this._intervalEvery}get keepalive(){return this._keepalive}constructor(e,t){this.client=e,this.timer="object"==typeof t&&"set"in t&&"clear"in t?t:(0,r.default)(t),this.setKeepalive(e.options.keepalive)}clear(){this.timerId&&(this.timer.clear(this.timerId),this.timerId=null)}setKeepalive(e){if(e*=1e3,isNaN(e)||e<=0||e>2147483647)throw new Error(`Keepalive value must be an integer between 0 and 2147483647. Provided value is ${e}`);this._keepalive=e,this.reschedule(),this.client.log(`KeepaliveManager: set keepalive to ${e}ms`)}destroy(){this.clear(),this.destroyed=!0}reschedule(){if(this.destroyed)return;this.clear(),this.counter=0;let e=Math.ceil(1.5*this._keepalive);this._keepaliveTimeoutTimestamp=Date.now()+e,this._intervalEvery=Math.ceil(this._keepalive/2),this.timerId=this.timer.set(()=>{this.destroyed||(this.counter+=1,2===this.counter?this.client.sendPing():this.counter>2&&this.client.onKeepaliveTimeout())},this._intervalEvery)}}}),bn=o(e=>{l(),tt(),Fe();var t,r=e&&e.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),n=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=e&&e.__importStar||(t=function(e){return(t=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t})(e)},function(e){if(e&&e.__esModule)return e;var i={};if(null!=e)for(var o=t(e),s=0;s<o.length;s++)"default"!==o[s]&&r(i,e,o[s]);return n(i,e),i}),o=e&&e.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(e,"__esModule",{value:!0});var s=o(rr()),a=qt(),u=o(ir()),c=o(Yt()),h=i(or()),f=o(sr()),p=o(Lr()),d=o(Dr()),y=o(Fr()),g=ur(),b=Wr(),m=o(gn()),w=i(dn()),v=globalThis.setImmediate||((...e)=>{let t=e.shift();(0,g.nextTick)(()=>{t(...e)})}),_={keepalive:60,reschedulePings:!0,protocolId:"MQTT",protocolVersion:4,reconnectPeriod:1e3,connectTimeout:3e4,clean:!0,resubscribe:!0,subscribeBatchSize:null,writeCache:!0,timerVariant:"auto"},S=class e extends b.TypedEventEmitter{static VERSION=g.MQTTJS_VERSION;connected;disconnecting;disconnected;reconnecting;incomingStore;outgoingStore;options;queueQoSZero;_reconnectCount;log;messageIdProvider;outgoing;messageIdToTopic;noop;keepaliveManager;stream;queue;streamBuilder;_resubscribeTopics;connackTimer;reconnectTimer;_storeProcessing;_packetIdsDuringStoreProcessing;_storeProcessingQueue;_firstConnection;topicAliasRecv;topicAliasSend;_deferredReconnect;connackPacket;static defaultId(){return`mqttjs_${Math.random().toString(16).substr(2,8)}`}constructor(t,r){super(),this.options=r||{};for(let e in _)typeof this.options[e]>"u"?this.options[e]=_[e]:this.options[e]=r[e];this.log=this.options.log||(0,c.default)("mqttjs:client"),this.noop=this._noop.bind(this),this.log("MqttClient :: version:",e.VERSION),w.isWebWorker?this.log("MqttClient :: environment","webworker"):this.log("MqttClient :: environment",w.default?"browser":"node"),this.log("MqttClient :: options.protocol",r.protocol),this.log("MqttClient :: options.protocolVersion",r.protocolVersion),this.log("MqttClient :: options.username",r.username),this.log("MqttClient :: options.keepalive",r.keepalive),this.log("MqttClient :: options.reconnectPeriod",r.reconnectPeriod),this.log("MqttClient :: options.rejectUnauthorized",r.rejectUnauthorized),this.log("MqttClient :: options.properties.topicAliasMaximum",r.properties?r.properties.topicAliasMaximum:void 0),this.options.clientId="string"==typeof r.clientId?r.clientId:e.defaultId(),this.log("MqttClient :: clientId",this.options.clientId),this.options.customHandleAcks=5===r.protocolVersion&&r.customHandleAcks?r.customHandleAcks:(...e)=>{e[3](null,0)},this.options.writeCache||(s.default.writeToStream.cacheNumbers=!1),this.streamBuilder=t,this.messageIdProvider=typeof this.options.messageIdProvider>"u"?new d.default:this.options.messageIdProvider,this.outgoingStore=r.outgoingStore||new f.default,this.incomingStore=r.incomingStore||new f.default,this.queueQoSZero=void 0===r.queueQoSZero||r.queueQoSZero,this._resubscribeTopics={},this.messageIdToTopic={},this.keepaliveManager=null,this.connected=!1,this.disconnecting=!1,this.reconnecting=!1,this.queue=[],this.connackTimer=null,this.reconnectTimer=null,this._storeProcessing=!1,this._packetIdsDuringStoreProcessing={},this._storeProcessingQueue=[],this.outgoing={},this._firstConnection=!0,r.properties&&r.properties.topicAliasMaximum>0&&(r.properties.topicAliasMaximum>65535?this.log("MqttClient :: options.properties.topicAliasMaximum is out of range"):this.topicAliasRecv=new y.default(r.properties.topicAliasMaximum)),this.on("connect",()=>{let{queue:e}=this,t=()=>{let r=e.shift();this.log("deliver :: entry %o",r);let n=null;if(!r)return void this._resubscribe();n=r.packet,this.log("deliver :: call _sendPacket for %o",n);let i=!0;n.messageId&&0!==n.messageId&&(this.messageIdProvider.register(n.messageId)||(i=!1)),i?this._sendPacket(n,e=>{r.cb&&r.cb(e),t()}):(this.log("messageId: %d has already used. The message is skipped and removed.",n.messageId),t())};this.log("connect :: sending queued packets"),t()}),this.on("close",()=>{this.log("close :: connected set to `false`"),this.connected=!1,this.log("close :: clearing connackTimer"),clearTimeout(this.connackTimer),this._destroyKeepaliveManager(),this.topicAliasRecv&&this.topicAliasRecv.clear(),this.log("close :: calling _setupReconnect"),this._setupReconnect()}),this.options.manualConnect||(this.log("MqttClient :: setting up stream"),this.connect())}handleAuth(e,t){t()}handleMessage(e,t){t()}_nextId(){return this.messageIdProvider.allocate()}getLastMessageId(){return this.messageIdProvider.getLastAllocated()}connect(){let e=new a.Writable,t=s.default.parser(this.options),r=null,n=[];this.log("connect :: calling method to clear reconnect"),this._clearReconnect(),this.disconnected&&!this.reconnecting&&(this.incomingStore=this.options.incomingStore||new f.default,this.outgoingStore=this.options.outgoingStore||new f.default,this.disconnecting=!1,this.disconnected=!1),this.log("connect :: using streamBuilder provided to client to create stream"),this.stream=this.streamBuilder(this),t.on("packet",e=>{this.log("parser :: on packet push to packets array."),n.push(e)});let i=()=>{this.log("work :: getting next packet in queue");let e=n.shift();if(e)this.log("work :: packet pulled from queue"),(0,p.default)(this,e,o);else{this.log("work :: no packets in queue");let e=r;r=null,this.log("work :: done flag is %s",!!e),e&&e()}},o=()=>{if(n.length)(0,g.nextTick)(i);else{let e=r;r=null,e()}};e._write=(e,n,o)=>{r=o,this.log("writable stream :: parsing buffer"),t.parse(e),i()};this.log("connect :: pipe stream to writable stream"),this.stream.pipe(e),this.stream.on("error",e=>{this.log("streamErrorHandler :: error",e.message),e.code?(this.log("streamErrorHandler :: emitting error"),this.emit("error",e)):this.noop(e)}),this.stream.on("close",()=>{this.log("(%s)stream :: on close",this.options.clientId),this._flushVolatile(),this.log("stream: emit close to MqttClient"),this.emit("close")}),this.log("connect: sending packet `connect`");let l={cmd:"connect",protocolId:this.options.protocolId,protocolVersion:this.options.protocolVersion,clean:this.options.clean,clientId:this.options.clientId,keepalive:this.options.keepalive,username:this.options.username,password:this.options.password,properties:this.options.properties};if(this.options.will&&(l.will={...this.options.will,payload:this.options.will?.payload}),this.topicAliasRecv&&(l.properties||(l.properties={}),this.topicAliasRecv&&(l.properties.topicAliasMaximum=this.topicAliasRecv.max)),this._writePacket(l),t.on("error",this.emit.bind(this,"error")),this.options.properties){if(!this.options.properties.authenticationMethod&&this.options.properties.authenticationData)return this.end(()=>this.emit("error",new Error("Packet has no Authentication Method"))),this;if(this.options.properties.authenticationMethod&&this.options.authPacket&&"object"==typeof this.options.authPacket){let e={cmd:"auth",reasonCode:0,...this.options.authPacket};this._writePacket(e)}}return this.stream.setMaxListeners(1e3),clearTimeout(this.connackTimer),this.connackTimer=setTimeout(()=>{this.log("!!connectTimeout hit!! Calling _cleanUp with force `true`"),this.emit("error",new Error("connack timeout")),this._cleanUp(!0)},this.options.connectTimeout),this}publish(e,t,r,n){this.log("publish :: message `%s` to topic `%s`",t,e);let{options:i}=this;"function"==typeof r&&(n=r,r=null),r=r||{},r={qos:0,retain:!1,dup:!1,...r};let{qos:o,retain:s,dup:a,properties:l,cbStorePut:u}=r;if(this._checkDisconnecting(n))return this;let c=()=>{let r=0;if((1===o||2===o)&&(r=this._nextId(),null===r))return this.log("No messageId left"),!1;let c={cmd:"publish",topic:e,payload:t,qos:o,retain:s,messageId:r,dup:a};switch(5===i.protocolVersion&&(c.properties=l),this.log("publish :: qos",o),o){case 1:case 2:this.outgoing[c.messageId]={volatile:!1,cb:n||this.noop},this.log("MqttClient:publish: packet cmd: %s",c.cmd),this._sendPacket(c,void 0,u);break;default:this.log("MqttClient:publish: packet cmd: %s",c.cmd),this._sendPacket(c,n,u)}return!0};return(this._storeProcessing||this._storeProcessingQueue.length>0||!c())&&this._storeProcessingQueue.push({invoke:c,cbStorePut:r.cbStorePut,callback:n}),this}publishAsync(e,t,r){return new Promise((n,i)=>{this.publish(e,t,r,(e,t)=>{e?i(e):n(t)})})}subscribe(e,t,r){let n=this.options.protocolVersion;"function"==typeof t&&(r=t),r=r||this.noop;let i=!1,o=[];"string"==typeof e?o=e=[e]:Array.isArray(e)?o=e:"object"==typeof e&&(i=e.resubscribe,delete e.resubscribe,o=Object.keys(e));let s=h.validateTopics(o);if(null!==s)return v(r,new Error(`Invalid topic ${s}`)),this;if(this._checkDisconnecting(r))return this.log("subscribe: discconecting true"),this;let a={qos:0};5===n&&(a.nl=!1,a.rap=!1,a.rh=0),t={...a,...t};let{properties:l}=t,u=[],c=(e,r)=>{if(r=r||t,!Object.prototype.hasOwnProperty.call(this._resubscribeTopics,e)||this._resubscribeTopics[e].qos<r.qos||i){let t={topic:e,qos:r.qos};5===n&&(t.nl=r.nl,t.rap=r.rap,t.rh=r.rh,t.properties=l),this.log("subscribe: pushing topic `%s` and qos `%s` to subs list",t.topic,t.qos),u.push(t)}};if(Array.isArray(e)?e.forEach(e=>{this.log("subscribe: array topic %s",e),c(e)}):Object.keys(e).forEach(t=>{this.log("subscribe: object topic %s, %o",t,e[t]),c(t,e[t])}),!u.length)return r(null,[]),this;let f=(e,t)=>{let r={cmd:"subscribe",subscriptions:e,messageId:t};if(l&&(r.properties=l),this.options.resubscribe){this.log("subscribe :: resubscribe true");let t=[];e.forEach(e=>{if(this.options.reconnectPeriod>0){let r={qos:e.qos};5===n&&(r.nl=e.nl||!1,r.rap=e.rap||!1,r.rh=e.rh||0,r.properties=e.properties),this._resubscribeTopics[e.topic]=r,t.push(e.topic)}}),this.messageIdToTopic[r.messageId]=t}let i=new Promise((t,n)=>{this.outgoing[r.messageId]={volatile:!0,cb(r,i){if(!r){let{granted:t}=i;for(let r=0;r<t.length;r+=1)e[r].qos=t[r]}r?n(new g.ErrorWithSubackPacket(r.message,i)):t(i)}}});return this.log("subscribe :: call _sendPacket"),this._sendPacket(r),i},p=()=>{let e=this.options.subscribeBatchSize??u.length,t=[];for(let r=0;r<u.length;r+=e){let n=u.slice(r,r+e),i=this._nextId();if(null===i)return this.log("No messageId left"),!1;t.push(f(n,i))}return Promise.all(t).then(e=>{r(null,u,e.at(-1))}).catch(e=>{r(e,u,e.packet)}),!0};return(this._storeProcessing||this._storeProcessingQueue.length>0||!p())&&this._storeProcessingQueue.push({invoke:p,callback:r}),this}subscribeAsync(e,t){return new Promise((r,n)=>{this.subscribe(e,t,(e,t)=>{e?n(e):r(t)})})}unsubscribe(e,t,r){"string"==typeof e&&(e=[e]),"function"==typeof t&&(r=t),r=r||this.noop;let n=h.validateTopics(e);if(null!==n)return v(r,new Error(`Invalid topic ${n}`)),this;if(this._checkDisconnecting(r))return this;let i=()=>{let n=this._nextId();if(null===n)return this.log("No messageId left"),!1;let i={cmd:"unsubscribe",messageId:n,unsubscriptions:[]};return"string"==typeof e?i.unsubscriptions=[e]:Array.isArray(e)&&(i.unsubscriptions=e),this.options.resubscribe&&i.unsubscriptions.forEach(e=>{delete this._resubscribeTopics[e]}),"object"==typeof t&&t.properties&&(i.properties=t.properties),this.outgoing[i.messageId]={volatile:!0,cb:r},this.log("unsubscribe: call _sendPacket"),this._sendPacket(i),!0};return(this._storeProcessing||this._storeProcessingQueue.length>0||!i())&&this._storeProcessingQueue.push({invoke:i,callback:r}),this}unsubscribeAsync(e,t){return new Promise((r,n)=>{this.unsubscribe(e,t,(e,t)=>{e?n(e):r(t)})})}end(e,t,r){this.log("end :: (%s)",this.options.clientId),(null==e||"boolean"!=typeof e)&&(r=r||t,t=e,e=!1),"object"!=typeof t&&(r=r||t,t=null),this.log("end :: cb? %s",!!r),(!r||"function"!=typeof r)&&(r=this.noop);let n=()=>{this.log("end :: closeStores: closing incoming and outgoing stores"),this.disconnected=!0,this.incomingStore.close(e=>{this.outgoingStore.close(t=>{if(this.log("end :: closeStores: emitting end"),this.emit("end"),r){let n=e||t;this.log("end :: closeStores: invoking callback with args"),r(n)}})}),this._deferredReconnect?this._deferredReconnect():(0===this.options.reconnectPeriod||this.options.manualConnect)&&(this.disconnecting=!1)},i=()=>{this.log("end :: (%s) :: finish :: calling _cleanUp with force %s",this.options.clientId,e),this._cleanUp(e,()=>{this.log("end :: finish :: calling process.nextTick on closeStores"),(0,g.nextTick)(n)},t)};return this.disconnecting?(r(),this):(this._clearReconnect(),this.disconnecting=!0,!e&&Object.keys(this.outgoing).length>0?(this.log("end :: (%s) :: calling finish in 10ms once outgoing is empty",this.options.clientId),this.once("outgoingEmpty",setTimeout.bind(null,i,10))):(this.log("end :: (%s) :: immediately calling finish",this.options.clientId),i()),this)}endAsync(e,t){return new Promise((r,n)=>{this.end(e,t,e=>{e?n(e):r()})})}removeOutgoingMessage(e){if(this.outgoing[e]){let{cb:t}=this.outgoing[e];this._removeOutgoingAndStoreMessage(e,()=>{t(new Error("Message removed"))})}return this}reconnect(e){this.log("client reconnect");let t=()=>{e?(this.options.incomingStore=e.incomingStore,this.options.outgoingStore=e.outgoingStore):(this.options.incomingStore=null,this.options.outgoingStore=null),this.incomingStore=this.options.incomingStore||new f.default,this.outgoingStore=this.options.outgoingStore||new f.default,this.disconnecting=!1,this.disconnected=!1,this._deferredReconnect=null,this._reconnect()};return this.disconnecting&&!this.disconnected?this._deferredReconnect=t:t(),this}_flushVolatile(){this.outgoing&&(this.log("_flushVolatile :: deleting volatile messages from the queue and setting their callbacks as error function"),Object.keys(this.outgoing).forEach(e=>{this.outgoing[e].volatile&&"function"==typeof this.outgoing[e].cb&&(this.outgoing[e].cb(new Error("Connection closed")),delete this.outgoing[e])}))}_flush(){this.outgoing&&(this.log("_flush: queue exists? %b",!!this.outgoing),Object.keys(this.outgoing).forEach(e=>{"function"==typeof this.outgoing[e].cb&&(this.outgoing[e].cb(new Error("Connection closed")),delete this.outgoing[e])}))}_removeTopicAliasAndRecoverTopicName(e){let t;e.properties&&(t=e.properties.topicAlias);let r=e.topic.toString();if(this.log("_removeTopicAliasAndRecoverTopicName :: alias %d, topic %o",t,r),0===r.length){if(typeof t>"u")return new Error("Unregistered Topic Alias");if(r=this.topicAliasSend.getTopicByAlias(t),typeof r>"u")return new Error("Unregistered Topic Alias");e.topic=r}t&&delete e.properties.topicAlias}_checkDisconnecting(e){return this.disconnecting&&(e&&e!==this.noop?e(new Error("client disconnecting")):this.emit("error",new Error("client disconnecting"))),this.disconnecting}_reconnect(){this.log("_reconnect: emitting reconnect to client"),this.emit("reconnect"),this.connected?(this.end(()=>{this.connect()}),this.log("client already connected. disconnecting first.")):(this.log("_reconnect: calling connect"),this.connect())}_setupReconnect(){!this.disconnecting&&!this.reconnectTimer&&this.options.reconnectPeriod>0?(this.reconnecting||(this.log("_setupReconnect :: emit `offline` state"),this.emit("offline"),this.log("_setupReconnect :: set `reconnecting` to `true`"),this.reconnecting=!0),this.log("_setupReconnect :: setting reconnectTimer for %d ms",this.options.reconnectPeriod),this.reconnectTimer=setInterval(()=>{this.log("reconnectTimer :: reconnect triggered!"),this._reconnect()},this.options.reconnectPeriod)):this.log("_setupReconnect :: doing nothing...")}_clearReconnect(){this.log("_clearReconnect : clearing reconnect timer"),this.reconnectTimer&&(clearInterval(this.reconnectTimer),this.reconnectTimer=null)}_cleanUp(e,t,r={}){if(t&&(this.log("_cleanUp :: done callback provided for on stream close"),this.stream.on("close",t)),this.log("_cleanUp :: forced? %s",e),e)0===this.options.reconnectPeriod&&this.options.clean&&this._flush(),this.log("_cleanUp :: (%s) :: destroying stream",this.options.clientId),this.stream.destroy();else{let e={cmd:"disconnect",...r};this.log("_cleanUp :: (%s) :: call _sendPacket with disconnect packet",this.options.clientId),this._sendPacket(e,()=>{this.log("_cleanUp :: (%s) :: destroying stream",this.options.clientId),v(()=>{this.stream.end(()=>{this.log("_cleanUp :: (%s) :: stream destroyed",this.options.clientId)})})})}!this.disconnecting&&!this.reconnecting&&(this.log("_cleanUp :: client not disconnecting/reconnecting. Clearing and resetting reconnect."),this._clearReconnect(),this._setupReconnect()),this._destroyKeepaliveManager(),t&&!this.connected&&(this.log("_cleanUp :: (%s) :: removing stream `done` callback `close` listener",this.options.clientId),this.stream.removeListener("close",t),t())}_storeAndSend(e,t,r){this.log("storeAndSend :: store packet with cmd %s to outgoingStore",e.cmd);let n,i=e;if("publish"===i.cmd&&(i=(0,u.default)(e),n=this._removeTopicAliasAndRecoverTopicName(i),n))return t&&t(n);this.outgoingStore.put(i,n=>{if(n)return t&&t(n);r(),this._writePacket(e,t)})}_applyTopicAlias(e){if(5===this.options.protocolVersion&&"publish"===e.cmd){let t;e.properties&&(t=e.properties.topicAlias);let r=e.topic.toString();if(this.topicAliasSend)if(t){if(0!==r.length&&(this.log("applyTopicAlias :: register topic: %s - alias: %d",r,t),!this.topicAliasSend.put(r,t)))return this.log("applyTopicAlias :: error out of range. topic: %s - alias: %d",r,t),new Error("Sending Topic Alias out of range")}else 0!==r.length&&(this.options.autoAssignTopicAlias?(t=this.topicAliasSend.getAliasByTopic(r),t?(e.topic="",e.properties={...e.properties,topicAlias:t},this.log("applyTopicAlias :: auto assign(use) topic: %s - alias: %d",r,t)):(t=this.topicAliasSend.getLruAlias(),this.topicAliasSend.put(r,t),e.properties={...e.properties,topicAlias:t},this.log("applyTopicAlias :: auto assign topic: %s - alias: %d",r,t))):this.options.autoUseTopicAlias&&(t=this.topicAliasSend.getAliasByTopic(r),t&&(e.topic="",e.properties={...e.properties,topicAlias:t},this.log("applyTopicAlias :: auto use topic: %s - alias: %d",r,t))));else if(t)return this.log("applyTopicAlias :: error out of range. topic: %s - alias: %d",r,t),new Error("Sending Topic Alias out of range")}}_noop(e){this.log("noop ::",e)}_writePacket(e,t){this.log("_writePacket :: packet: %O",e),this.log("_writePacket :: emitting `packetsend`"),this.emit("packetsend",e),this.log("_writePacket :: writing to stream");let r=s.default.writeToStream(e,this.stream,this.options);this.log("_writePacket :: writeToStream result %s",r),!r&&t&&t!==this.noop?(this.log("_writePacket :: handle events on `drain` once through callback."),this.stream.once("drain",t)):t&&(this.log("_writePacket :: invoking cb"),t())}_sendPacket(e,t,r,n){this.log("_sendPacket :: (%s) ::  start",this.options.clientId),r=r||this.noop,t=t||this.noop;let i=this._applyTopicAlias(e);if(i)t(i);else{if(!this.connected)return"auth"===e.cmd?void this._writePacket(e,t):(this.log("_sendPacket :: client not connected. Storing packet offline."),void this._storePacket(e,t,r));if(n)this._writePacket(e,t);else{switch(e.cmd){case"publish":break;case"pubrel":return void this._storeAndSend(e,t,r);default:return void this._writePacket(e,t)}switch(e.qos){case 2:case 1:this._storeAndSend(e,t,r);break;default:this._writePacket(e,t)}this.log("_sendPacket :: (%s) ::  end",this.options.clientId)}}}_storePacket(e,t,r){this.log("_storePacket :: packet: %o",e),this.log("_storePacket :: cb? %s",!!t),r=r||this.noop;let n=e;if("publish"===n.cmd){n=(0,u.default)(e);let r=this._removeTopicAliasAndRecoverTopicName(n);if(r)return t&&t(r)}let i=n.qos||0;0===i&&this.queueQoSZero||"publish"!==n.cmd?this.queue.push({packet:n,cb:t}):i>0?(t=this.outgoing[n.messageId]?this.outgoing[n.messageId].cb:null,this.outgoingStore.put(n,e=>{if(e)return t&&t(e);r()})):t&&t(new Error("No connection to broker"))}_setupKeepaliveManager(){this.log("_setupKeepaliveManager :: keepalive %d (seconds)",this.options.keepalive),!this.keepaliveManager&&this.options.keepalive&&(this.keepaliveManager=new m.default(this,this.options.timerVariant))}_destroyKeepaliveManager(){this.keepaliveManager&&(this.log("_destroyKeepaliveManager :: destroying keepalive manager"),this.keepaliveManager.destroy(),this.keepaliveManager=null)}reschedulePing(e=!1){this.keepaliveManager&&this.options.keepalive&&(e||this.options.reschedulePings)&&this._reschedulePing()}_reschedulePing(){this.log("_reschedulePing :: rescheduling ping"),this.keepaliveManager.reschedule()}sendPing(){this.log("_sendPing :: sending pingreq"),this._sendPacket({cmd:"pingreq"})}onKeepaliveTimeout(){this.emit("error",new Error("Keepalive timeout")),this.log("onKeepaliveTimeout :: calling _cleanUp with force true"),this._cleanUp(!0)}_resubscribe(){this.log("_resubscribe");let e=Object.keys(this._resubscribeTopics);if(!this._firstConnection&&(this.options.clean||this.options.protocolVersion>=4&&!this.connackPacket.sessionPresent)&&e.length>0)if(this.options.resubscribe)if(5===this.options.protocolVersion){this.log("_resubscribe: protocolVersion 5");for(let t=0;t<e.length;t++){let r={};r[e[t]]=this._resubscribeTopics[e[t]],r.resubscribe=!0,this.subscribe(r,{properties:r[e[t]].properties})}}else this._resubscribeTopics.resubscribe=!0,this.subscribe(this._resubscribeTopics);else this._resubscribeTopics={};this._firstConnection=!1}_onConnect(e){if(this.disconnected)return void this.emit("connect",e);this.connackPacket=e,this.messageIdProvider.clear(),this._setupKeepaliveManager(),this.connected=!0;let t=()=>{let r=this.outgoingStore.createStream(),n=()=>{r.destroy(),r=null,this._flushStoreProcessingQueue(),i()},i=()=>{this._storeProcessing=!1,this._packetIdsDuringStoreProcessing={}};this.once("close",n),r.on("error",e=>{i(),this._flushStoreProcessingQueue(),this.removeListener("close",n),this.emit("error",e)});let o=()=>{if(!r)return;let e,t=r.read(1);t?(this._storeProcessing=!0,this._packetIdsDuringStoreProcessing[t.messageId]?o():this.disconnecting||this.reconnectTimer?r.destroy&&r.destroy():(e=this.outgoing[t.messageId]?this.outgoing[t.messageId].cb:null,this.outgoing[t.messageId]={volatile:!1,cb(t,r){e&&e(t,r),o()}},this._packetIdsDuringStoreProcessing[t.messageId]=!0,this.messageIdProvider.register(t.messageId)?this._sendPacket(t,void 0,void 0,!0):this.log("messageId: %d has already used.",t.messageId))):r.once("readable",o)};r.on("end",()=>{let r=!0;for(let e in this._packetIdsDuringStoreProcessing)if(!this._packetIdsDuringStoreProcessing[e]){r=!1;break}this.removeListener("close",n),r?(i(),this._invokeAllStoreProcessingQueue(),this.emit("connect",e)):t()}),o()};t()}_invokeStoreProcessingQueue(){if(!this._storeProcessing&&this._storeProcessingQueue.length>0){let e=this._storeProcessingQueue[0];if(e&&e.invoke())return this._storeProcessingQueue.shift(),!0}return!1}_invokeAllStoreProcessingQueue(){for(;this._invokeStoreProcessingQueue(););}_flushStoreProcessingQueue(){for(let e of this._storeProcessingQueue)e.cbStorePut&&e.cbStorePut(new Error("Connection closed")),e.callback&&e.callback(new Error("Connection closed"));this._storeProcessingQueue.splice(0)}_removeOutgoingAndStoreMessage(e,t){delete this.outgoing[e],this.outgoingStore.del({messageId:e},(r,n)=>{t(r,n),this.messageIdProvider.deallocate(e),this._invokeStoreProcessingQueue()})}};e.default=S}),mn=o(e=>{l(),tt(),Fe(),Object.defineProperty(e,"__esModule",{value:!0});var t=Mr();e.default=class{numberAllocator;lastId;constructor(){this.numberAllocator=new t.NumberAllocator(1,65535)}allocate(){return this.lastId=this.numberAllocator.alloc(),this.lastId}getLastAllocated(){return this.lastId}register(e){return this.numberAllocator.use(e)}deallocate(e){this.numberAllocator.free(e)}clear(){this.numberAllocator.clear()}}});var wn,vn,_n,Sn=i(()=>{l(),tt(),Fe(),wn={},vn=!1,_n=function(){if(vn)return wn;vn=!0;let e=2147483647,t=36,r=/^xn--/,n=/[^\0-\x7F]/,i=/[\x2E\u3002\uFF0E\uFF61]/g,o={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},s=Math.floor,a=String.fromCharCode;function l(e){throw new RangeError(o[e])}function u(e,t){let r=e.split("@"),n="";r.length>1&&(n=r[0]+"@",e=r[1]);let o=function(e,t){let r=[],n=e.length;for(;n--;)r[n]=t(e[n]);return r}((e=e.replace(i,".")).split("."),t).join(".");return n+o}function c(e){let t=[],r=0,n=e.length;for(;r<n;){let i=e.charCodeAt(r++);if(i>=55296&&i<=56319&&r<n){let n=e.charCodeAt(r++);56320==(64512&n)?t.push(((1023&i)<<10)+(1023&n)+65536):(t.push(i),r--)}else t.push(i)}return t}let h=function(e){return e>=48&&e<58?e-48+26:e>=65&&e<91?e-65:e>=97&&e<123?e-97:t},f=function(e,t){return e+22+75*(e<26)-((0!=t)<<5)},p=function(e,r,n){let i=0;for(e=n?s(e/700):e>>1,e+=s(e/r);e>455;i+=t)e=s(e/35);return s(i+36*e/(e+38))},d=function(r){let n=[],i=r.length,o=0,a=128,u=72,c=r.lastIndexOf("-");c<0&&(c=0);for(let e=0;e<c;++e)r.charCodeAt(e)>=128&&l("not-basic"),n.push(r.charCodeAt(e));for(let f=c>0?c+1:0;f<i;){let c=o;for(let n=1,a=t;;a+=t){f>=i&&l("invalid-input");let c=h(r.charCodeAt(f++));c>=t&&l("invalid-input"),c>s((e-o)/n)&&l("overflow"),o+=c*n;let p=a<=u?1:a>=u+26?26:a-u;if(c<p)break;let d=t-p;n>s(e/d)&&l("overflow"),n*=d}let d=n.length+1;u=p(o-c,d,0==c),s(o/d)>e-a&&l("overflow"),a+=s(o/d),o%=d,n.splice(o++,0,a)}return String.fromCodePoint(...n)},y=function(r){let n=[],i=(r=c(r)).length,o=128,u=0,h=72;for(let e of r)e<128&&n.push(a(e));let d=n.length,y=d;for(d&&n.push("-");y<i;){let i=e;for(let e of r)e>=o&&e<i&&(i=e);let c=y+1;i-o>s((e-u)/c)&&l("overflow"),u+=(i-o)*c,o=i;for(let i of r)if(i<o&&++u>e&&l("overflow"),i===o){let e=u;for(let r=t;;r+=t){let i=r<=h?1:r>=h+26?26:r-h;if(e<i)break;let o=e-i,l=t-i;n.push(a(f(i+o%l,0))),e=s(o/l)}n.push(a(f(e,0))),h=p(u,c,y===d),u=0,++y}++u,++o}return n.join("")};return wn={version:"2.3.1",ucs2:{decode:c,encode:e=>String.fromCodePoint(...e)},decode:d,encode:y,toASCII:function(e){return u(e,function(e){return n.test(e)?"xn--"+y(e):e})},toUnicode:function(e){return u(e,function(e){return r.test(e)?d(e.slice(4).toLowerCase()):e})}}}(),_n.decode,_n.encode,_n.toASCII,_n.toUnicode,_n.ucs2,_n.version});function En(){return $n||($n=!0,qn=SyntaxError),qn}function An(){return Vn||(Vn=!0,Hn=TypeError),Hn}function In(){if(Qn)return Gn;Qn=!0;var e=typeof Symbol<"u"&&Symbol,t=(jn||(jn=!0,Cn=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var e={},t=Symbol("test"),r=Object(t);if("string"==typeof t||"[object Symbol]"!==Object.prototype.toString.call(t)||"[object Symbol]"!==Object.prototype.toString.call(r))return!1;for(t in e[t]=42,e)return!1;if("function"==typeof Object.keys&&0!==Object.keys(e).length||"function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(e).length)return!1;var n=Object.getOwnPropertySymbols(e);if(1!==n.length||n[0]!==t||!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var i=Object.getOwnPropertyDescriptor(e,t);if(42!==i.value||!0!==i.enumerable)return!1}return!0}),Cn);return Gn=function(){return"function"==typeof e&&"function"==typeof Symbol&&"symbol"==typeof e("foo")&&"symbol"==typeof Symbol("bar")&&t()}}function kn(){if(ti)return ei;ti=!0;var e=function(){if(Zn)return Xn;Zn=!0;var e=Object.prototype.toString,t=Math.max,r=function(e,t){for(var r=[],n=0;n<e.length;n+=1)r[n]=e[n];for(var i=0;i<t.length;i+=1)r[i+e.length]=t[i];return r};return Xn=function(n){var i=this;if("function"!=typeof i||"[object Function]"!==e.apply(i))throw new TypeError("Function.prototype.bind called on incompatible "+i);for(var o,s=function(e){for(var t=[],r=1,n=0;r<e.length;r+=1,n+=1)t[n]=e[r];return t}(arguments),a=t(0,i.length-s.length),l=[],u=0;u<a;u++)l[u]="$"+u;if(o=Function("binder","return function ("+function(e,t){for(var r="",n=0;n<e.length;n+=1)r+=e[n],n+1<e.length&&(r+=t);return r}(l,",")+"){ return binder.apply(this,arguments); }")(function(){if(this instanceof o){var e=i.apply(this,r(s,arguments));return Object(e)===e?e:this}return i.apply(n,r(s,arguments))}),i.prototype){var c=function(){};c.prototype=i.prototype,o.prototype=new c,c.prototype=null}return o},Xn}();return ei=Function.prototype.bind||e}function On(){if(oi)return ii;oi=!0;var e,t=(Bn||(Bn=!0,Mn=Error),Mn),r=(Un||(Un=!0,Nn=EvalError),Nn),n=(Dn||(Dn=!0,Ln=RangeError),Ln),i=(Wn||(Wn=!0,Fn=ReferenceError),Fn),o=En(),s=An(),a=(Kn||(Kn=!0,zn=URIError),zn),l=Function,u=function(e){try{return l('"use strict"; return ('+e+").constructor;")()}catch(e){}},c=Object.getOwnPropertyDescriptor;if(c)try{c({},"")}catch(t){c=null}var h=function(){throw new s},f=c?function(){try{return h}catch(e){try{return c(arguments,"callee").get}catch(e){return h}}}():h,p=In()(),d=function(){if(Jn)return Yn;Jn=!0;var e={__proto__:null,foo:{}},t=Object;return Yn=function(){return{__proto__:e}.foo===e.foo&&!(e instanceof t)}}()(),y=Object.getPrototypeOf||(d?function(e){return e.__proto__}:null),g={},b=typeof Uint8Array>"u"||!y?e:y(Uint8Array),m={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?e:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?e:ArrayBuffer,"%ArrayIteratorPrototype%":p&&y?y([][Symbol.iterator]()):e,"%AsyncFromSyncIteratorPrototype%":e,"%AsyncFunction%":g,"%AsyncGenerator%":g,"%AsyncGeneratorFunction%":g,"%AsyncIteratorPrototype%":g,"%Atomics%":typeof Atomics>"u"?e:Atomics,"%BigInt%":typeof BigInt>"u"?e:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?e:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?e:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?e:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":t,"%eval%":eval,"%EvalError%":r,"%Float32Array%":typeof Float32Array>"u"?e:Float32Array,"%Float64Array%":typeof Float64Array>"u"?e:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?e:FinalizationRegistry,"%Function%":l,"%GeneratorFunction%":g,"%Int8Array%":typeof Int8Array>"u"?e:Int8Array,"%Int16Array%":typeof Int16Array>"u"?e:Int16Array,"%Int32Array%":typeof Int32Array>"u"?e:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":p&&y?y(y([][Symbol.iterator]())):e,"%JSON%":"object"==typeof JSON?JSON:e,"%Map%":typeof Map>"u"?e:Map,"%MapIteratorPrototype%":typeof Map>"u"||!p||!y?e:y((new Map)[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?e:Promise,"%Proxy%":typeof Proxy>"u"?e:Proxy,"%RangeError%":n,"%ReferenceError%":i,"%Reflect%":typeof Reflect>"u"?e:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?e:Set,"%SetIteratorPrototype%":typeof Set>"u"||!p||!y?e:y((new Set)[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?e:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":p&&y?y(""[Symbol.iterator]()):e,"%Symbol%":p?Symbol:e,"%SyntaxError%":o,"%ThrowTypeError%":f,"%TypedArray%":b,"%TypeError%":s,"%Uint8Array%":typeof Uint8Array>"u"?e:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?e:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?e:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?e:Uint32Array,"%URIError%":a,"%WeakMap%":typeof WeakMap>"u"?e:WeakMap,"%WeakRef%":typeof WeakRef>"u"?e:WeakRef,"%WeakSet%":typeof WeakSet>"u"?e:WeakSet};if(y)try{null.error}catch(e){var w=y(y(e));m["%Error.prototype%"]=w}var v=function e(t){var r;if("%AsyncFunction%"===t)r=u("async function () {}");else if("%GeneratorFunction%"===t)r=u("function* () {}");else if("%AsyncGeneratorFunction%"===t)r=u("async function* () {}");else if("%AsyncGenerator%"===t){var n=e("%AsyncGeneratorFunction%");n&&(r=n.prototype)}else if("%AsyncIteratorPrototype%"===t){var i=e("%AsyncGenerator%");i&&y&&(r=y(i.prototype))}return m[t]=r,r},_={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},S=kn(),E=function(){if(ni)return ri;ni=!0;var e=Function.prototype.call,t=Object.prototype.hasOwnProperty,r=kn();return ri=r.call(e,t)}(),A=S.call(Function.call,Array.prototype.concat),I=S.call(Function.apply,Array.prototype.splice),k=S.call(Function.call,String.prototype.replace),O=S.call(Function.call,String.prototype.slice),x=S.call(Function.call,RegExp.prototype.exec),P=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,T=/\\(\\)?/g,R=function(e,t){var r,n=e;if(E(_,n)&&(n="%"+(r=_[n])[0]+"%"),E(m,n)){var i=m[n];if(i===g&&(i=v(n)),typeof i>"u"&&!t)throw new s("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:r,name:n,value:i}}throw new o("intrinsic "+e+" does not exist!")};return ii=function(e,t){if("string"!=typeof e||0===e.length)throw new s("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof t)throw new s('"allowMissing" argument must be a boolean');if(null===x(/^%?[^%]*%?$/,e))throw new o("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var r=function(e){var t=O(e,0,1),r=O(e,-1);if("%"===t&&"%"!==r)throw new o("invalid intrinsic syntax, expected closing `%`");if("%"===r&&"%"!==t)throw new o("invalid intrinsic syntax, expected opening `%`");var n=[];return k(e,P,function(e,t,r,i){n[n.length]=r?k(i,T,"$1"):t||e}),n}(e),n=r.length>0?r[0]:"",i=R("%"+n+"%",t),a=i.name,l=i.value,u=!1,h=i.alias;h&&(n=h[0],I(r,A([0,1],h)));for(var f=1,p=!0;f<r.length;f+=1){var d=r[f],y=O(d,0,1),g=O(d,-1);if(('"'===y||"'"===y||"`"===y||'"'===g||"'"===g||"`"===g)&&y!==g)throw new o("property names with quotes must have matching quotes");if(("constructor"===d||!p)&&(u=!0),E(m,a="%"+(n+="."+d)+"%"))l=m[a];else if(null!=l){if(!(d in l)){if(!t)throw new s("base intrinsic for "+e+" exists, but the property is not available.");return}if(c&&f+1>=r.length){var b=c(l,d);l=(p=!!b)&&"get"in b&&!("originalValue"in b.get)?b.get:l[d]}else p=E(l,d),l=l[d];p&&!u&&(m[a]=l)}}return l},ii}function xn(){if(ai)return si;ai=!0;var e=On()("%Object.defineProperty%",!0)||!1;if(e)try{e({},"a",{value:1})}catch(e){e=!1}return si=e}function Pn(){if(ui)return li;ui=!0;var e=On()("%Object.getOwnPropertyDescriptor%",!0);if(e)try{e([],"length")}catch(e){e=null}return li=e}function Tn(){if(yi)return di;yi=!0;var e=On(),t=function(){if(hi)return ci;hi=!0;var e=xn(),t=En(),r=An(),n=Pn();return ci=function(i,o,s){if(!i||"object"!=typeof i&&"function"!=typeof i)throw new r("`obj` must be an object or a function`");if("string"!=typeof o&&"symbol"!=typeof o)throw new r("`property` must be a string or a symbol`");if(arguments.length>3&&"boolean"!=typeof arguments[3]&&null!==arguments[3])throw new r("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&"boolean"!=typeof arguments[4]&&null!==arguments[4])throw new r("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&"boolean"!=typeof arguments[5]&&null!==arguments[5])throw new r("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&"boolean"!=typeof arguments[6])throw new r("`loose`, if provided, must be a boolean");var a=arguments.length>3?arguments[3]:null,l=arguments.length>4?arguments[4]:null,u=arguments.length>5?arguments[5]:null,c=arguments.length>6&&arguments[6],h=!!n&&n(i,o);if(e)e(i,o,{configurable:null===u&&h?h.configurable:!u,enumerable:null===a&&h?h.enumerable:!a,value:s,writable:null===l&&h?h.writable:!l});else{if(!c&&(a||l||u))throw new t("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.");i[o]=s}},ci}(),r=function(){if(pi)return fi;pi=!0;var e=xn(),t=function(){return!!e};return t.hasArrayLengthDefineBug=function(){if(!e)return null;try{return 1!==e([],"length",{value:1}).length}catch(e){return!0}},fi=t}()(),n=Pn(),i=An(),o=e("%Math.floor%");return di=function(e,s){if("function"!=typeof e)throw new i("`fn` is not a function");if("number"!=typeof s||s<0||s>4294967295||o(s)!==s)throw new i("`length` must be a positive 32-bit integer");var a=arguments.length>2&&!!arguments[2],l=!0,u=!0;if("length"in e&&n){var c=n(e,"length");c&&!c.configurable&&(l=!1),c&&!c.writable&&(u=!1)}return(l||u||!a)&&(r?t(e,"length",s,!0,!0):t(e,"length",s)),e},di}function Rn(){if(wi)return mi;wi=!0;var e=On(),t=function(){if(bi)return gi;bi=!0;var e=kn(),t=On(),r=Tn(),n=An(),i=t("%Function.prototype.apply%"),o=t("%Function.prototype.call%"),s=t("%Reflect.apply%",!0)||e.call(o,i),a=xn(),l=t("%Math.max%");gi=function(t){if("function"!=typeof t)throw new n("a function is required");var i=s(e,o,arguments);return r(i,1+l(0,t.length-(arguments.length-1)),!0)};var u=function(){return s(e,i,arguments)};return a?a(gi,"apply",{value:u}):gi.apply=u,gi}(),r=t(e("String.prototype.indexOf"));return mi=function(n,i){var o=e(n,!!i);return"function"==typeof o&&r(n,".prototype.")>-1?t(o):o}}var Cn,jn,Mn,Bn,Nn,Un,Ln,Dn,Fn,Wn,qn,$n,Hn,Vn,zn,Kn,Gn,Qn,Yn,Jn,Xn,Zn,ei,ti,ri,ni,ii,oi,si,ai,li,ui,ci,hi,fi,pi,di,yi,gi,bi,mi,wi,vi=i(()=>{l(),tt(),Fe(),Cn={},jn=!1,Mn={},Bn=!1,Nn={},Un=!1,Ln={},Dn=!1,Fn={},Wn=!1,qn={},$n=!1,Hn={},Vn=!1,zn={},Kn=!1,Gn={},Qn=!1,Yn={},Jn=!1,Xn={},Zn=!1,ei={},ti=!1,ri={},ni=!1,ii={},oi=!1,si={},ai=!1,li={},ui=!1,ci={},hi=!1,fi={},pi=!1,di={},yi=!1,gi={},bi=!1,mi={},wi=!1});function _i(e){throw new Error("Node.js process "+e+" is not supported by JSPM core outside of Node.js")}function Si(){!Li||!Di||(Li=!1,Di.length?Ui=Di.concat(Ui):Fi=-1,Ui.length&&Ei())}function Ei(){if(!Li){var e=setTimeout(Si,0);Li=!0;for(var t=Ui.length;t;){for(Di=Ui,Ui=[];++Fi<t;)Di&&Di[Fi].run();Fi=-1,t=Ui.length}Di=null,Li=!1,clearTimeout(e)}}function Ai(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];Ui.push(new Ii(e,t)),1===Ui.length&&!Li&&setTimeout(Ei,0)}function Ii(e,t){this.fun=e,this.array=t}function ki(){}function Oi(e){_i("_linkedBinding")}function xi(e){_i("dlopen")}function Pi(){return[]}function Ti(){return[]}function Ri(e,t){if(!e)throw new Error(t||"assertion error")}function Ci(){return!1}function ji(){return So.now()/1e3}function Mi(e){var t=Math.floor(.001*(Date.now()-So.now())),r=.001*So.now(),n=Math.floor(r)+t,i=Math.floor(r%1*1e9);return e&&(n-=e[0],(i-=e[1])<0&&(n--,i+=Ao)),[n,i]}function Bi(){return Io}function Ni(e){return[]}var Ui,Li,Di,Fi,Wi,qi,$i,Hi,Vi,zi,Ki,Gi,Qi,Yi,Ji,Xi,Zi,eo,to,ro,no,io,oo,so,ao,lo,uo,co,ho,fo,po,yo,go,bo,mo,wo,vo,_o,So,Eo,Ao,Io,ko=i(()=>{l(),tt(),Fe(),Ui=[],Li=!1,Fi=-1,Ii.prototype.run=function(){this.fun.apply(null,this.array)},Wi={PATH:"/usr/bin",LANG:navigator.language+".UTF-8",PWD:"/",HOME:"/home",TMP:"/tmp"},qi=["/usr/bin/node"],$i=[],Hi={},Vi=function(e,t){console.warn((t?t+": ":"")+e)},zi=function(e){_i("binding")},Ki=function(e){return 0},Gi=function(){return"/"},Qi=function(e){},Yi={name:"node",sourceUrl:"",headersUrl:"",libUrl:""},Ji=ki,Xi=[],Zi={},eo={},to=ki,ro=ki,io=no=function(){return{}},oo=no,so=ki,ao=ki,lo=ki,uo={},co={inspector:!1,debug:!1,uv:!1,ipv6:!1,tls_alpn:!1,tls_sni:!1,tls_ocsp:!1,tls:!1,cached_builtins:!0},ho=ki,fo=ki,po=ki,yo=ki,go=ki,bo=ki,mo=ki,wo=ki,vo=[],_o=ki,void 0===(So={now:typeof performance<"u"?performance.now.bind(performance):void 0,timing:typeof performance<"u"?performance.timing:void 0}).now&&(Eo=Date.now(),So.timing&&So.timing.navigationStart&&(Eo=So.timing.navigationStart),So.now=()=>Date.now()-Eo),Ao=1e9,Mi.bigint=function(e){var t=Mi(e);return typeof BigInt>"u"?t[0]*Ao+t[1]:BigInt(t[0]*Ao)+BigInt(t[1])},Io={version:"v16.8.0",versions:Hi,arch:"x64",platform:"browser",release:Yi,_rawDebug:Ji,moduleLoadList:Xi,binding:zi,_linkedBinding:Oi,_events:{},_eventsCount:0,_maxListeners:10,on:Bi,addListener:Bi,once:Bi,off:Bi,removeListener:Bi,removeAllListeners:Bi,emit:ki,prependListener:Bi,prependOnceListener:Bi,listeners:Ni,domain:Zi,_exiting:false,config:eo,dlopen:xi,uptime:ji,_getActiveRequests:Pi,_getActiveHandles:Ti,reallyExit:to,_kill:ro,cpuUsage:no,resourceUsage:io,memoryUsage:oo,kill:so,exit:ao,openStdin:lo,allowedNodeEnvironmentFlags:uo,assert:Ri,features:co,_fatalExceptions:ho,setUncaughtExceptionCaptureCallback:fo,hasUncaughtExceptionCaptureCallback:Ci,emitWarning:Vi,nextTick:Ai,_tickCallback:po,_debugProcess:yo,_debugEnd:go,_startProfilerIdleNotifier:bo,_stopProfilerIdleNotifier:mo,stdout:undefined,stdin:undefined,stderr:undefined,abort:wo,umask:Ki,chdir:Qi,cwd:Gi,env:Wi,title:"browser",argv:qi,execArgv:$i,pid:2,ppid:1,execPath:"/bin/usr/node",debugPort:9229,hrtime:Mi,argv0:"node",_preload_modules:vo,setSourceMapsEnabled:_o}});var Oo,xo,Po,To=i(()=>{l(),tt(),Fe(),ko(),Oo={},xo=!1,Po=function(){if(xo)return Oo;xo=!0;var e=Io;function t(e){if("string"!=typeof e)throw new TypeError("Path must be a string. Received "+JSON.stringify(e))}function r(e,t){for(var r,n="",i=0,o=-1,s=0,a=0;a<=e.length;++a){if(a<e.length)r=e.charCodeAt(a);else{if(47===r)break;r=47}if(47===r){if(o!==a-1&&1!==s)if(o!==a-1&&2===s){if(n.length<2||2!==i||46!==n.charCodeAt(n.length-1)||46!==n.charCodeAt(n.length-2))if(n.length>2){var l=n.lastIndexOf("/");if(l!==n.length-1){-1===l?(n="",i=0):i=(n=n.slice(0,l)).length-1-n.lastIndexOf("/"),o=a,s=0;continue}}else if(2===n.length||1===n.length){n="",i=0,o=a,s=0;continue}t&&(n.length>0?n+="/..":n="..",i=2)}else n.length>0?n+="/"+e.slice(o+1,a):n=e.slice(o+1,a),i=a-o-1;o=a,s=0}else 46===r&&-1!==s?++s:s=-1}return n}var n={resolve:function(){for(var n,i="",o=!1,s=arguments.length-1;s>=-1&&!o;s--){var a;s>=0?a=arguments[s]:(void 0===n&&(n=e.cwd()),a=n),t(a),0!==a.length&&(i=a+"/"+i,o=47===a.charCodeAt(0))}return i=r(i,!o),o?i.length>0?"/"+i:"/":i.length>0?i:"."},normalize:function(e){if(t(e),0===e.length)return".";var n=47===e.charCodeAt(0),i=47===e.charCodeAt(e.length-1);return 0===(e=r(e,!n)).length&&!n&&(e="."),e.length>0&&i&&(e+="/"),n?"/"+e:e},isAbsolute:function(e){return t(e),e.length>0&&47===e.charCodeAt(0)},join:function(){if(0===arguments.length)return".";for(var e,r=0;r<arguments.length;++r){var i=arguments[r];t(i),i.length>0&&(void 0===e?e=i:e+="/"+i)}return void 0===e?".":n.normalize(e)},relative:function(e,r){if(t(e),t(r),e===r||(e=n.resolve(e))===(r=n.resolve(r)))return"";for(var i=1;i<e.length&&47===e.charCodeAt(i);++i);for(var o=e.length,s=o-i,a=1;a<r.length&&47===r.charCodeAt(a);++a);for(var l=r.length-a,u=s<l?s:l,c=-1,h=0;h<=u;++h){if(h===u){if(l>u){if(47===r.charCodeAt(a+h))return r.slice(a+h+1);if(0===h)return r.slice(a+h)}else s>u&&(47===e.charCodeAt(i+h)?c=h:0===h&&(c=0));break}var f=e.charCodeAt(i+h);if(f!==r.charCodeAt(a+h))break;47===f&&(c=h)}var p="";for(h=i+c+1;h<=o;++h)(h===o||47===e.charCodeAt(h))&&(0===p.length?p+="..":p+="/..");return p.length>0?p+r.slice(a+c):(a+=c,47===r.charCodeAt(a)&&++a,r.slice(a))},_makeLong:function(e){return e},dirname:function(e){if(t(e),0===e.length)return".";for(var r=e.charCodeAt(0),n=47===r,i=-1,o=!0,s=e.length-1;s>=1;--s)if(47===(r=e.charCodeAt(s))){if(!o){i=s;break}}else o=!1;return-1===i?n?"/":".":n&&1===i?"//":e.slice(0,i)},basename:function(e,r){if(void 0!==r&&"string"!=typeof r)throw new TypeError('"ext" argument must be a string');t(e);var n,i=0,o=-1,s=!0;if(void 0!==r&&r.length>0&&r.length<=e.length){if(r.length===e.length&&r===e)return"";var a=r.length-1,l=-1;for(n=e.length-1;n>=0;--n){var u=e.charCodeAt(n);if(47===u){if(!s){i=n+1;break}}else-1===l&&(s=!1,l=n+1),a>=0&&(u===r.charCodeAt(a)?-1===--a&&(o=n):(a=-1,o=l))}return i===o?o=l:-1===o&&(o=e.length),e.slice(i,o)}for(n=e.length-1;n>=0;--n)if(47===e.charCodeAt(n)){if(!s){i=n+1;break}}else-1===o&&(s=!1,o=n+1);return-1===o?"":e.slice(i,o)},extname:function(e){t(e);for(var r=-1,n=0,i=-1,o=!0,s=0,a=e.length-1;a>=0;--a){var l=e.charCodeAt(a);if(47!==l)-1===i&&(o=!1,i=a+1),46===l?-1===r?r=a:1!==s&&(s=1):-1!==r&&(s=-1);else if(!o){n=a+1;break}}return-1===r||-1===i||0===s||1===s&&r===i-1&&r===n+1?"":e.slice(r,i)},format:function(e){if(null===e||"object"!=typeof e)throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return function(e,t){var r=t.dir||t.root,n=t.base||(t.name||"")+(t.ext||"");return r?r===t.root?r+n:r+e+n:n}("/",e)},parse:function(e){t(e);var r={root:"",dir:"",base:"",ext:"",name:""};if(0===e.length)return r;var n,i=e.charCodeAt(0),o=47===i;o?(r.root="/",n=1):n=0;for(var s=-1,a=0,l=-1,u=!0,c=e.length-1,h=0;c>=n;--c)if(47!==(i=e.charCodeAt(c)))-1===l&&(u=!1,l=c+1),46===i?-1===s?s=c:1!==h&&(h=1):-1!==s&&(h=-1);else if(!u){a=c+1;break}return-1===s||-1===l||0===h||1===h&&s===l-1&&s===a+1?-1!==l&&(r.base=r.name=0===a&&o?e.slice(1,l):e.slice(a,l)):(0===a&&o?(r.name=e.slice(1,s),r.base=e.slice(1,l)):(r.name=e.slice(a,s),r.base=e.slice(a,l)),r.ext=e.slice(s,l)),a>0?r.dir=e.slice(0,a-1):o&&(r.dir="/"),r},sep:"/",delimiter:":",win32:null,posix:null};return n.posix=n,Oo=n}()}),Ro={};function Co(){if($o)return qo;$o=!0;var e="function"==typeof Map&&Map.prototype,t=Object.getOwnPropertyDescriptor&&e?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,r=e&&t&&"function"==typeof t.get?t.get:null,n=e&&Map.prototype.forEach,i="function"==typeof Set&&Set.prototype,o=Object.getOwnPropertyDescriptor&&i?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,s=i&&o&&"function"==typeof o.get?o.get:null,a=i&&Set.prototype.forEach,l="function"==typeof WeakMap&&WeakMap.prototype?WeakMap.prototype.has:null,u="function"==typeof WeakSet&&WeakSet.prototype?WeakSet.prototype.has:null,c="function"==typeof WeakRef&&WeakRef.prototype?WeakRef.prototype.deref:null,h=Boolean.prototype.valueOf,f=Object.prototype.toString,p=Function.prototype.toString,d=String.prototype.match,y=String.prototype.slice,g=String.prototype.replace,b=String.prototype.toUpperCase,m=String.prototype.toLowerCase,w=RegExp.prototype.test,v=Array.prototype.concat,_=Array.prototype.join,S=Array.prototype.slice,E=Math.floor,A="function"==typeof BigInt?BigInt.prototype.valueOf:null,I=Object.getOwnPropertySymbols,k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?Symbol.prototype.toString:null,O="function"==typeof Symbol&&"object"==typeof Symbol.iterator,x="function"==typeof Symbol&&Symbol.toStringTag&&(Symbol.toStringTag,1)?Symbol.toStringTag:null,P=Object.prototype.propertyIsEnumerable,T=("function"==typeof Reflect?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(e){return e.__proto__}:null);function R(e,t){if(e===1/0||e===-1/0||e!=e||e&&e>-1e3&&e<1e3||w.call(/e/,t))return t;var r=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if("number"==typeof e){var n=e<0?-E(-e):E(e);if(n!==e){var i=String(n),o=y.call(t,i.length+1);return g.call(i,r,"$&_")+"."+g.call(g.call(o,/([0-9]{3})/g,"$&_"),/_$/,"")}}return g.call(t,r,"$&_")}var C=Wo,j=C.custom,M=D(j)?j:null;function B(e,t,r){var n="double"===(r.quoteStyle||t)?'"':"'";return n+e+n}function N(e){return g.call(String(e),/"/g,"&quot;")}function U(e){return!("[object Array]"!==q(e)||x&&"object"==typeof e&&x in e)}function L(e){return!("[object RegExp]"!==q(e)||x&&"object"==typeof e&&x in e)}function D(e){if(O)return e&&"object"==typeof e&&e instanceof Symbol;if("symbol"==typeof e)return!0;if(!e||"object"!=typeof e||!k)return!1;try{return k.call(e),!0}catch(e){}return!1}qo=function e(t,i,o,f){var b=i||{};if(W(b,"quoteStyle")&&"single"!==b.quoteStyle&&"double"!==b.quoteStyle)throw new TypeError('option "quoteStyle" must be "single" or "double"');if(W(b,"maxStringLength")&&("number"==typeof b.maxStringLength?b.maxStringLength<0&&b.maxStringLength!==1/0:null!==b.maxStringLength))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var w=!W(b,"customInspect")||b.customInspect;if("boolean"!=typeof w&&"symbol"!==w)throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(W(b,"indent")&&null!==b.indent&&"\t"!==b.indent&&!(parseInt(b.indent,10)===b.indent&&b.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(W(b,"numericSeparator")&&"boolean"!=typeof b.numericSeparator)throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var E=b.numericSeparator;if(typeof t>"u")return"undefined";if(null===t)return"null";if("boolean"==typeof t)return t?"true":"false";if("string"==typeof t)return H(t,b);if("number"==typeof t){if(0===t)return 1/0/t>0?"0":"-0";var I=String(t);return E?R(t,I):I}if("bigint"==typeof t){var j=String(t)+"n";return E?R(t,j):j}var F=typeof b.depth>"u"?5:b.depth;if(typeof o>"u"&&(o=0),o>=F&&F>0&&"object"==typeof t)return U(t)?"[Array]":"[Object]";var V=function(e,t){var r;if("\t"===e.indent)r="\t";else{if(!("number"==typeof e.indent&&e.indent>0))return null;r=_.call(Array(e.indent+1)," ")}return{base:r,prev:_.call(Array(t+1),r)}}(b,o);if(typeof f>"u")f=[];else if($(f,t)>=0)return"[Circular]";function J(t,r,n){if(r&&(f=S.call(f)).push(r),n){var i={depth:b.depth};return W(b,"quoteStyle")&&(i.quoteStyle=b.quoteStyle),e(t,i,o+1,f)}return e(t,b,o+1,f)}if("function"==typeof t&&!L(t)){var X=function(e){if(e.name)return e.name;var t=d.call(p.call(e),/^function\s*([\w$]+)/);return t?t[1]:null}(t),Z=Y(t,J);return"[Function"+(X?": "+X:" (anonymous)")+"]"+(Z.length>0?" { "+_.call(Z,", ")+" }":"")}if(D(t)){var ee=O?g.call(String(t),/^(Symbol\(.*\))_[^)]*$/,"$1"):k.call(t);return"object"!=typeof t||O?ee:z(ee)}if(function(e){return!(!e||"object"!=typeof e)&&(typeof HTMLElement<"u"&&e instanceof HTMLElement||"string"==typeof e.nodeName&&"function"==typeof e.getAttribute)}(t)){for(var te="<"+m.call(String(t.nodeName)),re=t.attributes||[],ne=0;ne<re.length;ne++)te+=" "+re[ne].name+"="+B(N(re[ne].value),"double",b);return te+=">",t.childNodes&&t.childNodes.length&&(te+="..."),te+="</"+m.call(String(t.nodeName))+">"}if(U(t)){if(0===t.length)return"[]";var ie=Y(t,J);return V&&!function(e){for(var t=0;t<e.length;t++)if($(e[t],"\n")>=0)return!1;return!0}(ie)?"["+Q(ie,V)+"]":"[ "+_.call(ie,", ")+" ]"}if(function(e){return!("[object Error]"!==q(e)||x&&"object"==typeof e&&x in e)}(t)){var oe=Y(t,J);return"cause"in Error.prototype||!("cause"in t)||P.call(t,"cause")?0===oe.length?"["+String(t)+"]":"{ ["+String(t)+"] "+_.call(oe,", ")+" }":"{ ["+String(t)+"] "+_.call(v.call("[cause]: "+J(t.cause),oe),", ")+" }"}if("object"==typeof t&&w){if(M&&"function"==typeof t[M]&&C)return C(t,{depth:F-o});if("symbol"!==w&&"function"==typeof t.inspect)return t.inspect()}if(function(e){if(!r||!e||"object"!=typeof e)return!1;try{r.call(e);try{s.call(e)}catch(e){return!0}return e instanceof Map}catch(e){}return!1}(t)){var se=[];return n&&n.call(t,function(e,r){se.push(J(r,t,!0)+" => "+J(e,t))}),G("Map",r.call(t),se,V)}if(function(e){if(!s||!e||"object"!=typeof e)return!1;try{s.call(e);try{r.call(e)}catch(e){return!0}return e instanceof Set}catch(e){}return!1}(t)){var ae=[];return a&&a.call(t,function(e){ae.push(J(e,t))}),G("Set",s.call(t),ae,V)}if(function(e){if(!l||!e||"object"!=typeof e)return!1;try{l.call(e,l);try{u.call(e,u)}catch(e){return!0}return e instanceof WeakMap}catch(e){}return!1}(t))return K("WeakMap");if(function(e){if(!u||!e||"object"!=typeof e)return!1;try{u.call(e,u);try{l.call(e,l)}catch(e){return!0}return e instanceof WeakSet}catch(e){}return!1}(t))return K("WeakSet");if(function(e){if(!c||!e||"object"!=typeof e)return!1;try{return c.call(e),!0}catch(e){}return!1}(t))return K("WeakRef");if(function(e){return!("[object Number]"!==q(e)||x&&"object"==typeof e&&x in e)}(t))return z(J(Number(t)));if(function(e){if(!e||"object"!=typeof e||!A)return!1;try{return A.call(e),!0}catch(e){}return!1}(t))return z(J(A.call(t)));if(function(e){return!("[object Boolean]"!==q(e)||x&&"object"==typeof e&&x in e)}(t))return z(h.call(t));if(function(e){return!("[object String]"!==q(e)||x&&"object"==typeof e&&x in e)}(t))return z(J(String(t)));if(typeof window<"u"&&t===window)return"{ [object Window] }";if(typeof globalThis<"u"&&t===globalThis||typeof Ho<"u"&&t===Ho)return"{ [object globalThis] }";if(!function(e){return!("[object Date]"!==q(e)||x&&"object"==typeof e&&x in e)}(t)&&!L(t)){var le=Y(t,J),ue=T?T(t)===Object.prototype:t instanceof Object||t.constructor===Object,ce=t instanceof Object?"":"null prototype",he=!ue&&x&&Object(t)===t&&x in t?y.call(q(t),8,-1):ce?"Object":"",fe=(ue||"function"!=typeof t.constructor?"":t.constructor.name?t.constructor.name+" ":"")+(he||ce?"["+_.call(v.call([],he||[],ce||[]),": ")+"] ":"");return 0===le.length?fe+"{}":V?fe+"{"+Q(le,V)+"}":fe+"{ "+_.call(le,", ")+" }"}return String(t)};var F=Object.prototype.hasOwnProperty||function(e){return e in(this||Ho)};function W(e,t){return F.call(e,t)}function q(e){return f.call(e)}function $(e,t){if(e.indexOf)return e.indexOf(t);for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}function H(e,t){if(e.length>t.maxStringLength){var r=e.length-t.maxStringLength,n="... "+r+" more character"+(r>1?"s":"");return H(y.call(e,0,t.maxStringLength),t)+n}return B(g.call(g.call(e,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,V),"single",t)}function V(e){var t=e.charCodeAt(0),r={8:"b",9:"t",10:"n",12:"f",13:"r"}[t];return r?"\\"+r:"\\x"+(t<16?"0":"")+b.call(t.toString(16))}function z(e){return"Object("+e+")"}function K(e){return e+" { ? }"}function G(e,t,r,n){return e+" ("+t+") {"+(n?Q(r,n):_.call(r,", "))+"}"}function Q(e,t){if(0===e.length)return"";var r="\n"+t.prev+t.base;return r+_.call(e,","+r)+"\n"+t.prev}function Y(e,t){var r=U(e),n=[];if(r){n.length=e.length;for(var i=0;i<e.length;i++)n[i]=W(e,i)?t(e[i],e):""}var o,s="function"==typeof I?I(e):[];if(O){o={};for(var a=0;a<s.length;a++)o["$"+s[a]]=s[a]}for(var l in e)W(e,l)&&(r&&String(Number(l))===l&&l<e.length||O&&o["$"+l]instanceof Symbol||(w.call(/[^\w$]/,l)?n.push(t(l,e)+": "+t(e[l],e)):n.push(l+": "+t(e[l],e))));if("function"==typeof I)for(var u=0;u<s.length;u++)P.call(e,s[u])&&n.push("["+t(s[u])+"]: "+t(e[s[u]],e));return n}return qo}function jo(){if(zo)return Vo;zo=!0;var e=On(),t=Rn(),r=Co(),n=An(),i=e("%WeakMap%",!0),o=e("%Map%",!0),s=t("WeakMap.prototype.get",!0),a=t("WeakMap.prototype.set",!0),l=t("WeakMap.prototype.has",!0),u=t("Map.prototype.get",!0),c=t("Map.prototype.set",!0),h=t("Map.prototype.has",!0),f=function(e,t){for(var r,n=e;null!==(r=n.next);n=r)if(r.key===t)return n.next=r.next,r.next=e.next,e.next=r,r};return Vo=function(){var e,t,p,d={assert:function(e){if(!d.has(e))throw new n("Side channel does not contain "+r(e))},get:function(r){if(i&&r&&("object"==typeof r||"function"==typeof r)){if(e)return s(e,r)}else if(o){if(t)return u(t,r)}else if(p)return function(e,t){var r=f(e,t);return r&&r.value}(p,r)},has:function(r){if(i&&r&&("object"==typeof r||"function"==typeof r)){if(e)return l(e,r)}else if(o){if(t)return h(t,r)}else if(p)return function(e,t){return!!f(e,t)}(p,r);return!1},set:function(r,n){i&&r&&("object"==typeof r||"function"==typeof r)?(e||(e=new i),a(e,r,n)):o?(t||(t=new o),c(t,r,n)):(p||(p={key:{},next:null}),function(e,t,r){var n=f(e,t);n?n.value=r:e.next={key:t,next:e.next,value:r}}(p,r,n))}};return d}}function Mo(){if(Go)return Ko;Go=!0;var e=String.prototype.replace,t=/%20/g,r="RFC3986";return Ko={default:r,formatters:{RFC1738:function(r){return e.call(r,t,"+")},RFC3986:function(e){return String(e)}},RFC1738:"RFC1738",RFC3986:r}}function Bo(){if(Yo)return Qo;Yo=!0;var e=Mo(),t=Object.prototype.hasOwnProperty,r=Array.isArray,n=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}(),i=function(e,t){for(var r=t&&t.plainObjects?Object.create(null):{},n=0;n<e.length;++n)typeof e[n]<"u"&&(r[n]=e[n]);return r},o=1024;return Qo={arrayToObject:i,assign:function(e,t){return Object.keys(t).reduce(function(e,r){return e[r]=t[r],e},e)},combine:function(e,t){return[].concat(e,t)},compact:function(e){for(var t=[{obj:{o:e},prop:"o"}],n=[],i=0;i<t.length;++i)for(var o=t[i],s=o.obj[o.prop],a=Object.keys(s),l=0;l<a.length;++l){var u=a[l],c=s[u];"object"==typeof c&&null!==c&&-1===n.indexOf(c)&&(t.push({obj:s,prop:u}),n.push(c))}return function(e){for(;e.length>1;){var t=e.pop(),n=t.obj[t.prop];if(r(n)){for(var i=[],o=0;o<n.length;++o)typeof n[o]<"u"&&i.push(n[o]);t.obj[t.prop]=i}}}(t),e},decode:function(e,t,r){var n=e.replace(/\+/g," ");if("iso-8859-1"===r)return n.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(n)}catch(e){return n}},encode:function(t,r,i,s,a){if(0===t.length)return t;var l=t;if("symbol"==typeof t?l=Symbol.prototype.toString.call(t):"string"!=typeof t&&(l=String(t)),"iso-8859-1"===i)return escape(l).replace(/%u[0-9a-f]{4}/gi,function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"});for(var u="",c=0;c<l.length;c+=o){for(var h=l.length>=o?l.slice(c,c+o):l,f=[],p=0;p<h.length;++p){var d=h.charCodeAt(p);45===d||46===d||95===d||126===d||d>=48&&d<=57||d>=65&&d<=90||d>=97&&d<=122||a===e.RFC1738&&(40===d||41===d)?f[f.length]=h.charAt(p):d<128?f[f.length]=n[d]:d<2048?f[f.length]=n[192|d>>6]+n[128|63&d]:d<55296||d>=57344?f[f.length]=n[224|d>>12]+n[128|d>>6&63]+n[128|63&d]:(p+=1,d=65536+((1023&d)<<10|1023&h.charCodeAt(p)),f[f.length]=n[240|d>>18]+n[128|d>>12&63]+n[128|d>>6&63]+n[128|63&d])}u+=f.join("")}return u},isBuffer:function(e){return!(!e||"object"!=typeof e)&&!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))},isRegExp:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},maybeMap:function(e,t){if(r(e)){for(var n=[],i=0;i<e.length;i+=1)n.push(t(e[i]));return n}return t(e)},merge:function e(n,o,s){if(!o)return n;if("object"!=typeof o){if(r(n))n.push(o);else{if(!n||"object"!=typeof n)return[n,o];(s&&(s.plainObjects||s.allowPrototypes)||!t.call(Object.prototype,o))&&(n[o]=!0)}return n}if(!n||"object"!=typeof n)return[n].concat(o);var a=n;return r(n)&&!r(o)&&(a=i(n,s)),r(n)&&r(o)?(o.forEach(function(r,i){if(t.call(n,i)){var o=n[i];o&&"object"==typeof o&&r&&"object"==typeof r?n[i]=e(o,r,s):n.push(r)}else n[i]=r}),n):Object.keys(o).reduce(function(r,n){var i=o[n];return t.call(r,n)?r[n]=e(r[n],i,s):r[n]=i,r},a)}}}function No(){if(Xo)return Jo;Xo=!0;var e=jo(),t=Bo(),r=Mo(),n=Object.prototype.hasOwnProperty,i={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},o=Array.isArray,s=Array.prototype.push,a=function(e,t){s.apply(e,o(t)?t:[t])},l=Date.prototype.toISOString,u=r.default,c={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:t.encode,encodeValuesOnly:!1,format:u,formatter:r.formatters[u],indices:!1,serializeDate:function(e){return l.call(e)},skipNulls:!1,strictNullHandling:!1},h={},f=function r(n,i,s,l,u,f,p,d,y,g,b,m,w,v,_,S,E,A){for(var I=n,k=A,O=0,x=!1;void 0!==(k=k.get(h))&&!x;){var P=k.get(n);if(O+=1,typeof P<"u"){if(P===O)throw new RangeError("Cyclic object value");x=!0}typeof k.get(h)>"u"&&(O=0)}if("function"==typeof g?I=g(i,I):I instanceof Date?I=w(I):"comma"===s&&o(I)&&(I=t.maybeMap(I,function(e){return e instanceof Date?w(e):e})),null===I){if(f)return y&&!S?y(i,c.encoder,E,"key",v):i;I=""}if(function(e){return"string"==typeof e||"number"==typeof e||"boolean"==typeof e||"symbol"==typeof e||"bigint"==typeof e}(I)||t.isBuffer(I))return y?[_(S?i:y(i,c.encoder,E,"key",v))+"="+_(y(I,c.encoder,E,"value",v))]:[_(i)+"="+_(String(I))];var T,R=[];if(typeof I>"u")return R;if("comma"===s&&o(I))S&&y&&(I=t.maybeMap(I,y)),T=[{value:I.length>0?I.join(",")||null:void 0}];else if(o(g))T=g;else{var C=Object.keys(I);T=b?C.sort(b):C}var j=d?i.replace(/\./g,"%2E"):i,M=l&&o(I)&&1===I.length?j+"[]":j;if(u&&o(I)&&0===I.length)return M+"[]";for(var B=0;B<T.length;++B){var N=T[B],U="object"==typeof N&&typeof N.value<"u"?N.value:I[N];if(!p||null!==U){var L=m&&d?N.replace(/\./g,"%2E"):N,D=o(I)?"function"==typeof s?s(M,L):M:M+(m?"."+L:"["+L+"]");A.set(n,O);var F=e();F.set(h,A),a(R,r(U,D,s,l,u,f,p,d,"comma"===s&&S&&o(I)?null:y,g,b,m,w,v,_,S,E,F))}}return R};return Jo=function(t,s){var l,u=t,h=function(e){if(!e)return c;if(typeof e.allowEmptyArrays<"u"&&"boolean"!=typeof e.allowEmptyArrays)throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof e.encodeDotInKeys<"u"&&"boolean"!=typeof e.encodeDotInKeys)throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.encoder&&typeof e.encoder<"u"&&"function"!=typeof e.encoder)throw new TypeError("Encoder has to be a function.");var t=e.charset||c.charset;if(typeof e.charset<"u"&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var s=r.default;if(typeof e.format<"u"){if(!n.call(r.formatters,e.format))throw new TypeError("Unknown format option provided.");s=e.format}var a,l=r.formatters[s],u=c.filter;if(("function"==typeof e.filter||o(e.filter))&&(u=e.filter),a=e.arrayFormat in i?e.arrayFormat:"indices"in e?e.indices?"indices":"repeat":c.arrayFormat,"commaRoundTrip"in e&&"boolean"!=typeof e.commaRoundTrip)throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var h=typeof e.allowDots>"u"?!0===e.encodeDotInKeys||c.allowDots:!!e.allowDots;return{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:c.addQueryPrefix,allowDots:h,allowEmptyArrays:"boolean"==typeof e.allowEmptyArrays?!!e.allowEmptyArrays:c.allowEmptyArrays,arrayFormat:a,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:c.charsetSentinel,commaRoundTrip:e.commaRoundTrip,delimiter:typeof e.delimiter>"u"?c.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:c.encode,encodeDotInKeys:"boolean"==typeof e.encodeDotInKeys?e.encodeDotInKeys:c.encodeDotInKeys,encoder:"function"==typeof e.encoder?e.encoder:c.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:c.encodeValuesOnly,filter:u,format:s,formatter:l,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:c.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:c.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:c.strictNullHandling}}(s);"function"==typeof h.filter?u=(0,h.filter)("",u):o(h.filter)&&(l=h.filter);var p=[];if("object"!=typeof u||null===u)return"";var d=i[h.arrayFormat],y="comma"===d&&h.commaRoundTrip;l||(l=Object.keys(u)),h.sort&&l.sort(h.sort);for(var g=e(),b=0;b<l.length;++b){var m=l[b];h.skipNulls&&null===u[m]||a(p,f(u[m],m,d,y,h.allowEmptyArrays,h.strictNullHandling,h.skipNulls,h.encodeDotInKeys,h.encode?h.encoder:null,h.filter,h.sort,h.allowDots,h.serializeDate,h.format,h.formatter,h.encodeValuesOnly,h.charset,g))}var w=p.join(h.delimiter),v=!0===h.addQueryPrefix?"?":"";return h.charsetSentinel&&("iso-8859-1"===h.charset?v+="utf8=%26%2310003%3B&":v+="utf8=%E2%9C%93&"),w.length>0?v+w:""}}function Uo(){if(es)return Zo;es=!0;var e=Bo(),t=Object.prototype.hasOwnProperty,r=Array.isArray,n={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:e.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictDepth:!1,strictNullHandling:!1},i=function(e){return e.replace(/&#(\d+);/g,function(e,t){return String.fromCharCode(parseInt(t,10))})},o=function(e,t){return e&&"string"==typeof e&&t.comma&&e.indexOf(",")>-1?e.split(","):e},s=function(e,r,n,i){if(e){var s=n.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,a=/(\[[^[\]]*])/g,l=n.depth>0&&/(\[[^[\]]*])/.exec(s),u=l?s.slice(0,l.index):s,c=[];if(u){if(!n.plainObjects&&t.call(Object.prototype,u)&&!n.allowPrototypes)return;c.push(u)}for(var h=0;n.depth>0&&null!==(l=a.exec(s))&&h<n.depth;){if(h+=1,!n.plainObjects&&t.call(Object.prototype,l[1].slice(1,-1))&&!n.allowPrototypes)return;c.push(l[1])}if(l){if(!0===n.strictDepth)throw new RangeError("Input depth exceeded depth option of "+n.depth+" and strictDepth is true");c.push("["+s.slice(l.index)+"]")}return function(e,t,r,n){for(var i=n?t:o(t,r),s=e.length-1;s>=0;--s){var a,l=e[s];if("[]"===l&&r.parseArrays)a=r.allowEmptyArrays&&(""===i||r.strictNullHandling&&null===i)?[]:[].concat(i);else{a=r.plainObjects?Object.create(null):{};var u="["===l.charAt(0)&&"]"===l.charAt(l.length-1)?l.slice(1,-1):l,c=r.decodeDotInKeys?u.replace(/%2E/g,"."):u,h=parseInt(c,10);r.parseArrays||""!==c?!isNaN(h)&&l!==c&&String(h)===c&&h>=0&&r.parseArrays&&h<=r.arrayLimit?(a=[])[h]=i:"__proto__"!==c&&(a[c]=i):a={0:i}}i=a}return i}(c,r,n,i)}};return Zo=function(a,l){var u=function(t){if(!t)return n;if(typeof t.allowEmptyArrays<"u"&&"boolean"!=typeof t.allowEmptyArrays)throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof t.decodeDotInKeys<"u"&&"boolean"!=typeof t.decodeDotInKeys)throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==t.decoder&&typeof t.decoder<"u"&&"function"!=typeof t.decoder)throw new TypeError("Decoder has to be a function.");if(typeof t.charset<"u"&&"utf-8"!==t.charset&&"iso-8859-1"!==t.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var r=typeof t.charset>"u"?n.charset:t.charset,i=typeof t.duplicates>"u"?n.duplicates:t.duplicates;if("combine"!==i&&"first"!==i&&"last"!==i)throw new TypeError("The duplicates option must be either combine, first, or last");return{allowDots:typeof t.allowDots>"u"?!0===t.decodeDotInKeys||n.allowDots:!!t.allowDots,allowEmptyArrays:"boolean"==typeof t.allowEmptyArrays?!!t.allowEmptyArrays:n.allowEmptyArrays,allowPrototypes:"boolean"==typeof t.allowPrototypes?t.allowPrototypes:n.allowPrototypes,allowSparse:"boolean"==typeof t.allowSparse?t.allowSparse:n.allowSparse,arrayLimit:"number"==typeof t.arrayLimit?t.arrayLimit:n.arrayLimit,charset:r,charsetSentinel:"boolean"==typeof t.charsetSentinel?t.charsetSentinel:n.charsetSentinel,comma:"boolean"==typeof t.comma?t.comma:n.comma,decodeDotInKeys:"boolean"==typeof t.decodeDotInKeys?t.decodeDotInKeys:n.decodeDotInKeys,decoder:"function"==typeof t.decoder?t.decoder:n.decoder,delimiter:"string"==typeof t.delimiter||e.isRegExp(t.delimiter)?t.delimiter:n.delimiter,depth:"number"==typeof t.depth||!1===t.depth?+t.depth:n.depth,duplicates:i,ignoreQueryPrefix:!0===t.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof t.interpretNumericEntities?t.interpretNumericEntities:n.interpretNumericEntities,parameterLimit:"number"==typeof t.parameterLimit?t.parameterLimit:n.parameterLimit,parseArrays:!1!==t.parseArrays,plainObjects:"boolean"==typeof t.plainObjects?t.plainObjects:n.plainObjects,strictDepth:"boolean"==typeof t.strictDepth?!!t.strictDepth:n.strictDepth,strictNullHandling:"boolean"==typeof t.strictNullHandling?t.strictNullHandling:n.strictNullHandling}}(l);if(""===a||null===a||typeof a>"u")return u.plainObjects?Object.create(null):{};for(var c="string"==typeof a?function(s,a){var l={__proto__:null},u=a.ignoreQueryPrefix?s.replace(/^\?/,""):s;u=u.replace(/%5B/gi,"[").replace(/%5D/gi,"]");var c,h=a.parameterLimit===1/0?void 0:a.parameterLimit,f=u.split(a.delimiter,h),p=-1,d=a.charset;if(a.charsetSentinel)for(c=0;c<f.length;++c)0===f[c].indexOf("utf8=")&&("utf8=%E2%9C%93"===f[c]?d="utf-8":"utf8=%26%2310003%3B"===f[c]&&(d="iso-8859-1"),p=c,c=f.length);for(c=0;c<f.length;++c)if(c!==p){var y,g,b=f[c],m=b.indexOf("]="),w=-1===m?b.indexOf("="):m+1;-1===w?(y=a.decoder(b,n.decoder,d,"key"),g=a.strictNullHandling?null:""):(y=a.decoder(b.slice(0,w),n.decoder,d,"key"),g=e.maybeMap(o(b.slice(w+1),a),function(e){return a.decoder(e,n.decoder,d,"value")})),g&&a.interpretNumericEntities&&"iso-8859-1"===d&&(g=i(g)),b.indexOf("[]=")>-1&&(g=r(g)?[g]:g);var v=t.call(l,y);v&&"combine"===a.duplicates?l[y]=e.combine(l[y],g):(!v||"last"===a.duplicates)&&(l[y]=g)}return l}(a,u):a,h=u.plainObjects?Object.create(null):{},f=Object.keys(c),p=0;p<f.length;++p){var d=f[p],y=s(d,c[d],u,"string"==typeof a);h=e.merge(h,y,u)}return!0===u.allowSparse?h:e.compact(h)}}function Lo(){if(is)return ns;is=!0;var e=_n;function t(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var r=/^([a-z0-9.+-]+:)/i,n=/:[0-9]*$/,i=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,o=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),s=["'"].concat(o),a=["%","/","?",";","#"].concat(s),l=["/","?","#"],u=/^[+a-z0-9A-Z_-]{0,63}$/,c=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,h={javascript:!0,"javascript:":!0},f={javascript:!0,"javascript:":!0},p={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},d=function(){if(rs)return ts;rs=!0;var e=No(),t=Uo(),r=Mo();return ts={formats:r,parse:t,stringify:e}}();function y(e,r,n){if(e&&"object"==typeof e&&e instanceof t)return e;var i=new t;return i.parse(e,r,n),i}return t.prototype.parse=function(t,n,o){if("string"!=typeof t)throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var y=t.indexOf("?"),g=-1!==y&&y<t.indexOf("#")?"?":"#",b=t.split(g);b[0]=b[0].replace(/\\/g,"/");var m=t=b.join(g);if(m=m.trim(),!o&&1===t.split("#").length){var w=i.exec(m);if(w)return this.path=m,this.href=m,this.pathname=w[1],w[2]?(this.search=w[2],this.query=n?d.parse(this.search.substr(1)):this.search.substr(1)):n&&(this.search="",this.query={}),this}var v=r.exec(m);if(v){var _=(v=v[0]).toLowerCase();this.protocol=_,m=m.substr(v.length)}if(o||v||m.match(/^\/\/[^@/]+@[^@/]+/)){var S="//"===m.substr(0,2);S&&(!v||!f[v])&&(m=m.substr(2),this.slashes=!0)}if(!f[v]&&(S||v&&!p[v])){for(var E=-1,A=0;A<l.length;A++){-1!==(O=m.indexOf(l[A]))&&(-1===E||O<E)&&(E=O)}var I,k;-1!==(k=-1===E?m.lastIndexOf("@"):m.lastIndexOf("@",E))&&(I=m.slice(0,k),m=m.slice(k+1),this.auth=decodeURIComponent(I)),E=-1;for(A=0;A<a.length;A++){var O;-1!==(O=m.indexOf(a[A]))&&(-1===E||O<E)&&(E=O)}-1===E&&(E=m.length),this.host=m.slice(0,E),m=m.slice(E),this.parseHost(),this.hostname=this.hostname||"";var x="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!x)for(var P=this.hostname.split(/\./),T=(A=0,P.length);A<T;A++){var R=P[A];if(R&&!R.match(u)){for(var C="",j=0,M=R.length;j<M;j++)R.charCodeAt(j)>127?C+="x":C+=R[j];if(!C.match(u)){var B=P.slice(0,A),N=P.slice(A+1),U=R.match(c);U&&(B.push(U[1]),N.unshift(U[2])),N.length&&(m="/"+N.join(".")+m),this.hostname=B.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),x||(this.hostname=e.toASCII(this.hostname));var L=this.port?":"+this.port:"",D=this.hostname||"";this.host=D+L,this.href+=this.host,x&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==m[0]&&(m="/"+m))}if(!h[_])for(A=0,T=s.length;A<T;A++){var F=s[A];if(-1!==m.indexOf(F)){var W=encodeURIComponent(F);W===F&&(W=escape(F)),m=m.split(F).join(W)}}var q=m.indexOf("#");-1!==q&&(this.hash=m.substr(q),m=m.slice(0,q));var $=m.indexOf("?");if(-1!==$?(this.search=m.substr($),this.query=m.substr($+1),n&&(this.query=d.parse(this.query)),m=m.slice(0,$)):n&&(this.search="",this.query={}),m&&(this.pathname=m),p[_]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){L=this.pathname||"";var H=this.search||"";this.path=L+H}return this.href=this.format(),this},t.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",r=this.pathname||"",n=this.hash||"",i=!1,o="";this.host?i=e+this.host:this.hostname&&(i=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(i+=":"+this.port)),this.query&&"object"==typeof this.query&&Object.keys(this.query).length&&(o=d.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var s=this.search||o&&"?"+o||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||p[t])&&!1!==i?(i="//"+(i||""),r&&"/"!==r.charAt(0)&&(r="/"+r)):i||(i=""),n&&"#"!==n.charAt(0)&&(n="#"+n),s&&"?"!==s.charAt(0)&&(s="?"+s),t+i+(r=r.replace(/[?#]/g,function(e){return encodeURIComponent(e)}))+(s=s.replace("#","%23"))+n},t.prototype.resolve=function(e){return this.resolveObject(y(e,!1,!0)).format()},t.prototype.resolveObject=function(e){if("string"==typeof e){var r=new t;r.parse(e,!1,!0),e=r}for(var n=new t,i=Object.keys(this),o=0;o<i.length;o++){var s=i[o];n[s]=this[s]}if(n.hash=e.hash,""===e.href)return n.href=n.format(),n;if(e.slashes&&!e.protocol){for(var a=Object.keys(e),l=0;l<a.length;l++){var u=a[l];"protocol"!==u&&(n[u]=e[u])}return p[n.protocol]&&n.hostname&&!n.pathname&&(n.pathname="/",n.path=n.pathname),n.href=n.format(),n}if(e.protocol&&e.protocol!==n.protocol){if(!p[e.protocol]){for(var c=Object.keys(e),h=0;h<c.length;h++){var d=c[h];n[d]=e[d]}return n.href=n.format(),n}if(n.protocol=e.protocol,e.host||f[e.protocol])n.pathname=e.pathname;else{for(var y=(e.pathname||"").split("/");y.length&&!(e.host=y.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==y[0]&&y.unshift(""),y.length<2&&y.unshift(""),n.pathname=y.join("/")}if(n.search=e.search,n.query=e.query,n.host=e.host||"",n.auth=e.auth,n.hostname=e.hostname||e.host,n.port=e.port,n.pathname||n.search){var g=n.pathname||"",b=n.search||"";n.path=g+b}return n.slashes=n.slashes||e.slashes,n.href=n.format(),n}var m=n.pathname&&"/"===n.pathname.charAt(0),w=e.host||e.pathname&&"/"===e.pathname.charAt(0),v=w||m||n.host&&e.pathname,_=v,S=n.pathname&&n.pathname.split("/")||[],E=(y=e.pathname&&e.pathname.split("/")||[],n.protocol&&!p[n.protocol]);if(E&&(n.hostname="",n.port=null,n.host&&(""===S[0]?S[0]=n.host:S.unshift(n.host)),n.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===y[0]?y[0]=e.host:y.unshift(e.host)),e.host=null),v=v&&(""===y[0]||""===S[0])),w)n.host=e.host||""===e.host?e.host:n.host,n.hostname=e.hostname||""===e.hostname?e.hostname:n.hostname,n.search=e.search,n.query=e.query,S=y;else if(y.length)S||(S=[]),S.pop(),S=S.concat(y),n.search=e.search,n.query=e.query;else if(null!=e.search){if(E)n.host=S.shift(),n.hostname=n.host,(x=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=x.shift(),n.hostname=x.shift(),n.host=n.hostname);return n.search=e.search,n.query=e.query,(null!==n.pathname||null!==n.search)&&(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.href=n.format(),n}if(!S.length)return n.pathname=null,n.search?n.path="/"+n.search:n.path=null,n.href=n.format(),n;for(var A=S.slice(-1)[0],I=(n.host||e.host||S.length>1)&&("."===A||".."===A)||""===A,k=0,O=S.length;O>=0;O--)"."===(A=S[O])?S.splice(O,1):".."===A?(S.splice(O,1),k++):k&&(S.splice(O,1),k--);if(!v&&!_)for(;k--;k)S.unshift("..");v&&""!==S[0]&&(!S[0]||"/"!==S[0].charAt(0))&&S.unshift(""),I&&"/"!==S.join("/").substr(-1)&&S.push("");var x,P=""===S[0]||S[0]&&"/"===S[0].charAt(0);E&&(n.hostname=P?"":S.length?S.shift():"",n.host=n.hostname,(x=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=x.shift(),n.hostname=x.shift(),n.host=n.hostname));return(v=v||n.host&&S.length)&&!P&&S.unshift(""),S.length>0?n.pathname=S.join("/"):(n.pathname=null,n.path=null),(null!==n.pathname||null!==n.search)&&(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.auth=e.auth||n.auth,n.slashes=n.slashes||e.slashes,n.href=n.format(),n},t.prototype.parseHost=function(){var e=this.host,t=n.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)},ns.parse=y,ns.resolve=function(e,t){return y(e,!1,!0).resolve(t)},ns.resolveObject=function(e,t){return e?y(e,!1,!0).resolveObject(t):t},ns.format=function(e){return"string"==typeof e&&(e=y(e)),e instanceof t?e.format():t.prototype.format.call(e)},ns.Url=t,ns}function Do(e){if("string"==typeof e)e=new URL(e);else if(!(e instanceof URL))throw new Deno.errors.InvalidData("invalid argument path , must be a string or URL");if("file:"!==e.protocol)throw new Deno.errors.InvalidData("invalid url scheme");return bs?function(e){let t=e.hostname,r=e.pathname;for(let e=0;e<r.length;e++)if("%"===r[e]){let t=r.codePointAt(e+2)||32;if("2"===r[e+1]&&102===t||"5"===r[e+1]&&99===t)throw new Deno.errors.InvalidData("must not include encoded \\ or / characters")}if(r=r.replace(ms,"\\"),r=decodeURIComponent(r),""!==t)return`\\\\${t}${r}`;{let e=32|r.codePointAt(1),t=r[2];if(e<ys||e>gs||":"!==t)throw new Deno.errors.InvalidData("file url path must be absolute");return r.slice(1)}}(e):function(e){if(""!==e.hostname)throw new Deno.errors.InvalidData("invalid file url hostname");let t=e.pathname;for(let e=0;e<t.length;e++)if("%"===t[e]){let r=t.codePointAt(e+2)||32;if("2"===t[e+1]&&102===r)throw new Deno.errors.InvalidData("must not include encoded / characters")}return decodeURIComponent(t)}(e)}function Fo(e){let t=Po.resolve(e),r=e.charCodeAt(e.length-1);(r===ds||bs&&r===ps)&&t[t.length-1]!==Po.sep&&(t+="/");let n=new URL("file://");return t.includes("%")&&(t=t.replace(ws,"%25")),!bs&&t.includes("\\")&&(t=t.replace(vs,"%5C")),t.includes("\n")&&(t=t.replace(_s,"%0A")),t.includes("\r")&&(t=t.replace(Ss,"%0D")),t.includes("\t")&&(t=t.replace(Es,"%09")),n.pathname=t,n}s(Ro,{URL:()=>fs,Url:()=>as,default:()=>os,fileURLToPath:()=>Do,format:()=>ls,parse:()=>hs,pathToFileURL:()=>Fo,resolve:()=>us,resolveObject:()=>cs});var Wo,qo,$o,Ho,Vo,zo,Ko,Go,Qo,Yo,Jo,Xo,Zo,es,ts,rs,ns,is,os,ss,as,ls,us,cs,hs,fs,ps,ds,ys,gs,bs,ms,ws,vs,_s,Ss,Es,As=i(()=>{l(),tt(),Fe(),Sn(),vi(),To(),ko(),Wo=Object.freeze(Object.create(null)),qo={},$o=!1,Ho=typeof globalThis<"u"?globalThis:typeof self<"u"?self:global,Vo={},zo=!1,Ko={},Go=!1,Qo={},Yo=!1,Jo={},Xo=!1,Zo={},es=!1,ts={},rs=!1,ns={},is=!1,(os=Lo()).parse,os.resolve,os.resolveObject,os.format,os.Url,ss=typeof Deno<"u"?"windows"===Deno.build.os?"win32":Deno.build.os:void 0,os.URL=typeof URL<"u"?URL:null,os.pathToFileURL=Fo,os.fileURLToPath=Do,as=os.Url,ls=os.format,us=os.resolve,cs=os.resolveObject,hs=os.parse,fs=os.URL,ps=92,ds=47,ys=97,gs=122,bs="win32"===ss,ms=/\//g,ws=/%/g,vs=/\\/g,_s=/\n/g,Ss=/\r/g,Es=/\t/g}),Is=o((e,t)=>{l(),tt(),Fe(),t.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}}),ks=o(e=>{l(),tt(),Fe(),Object.defineProperty(e,"__esModule",{value:!0}),e.BufferedDuplex=void 0,e.writev=n;var t=qt(),r=(et(),a(Qe));function n(e,t){let n=new Array(e.length);for(let t=0;t<e.length;t++)"string"==typeof e[t].chunk?n[t]=r.Buffer.from(e[t].chunk,"utf8"):n[t]=e[t].chunk;this._write(r.Buffer.concat(n),"binary",t)}var i=class extends t.Duplex{socket;proxy;isSocketOpen;writeQueue;constructor(e,t,r){super({objectMode:!0}),this.proxy=t,this.socket=r,this.writeQueue=[],e.objectMode||(this._writev=n.bind(this)),this.isSocketOpen=!1,this.proxy.on("data",e=>{!this.destroyed&&this.readable&&this.push(e)})}_read(e){this.proxy.read(e)}_write(e,t,r){this.isSocketOpen?this.writeToProxy(e,t,r):this.writeQueue.push({chunk:e,encoding:t,cb:r})}_final(e){this.writeQueue=[],this.proxy.end(e)}_destroy(e,t){this.writeQueue=[],this.proxy.destroy(),t(e)}socketReady(){this.emit("connect"),this.isSocketOpen=!0,this.processWriteQueue()}writeToProxy(e,t,r){!1===this.proxy.write(e,t)?this.proxy.once("drain",r):r()}processWriteQueue(){for(;this.writeQueue.length>0;){let{chunk:e,encoding:t,cb:r}=this.writeQueue.shift();this.writeToProxy(e,t,r)}}};e.BufferedDuplex=i}),Os=o(e=>{l(),tt(),Fe();var t=e&&e.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(e,"__esModule",{value:!0}),e.streamBuilder=e.browserStreamBuilder=void 0;var r=(et(),a(Qe)),n=t(Is()),i=t(Yt()),o=qt(),s=t(dn()),u=ks(),c=(0,i.default)("mqttjs:ws"),h=["rejectUnauthorized","ca","cert","key","pfx","passphrase"];function f(e,t){let r=`${e.protocol}://${e.hostname}:${e.port}${e.path}`;return"function"==typeof e.transformWsUrl&&(r=e.transformWsUrl(r,e,t)),r}function p(e){let t=e;return e.port||("wss"===e.protocol?t.port=443:t.port=80),e.path||(t.path="/"),e.wsOptions||(t.wsOptions={}),!s.default&&!e.forceNativeWebSocket&&"wss"===e.protocol&&h.forEach(r=>{Object.prototype.hasOwnProperty.call(e,r)&&!Object.prototype.hasOwnProperty.call(e.wsOptions,r)&&(t.wsOptions[r]=e[r])}),t}e.streamBuilder=(e,t)=>{c("streamBuilder");let r=p(t);r.hostname=r.hostname||r.host||"localhost";let i=f(r,e),o=function(e,t,r){c("createWebSocket"),c(`protocol: ${r.protocolId} ${r.protocolVersion}`);let i,o="MQIsdp"===r.protocolId&&3===r.protocolVersion?"mqttv3.1":"mqtt";return c(`creating new Websocket for url: ${t} and protocol: ${o}`),i=r.createWebsocket?r.createWebsocket(t,[o],r):new n.default(t,[o],r.wsOptions),i}(0,i,r),s=n.default.createWebSocketStream(o,r.wsOptions);return s.url=i,o.on("close",()=>{s.destroy()}),s};e.browserStreamBuilder=(e,t)=>{c("browserStreamBuilder");let n,i=function(e){let t=p(e);if(t.hostname||(t.hostname=t.host),!t.hostname){if(typeof document>"u")throw new Error("Could not determine host. Specify host manually.");let e=new URL(document.URL);t.hostname=e.hostname,t.port||(t.port=Number(e.port))}return void 0===t.objectMode&&(t.objectMode=!(!0===t.binary||void 0===t.binary)),t}(t).browserBufferSize||524288,s=t.browserBufferTimeout||1e3,a=!t.objectMode,l=function(e,t){let r,n="MQIsdp"===t.protocolId&&3===t.protocolVersion?"mqttv3.1":"mqtt",i=f(t,e);return r=t.createWebsocket?t.createWebsocket(i,[n],t):new WebSocket(i,[n]),r.binaryType="arraybuffer",r}(e,t),h=function(e,t,r){let n=new o.Transform({objectMode:e.objectMode});return n._write=t,n._flush=r,n}(t,function e(t,n,o){if(l.bufferedAmount>i)return void setTimeout(e,s,t,n,o);a&&"string"==typeof t&&(t=r.Buffer.from(t,"utf8"));try{l.send(t)}catch(e){return o(e)}o()},function(e){l.close(),e()});t.objectMode||(h._writev=u.writev.bind(h)),h.on("close",()=>{l.close()});let d=typeof l.addEventListener<"u";function y(){c("WebSocket onOpen"),n instanceof u.BufferedDuplex&&n.socketReady()}function g(e){c("WebSocket onClose",e),n.end(),n.destroy()}function b(e){c("WebSocket onError",e);let t=new Error("WebSocket error");t.event=e,n.destroy(t)}async function m(e){if(!h||!h.readable||!h.writable)return;let{data:t}=e;t=t instanceof ArrayBuffer?r.Buffer.from(t):t instanceof Blob?r.Buffer.from(await new Response(t).arrayBuffer()):r.Buffer.from(t,"utf8"),h.push(t)}return l.readyState===l.OPEN?(n=h,n.socket=l):(n=new u.BufferedDuplex(t,h,l),d?l.addEventListener("open",y):l.onopen=y),d?(l.addEventListener("close",g),l.addEventListener("error",b),l.addEventListener("message",m)):(l.onclose=g,l.onerror=b,l.onmessage=m),n}}),xs={};function Ps(){throw new Error("Node.js net module is not supported by JSPM core outside of Node.js")}s(xs,{Server:()=>Ps,Socket:()=>Ps,Stream:()=>Ps,_createServerHandle:()=>Ps,_normalizeArgs:()=>Ps,_setSimultaneousAccepts:()=>Ps,connect:()=>Ps,createConnection:()=>Ps,createServer:()=>Ps,default:()=>Ts,isIP:()=>Ps,isIPv4:()=>Ps,isIPv6:()=>Ps});var Ts,Rs=i(()=>{l(),tt(),Fe(),Ts={_createServerHandle:Ps,_normalizeArgs:Ps,_setSimultaneousAccepts:Ps,connect:Ps,createConnection:Ps,createServer:Ps,isIP:Ps,isIPv4:Ps,isIPv6:Ps,Server:Ps,Socket:Ps,Stream:Ps}}),Cs=o((e,t)=>{l(),tt(),Fe(),t.exports={}}),js=o(e=>{l(),tt(),Fe();var t=e&&e.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(e,"__esModule",{value:!0});var r=t((Rs(),a(xs))),n=t(Yt()),i=t(Cs()),o=(0,n.default)("mqttjs:tcp");e.default=(e,t)=>{if(t.port=t.port||1883,t.hostname=t.hostname||t.host||"localhost",t.socksProxy)return(0,i.default)(t.hostname,t.port,t.socksProxy,{timeout:t.socksTimeout});let{port:n,path:s}=t,a=t.hostname;return o("port %d and host %s",n,a),r.default.createConnection({port:n,host:a,path:s})}}),Ms={};s(Ms,{default:()=>Bs});var Bs,Ns=i(()=>{l(),tt(),Fe(),Bs={}}),Us=o(e=>{l(),tt(),Fe();var t=e&&e.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(e,"__esModule",{value:!0});var r=(Ns(),a(Ms)),n=t((Rs(),a(xs))),i=t(Yt()),o=t(Cs()),s=(0,i.default)("mqttjs:tls");e.default=(e,t)=>{t.port=t.port||8883,t.host=t.hostname||t.host||"localhost",0===n.default.isIP(t.host)&&(t.servername=t.host),t.rejectUnauthorized=!1!==t.rejectUnauthorized,delete t.path,s("port %d host %s rejectUnauthorized %b",t.port,t.host,t.rejectUnauthorized);let i=function(e){let{host:t,port:n,socksProxy:i,...s}=e;if(void 0!==i){let a=(0,o.default)(t,n,i,{timeout:e.socksTimeout});return(0,r.connect)({...s,socket:a})}return(0,r.connect)(e)}(t);function a(r){t.rejectUnauthorized&&e.emit("error",r),i.end()}return i.on("secureConnect",()=>{t.rejectUnauthorized&&!i.authorized?i.emit("error",new Error("TLS not authorized")):i.removeListener("error",a)}),i.on("error",a),i}}),Ls=o(e=>{l(),tt(),Fe(),Object.defineProperty(e,"__esModule",{value:!0});var t,r,n,i=(et(),a(Qe)),o=qt(),s=ks();e.default=(e,a)=>{if(a.hostname=a.hostname||a.host,!a.hostname)throw new Error("Could not determine host. Specify host manually.");let l="MQIsdp"===a.protocolId&&3===a.protocolVersion?"mqttv3.1":"mqtt";!function(e){e.hostname||(e.hostname="localhost"),e.path||(e.path="/"),e.wsOptions||(e.wsOptions={})}(a);let u=function(e,t){let r="wxs"===e.protocol?"wss":"ws",n=`${r}://${e.hostname}${e.path}`;return e.port&&80!==e.port&&443!==e.port&&(n=`${r}://${e.hostname}:${e.port}${e.path}`),"function"==typeof e.transformWsUrl&&(n=e.transformWsUrl(n,e,t)),n}(a,e);t=wx.connectSocket({url:u,protocols:[l]}),r=function(){let e=new o.Transform;return e._write=(e,r,n)=>{t.send({data:e.buffer,success(){n()},fail(e){n(new Error(e))}})},e._flush=e=>{t.close({success(){e()}})},e}(),(n=new s.BufferedDuplex(a,r,t))._destroy=(e,r)=>{t.close({success(){r&&r(e)}})};let c=n.destroy;return n.destroy=(e,r)=>(n.destroy=c,setTimeout(()=>{t.close({fail(){n._destroy(e,r)}})},0),n),t.onOpen(()=>{n.socketReady()}),t.onMessage(e=>{let{data:t}=e;t=t instanceof ArrayBuffer?i.Buffer.from(t):i.Buffer.from(t,"utf8"),r.push(t)}),t.onClose(()=>{n.emit("close"),n.end(),n.destroy()}),t.onError(e=>{let t=new Error(e.errMsg);n.destroy(t)}),n}}),Ds=o(e=>{l(),tt(),Fe(),Object.defineProperty(e,"__esModule",{value:!0});var t,r,n,i=(et(),a(Qe)),o=qt(),s=ks(),u=!1;e.default=(e,a)=>{if(a.hostname=a.hostname||a.host,!a.hostname)throw new Error("Could not determine host. Specify host manually.");let l="MQIsdp"===a.protocolId&&3===a.protocolVersion?"mqttv3.1":"mqtt";!function(e){e.hostname||(e.hostname="localhost"),e.path||(e.path="/"),e.wsOptions||(e.wsOptions={})}(a);let c=function(e,t){let r="alis"===e.protocol?"wss":"ws",n=`${r}://${e.hostname}${e.path}`;return e.port&&80!==e.port&&443!==e.port&&(n=`${r}://${e.hostname}:${e.port}${e.path}`),"function"==typeof e.transformWsUrl&&(n=e.transformWsUrl(n,e,t)),n}(a,e);return(t=a.my).connectSocket({url:c,protocols:l}),r=function(){let e=new o.Transform;return e._write=(e,r,n)=>{t.sendSocketMessage({data:e.buffer,success(){n()},fail(){n(new Error)}})},e._flush=e=>{t.closeSocket({success(){e()}})},e}(),n=new s.BufferedDuplex(a,r,t),u||(u=!0,t.onSocketOpen(()=>{n.socketReady()}),t.onSocketMessage(e=>{if("string"==typeof e.data){let t=i.Buffer.from(e.data,"base64");r.push(t)}else{let t=new FileReader;t.addEventListener("load",()=>{t.result instanceof ArrayBuffer?r.push(i.Buffer.from(t.result)):r.push(i.Buffer.from(t.result,"utf-8"))}),t.readAsArrayBuffer(e.data)}}),t.onSocketClose(()=>{n.end(),n.destroy()}),t.onSocketError(e=>{n.destroy(e)})),n}}),Fs=o(e=>{l(),tt(),Fe();var t=e&&e.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(e,"__esModule",{value:!0}),e.connectAsync=function(e,t,r=!0){return new Promise((n,i)=>{let o=h(e,t),s={connect:e=>{a(),n(o)},end:()=>{a(),n(o)},error:e=>{a(),o.end(),i(e)}};function a(){Object.keys(s).forEach(e=>{o.off(e,s[e])})}!1===r&&(s.close=()=>{s.error(new Error("Couldn't connect to server"))}),Object.keys(s).forEach(e=>{o.on(e,s[e])})})};var r=t(Yt()),n=t((As(),a(Ro))),i=t(bn()),o=t(dn());"function"!=typeof u?.nextTick&&(u.nextTick=setImmediate);var s=(0,r.default)("mqttjs"),c=null;function h(e,t){if(s("connecting to an MQTT broker..."),"object"==typeof e&&!t&&(t=e,e=""),t=t||{},e&&"string"==typeof e){let r=n.default.parse(e,!0),i={};if(null!=r.port&&(i.port=Number(r.port)),i.host=r.hostname,i.query=r.query,i.auth=r.auth,i.protocol=r.protocol,i.path=r.path,!(t={...i,...t}).protocol)throw new Error("Missing protocol");t.protocol=t.protocol.replace(/:$/,"")}if(t.unixSocket=t.unixSocket||t.protocol?.includes("+unix"),t.unixSocket?t.protocol=t.protocol.replace("+unix",""):!t.protocol?.startsWith("ws")&&!t.protocol?.startsWith("wx")&&delete t.path,function(e){let t;if(e.auth)if(t=e.auth.match(/^(.+):(.+)$/),t){let[,r,n]=t;e.username=r,e.password=n}else e.username=e.auth}(t),t.query&&"string"==typeof t.query.clientId&&(t.clientId=t.query.clientId),o.default||t.unixSocket?t.socksProxy=void 0:void 0===t.socksProxy&&typeof u<"u"&&(t.socksProxy=u.env.MQTTJS_SOCKS_PROXY),t.cert&&t.key){if(!t.protocol)throw new Error("Missing secure protocol key");if(-1===["mqtts","wss","wxs","alis"].indexOf(t.protocol))switch(t.protocol){case"mqtt":t.protocol="mqtts";break;case"ws":t.protocol="wss";break;case"wx":t.protocol="wxs";break;case"ali":t.protocol="alis";break;default:throw new Error(`Unknown protocol for secure connection: "${t.protocol}"!`)}}if(c||(c={},o.default||t.forceNativeWebSocket?(c.ws=Os().browserStreamBuilder,c.wss=Os().browserStreamBuilder,c.wx=Ls().default,c.wxs=Ls().default,c.ali=Ds().default,c.alis=Ds().default):(c.ws=Os().streamBuilder,c.wss=Os().streamBuilder,c.mqtt=js().default,c.tcp=js().default,c.ssl=Us().default,c.tls=c.ssl,c.mqtts=Us().default)),!c[t.protocol]){let e=-1!==["mqtts","wss"].indexOf(t.protocol);t.protocol=["mqtt","mqtts","ws","wss","wx","wxs","ali","alis"].filter((t,r)=>(!e||r%2!=0)&&"function"==typeof c[t])[0]}if(!1===t.clean&&!t.clientId)throw new Error("Missing clientId for unclean clients");t.protocol&&(t.defaultProtocol=t.protocol);let r=new i.default(function(e){return t.servers&&((!e._reconnectCount||e._reconnectCount===t.servers.length)&&(e._reconnectCount=0),t.host=t.servers[e._reconnectCount].host,t.port=t.servers[e._reconnectCount].port,t.protocol=t.servers[e._reconnectCount].protocol?t.servers[e._reconnectCount].protocol:t.defaultProtocol,t.hostname=t.host,e._reconnectCount++),s("calling streambuilder for",t.protocol),c[t.protocol](e,t)},t);return r.on("error",()=>{}),r}e.default=h}),Ws=o(e=>{l(),tt(),Fe();var t,r=e&&e.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),n=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=e&&e.__importStar||(t=function(e){return(t=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t})(e)},function(e){if(e&&e.__esModule)return e;var i={};if(null!=e)for(var o=t(e),s=0;s<o.length;s++)"default"!==o[s]&&r(i,e,o[s]);return n(i,e),i}),o=e&&e.__exportStar||function(e,t){for(var n in e)"default"!==n&&!Object.prototype.hasOwnProperty.call(t,n)&&r(t,e,n)},s=e&&e.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(e,"__esModule",{value:!0}),e.ReasonCodes=e.KeepaliveManager=e.UniqueMessageIdProvider=e.DefaultMessageIdProvider=e.Store=e.MqttClient=e.connectAsync=e.connect=e.Client=void 0;var a=s(bn());e.MqttClient=a.default;var u=s(Dr());e.DefaultMessageIdProvider=u.default;var c=s(mn());e.UniqueMessageIdProvider=c.default;var h=s(sr());e.Store=h.default;var f=i(Fs());e.connect=f.default,Object.defineProperty(e,"connectAsync",{enumerable:!0,get:function(){return f.connectAsync}});var p=s(gn());e.KeepaliveManager=p.default,e.Client=a.default,o(bn(),e),o(ur(),e);var d=cr();Object.defineProperty(e,"ReasonCodes",{enumerable:!0,get:function(){return d.ReasonCodes}})});return o(e=>{l(),tt(),Fe();var t,r=e&&e.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),n=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=e&&e.__importStar||(t=function(e){return(t=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t})(e)},function(e){if(e&&e.__esModule)return e;var i={};if(null!=e)for(var o=t(e),s=0;s<o.length;s++)"default"!==o[s]&&r(i,e,o[s]);return n(i,e),i}),o=e&&e.__exportStar||function(e,t){for(var n in e)"default"!==n&&!Object.prototype.hasOwnProperty.call(t,n)&&r(t,e,n)};Object.defineProperty(e,"__esModule",{value:!0});var s=i(Ws());e.default=s,o(Ws(),e)})()})();
/*! Bundled license information:

@jspm/core/nodelibs/browser/chunk-DtuTasat.js:
  (*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> *)

safe-buffer/index.js:
  (*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> *)

@babel/runtime/helpers/regenerator.js:
  (*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE *)
*/</script></head></html>